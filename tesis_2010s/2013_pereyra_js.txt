ASSIGNMENT PROBLEMS IN MATCHING MARKETS TESIS PRESENTADA POR:
JUAN SEBASTIÁN PEREYRA BARREIRO
PARA OPTAR POR EL GRADO DE DOCTOR EN ECONOMÍA
PROMOCIÓN 2010-2013 DIRECTOR DE TESIS DR. DAVID CANTALA

MÉXICO D.F.

JUNIO 2013

Assignment Problems in Matching Markets i

Agradecimientos
A lo largo de mis estudios doctorales conté con el apoyo de personas e instituciones que hicieron posible la culminación de este proceso. Mi sincero agradecimiento para todos ellos.
En primer lugar, quiero agradecer muy especialmente a David Cantala, mi director de tesis. Gracias a él comencé a interesarme, ya desde el final de la maestría, en los temas que luego desarrollé durante el doctorado. Su dedicación durante todo el proceso de elaboración de este trabajo significó un constante estímulo para encauzar mis intereses académicos, compartiendo generosamente sus conocimientos a la vez que dejándome ahondar en mis inquietudes y estimulando el intercambio con distintos investigadores. Tuve además el gran privilegio de realizar uno de los capítulos de esta tesis bajo la supervisión de Federico Echenique quien además de compartirme sus conocimientos y guiarme en la elaboración del capítulo, apoyó ampliamente mi formación como investigador. A él le agradezco las constantes discusiones que sostuvimos durante la elaboración de todos los capítulos de esta tesis y su genuino interés por colaborar con mi formación durante el doctorado. Debo darle las gracias además por el respaldo en la búsqueda para continuar mi trayectoria académica.
También tuve el privilegio de contar con dos lectores agudos. En Kaniska Dam y Alexander Elbittar encontré profesores siempre ansiosos por aportar a la discusión de distintos aspectos de mi investigación. Gracias a Horacio Sobarzo quien se incorporó en las últimas instancias de este proceso.
Durante todos mis estudios de postgrado fue indispensable la ayuda que recibí de Juan Gabriel Brida, Martín Puchet, Elvio Accinelli y Edgar J. Sánchez Carrera. Sin la ayuda de todos ellos hubiera sido mucho más difícil la culminación de este proceso. En particular quiero agradecer a Gabriel por su incansable apoyo desde ya hace mucho tiempo, sus consejos, y su entrañable amistad.
Los dos primeros capítulos de esta tesis se vieron beneficiados por los excelentes comentarios de Jordi Massó. Fue fundamental su apoyo en todos estos años. Su calidez humana y generosidad son, sin duda, un ejemplo a seguir. Tuve además la suerte de poder contar con la ayuda de Andrés Sambarino y de Serafín Frache cuando las cosas se pusieron difíciles.
iii

Para desarrollar esta investigación fue muy importante la ayuda financiera que me brindaron distintas instituciones. Agradezco al Consejo Nacional de Ciencia y Tecnología por becarme durante los dos años en los que realicé la maestría, y a El Colegio de México a través del Centro de Estudios Económicos por la beca que me concedió durante el doctorado, así como por los fondos para la realización de estancias en universidades en el exterior. En este sentido debo agradecer la hospitalidad que me brindaron en el Departamento de Economía de la École Polytechnique de Paris y en la Division of the Humanities and Social Sciences del California Institute of Technology. Mi estadía en París fue posible además gracias al apoyo de Francis Bloch, y fue muy gratificante la amistad de Rafael Trebich. En California tuve la suerte de conocer a Laura, Helena, Natalia, Emerson y SangMok, quienes hicieron mi estancia mucho más disfrutable.
En el Centro de Estudios Económicos compartí espacios de formación con profesores y compañeros que resultaron sumamente estimulantes para mi actividad académica. En particular, Edwin van Gameren y Manuel Gil Antón me brindaron comentarios muy interesantes al desarrollo de mi trabajo de tesis. De Isidro Soloaga y Raymundo Campos recibí también un apoyo constante. Quiero agradecer a mis compañeros Alma Santillán, Brisna Beltrán, Mariana Pereira, Curtis Huffman, Javier Morales, José Luis Luna, Armando Rosales, Freddy Urbina, Salvador Flores, Pedro Ibarra, Andrés Hincapié, Erick Limas y Jaime Sarmiento. Gracias también a Grisel Ayllón por toda su ayuda.
Agradezco además, a Carolina Palacios Salinas y todos quienes trabajan en la biblioteca del Colmex por el apoyo brindado en la búsqueda de los materiales que necesité.
En Uruguay, distintas personas han colaborado en el desarrollo de mi trabajo de tesis. En el plano académico, agradezco la ayuda de Juan Dubra de la Universidad de Montevideo, de Néstor Gandelman de la Universidad ORT-Uruguay y del Departamento de Economía de la Facultad de Ciencias Sociales de la Universidad de la República. El estímulo académico y emocional de Gastón Cayssials fue indispensable en todo este tiempo. Desde los primeros años de la licenciatura en Uruguay su presencia ha siendo fundamental. Matías Mednik y Alejandro Ortiz, colegas y amigos entrañables, me han demostrado en incontables ocasiones su interés por apoyar mi trabajo
iv

En lo personal y profesional, quiero agradecer a mi gran amiga Mariana Pereira, con quien tuve la suerte y alegría de compartir la maestría y el doctorado.
Mi hermano Rodrigo Puchet fue quien me sugirió hace muchos años en Uruguay pensar en continuar mis estudios en México. Desde ese momento me siento privilegiado de contar con su amistad. Con su infinita generosidad me abrió las puertas de su casa en México, gracias a lo cual pude conocer a Silvia y Martín, Andrea, Caro, Ezra y, un poco después, a Darío. Gracias a todos ellos por hacerme sentir que en México también pueden despeinarte los vientos del Sur. En particular a Martín quiero agradecerle por todo su apoyo en el plano académico y sus consejos, siempre tan oportunos.
Buenos amigos hice en estos años en México. Gracias a ellos por su cariño. Gracias a Melina, Xime, Cris, Iliana, Gabi, Sara María, Chemor, Jorge, Carlos (mi valedor), Ivo, a todos los Puchet y a todos los Dutrénit. En Manuel y Mónica descubrí dos amigos que me acompañarán de ahora en adelante. En particular, gracias Manuel por todo lo que me has enseñado en estos años.
Mis padres, mis hermanos, mi abuela, mi tío y Mili desde Uruguay siempre estuvieron a mi lado en estos cinco años. También tuve la dicha de contar con el soporte de mi “otra” familia: muchas gracias a los Espíndola y a Maqui y a Nenela. Sin ellos esto no podría ni siquiera ser imaginado.
En la base de este trabajo y de todos estos años en México está el amor de Fabiana. Además de alegrías, este trabajo ha significado muchos sacrificios de su parte. Para ella van mis más sinceras gracias por su paciencia y sostén de todos los días, en las buenas, en las malas y en las peores. Cuando el panorama no era claro, fue fundamental saberte a mi lado y escuchar tus consejos. Gracias a tu amor hoy podemos estar cerrando este ciclo, abriendo otro, y seguir disfrutando de la felicidad de estar juntos.
v

Table of Contents

Chapter 1: Introduction

5

Chapter 2: A Dynamic School Choice Model

9

2.1 Introduction

9

2.2 Preliminary deﬁnitions

15

2.2.1 The Model

15

2.2.2 Matchings

16

2.2.3 Acceptability

17

2.3 Existence

22

2.4 A Mechanism

26

2.5 Dynamic Strategy-Proofness

27

2.6 Respecting Improvements

30

2.7 Concluding Remarks

33

2.8 Appendix

37

Bibliography

42

Chapter 3: Housing Markets with Endogenous Budget Constraints

45

3.1 Introduction

45

3.1.1 Existence

46

3.1.2 Mechanisms

49

3.1.3 Related literature

50

3.2 An illustrative example

52

3.3 The model

54

3.3.1 Agents and goods

54

3.3.2 Allocations and prices

55

3.4 Competitive equilibrium

57

3.4.1 Mechanisms

57

3.4.1.1 The Demange, Gale and Sotomayor mechanism

57

3.4.1.2 The top trading cycles with price setting

58

3.4.2 Existence

60

3.5 Strategic questions

66

3.5.1 Strategy-proofness

66

3.5.1.1 The top trading cycles with price setting mechanism

68

3.5.1.2 The extended top trading cycles mechanism

68

3.5.1.3 The Demange, Gale and Sotomayor mechanism

69

3.5.2 Convergence of the DGS mechanism

72

3.6 Concluding remarks

73

3.7 Appendix

74

2

Bibliography

86

Chapter 4: Strategic Uncertainty and Unraveling in Matching Markets

89

4.1 Introduction

89

4.2 Related Literature

92

4.3 The model and results

94

4.3.1 Matching over time: early or late oﬀers

95

4.3.2 Incomplete information

98

4.3.3 Stability of BNE - Uniform F

99

4.3.4 Strategic doctors

101

4.4 A discussion of our model

102

4.5 Proof of Lemma 1

104

4.5.1 Computing B1

105

4.5.2 An algorithm to compute Bm

107

4.6 Proof of Theorem 2

117

4.6.1 Behavior as n → ∞

124

4.7 Proof of Theorem 1

125

4.8 Proof of Theorem 4

126

4.9 Proof of Theorem 3

134

Bibliography

134

3

Chapter 1
Introduction
This thesis is a collection of three essays on assignment problems in matching markets. Each essay is self-contained and can be read in any order chosen by the reader.
The problems analyzed in this thesis lie at the intersection of game theory, social choice theory, and mechanism design. Our main concern is to study the allocation of indivisibles goods (e.g., school seats, houses, hospitals) to diﬀerent agents (e.g., students, buyers, doctors), in a model where each agent has preferences over goods, and each good is endowed with a priority relation over the set of agents. As we shall see, the existence of indivisible goods arises diﬃculties that are no present in the standard model, in which all goods are supposed to be perfectly divisible.
In the ﬁrst two essays our general goal is to investigate, in two diﬀerent models, the existence of allocations that satisfy some desirable properties. The ﬁrst essay focuses on a variant of the well known School Choice Model, where agents may enter and exit the market in diﬀerent periods. In particular, the essay examines the problem of assigning teacher positions to teachers in the Mexican public education system. The second essay studies a situation where each agent owns an indivisible good (e.g., a house) and has a certain amount of money, and seeks to sell her good to buy another. In both essays we analyze some mechanisms to ﬁnd the solutions. We will concentrate on strategy-proof mechanisms; that is, mechanisms with the property that no matter the report of the other agents, an agent can do no better than reporting her preferences truthfully. In the last essay, we adopt a diﬀerent point of view. We take as given the rules of the market, and we explore the reasons that may force some agents to take actions that will produce ineﬃcient outcomes. This last analysis complements the one of the previous chapters: instead of ﬁnding an optimal design of the market, we give a theoretical explanation of why matching markets may not behave as the standard theory predicts.
5

The ﬁrst essay inspires from a real-life assignment problem faced by the Mexican Ministry of Public Education. I introduce a dynamic school choice problem that consists in assigning positions to overlapping generations of teachers. From one period to another, teachers can either retain their current positions or choose a preferred one. In this framework, a solution concept that conciliates the fairness criteria with the individual rationality condition is introduced. It is then proved that a fair matching always exists and that it can be reached by a modiﬁed version of the deferred acceptance algorithm of Gale and Shapley. I also show that the mechanism is dynamically strategy-proof, and respects improvements whenever the set of orders is lexicographic by tenure.
The second essay studies economies with indivisible goods and budget-constrained agents with unit-demand who act as both sellers and buyers. In prior literature on the existence of competitive equilibrium, it is assumed the indispensability of money, which in turn implies that budgets constraints are irrelevant. A new condition, Money Scarcity (MS), is introduced. The condition considers agents’ budget constraints and ensures the existence of equilibrium. Moreover, two mechanisms to ﬁnd a competitive equilibrium are analyzed: an extended version of Gale’s top trading cycles algorithm and of the exact auction mechanism of Demange, Gale and Sotomayor. Under MS, the ﬁrst mechanism is strategy-proof; the second is not. The MS condition is strengthened to guarantee the existence of Nash equilibria in the revelation game induced by the second mechanism, where the outcome coincides with the assignment found by the ﬁrst mechanism; moreover, this assignment is Pareto eﬃcient.
The last essay studies unraveling in labor markets, and in matching markets in general. Unraveling is a phenomenon by which matches are made too early. They are made at a point in time when there is too little information about the quality of a match. In particular, the essay investigates the role of impatience as a factor driving unraveling in two-sided matching markets. A two-period Bayesian game where ﬁrms and workers can contract in either period is considered. In the ﬁrst period qualities are unknown and this uncertainty is resolved just prior to the second period. In order to decide whether or not to make early oﬀers, ﬁrms compare the expected utility of each decision and use their discount factors. The number
6

of ﬁrms that will unravel is unknown since discounts factors are agents’ private information. Moreover, there is a negative externality imposed on the rest of the market by agents who make match early. As a consequence, an agent may make an early oﬀer because she is concerned that others are making early oﬀers. Yet other agents make early oﬀers because they are concerned that others worry about early oﬀers; and so on and so forth. The end result is that any given agent is more likely to make an early oﬀer than a late oﬀer.
7

Chapter 2
A Dynamic School Choice Model
2.1 Introduction
Since David Gale and Lloyd Shapley published their famous paper “College admissions and the stability of marriage” (Gale and Shapley (12)), many authors have studied assignment problems in diﬀerent contexts. Therefore, there is an extensive literature on allocation problems, which primarily considers static models. In contrast, there are many real-life applications where the assignment is made in a dynamic context. Some examples are oncampus housing for college students, in which freshmen apply to move in and graduating seniors leave (Kurino (15)), kidney exchange of patients, in which each agent arrives with an object to trade (U¨ nver (21)), and ﬁrms with workers whose entry and exit lead to a reassignment of ﬁxed resources (Bloch and Cantala (4)). In this paper we study a dynamic version of the well-known school choice model. Speciﬁcally, our model assigns school positions to overlapping generations of teachers. In each period, the central authority must assign positions to teachers, taking into account each school’s priority ranking and the previous matching. From one period to another, teachers can either retain their current positions or choose a preferred one. Hence, the central authority faces a dynamic allocation problem.
The original motivation for this paper is an assignment problem faced by the Mexican Min-
This chapter was written under the supervision of David Cantala. I am very are grateful to him for encouragement and guidance. I also thank Jordi Massso´, Szilvia Papa¨ı, Federico Echenique, Christine Daley, Kaniska Dam, Juan Dubra, Alexander Elbittar, Rafael Treibich, Francis Bloch, Emerson Melo, SangMok Lee, Fuhito Kojima, Edwin van Gameren, Juan Gabriel Brida, Juliana Xavier, Andr´es Sambarino and Rodrigo Velez for their comments and suggestions and the seminar participants at E´cole Polytechnique, Economics Department at Universidad de la Repu´blica de Uruguay and El Colegio de M´exico for discussions.
9

istry of Public Education. In May 2008 the Mexican Federal Government, through the Ministry of Public Education, signed an agreement with the National Education Workers Union called “The Alliance for the Quality of Education”.1 Part of the agreement was the creation of the National Contest for the Allocation of Teaching Positions, a mechanism to assign teachers to teaching positions. As a consequence of this agreement, teachers looking for a position in the public education system are required to sit an exam. According to each teacher’s grade, the central authority ranks teachers and then assigns each a teaching position. Speciﬁcally, under the mechanism used by the central authority, all open positions (that is, positions that are not already assigned) are oﬀered to the ﬁrst teacher in the ranking. Once this ﬁrst ranked teacher chooses a school, remaining open positions are oﬀered to the second teacher, and so on. Moreover, any teacher that had been previously assigned a position may choose to retain it over the new positions that are oﬀered, but if she chooses a new one, her previous position becomes “open”. In Appendix A we present an example with an application of this mechanism. It is worth noting that the algorithm is not a sort of “You-request-my-house-I-get-your-turn” (Abdulkadiro˘glu and So¨nmez (1)) since a position that was assigned to a teacher in a previous period, cannot be asked by another teacher until the teacher who is assigned to it, moves to another position. Thus, the central authority applies a variant of the serial dictatorship mechanism, which takes into account that some teachers are initially assigned a position. In 2012, 134,704 teachers participated in the exam in order to obtain a position.
Cantala (5) shows that the mechanism has some major ﬂaws (see Appendix A for an illustrative example). In particular, a teacher can proﬁt in a period after she enters the market by misrepresenting her preferences. This implies that the mechanism is not dynamically strategy-proof: it can be manipulated by teachers. Another ﬂaw is that the mechanism does not respect improvements made by teachers (Balinski and So¨nmez, (3)), that is, a teacher may increase her order in one school’s priority ranking, but be assigned to a worse position. Finally, Cantala (5) shows that the mechanism is not eﬃcient. In this paper, we study
1More information is available at http://www.concursonacionalalianza.org
10

the described problem within a more general framework in order to cast some light on the resource allocation problem faced by the Mexican Ministry of Public Education.
A central concept in matching theory is stability: a matching is stable if there does not exist any unmatched teacher-school pair (i, s) such that i prefers s to the school that she is assigned to and there exists a teacher assigned to s who has a lower priority at s than i. In school choice models, this concept is usually referred to as the elimination of justiﬁed envy (Abdulkadirog˘lu and S¨onmez (2)) and embodies a notion of fairness. In addition to elimination of justiﬁed envy, since we cannot assign a teacher to a less preferred school than the one where she is teaching, we have to address the individual rationality condition. We present a new solution concept to accommodate these concepts.
In order to deﬁne our solution concept, we consider the claims that could exist in a matching. A teacher has a claim over a school if there exists a school that she prefers over her assignment, and she has higher priority for it than one of the assigned teachers. Note that a matching eliminates the justiﬁed envy if and only if there is no claim in the matching. Moreover, we consider two kinds of claims. If the teacher in the preferred school was not assigned to it in the previous period, we say that it is a justiﬁed claim. On the contrary, if the teacher was assigned to the school in the previous period, the claim is considered inappropriate. Observe that the last type of claim is inappropriate due to the individual rationality restriction. Finally, our solution concept is as follows. We say that a matching minimizes inappropriate claims if:
- it is individually rational, non-wasteful (whenever a teacher prefers a school to her own assignment, that school already has all its positions ﬁlled), and does not have justiﬁed claims; and
- if there are inappropriate claims, the following must hold: there is no other matching that satisﬁes the three previous properties and one inappropriate claim is solved without creating a new one.
11

It is worth noting that Mexican Ministry of Public Education did not propose an explicit fairness concept and, also, that the mechanism which is used by this central authority does not satisfy the last deﬁnition.
In this context, we show that within the set of matchings that minimize inappropriate claims, there is a unique matching Pareto superior to all other matchings. In order to ﬁnd it, a modiﬁed version of the deferred acceptance algorithm of Gale and Shapley is introduced. Before applying the algorithm, we modify each school’s priority ranking by moving teachers who had been assigned to the school in the previous period to the top of the school’s priority ranking.2 With these new orders we deﬁne the related market in which the deferred acceptance algorithm is applied.
A new dynamic version of strategy-proofness is introduced. The classic concept in static matching problems only makes reference to the beneﬁt in one period. Our notion of strategyproofness is dynamic in the sense that it involves not only the period when the teacher enters the market but also all the later periods while she is in the market. In our framework, teachers reveal their preferences in the period in which they enter the market. In the following periods, they cannot modify the announced preferences. We prove that if each school’s priority ranking is lexicographic by tenure, that is, if teachers who were present in the previous period have priority over new teachers, then the proposed mechanism is dynamically strategy-proof. Finally, it is shown under the same condition that the mechanism also respects improvements made by teachers. Our concept of respecting improvements involves not only the period when the teacher improves her position in the ranking (like the classic notion), but also every following period.
Our model assumes that teachers’ preferences are time invariant, that is, teachers reveal their preferences entering the market and do not change from one period to the other. Although the assumption of time-invariant preferences is strong in many real-life applications, we think
2The idea was originally introduced by Guillen and Kesten (13). Compte and Jehiel (7) also use the same idea.
12

that it ﬁts the market studied in the paper. The assumption reﬂects two teachers’ behavioral patterns present in this market. In the ﬁrst place, we know that most teachers that work in rural areas want to settle in a big city. The reason for this behavior is that residing in a big city implies better standards of living and more educational opportunities for teacher’s children.3 Thus, even if a teacher begins to work in a small town, she wants to change the school where she is assigned to in order to be closer to the capital city of the State where she works. In the second place, once a teacher is assigned to a school in a city, changes from one school to another are spare. In this sense, descriptive statistics on Mexico City presented by de Ibarrola et al. (8), support the idea that teachers’ preferences are stable. In Mexico City there are 64,000 teacher positions and in each year 5,500 new positions are created. Therefore, it is possible to change from one school to another. Nevertheless, 82.3% of teachers in Mexico City had their ﬁrst position in that city, 35.3% never changed the school where they started to teach and, another 37.5% changed their appointment no more than three times during their careers. Thus, there is some evidence that teachers’ preferences are stable over time in the Mexican market of public school teachers, although the assumption may not be valid in other markets.4
All the results about the existence of a matching that minimizes inappropriate claims and the proposed mechanism can be easily extended to the case in which the time-invariant preferences assumption does not hold. The extension is straightforward since those results refer to the static problem of our model and thus, they only use the information of the period. When preferences change over time, however, our analysis over strategy-proofness and respecting improvements does not carry over.5
As we mentioned, the literature on matching is mostly devoted to static matching problems (see, for example, the excellent surveys of Roth and Sotomayor (19) and, S¨onmez and U¨ nver
3There are also teachers who want to go back to their home town. We are very grateful with Manuel Gil Anto´n and Rodolfo Ram´ırez for information on this issue.
4It is worth noting that there is no national data about teachers’ preferences. 5See Section 2.7 for a discussion.
13

(20)). Recently, some articles have presented assignment problems in dynamic contexts. Kurino (15) is closest to our model. The author introduces a model of house allocation with overlapping agents and analyzes the impact of orderings on Pareto eﬃciency and strategyproofness. In this sense, it is shown that under time-invariant preferences, orders that favor existing tenants perform better, in terms of Pareto eﬃciency and strategy-proofness, than those that favor newcomers. The concept of an order that favors existing tenants deﬁned by this author is similar to our concept of school’s priority ranking lexicographic by tenure and in relation to the mechanism proposed in this paper, it is a spot mechanism with property-rights transfer, according to Kurino’s classiﬁcation. Nevertheless, there are three main diﬀerences that distinguish our work from Kurino’s (15). In the ﬁrst place, we consider a fairness concept. We are interested in matchings that minimize inappropriate claims because each school’s priority ranking should be taken into account. In the second place, since fairness is a key concept in our analysis, instead of the top trading cycles algorithm studied by Kurino (15), we focus in the deferred acceptance algorithm of Gale and Shapley. Finally, Kurino’s general results about the top trading cycles mechanism are restricted to the case in which agents live two periods. Indeed, in the general case where agents stay in the market for at least three periods, the main properties of the top trading cycles spot rule favoring existing tenants are no longer valid. In contrast, our positive results are valid in the general case.
The rest of the paper is organized as follows. In Section 2, we introduce the ingredients of our model and the main concepts. Section 3 is devoted to the existence of a solution to our problem. In the next section, the proposed mechanism is introduced. Sections 5 and 6 analyze dynamics problems that arise in the model: dynamic strategy-proofness and respecting improvements properties. In Section 7, we present the conclusions and directions for future research.
14

2.2 Preliminary deﬁnitions
2.2.1 The Model
We consider the allocation of teaching positions to overlapping generations of teachers. Time is discrete, starts at t = 1, and lasts forever. In each period, there is a set of schools denoted by S. Each school s ∈ S has qs positions, and in each period, some of them can already be assigned.6 Additionally, we have the null school, denoted by s0, which will be used to assign no school to teachers; we suppose that s0 is not scarce. Denote by It the set of teachers in period t. Note that It changes over time because in each period some teachers may exit the market while new teachers may enter.
Another ingredient of the model is a set of strict priority orders of all teachers, denoted by >t ≡ {>st }s∈S ,which includes one diﬀerent order for each school. When teacher i has priority over j to choose a position in school s in period t, we write i >ts j. We suppose that the relative order of teachers for each school does not change over time, that is, if i >st j at some t, then i >sτ j for all τ such that i, j ∈ Iτ .7.
Each teacher has preferences deﬁned over a single period, and the comparisons of sequences of assignments that are considered are made period by period. Formally, we suppose that preferences over path of schools are time separable.8 Then, each teacher i ∈ It has a complete and transitive preference relation over S ∪ {s0}, denoted by i, and i is the induced strict preference relation over the same set. Teachers reveal their preferences in the period in which they enter. In the following periods their announced preferences remain constant. Let Λ be the domain of admissible preference relations of each teacher. A preference proﬁle at t is an element of the Cartesian product of the set of preferences of all teachers present at t, that is, an element of Λ|It|; we denote by = ( i)i∈It a preference proﬁle at t.9
6We will use also the notation qi to refer to the number of positions of school si. 7As it is common in this type of model, we assume that each school’s priority ranking is responsive (see Roth and Sotomayor (19) for more details) 8See Kurino (15) for a discussion about this assumption. 9Although formal notation would be t, to simplify it we will not use the subindex t.
15

2.2.2 Matchings
A matching at t is an assignment of teachers to schools such that every teacher is assigned one school, and no school has more teachers assigned than positions, i.e., a function µt : It → S ∪ {s0} such that µt−1(s) ≤ qs for each s ∈ S. To indicate that teacher i is matched to school s in period t, we write µt(i) = s. Let Mt be the set of all matchings in period t. A submatching is a matching with restricted domain, i.e., a function νt : J ⊂ It → S ∪ {s0}.
In the initial period, we have a set of teachers (denoted by IE1 ⊂ I1), each of whom is initially assigned to a school. The initial assignment can be considered as a submatching in which each teacher in the set IE1 is matched to her school. Hence, we describe the initial submatching of period 1 as a function ν1 : IE1 → S such that ν1(i) = s if and only if i is initially matched to school s. For any period t ≥ 2, the initial submatching, denoted by νt, is deﬁned by the matching of the previous period; that is, given the matching of the previous period µt−1 and sets S, It, we have νt = µt−1 | IEt with IEt = µ−t−11(S)∩ It.10 Clearly, at each t we have νt−1(s) ≤ qs for all s. Note that It \ IEt is the set of teachers who do not hold positions and are competing to hold one.
Given a matching µt−1, sets S, It, the number of positions in each school {qs}s, the set of strict orders >t= {>st }s , and the preference proﬁle at t , an overlapping teacher placement problem is represented by M t = S, {qs}s , It, µt−1, , >t . Notice that the problem M t deﬁnes the initial submatching of period t, since νt = µt−1 | IEt and IEt = µt−−11(S) ∩ It if t ≥ 2 (for t = 1 we have µ0 ≡ ν1). A solution of an overlapping teacher placement problem is a matching.
A mechanism is a systematic procedure that assigns a matching for each problem; that is, a function ϕ such that ϕ ( S, {qs}s , It, µt−1, , >t ) ∈ Mt, for any problem S, {qs}s , It, µt−1,
, >t . We will often abbreviate notation by omitting most of the arguments and we will write ϕ (It, ) . We believe that this abuse does not confuse and it makes the notation more manageable.
10Here µt−1 | IEt means the restriction of function µt−1 to the set IEt .
16

An economy is deﬁned by the set of schools S and its positions {qs}s, an initial submatching ν1, sequences of sets {It}t , preference proﬁles { }t = {( i)i∈It}t, strict priority orders of all teachers for each school {>t}t and ﬁnally, the mechanism, denoted by ϕ. Note that in the context of our model, the mechanism is included in the economy because the matching in one period links this period with the one following. Speciﬁcally, the matching in one period determines the initial submatching for the next period. Therefore, the mechanism plays the role of a transition rule between periods. Finally, note that an economy deﬁnes the problem of each period.
2.2.3 Acceptability
In this section we deﬁne some properties that a matching should verify. We combine two traditional concepts present in the literature. On the one hand, since there are incumbent teachers in our model, we cannot assign a teacher to a less preferred school than the one where she is teaching. Therefore, a matching should satisfy the individual rationality condition, as deﬁned in Abdulkadirog˘lu and S¨onmez (1). On the other hand, we must respect the strict priority order of all teachers for each school. Hence, a matching should eliminate justiﬁed envy, as deﬁned by Abdulkadirog˘lu and So¨nmez (2).
Consider a period t of the model. The information in that period is given by M t = S, {qs}s , It, µt−1, t, >t . Then, the initial submatching of period t is deﬁned by IEt = µt−−11(S)∩ It and νt = µt−1 | IEt . In order to present the solution concept adopted for the problem M t, we ﬁrst deﬁne the concepts of individual rationality and non-wastefulness:
- A matching is individually rational if no teacher prefers the null school option or the school she was initially assigned to her newly assigned school.
- A matching is non-wasteful if whenever a teacher prefers a school to her own assignment, that school already has all its positions ﬁlled.
Next, we consider the claims that could exist after the matching. We say that a teacher
17

has a claim over a school if she prefers that school over her own assignment and if a lower ranked teacher (in the priority order) has been assigned to that school. Moreover, two kinds of claims may occur. The formal deﬁnitions are the following.
Deﬁnition 1. A matching µt is individually rational if: i) µt(i) i s0, for all i ∈ It, ii) µt(i) i νt(i), for all i ∈ IEt . Deﬁnition 2. A matching µt is non-wasteful if whenever a teacher i ∈ It exists and a school s, such that s i µt(i) then µt−1(s) = qs.
Deﬁnition 3. Given a matching µt, teacher i has a justiﬁed claim over school s if:
i) i prefers s to her assignment: s i µt(i), and
ii) there exists a teacher k assigned to s such that i has priority over teacher k in the school’s ranking, and k was not assigned to s in the previous period; that is: ∃ k ∈ It such that µt(k) = s, i >ts k, and k ∈/ νt−1(s).
We say that a matching eliminates the justiﬁed claims if there is no justiﬁed claim in the matching.
The last deﬁnition takes into account that teacher i has justiﬁed envy of the assignment of teacher k. We deﬁne the claim as justiﬁed because the teacher who is assigned to the preferred school, in the previous period was assigned to another school and thus, she is not an incumbent teacher. Clearly, the existence of justiﬁed claims is an undesirable situation that the solution concept should prevent. Also note that if a teacher in the preferred school was assigned to it in the previous period, the claim is inappropriate, because as an incumbent she has the right to continue in that school.
18

Deﬁnition 4. Given a matching µt , teacher i has an inappropriate claim over school s if:
i) i prefers s to her assignment: s i µt(i), and
ii) there exists a teacher k assigned to s, such that i has priority over teacher k in the school’s ranking, and k was assigned to s in the previous period; that is: ∃ k ∈ It such that µt(k) = s, i >st k, and k ∈ νt−1(s).

We say that a matching eliminates the inappropriate claims if there is no inappropriate claim in the matching.
Let Γ(µt) be the set of all inappropriate claims in matching µt, that is: Γ(µt) = {(i, s) ∈ It×S, such that i has an inappropriate claim over s in µt}.
The usual deﬁnition of a fair matching (also called stable) implies that there are no claims in the matching (neither justiﬁed nor inappropriate). As we note in the next example, for some markets there may not exist a fair matching.

Deﬁnition 5. A matching is fair if it is individually rational, non-wasteful and eliminates both justiﬁed and inappropriate claims.

Example 1. Consider the following problem with S = {s1, s2}, q1 = q2 = 1, It = {i, j}, νt =

{(i, s1)}, and the following preferences (from best to worst) and orders:





ij





 

s1

s1

 





s2 s2

 >t1



 

j



i

 >2t



j

 



i

The unique individually rational matching is:





ij

µt = 

.

s1 s2

19

Note that in this matching teacher j has an inappropriate claim over s1. Thus, there is no fair matching in this market.
The new ingredient in our model is the existence of incumbents whose rights should be considered. Thus, we need to relax the deﬁnition of a fair matching in order to adapt it to our framework. The next deﬁnition enumerates the minimal desirable properties that a matching should verify in order to be a solution to the problem M t.
Deﬁnition 6. A matching is acceptable if it:
i) is individually rational,
ii) is non-wasteful, and
iii) eliminates the justiﬁed claims.
Let Ct ⊂ Mt denote the set of all acceptable matchings.
On the one hand, inappropriate claims should not be considered from a fairness perspective since they do not proceed because of the incumbents’ rights. On the other hand, when an inappropriate claim is solved without creating a new one, the new matching is Pareto superior. Roughly speaking, an inappropriate claim (i, s) can be settled by reallocating teacher i to a school better than s or by changing the teacher who is assigned to s with another teacher with priority for s over i. In this last case, since the new matching should be individually rational, the teacher who was originally assigned to s should be reallocated to a better school. If these modiﬁcations are made such that no other inappropriate claim is created, then the new matching is Pareto superior to the original matching. Thus, from an eﬃciency point of view, is desirable a matching that minimizes the inappropriate claims. The following example points out this remark.11
11The link between inappropriate claims and eﬃciency will be clear after we prove Lemma 2. In that Lemma we prove that if a matching is Pareto superior to another matching, then the set of inappropriate claims of the ﬁrst matching is included in the set of inappropriate claims of the other matching
20

Example 2. Consider the same problem of Example 1, but with the following preference for teacher i: i= (s2, s1). The following matchings are acceptable:





ij

µ1t = 



s1 s2





ij

and µt2 = 

.

s2 s1

Note that Γ(µt2) = ∅ Γ(µt1) = {(j, s1)}. Thus, µt2 solves the claim present in µ1t , without creating a new one. Also note that all agents prefer their assignment in µ2t at least as well as their assignment in µ1t . Therefore, µt2 is Pareto superior to the other matching
We reﬁne the concept of acceptability based on the situation illustrated by the last example. We introduce a new solution concept, minimization of inappropriate claims, which is fair-consistent: if there is a fair matching (i.e., an acceptable matching with no claims), it is selected. In those cases where there is no fair matching (which means that all acceptable matchings have at least one inappropriate claim) the criterion is to minimize the inappropriate claims. If all acceptable matchings have the same inappropriate claims, then all of them are selected. However, if there are two acceptable matchings such that the set of inappropriate claims of one matching is strictly included in the set of inappropriate claims of the other matching (as in the last example), the solution concept chooses the ﬁrst matching. In this situation, the criterion implies that the selected matchings are no Pareto dominated by others matchings. The solution concept is the following.
Deﬁnition 7. A matching µt minimizes inappropriate claims:
i) if it is acceptable, and
ii) there is no acceptable matching µt such that Γ(µt) Γ(µt).
21

If there is an acceptable matching without inappropriate claims (that is, a fair matching) then, by the previous deﬁnition, it minimizes inappropriate claims. Also notice that the concept does not imply a utilitarian perspective.
Although minimization of inappropriate claims is also related with improving eﬃciency, the link is not straightforward. Indeed, a matching that minimizes inappropriate claims could be Pareto dominated by another matching with the same property: if there are no incumbents in the market, all acceptable matchings minimize inappropriate claims, but some of these matchings are Pareto dominated by others. In fact, as we will prove in the next Section, within the set of matchings that minimize inappropriate claims, there is a unique matching Pareto superior to all other matchings.
2.3 Existence
In order to prove the existence of a matching that minimizes inappropriate claims, we introduce the concept of related market. We want to apply the deferred acceptance (DA) algorithm of Gale and Shapley to obtain an individually rational matching. With that purpose, we modify each school’s priority ranking. In each new priority ranking, we have two groups of teachers. The ﬁrst group in the new ranking is the set of teachers who had been assigned to the school in the previous period, and the second is the remaining teachers. Within each group, the order is deﬁned by the original ranking >st . With these new orders, we deﬁne the related market in which the DA algorithm is applied. By Ergin (11) Proposition 1, we know that the outcome of the DA algorithm adapts to the order structure: there is no teacher such that there is a school that she prefers over her assignment, and she has priority for it over one of the assigned teachers. Next, we prove that the DA outcome is an acceptable matching in the original market. Finally, since the set Ct is ﬁnite and not empty, we choose one acceptable matching with the fewer number of claims; then we ﬁnd a matching that minimizes inappropriate claims.
22

Deﬁnition 8. Let M t = S, {qs}s , It, µt−1, , >t be an overlapping teacher placement problem. For each school s ∈ S with priority ranking >st , let’s deﬁne the following order of all teachers, denoted by Ost(M t), in the following way: for each pair i, j ∈ It and s ∈ S, if
1. i, j ∈ νt−1(s) the order is deﬁned by >st , that is i Ost(M t) j ⇔ i >st j, 2. i ∈ νt−1(s) and j ∈/ νt−1(s), then i Ost(M t) j, and 3. i, j ∈ It νt−1(s) the order is deﬁned by >ts, that is i Ost(M t)j ⇔ i >ts j.
Let Ot(M t) = {Ost(M t)}s∈S be the set of all such orders indexed by the school. Then, given a problem M t = S, {qs}s , It, µt−1, , >t , the related market is S, {qs}s , It, , Ot(M t) . We will often abbreviate notation by omitting the argument M t of the new orders Ost.12
Given a problem M t = S, {qs}s , It, µt−1, , >t and the related market S, {qs}s , It, , Ot , we have all elements to apply the DA algorithm of Gale and Shapley (12) to the related market. The algorithm works as follows:
Step 1. Each teacher proposes to her top choice. Each school s rejects all but the best qs teachers among those teachers who proposed to it. Those that remain are “tentatively” assigned one position at school s.
In general,
Step k. Each teacher who is rejected in the last step proposes to her top choice among those schools that have not yet rejected her. Each school s rejects all but the best qs teachers among those teachers who have just proposed and those who were tentatively assigned to it at the last step. Those who remain are “tentatively” assigned one position at school s.
The algorithm terminates when no teacher proposal is rejected. Each teacher is assigned to her ﬁnal tentative assignment.
12The idea of the related market in which position-speciﬁc priorities are modiﬁed was originally introduced by Guillen and Kesten (13).
23

When we apply the DA algorithm, since νt−1(s) ≤ qs, if µt(k) = νt(k) for some k ∈ νt−1(s), then µt(k) k νt(k). That is, using orders Ot(M t) and applying the DA algorithm, we obtain an individually rational matching.
Following Ergin (11), we present the next deﬁnition.
Deﬁnition 9. Given an overlapping teacher placement problem S, {qs}s , It, µt−1, , >t and the related market S, {qs}s , It, , Ot , we say that matching µt violates the priority of i for s, if there is a teacher h such that µt(h) = s, s i µt(i) and i Ost h. The matching µt adapts to Ot if it does not violate any priorities.
The relation between a matching that adapts to Ot and an acceptable matching is straightforward, as we prove in the next lemma.
Lemma 1. Given an overlapping teacher placement problem M t = S, {qs}s , It, µt−1, , >t and the related market S, {qs}s , It, , Ot , a matching is acceptable (relative to the problem M t) if and only if it adapts to Ot (regarding the related market) and it is non-wasteful.
Proof. (⇒) An acceptable matching is, by deﬁnition, non-wasteful. Then, suppose that µt is acceptable but violates the priority of i for s. Then, there is a teacher j such that µt(j) = s, s i µt(i) and i Ost j. We have two cases: i >st j or j >ts i. The latter implies that i was originally assigned to school s, that is i ∈ νt−1(s), but this violates the individual rationality assumption. The ﬁrst implies that both i and j were originally assigned to school s, since µt is an acceptable matching. But, once again, the latter violates the individual rationality assumption for the assignment of i.
(⇐) Suppose that µt adapts to Ot and is non-wasteful, but it is not acceptable. Then we have two cases: µt is not individually rational or there is a justiﬁed claim in µt. In the ﬁrst case, suppose that i is such that s = νt(i) i µt(i). Since matching µt is non-wasteful, we have teacher j, such that j ∈/ νt−1(s) and µt(j) = s. But then, i Ost j, and µt does not adapt
24

to Ot. If there is a justiﬁed claim in µt, we have two teachers i, j and a school s, such that µt(j) = s i µt(i), i >ts j and j ∈/ νt−1(s). But then i Ost j and µt does not adapt to Ot.
Therefore, the problem of ﬁnding an acceptable matching in our original framework is equivalent to ﬁnding a matching that adapts to Ot and is non-wasteful in the related market.
Proposition 1. Given an overlapping teacher placement problem S, {qs}s , It, µt−1, , >t , there is an acceptable matching.
Proof. Given the related market S, {qs}s , It, , Ot , we apply the DA algorithm. It is well known (see Ergin (11), Proposition 1), that the outcome of the algorithm is a matching that adapts to Ot. It is easy to show that the outcome is also non-wasteful. Then, by Lemma 1, we have an acceptable matching in the problem S, {qs}s , It, µt−1, , >t .
Corollary 1. Given an overlapping teacher placement problem S, {qs}s , It, µt−1, , >t , there always exists a matching that minimizes inappropriate claims.
Proof. We know that Ct is nonempty and ﬁnite. For each matching µt ∈ Ct , compute |Γ(µt)| . Therefore, we have a ﬁnite set of real numbers; take µt ∈ Ct such that |Γ(µt)| ≤ |Γ(µt)| , for all µt ∈ Ct. Then, µt minimizes inappropriate claims.
We know that in every problem, there is one matching that minimizes inappropriate claims. One easily ﬁnds examples in which there is more than one matching with this property.
It is a classic result of matching theory that the outcome of the DA algorithm satisﬁes that every agent prefers her partner at this outcome at least as well as the partner of any other acceptable matching. (It is said that the matching is agent-optimal in the subset of acceptable matchings.) Then we know that DA outcome is Pareto superior to any other matching that minimizes inappropriate claims. If we proved that the outcome of the DA algorithm minimizes inappropriate claims, we would prove that it is also the best matching that minimizes inappropriate claims, because it is a well-known result that if preferences are strict,
25

there is only one acceptable matching Pareto superior to any other acceptable matching.13 This is the purpose of the following results.
Lemma 2. Given an overlapping teacher placement problem S, {qs}s , It, µt−1, , >t , consider the outcome of the DA algorithm, denoted by µGt S, when it is applied to the related market S, {qs}s , It, , Ot . Then µGt S minimizes inappropriate claims. (See Appendix for a proof).
Since preferences are strict, we have the following characterization theorem.
Theorem 1. Given an overlapping teacher placement problem S, {qs}s , It, µt−1, , >t , a matching that minimizes inappropriate claims is Pareto superior to
any other matching that minimizes inappropriate claims if and only if it is the outcome of the DA algorithm (applied to the related market).
2.4 A Mechanism
As we have deﬁned, an economy includes a mechanism, because the dynamics of our problem are deﬁned by the relation between the matching of one period and the initial assignment of the following one. We know that the outcome of the DA algorithm is the best matching, in the sense that within the set of matchings that minimize inappropriate claims it is Pareto superior to all other matchings. Then, we have the following deﬁnition.
Deﬁnition 10. The teacher proposing deferred acceptance mechanism is the mechanism that assigns to each overlapping teacher placement problem S, {qs}s , It, µt−1, , >t the outcome of the DA algorithm when it is applied to the related market S, {qs}s , It, , Ot . Deﬁnition 11. The teacher proposing deferred acceptance economy is an economy in which the mechanism is the teacher proposing deferred acceptance mechanism.
13See Ergin (11), Proposition 1, and Balinski and S¨onmez (3), Theorem 2.
26

Deﬁnition 12. A mechanism minimizes inappropriate claims if it always selects a matching that minimizes inappropriate claims. An economy minimizes inappropriate claims if the used mechanism minimizes inappropriate claims.
The previous sections show that if we restrict our attention to economies that minimize inappropriate claims, the best economy in terms of eﬃciency is the teacher proposing deferred acceptance economy. And we also know that essentially it is the unique economy with that property. Hence, we have the following proposition.
Proposition 2. A mechanism minimizes inappropriate claims and is Pareto superior to any other mechanism that minimizes inappropriate claims, if and only if it is the teacher proposing deferred acceptance mechanism.
In the next two sections, we study some dynamic properties of the proposed mechanism.
2.5 Dynamic Strategy-Proofness
Suppose that a new teacher enters the market to compete for a position at time t0. A natural question is whether this new teacher can ever beneﬁt by unilaterally misrepresenting her preferences. If the DA algorithm is used, it is a well-known result that she cannot beneﬁt in period t0 by manipulating her preferences (Dubins and Freedman (9); Roth (18)). But, what can be said about the following periods? Can a teacher beneﬁt, in the following periods, by sacriﬁcing her school in period t0? After some deﬁnitions, we study this issue.
Notation 1. We denote by ϕ [It, ] (i) the school assigned in period t to teacher i under the mechanism ϕ.
Deﬁnition 13. Suppose an economy S, {qs}s , ν1, {It}t , {( i)i∈It}t , {>t}t , ϕ and a teacher i who enters the market at time t0. We say that the mechanism ϕ is dynamically strategyproof if teacher i cannot ever beneﬁt by unilaterally misrepresenting her preferences, that is: ϕ is dynamically strategy-proof if ϕ[It, −i, i] (i) i ϕ[It, −i, i](i) for all i, −i, i
27

and for all t ≥ t0 such that i ∈ It, where −i are the preferences of teachers in the set It {i} .
Remark 1. The classic concept in static matching problems only makes reference to the beneﬁt in one period. In our framework, the concept involves not only the period when the teacher enters the market (and reveals her preferences), but also all the later periods while she is in the market.
It is interesting to note that a mechanism can be strategy-proof (with the usual static deﬁnition) but not dynamically strategy-proof. Appendix A shows a mechanism with this property.

As we remarked in the beginning of this section, when the teacher proposing deferred acceptance mechanism is used and a new teacher enters the market, she cannot beneﬁt in that period by misrepresenting her preferences. In this sense, the mechanism is strategy-proof in the “static” problem. Then, we can wonder if this property is also veriﬁed by the mechanism in a dynamic context. In the next example, we prove that in our dynamic model, the mechanism can be manipulated by teachers.

Example 3. Consider the following problem:

IEt = {j, k} ⊂ It = {i, j, k} , S = {s1, s2, s3} , qi = 1, i = 1, 2, 3, νt = {(j, s2), (k, s3)} , and

the following teacher preferences (from best to worst) and orders:





ijk





 

s2

s3

s2

 





 

s3

s2

s3

 





s1 s1 s1





>t1 >2t >3t





 

i

j

k

 





 

j

k

i

 





kij

Then the outcome of the teacher proposing deferred acceptance mechanism is:





ijk

µt = 



s1 s2 s3

28

For the next period assume: It+1 = {i, j, l},



l



 

s2

 



 

s3

 



s1

The matching in this period is:

 >t1+1



 

i



 

j



l

>2t+1 j i l

 >3t+1



l

 



i

 



j





ijl

µt+1 = 



s1 s2 s3

Suppose that instead of her true preferences, teacher i reveals the following preferences:

i= (s2, s1, s3). Then the matching generated in each period is:





ijk

µt = 



s1 s3 s2





ijl

µt+1 = 



s2 s3 s1

Since µt+1(i) = s2 i µt+1(i) = s1, teacher i can beneﬁt by unilaterally misrepresenting her preferences.
Let’s examine the last example more closely. By revealing other preferences, teacher i can manipulate the initial submatching of period t+1. When she reveals i, teacher j is assigned in period t to school s3. Then j has priority over new teacher l to school s3 even when she is lower ranked than the new teacher. If i reveals her true preferences, new teacher l has priority over j to school s3, then j is rejected from that school and she proposes to s2, causing the rejection of i from that school. It is easy to see that this case is also possible when there is a unique priority order of all teachers, that is: when >st = >t for all s and t. However, as we will prove in the next theorem, if at each school’s priority ranking teachers that were present in the previous period have priority over new teachers, then the teacher proposing deferred acceptance mechanism is dynamically strategy-proof. We ﬁrst deﬁne this property and then we present our positive result.

29

Deﬁnition 14. A set of orders {>st }s∈S is lexicographic by tenure if for all teachers i, j ∈ It, whenever i ∈ IEt , and j ∈/ IEt then i >ts j for all schools s ∈ S.
In an overlapping teacher placement problem S, {qs}s , It, µt−1, , >t in which the set of orders >t= {>st }s∈S is lexicographic by tenure, each order in the related market consists of three groups of teachers. The ﬁrst group in the order is the set of teachers who were assigned to the school; then we have the set of teachers who were assigned to another school in the previous period. Finally, we have the new teachers. Within each group, the order is deﬁned by the original priority ranking >st .
Deﬁnition 15. An economy is dynamically strategy-proof if the used mechanism is dynamically strategy-proof.
Theorem 2. Let S, {qs}s , ν1, {It}t , {( i)i∈It}t , {>t}t , ϕ be the teacher proposing deferred acceptance economy. If in each t the set of orders {>st }s∈S is lexicographic by tenure, then the economy is dynamically strategy-proof.
(See Appendix for a proof).
2.6 Respecting Improvements
In this section, we study another important property of mechanisms, namely, respecting improvements. We say that a mechanism does not respect improvements made by teachers if a teacher may increase her place in one school’s priority ranking, everything else remains unchanged, and yet she is punished with a less preferred assignment (Balinski and So¨mnez (3)). In Appendix A, we present a mechanism that does not respect improvements. In this section, we study whether or not the teacher proposing deferred acceptance mechanism has this property.
Deﬁnition 16. An overlapping teacher placement problem S, {qs}s , It, µt−1, , >˜ st , {>ts}s=s is an improvement for teacher i over another problem S, {qs}i , It, µt−1, , >st , {>ts}s=s ,
30

if i >st j implies that i >˜ st j , and for all teachers k, h diﬀerent from i, we have that h>˜ ts k ⇔ h >st k.
According to Deﬁnition 16, an improvement for a teacher is basically the original placement problem with the only diﬀerence being that the teacher possibly has a higher priority in some school’s priority ranking.
Deﬁnition 17. A mechanism respects improvements if for any teacher i and S, {qs}s , It, µt−1, , >˜ st , {>st }s=s an improvement for that teacher over another problem S, {qs}s , It, µt−1, , >ts , {>st }s=s , the position assigned by the mechanism to teacher i in each period since the improvement (that is, in all periods τ ≥ t) is, for teacher i, at least as good as the position assigned in each period beginning with the problem S, {qs}s , It, µt−1, , >st , {>st }s=s . That is, let µt denote the matching selected by the mechanism in the problem with >ts and µ˜t the selected matching in the problem with >˜ ts . Then the mechanism respects improvements if µ˜τ (i) i µτ (i) for all τ ≥ t.
Remark 2. The comment of Remark 1 also applies to this deﬁnition. Our concept of respecting improvements involves not only the period when the teacher improves her place in the priority ranking (as in the classic notion), but also every following period while she is in the market.
It is worth noting that there is no relation between the properties of respecting improvements and dynamic strategy-proofness. Consider the static problem; on the one hand, the mechanism described in the introduction is strategy-proof but does not respect improvements made by teachers (see Appendix A.1). On the other hand, it is straightforward to ﬁnd a mechanism that respects improvements but is not strategy-proof. Now consider the dynamic problem and a mechanism that is both strategy-proof and respects improvements (in the static problem). We can wonder if there is any relation between both properties in the dynamic problem. One easily ﬁnds examples of mechanisms that satisfy only one of these properties. Hence, there is no relation between these two properties, neither in the static problem nor in the dynamic one.
31

In the next example, we show that the problem described in the previous section also appears with this property.

Example 4. Consider the same problem of Example 3 and suppose another problem with

the same elements, but in which the order of school s3 is: >¯ 3t = (k, j, i). Denote by M t and M¯ t the problem of Example 3 and its modiﬁcation, respectively. Then, problem M t

represents an improvement for teacher i over M¯ t. The outcome of the teacher proposing

deferred acceptance mechanism for each problem is (µt corresponds to the problem M t and

µ¯t to M¯ t):





ijk

µt = 



s1 s2 s3





ijl

µ¯t = 



s1 s3 s2

In the next period, we have >¯ t3+1 = (l, j, i) and the following matchings:





ijk

µt+1 = 



s1 s2 s3





ijl

µ¯t+1 = 



s2 s3 s1

Note that µ¯t+1(i) i µt+1(i). Then, although teacher i improves her position in the ranking of school s3, she is assigned in period t + 1 to a less preferred school.

As we will prove in the next theorem, if the set of orders is lexicographic by tenure, the mechanism respects improvements. Deﬁnition 18. An economy respects improvements if the used mechanism respects improvements.
Theorem 3. Consider a teacher i and S, {qs}s , It, µt−1, , >˜ st , {>st }s=s , an improvement for that teacher over another problem S, {qs}s , It, µt−1, , >ts , {>st }s=s . Denote by µ˜t and µt matchings selected by the teacher proposing deferred acceptance mechanism in each problem. Then µ˜t(i) i µt(i). Moreover, if in each period τ ≥ t the set of orders is lexicographic by tenure, then the teacher proposing deferred acceptance economy respects improvements.

(See Appendix for a proof). 32

2.7 Concluding Remarks
We conclude with a brief discussion about eﬃciency. A matching µt is Pareto eﬃcient (or simply eﬃcient) if there is no other matching that makes all teachers present at t weakly better oﬀ and at least one teacher strictly better oﬀ. A mechanism is eﬃcient if, for any preference proﬁle, it always selects an eﬃcient matching. Then, one can wonder if the mechanism proposed in our model is eﬃcient. We use a result from Ergin (11) to address this question: a cycle for a given priority structure Ot is constituted of distinct schools s, s ∈ S and teachers i, j, k ∈ It, such that i Ost j Ost k Ost i. By Theorem 1 of Ergin (11), we know that the DA mechanism is Pareto eﬃcient if and only if the priority structure is acyclical (that is, the priority structure has no cycle). In our problem, under the assumption that in each period there are at least three teachers, each of whom was assigned to a diﬀerent school in the previous period, the priority structure of the related market Ot always has at least one cycle. Let i, j, k ∈ IEt with νt(i) = s, νt(j) = s and νt(k) = s , then i Ost j Ost k Ost i or i Ost k Ost j Ost i, but in each case there is a cycle. Finally, applying the mentioned theorem, we know that the proposed mechanism is not Pareto eﬃcient. However, it is important to stress that the outcome of DA algorithm is Pareto eﬃcient in the subset of acceptable matchings. Moreover, since within the set of matchings that minimize inappropriate claims, the DA outcome is the unique matching Pareto superior to all other matchings, we have the following result: if in each period there are at least three teachers, each of whom was assigned to a diﬀerent school in a previous period, there is no eﬃcient mechanism that minimizes inappropriate claims.
The last result stresses the classic tradeoﬀ between eﬃciency and fairness (see Abdulkadirog˘lu and S¨onmez (2)). Roughly speaking, one has to choose between one of these properties. In our model, we consider fairness as more important since once a teacher is assigned to a school, she cannot be changed unless she is assigned to a preferred school. In this sense a violation of the fairness condition has consequences in future periods. There are other mechanisms that select Pareto eﬃcient matchings. Gale’s top trading cycles mechanism (described in Abdulkadirog˘lu and So¨nmez (1)) is one of them.
33

In this paper, we have developed a new framework to model a dynamic school choice problem with overlapping generations of teachers. In each period, the central authority must assign teachers to teaching positions. Two elements must be considered in the assignments: the schools’ priority rankings and previous assignments. From one period to another, teachers are allowed either to retain their current position, or to choose a preferred one (if available). Hence, the central authority faces a dynamic allocation problem.
The dynamics of our model are deﬁned by the mechanism. The matching in one period links this period with the following one because it determines the initial submatching for the next period. In this framework, we introduced a new solution concept which is very natural in our context. We have proved that a matching that minimizes inappropriate claims always exists and that it can be reached by a modiﬁed version of the deferred acceptance algorithm of Gale and Shapley. In particular, the algorithm is applied to a related market in which each school’s priority ranking is modiﬁed to obtain an individually rational matching. In relation to the properties of the mechanism, we proved that if the set of orders is lexicographic by tenure, it is dynamically strategy-proof and respects improvements made by teachers.
The mechanism proposed in this paper can be easily implemented in the real-life market since it is based on the DA algorithm which is widely used in practice.14 Also, the mechanism implies an improvement upon the mechanism which is actually applied. Indeed, the teacher proposing deferred acceptance mechanism ﬁxes all the problems that the used mechanism has. As we noted in the Introduction, the mechanism used by the central authority in the problem studied in this paper is an individually rational variant of the serial dictatorship. The outcome of this mechanism may create a situation in which a new teacher has justiﬁed envy in the resulting matching. Indeed, it may happen that a new teacher i prefers the school µt(j) over her assignment and that i has priority over j and j is not an incumbent teacher. This unfair situation is avoided under the mechanism that we propose. Moreover, the outcome of the teacher proposing deferred acceptance mechanism is Pareto superior to any other matching that minimizes inappropriate claims. These two properties additionally to
14See Roth (16) for a list of diﬀerent markets that use the DA algorithm.
34

dynamic strategy-proofness and respecting improvements, promote the proposed mechanism as an excellent substitute to the mechanism actually used. Although we have to convince authorities about the beneﬁts of implementing the teacher proposing deferred acceptance mechanism, the properties that this mechanism has is a promising beginning.
Although the time-invariant preferences assumption ﬁts the analyzed case, it should be reconsidered if one wants to study other markets. In this sense, it is reasonable to suppose that agents’ preferences may evolve by learning and an option which was initially one of the top choices of the agent, in a later period it may lose ranking positions. The same comment applies to the schools’ priority rankings: poorly performing teachers may be ranked below their initial ranking position. An important restriction is the individual rationality: a teacher cannot be assigned to a less preferred school than the one she is teaching and in this sense, she cannot be considered as a new teacher.
The mechanism we propose can be extended to the case where teachers’ preferences may change over time. Indeed, suppose that preferences evolve and in each period, the clearinghouse asks teachers for their preferences. In this framework, the mechanism introduced in this paper allows for exchanges that improve eﬃciency. In particular, suppose that teacher i who was assigned to school s1, with time she prefers s2, while j who is teaching at s2, now prefers s1. By Theorem 1, we know that the outcome of the mechanism is Pareto superior to any other matching that minimizes inappropriate claims. Then, if teachers i and j are allowed to express their new preferences, they may exchange their positions.
However, the concept of strategy-proofness should be reconsidered. First note that if one wants to encompass time-evolving preferences, under the deﬁnition of dynamic strategyproofness stated in the paper, there is no dynamically strategy-proof mechanism that always selects an individually rational and acceptable matching. In this sense, consider the following example.
Example 5. Suppose there are no incumbent teachers in the market, two new teachers (i and
35

j) and two schools. Consider the following preferences and orders:





tt

ij





 

s1

s2

 





s2 s1

 >1t



 

i



j

 >2t



i

 



j

The matching selected by the mechanism is:





ij

µt = 

.

s1 s2

Suppose that in period t + 1, teacher i changes her preferences and prefers school s2 to s1, while teacher j has the same preferences. The unique individually rational matching in t + 1 is µt. But, if i declares in period t school s2 as preferred to s1, then she is assigned to that school in both periods. Therefore, the mechanism is not dynamically strategy-proof, because teacher i beneﬁts in period t + 1 if she reports other preferences

In the last example, we assume that teachers know their future preferences. The study of the case where each agent only knows her current preferences, requires a deeper analysis. Some articles that investigate matching models with incomplete information are: Chakraborty et al. (6), Ehlers and Masso´ (10) and Roth (17). Although the study of a model with incomplete information goes beyond the scope of the present work, Example 3 shows that also in that framework, strategy-proofness requires orders to be lexicographic by tenure. Otherwise, the mechanism can be manipulated by teachers via the initial submatching of the next period.
15

Finally, it would be interesting to study the performance of the proposed mechanism in large markets. In this sense, the model of Kojima and Pathak (14) can be used to analyze the properties of the teacher proposing deferred acceptance mechanism in large markets.
15These manipulations are mainly made by lying about the relative ranking positions of the schools not assigned to the teacher. Note also that overstating the preference for a school to which the teacher is assigned, is not proﬁtable since the individually rational restriction.
36

2.8 Appendix
A.1 The weaknesses of the mechanism used by Mexican Ministry of Public Education.

Suppose there are four schools S = {s1, s2, s3, s4} , each one with only one position and four teachers present in the market at time t : It = {i, j, k, l} . Assume that teachers k and l were

assigned in a previous period to schools s3 and s4, respectively. Teacher preferences (from best to worst) and the ranking are (where h are preferences of teacher h):





ijkl





 

s3

s4

s1

s2

 





 

s1

s2

s3

s3

 





 

s2

s3

s2

s4

 





s4 s1 s4 s1

 >t



 

i

 



 

k

 



 

l

 

 j

That is, teacher i ’s most preferred school is s3, her second choice is s1, and so on. We also have that the ﬁrst teacher in the ranking is i, the second k, the third l, and the last j. If we use the mechanism described in the introduction, the matching in this market is (the school below each teacher is her assigned school):





ijkl

µt = 



s1 s4 s3 s2

Assume that in the next period, teachers k and l exit the market and two new teachers enter. Then we have It+1 = {i, j, m, n} , >t+1= (m, i, n, j). The preferences of new teachers

are m= (s1, s3, s4, s2) and n= (s2, s4, s1, s3). Then, the outcome of the mechanism is:





i j mn

µt+1 = 



s1 s4 s3 s2

Next we will show how a teacher can beneﬁt by manipulating her preferences. Suppose that instead of her true preferences, teacher i reveals the following preferences: i= (s3, s2, s1, s4).

37

Hence, the outcome of the mechanism in each period is:





ijkl

µt = 



s2 s4 s1 s3





i j mn

and µt+1 = 



s3 s4 s1 s2

Note that µt+1(i) i µt+1(i), and then teacher i beneﬁts in period t + 1 by misrepresenting her preferences. Hence, the mechanism is not dynamically strategy-proof. The second ﬂaw

we will illustrate is that the mechanism does not respect improvements made by teachers. Suppose that teacher i, instead of being the ﬁrst in the ranking >t, has a worse performance

and she is the second in the ranking. Speciﬁcally, assume that at period t the ranking of teachers is: >˜ t = (k, i, l, j). Then the outcome of the mechanism is:





ijkl

µ˜t = 



s3 s4 s1 s2

Therefore, it is better for teacher i to have a lower order in the ranking, because if she increases her position in the ‘priority order,’ like in >t, she will be punished with a worse position.

A.2 Proof of Lemma 2

Proof. If Γ(µGt S) = ∅, the proof is complete. Otherwise, we already know that µtGS is acceptable. Suppose that it does not minimize inappropriate claims; then, we have another acceptable matching µt, such that Γ(µt) Γ(µGt S). Since µtGS is Pareto superior to µt : µtGS(i) i µt(i) ∀i and there is a teacher h such that µGt S(h) h µt(h). We claim that in this case Γ(µtGS) ⊂ Γ(µt), but this contradicts the last relation. Suppose there is a pair (i, s) ∈ It × S, such that (i, s) ∈ Γ(µtGS) but (i, s) ∈/ Γ(µt). Then we have a teacher j, such that µtGS(j) = s i µGt S(i) = s , i >st j and j ∈ νt−1(s). As (i, s) ∈/ Γ(µt), we have two cases: µt(i) i s or j ∈/ µt−1(s). The ﬁrst case implies µt(i) i s i µtGS(i), but it is not possible since µGt S is Pareto superior to all acceptable matchings. In the second case, it must be µGt S(j) = s = νt(j) j µt(j), but then µt is not individually rational. Finally, we prove that Γ(µtGS) ⊂ Γ(µt).
38

A.3 Proof of Theorem 2
Proof. The proof of the theorem is built on the following observation.
Let Itt be the set of teachers at period t who joined the market at period t ≤ t. If the priority structure is lexicographic by tenure, the outcome of the teacher proposing deferred acceptance mechanism becomes the same as the outcome of the following procedure:
Step 0: Teachers in I0t propose to schools under DA (using the strict priority >st of each school s) and a matching is produced. The capacities of the schools are updated by subtracting the positions that are ﬁlled.
Step t ≤ t: Teachers in Itt propose to schools (with their unﬁlled capacities) under DA (using the strict priority >st of each school s) and a matching is produced. The capacities of school are updated by subtracting the positions that are ﬁlled.
To prove the equivalence between the previous procedure and the teacher proposing deferred acceptance mechanism, ﬁx a period t, a school s and two teachers i and j. We have two cases to study: both teachers joined the market at the same period or one of them, say i, joined before j. In the ﬁrst case, suppose i >ts j. Then, the strict priority order of school s used by each mechanism can be diﬀerent if and only if, teacher j was assigned to school s at the previous period and i was assigned to another school. In the second case we have a similar situation, teacher i has priority for all school over j in the alternative mechanism while in the teacher proposing deferred acceptance mechanism j has priority over i if and only if j was assigned to s in t − 1 and i was not. In both cases we will prove that teacher i does not propose to school s when the teacher proposing deferred acceptance mechanism is used. Since this mechanism selects an individually rational matching, it is enough to prove that µt−1(i) i s. Suppose, to the contrary, that s i µt−1(i) and be l the period when teacher j was assigned to school s. Then we have µl(j) = s i µl(i) and also i >sl j since orders are lexicographic by tenure; but this implies that the matching is not acceptable, a contradiction.
39

Then, once priorities are assumed to be lexicographic by tenure, at period t a teacher in Itt only competes with other teachers in the same set. Teachers in Itt , by changing their reported preferences, cannot inﬂuence, in the described procedure, which positions at schools remain after Step t − 1. To complete the proof just note that when a teacher competes with other teachers that enter in the same period that she enters, strategy-proofness is a direct consequence of the classic results from Dubins and Freedman (9) and Roth (18).
A.4 Proof of Theorem 3
Proof. For the ﬁrst period, the result is similar to the one presented in Balinski and S¨omnez (3), Theorem 5. For the sake of completeness, we include the adapted proof. Fix a problem M t = S, {qs}s , It, µt−1, , >st , {>ts}s=s and another problem M˜ t = S, {qs}s , It, µt−1,
, >˜ st , {>st }s=s , that represents an improvement for teacher i. Let µt denote the matching selected by the teacher proposing deferred acceptance mechanism in the problem M t and µ˜t the one selected in the problem M˜ t.
We shall prove that µ˜t(i) i µt(i). Suppose that µt(i) i µ˜t(i) and let µt(i) ≡ s1. Denote by O˜t the set of strict priority orders in the related market for the problem M˜ t. In the related market of each problem, we know that Ost = O˜st for all s = s , j Ost k ⇐⇒ j O˜st k (with j, k = i), if i Ost k then i O˜st k and if j O˜st i then j Ost i.
First, note that µt does not adapt to O˜t because we know that µ˜t is Pareto superior to any other matching that minimizes inappropriate claims. Suppose that teacher i announces the following preferences i: s1 i s0 i s for all s = s1 and consider the following problem
j=i, i, >˜ ts , {>ts}s=s , that is, problem M˜ t which represents an improvement for teacher i but with the preferences deﬁned before. We will prove that µt is a matching that minimizes inappropriate claims in the problem j=i, i, >˜ st , {>ts}s=s .
Claim 1: µt is individually rational. As µt is individually rational in the problem M t,
40

then for any teacher j = i that reveals the same preference in both problems we have µt(j) jµt−1(j) if j ∈ IEt or µt(j) js0 if j is a new teacher, and teacher i is assigned to her top school.
Claim 2: µt adapts to O˜t. Matching µt cannot violate the priority of a teacher diﬀerent to i, otherwise the same priority would be violated by µt in the problem M t. Indeed, suppose there is a teacher j = i and a school s such that s j µt(j) and j O˜st h with µt(h) = s. But then s j µt(j) and j Ost h with µt(h) = s and µt is not an acceptable matching in the problem M t. Clearly, matching µt cannot violate any priority of i because she is assigned to her top school.
Claim 3: The school assigned to teacher i by the teacher proposing deferred acceptance mechanism in the problem j=i, i, >˜ st , {>st }s=s is s1. To prove this claim just note that the DA algorithm satisﬁes that every teacher prefers his assigned school at this outcome at least as well as the school that she is assigned in any other matching that minimizes inappropriate claims and in µt, which minimizes inappropriate claims in this problem, teacher i is assigned to her top school s1.
Claim 4: In the problem M˜ t teacher i can beneﬁt by misrepresenting her preferences. Indeed, if i announces her true preferences, she is assigned to school µ˜t(i), but when she announces preferences i, she is assigned to µt(i) i µ˜t(i). Then the teacher proposing deferred acceptance mechanism is not strategy-proof, a contradiction.
Since the observation made in the last proof, the proof for the following periods is straightforward. An improvement for a teacher in Itt does not inﬂuence, in the alternative procedure, which positions at schools remain after Step t − 1. Then, given that in each period a teacher only competes with teachers that enter the market in the same period that she entered, if the teacher improves her place in one school’s priority ranking, the teacher proposing deferred acceptance mechanism will not assign her to a less preferred school.
41

References
[1] Abdulkadiro˘glu, A., S¨onmez, T., 1999. House allocation with existing tenants. J. Econ. Theory. 88, 233-260.
[2] Abdulkadiro˘glu, A., S¨onmez, T., 2003. School choice: A mechanism design approach. Amer. Econ. Rev. 93 (3), 729-747.
[3] Balinski, M., S¨onmez, T., 1999. A tale of two mechanisms: Student placement. J. Econ. Theory. 84, 73-94.
[4] Bloch, F., Cantala, D., 2013. Markovian assignment rules. Soc Choice Welf. 40, 1-25.
[5] Cantala, D., 2008. Eﬁciencia y justicia en la administracio´n publica: la educacio´n en M´exico. Mimeo El Colegio de M´exico.
[6] Chakraborty, A., Citanna, A., Ostrovsky, M., 2010. Two-Sided Matching with Interdependent Values. J. Econ. Theory. 145, 85-105.
[7] Compte, O., Jehiel, P., 2008. Voluntary participation and re-assignment in two-sided matching. Working paper.
[8] de Ibarrola, M., Sillva Ruiz, G., Castel´an Cedillo, A., 1997. Qui´enes son nuestros profesores. Fundacio´n SNTE para la Cultura del Maestro Mexicano A.C.
[9] Dubins, L., Freedman, D., 1981. Machiavelli and the Gale Shapley algorithm. Amer. Math. Monthly. 88, 485-494.
[10] Ehlers, L., Mass´o, J., 2012. Matching Markets under (In)complete Information. Working Paper.
[11] Ergin, H., 2002. Eﬃcient resources allocation on the basis of priorities. Econometrica. 70 (6), 2489-2497.
[12] Gale, D., Shapley, L., 1962. College admissions and the stability of marriage. Amer. Math. Monthly. 69, 9-15. 42

[13] Guillen P., Kesten, O., 2012. Matching Markets with Mixed Ownership: The Case for a Real-life Mechanism. Int. Econ. Rev. 53 (3), 1027-1046.
[14] Kojima, F., Pathak,P., 2009. Incentives and Stability in Large Two-Sided Matching Markets. Amer. Econ. Rev. 99, 608-27.
[15] Kurino, M., 2011. House allocation with overlapping generations. Maastricht University RM/11/032.
[16] Roth, A., 2008. Deferred acceptance algorithms: history, theory, practice, and open questions. Int. J. Game Theory. 36, 537-569.
[17] Roth, A., 1989. Two-Sided Matching with Incomplete Information about Others’ Preferences. Games Econo. Behav. 1, 191-209.
[18] Roth, A., 1982. The economics of matching: Stability and incentives. Math Oper Res. 7, 617-628.
[19] Roth, A., Sotomayor, M., 1990. Two-sided matching: A study in game-theoretic modeling and analysis. Cambridge University Press, Cambridge.
[20] S¨onmez, T., U¨ nver, U., 2009. Matching, allocation, and exchange of discrete resources. Jess Benhabib, Alberto Bisin, and Matthew Jackson (eds.). Handbook of Social Economics. Elsevier.
[21] U¨ nver, U., 2010. Dynamic kidney exchange. Rev. Econ. Stud. 77 (1), 372-414.
43

Chapter 3
Housing Markets with Endogenous
Budget Constraints
3.1 Introduction
This paper is aimed at studying economies with indivisible goods and budget-constrained agents with unit-demand who act as both sellers and buyers. Important examples of markets with indivisible goods include housing and automobile markets, the market for video games, and collectors’ markets (e.g., ﬁne art, stamps). The single unit-demand assumption best applies to a housing market where agents own a house and have a certain amount of money, and seek to sell their house to buy another. In this market, budget constraints are endogenous because each agent’s total resources depend on the selling price of her house. Thus, agents endowed with an indivisible good, endogenous budget constraints and unit-demands, are important features of housing markets.
Recently, Milgrom (15) presented a model which extends the Assignment Game of Shapley and Shubik (20) in three important ways: agents may buy or sell multiple types of goods simultaneously, they may trade any integer number of units of each type of good and they may buy some goods and sell other. However, as the author asserts, the assignment message
This chapter was written under the supervision of David Cantala. I am very are grateful to him for encouragement and guidance. I also thank Atila Abdulkadirog˘lu, Grisel Ayllo´n, Kaniska Dam, Juan Dubra, Federico Echenique, Alexander Elbittar, Paula Jaramillo, C¸ ag˘atay Kayı, Jordi Mass´o, Herv´e Moulin, Antonio Nicol`o and Rodrigo A. Velez for their comments and suggestions and seminar participants at UAB, El Colegio de M´exico, Universidad de Montevideo, Rice, Texas A&M and XIII Latin-American Workshop in Economic Theory for discussions.
45

space used in his model does not allow buyers to express directly a budget limit. Additionally, Milgrom argues that the case of indivisible goods is relevant because: “Even when goods are perfectly divisible, contracts are often denominated and traded in whole numbers of units, so the ability to respect integer constraints may be useful even in those applications.”16
The contribution of the paper is twofold. First, we explore the existence of competitive equilibrium, complementing the analysis of Quinzii (17). Second, we extend and study two classical mechanisms, the exact auction mechanism of Demange, Gale and Sotomayor (6) and the top trading cycles with price setting.
3.1.1 Existence
In the literature on economies with indivisible goods, a widely-used assumption is the indispensability of money (IM). This condition, originally stated by Quinzii (17), says that agents should retain some of their initial amount of money in order to attain a utility level higher than their initial one. According to Quinzii (17), under the IM condition, competitive equilibrium exists. At equilibrium, an agent either trades and, under the IM assumption, keeps some of her endowment in money, which implies that her budget constraint does not bind; or she does not trade, in which case money restriction is irrelevant. Thus, under the IM condition, budget constraints never bind and then, previous studies that adopt the condition do not consider eﬀective budget constraints.
Let us examine the IM condition more closely. In the ﬁrst place, it implies, as Wako (24) asserts, that there is no active exchange unless some agents have divisible goods (money). However, in some markets without money, for example the housing market of Shapley and Scarf (19), there exists a competitive equilibrium which can be found by the top trading cycles algorithm. In the second place, as we just mentioned, under that assumption each agent’s budget constraint does not bind, which is far from reality, in particular in housing markets.
16Milgrom (15), page 96.
46

Two main problems arise when the IM does not hold. First, the existence of competitive equilibrium is not guaranteed. Second, even if a competitive equilibrium exists, there is no adequate mechanism to ﬁnd it. The Exact Auction Mechanism of Demange, Gale and Sotomayor (6), which ﬁnds an equilibrium in the classic Assignment Game, when it is applied to some of the economies considered in this article, prices rise indeﬁnitely and the algorithm does not stop.17
The diﬀerence in valuations of goods is the yardstick for evaluating if there is a lot or little money in the economy. If for any agent, the amount of money she owns is larger than any of her diﬀerences, there is abundance of money. Scarcity, on the contrary, is evaluated at the aggregate level. Roughly, money is scarce if the summation of money in the economy is smaller than any diﬀerence in valuations, for any agent.
At equilibrium prices, no good is overdemanded. When agents are rich enough, the mechanism of Demange, Gale and Sotomayor (6) always produces an equilibrium by increasing prices of goods which are minimally overdemanded, and holding others constant. The idea is simply to make agents indiﬀerent between an increasing numbers of goods. Once indiﬀerences are suﬃciently widespread in the economy, all agents can be assigned one of her top choices, meaning that an equilibrium exists. The procedure does not extend when agents face budget constraint since rising prices might lead some demand to disappear.
When money is suitably scarce, prices cannot raise suﬃciently 1) to make agents indiﬀerentso that we keep a lot of heterogeneity in the economy- 2) to make an agent switch from her top aﬀordable choice for a very cheap but less preferred good. Thus, the main source of richness is the endowment of good, and the assignment produced by TTC is an equilibrium assignment.
17Since the model we study diﬀers from the Assignment Game analyzed by Demange, Gale and Sotomayor (6), their mechanism is not the one used in this paper. However, since we apply the algorithm stated by these authors, we abuse notation by referring as Demange, Gale and Sotomayor mechanism the application of their algorithm in our model.
47

The central conditions analyzed in this paper are the Money Scarcity (MS) and its Strong (SMS) and Weak (WMS) versions. The key components of these concepts include one related to the scarcity of money and other related to the number of steps in the top trading cycles algorithm. Formally, if the top trading cycles algorithm consists of k steps, the WMS condition says that the diﬀerence between each agent’s valuation for two goods should be greater than or equal to the sum of the initial amount of money held by the rest of agents, plus k − 1. Thus, the condition requires that each agent should consider goods as heterogeneous, and is independent of the agent’s endowment in money and also of the initial distribution of money. The MS condition is slightly stronger: it takes into account the total amount of money, including the agent’s endowment. Finally, the strong version replaces the number of steps in the top trading cycles algorithm with the total number of agents. Whereas the IM can be viewed as an assumption of abundance of money in the economy, these conditions assume the opposite.
The WMS condition ensures the existence of competitive equilibrium: an allocation of goods to agents and a price vector such that all goods are assigned to one and only one agent who demands it, and each agent satisﬁes her budget constraint. The intuitive understanding behind this result is the following. The assignment of goods is found by the top trading cycles algorithm, which deﬁnes a partition of the set of agents; each subset consists of agents that exit the market in the same step of the algorithm (although they might belong to diﬀerent trading cycles). In order to ﬁnd a competitive equilibrium, prices are set according to the step at which goods leave the market: goods that leave ﬁrst have a higher price.18 But each agent’s endowment in money should also be considered. Then, all goods that leave the market in the last step are assigned a price of zero; for goods that leave in step t, the assigned price is the highest endowment in money of agents that leave the market in step t + 1, plus the price assigned in that step, plus one. This method implies that goods with the highest price are those that leave the market in the ﬁrst step. The WMS condition guarantees that this procedure deﬁnes a competitive equilibrium since no agent has incentives to sell her
18The idea is adopted from Shapley and Scarf (19)
48

good and buy another with lower price and, although an agent may prefer another good over the one she is assigned to, she cannot aﬀord it. Thus, Quinzii’s result on the existence of competitive equilibrium is extended to cases where the IM does not hold and utility functions are quasi-linear.
3.1.2 Mechanisms
Two mechanisms are considered to ﬁnd a competitive equilibrium which are extended versions of the top trading cycles algorithm, and of the Exact Auction Mechanism of Demange, Gale and Sotomayor (6). When agents’ endowment in money are common knowledge, the extended version of the top trading cycles is strategy-proof under the MS condition; this result means that truthful revelation is a weakly dominant strategy for each agent in the preference revelation game induced by this mechanism. Then, we show that the mechanism of Demange, Gale and Sotomayor does not satisfy that property, and a set of Nash equilibria for the revelation game induced by this mechanism is found. Using the SMS condition we obtain this result, specifying a link between the mechanisms, since the assignment of goods in a Nash equilibrium coincides with the assignment found by the extended version of the top trading cycles mechanism, and it is thus Pareto eﬃcient.
Finally, we identify certain conditions under which the mechanism of Demange, Gale and Sotomayor ﬁnds a competitive equilibrium. It is shown that under the MS condition, this mechanism always ﬁnds a competitive equilibrium in a market with three agents, but may fail in a more general setting. Then, we posit a stronger condition for each agent’s valuations in order to show the convergence of the mechanism to a competitive equilibrium in the general case.
An important ﬁeld of application for these mechanisms is on-campus housing at universities. In this problem, a number of dormitory rooms has to be allocated to a group of students; there are existing tenants (students who are occupants of a room), new applicants, and vacant rooms. Abdulkadirog˘lu and So¨nmez (1) ﬁrst studied this problem. They introduce
49

a class of mechanisms to ﬁnd an assignment: the top trading cycles mechanisms. The literature assumes that rents are exogenously given (see Miyagawa (16), Kesten (11) and, So¨nmez and U¨ nver (21)).19 Suppose the following situation. Incoming freshmen arrive and each one is assigned to an available room (according to the assignment policies of the central clearinghouse). Then, some of these students or some existing tenants may want to exchange their rooms. We introduce a mechanism which, based on the cardinal utility of each student, ﬁnds the reassignment of rooms to students and the rent of each room. Moreover, the price vector and the new assignment is a competitive equilibrium at which no student pays a higher rent than in the initial assignment. The mechanism is strategy-proof, and thus there is no point in misrepresenting preferences.
3.1.3 Related literature
Shapley and Shubik (20) introduce the Assignment Game under the assumptions that there is a bipartition in the set of agents, sellers and buyers, and that no agent has ever problems to “pay the bill”. The authors analyze, in the ﬁrst place, the core of the economy; that is, those allocations of goods such that no coalition of agents can ﬁnd another allocation which is preferred by all its members, and, in the second place, the set of competitive equilibria. They prove that the core is nonempty and its equivalence with the set of competitive equilibria. In the same line, Shapley and Scarf (19) present a model without money in which each agent owns one indivisible good and wants to exchange it for another. They show that the market has nonempty core and at least one core allocation can be decentralized as a competitive equilibrium (and thus, there is a competitive equilibrium of the model). This last result is proved using an algorithm called the top trading cycles, due to David Gale.
Quinzii (17) presents a model that embeds the two previous models. In her article there are two types of agents, those that have an endowment consisting in one indivisible good and a
19Miyagawa (16), for instance, studies the house allocation problem and, although monetary transfers are allowed, the price of each object is ﬁxed in advance.
50

certain amount of money and those that only have money. She proves that the core of the market is not empty. To show the equivalence of the core and the set of competitive equilibria, Quinzii (17) supposes that the IM condition holds.20 The condition can be understood as abundance of money: if agents initially have a lot of money, they would not give up all of their money to buy any object. Since Quinzii (17) many articles have worked under this assumption, for instance: Lars-Gunnar (13), van der Laan et al. (23), Bevia´ et al. (4), Yang (25), Saitoh (18) and Hwang and Shih (10).
Wako (24) allows for scarcity of money and studies the strong core of the economy; that is, those allocations such that no coalition of agents can ﬁnd another allocation at which no member is worse oﬀ and at least one of them is strictly better oﬀ. He shows that the strong core always coincides with the set of competitive equilibria. However, if the IM assumption does not hold, both the strong core and the set of competitive equilibria can be strictly included in the core and also can disappear in some cases. Thus, the assumption is crucial to guarantee the existence of a competitive equilibrium.
A closely related work is Demange, Gale and Sotomayor (6), which studies the Assignment Game of Shapley and Shubik (20). The paper introduces a dynamic auction mechanism, named the Exact Auction Mechanism, to ﬁnd a competitive equilibrium. It is shown that prices obtained by the mechanism are the minimum equilibrium prices. Also, it is well-known that the mechanism is strategy-proof (Demange and Gale (5)). This paper discusses on the extension of this mechanism to Quinzii’s model in which budget-constrained agents act as both sellers and buyers.
The model that we study is a special case of the one presented by Quinzii (17). In the ﬁrst place, we assume that all agents initially own one indivisible good and a certain amount of money. In Quinzii’s model there are also agents that only have money and do not own any good. In the second place, we assume quasi-linear utility functions while Quinzii allows for general utility functions, although continuous and non decreasing with respect to the quantity
20The same results, but using diﬀerent arguments, are showed by Gale (7)
51

of money. Finally, we restrict our attention to the integer case. The main diﬀerence from Quinzii (17) is that the IM is not assumed.
The rest of the paper is laid out as follows. The next section presents an example of the problems addressed in the paper. Section 3 sets up the model and introduces the main concepts. Section 4 describes the two mechanisms that are analyzed and presents the main condition that guarantees the existence of a competitive equilibrium. The following section studies some strategic properties of the two mechanisms introduced before. Section 6 concludes.
3.2 An illustrative example
This section presents an example that illustrates the main problems studied in the rest of the paper. Suppose an economy with four agents: {a1, a2, a3, a4}, and four indivisible goods: {g1, g2, g3, g4}. Each agent initially owns one good and a certain amount of money. The valuation of each agent for each good and her initial amount of money is given by the following matrix (the element in the ith row and the jth column, denoted by αij, is the valuation of agent i for good j and the last column is the initial amount of money owned by each agent).
g1 g2 g3 g4 ω a1 1 10 19 28 4 a2 1 11 21 31 3 a3 1 34 23 12 2 a4 25 37 13 1 1
Assume that agent ai initially owns good gi and her utility by holding an amount of money m and good gj is, αij + m. Suppose that each agent has no use for more than one indivisible good. This example is included in the model analyzed by Quinzii (17). However, note that the example does not satisfy the IM condition. Indeed, agent a1 by holding good g2 and without saving money enjoys an utility level higher than her initial one (which is 5).
52

Let us try to ﬁnd a competitive equilibrium applying the mechanism of Demange, Gale and Sotomayor (6) (DGS). The mechanism uses the concept of minimal overdemanded set. A set of goods is overdemanded if the number of agents demanding goods only in the set is greater than the number of goods. In each step a price vector is announced and each agent’s demand set (the set of aﬀordable goods that maximize agent’s utility) is computed. If it is possible to assign each good to an agent who demands it, the mechanism already ﬁnds a competitive equilibrium and stops. Otherwise, a minimal overdemanded set (an overdemanded set with the property that none of its proper subset is overdemanded) is located and the price of each good in this set is raised by one unit. Then, each agent’s demand set is computed. If there are no budget constraints (or, if the IM condition holds) the model reduces to the Assignment Game and, as Demange, Gale and Sotomayor (6) show, the mechanism stops and ﬁnds a competitive equilibrium.

Next ﬁgure shows the demand set of every agent (denoted by Di(p1, p2, p3, p4)) in each step of the mechanism.

Di(0, 0, 0, 0) Di(0, 1, 0, 0) Di(0, 2, 0, 0) ... Di(0, 7, 5, 5)

a1

4

4

4

1

a2

4

4

4

4

a3

2

2

2

2

a4

2

2

1

1

Di(1, 7, 5, 5) Di(1, 7, 5, 6) Di(1, 8, 5, 6) Di(1, 8, 6, 6) ...

a1

4

3

3

1

a2

4

4

4

4

a3

2

2

3

2

a4

1

2

1

1

Note that when the mechanism reaches the price vector p = (0, 7, 5, 5), it enters in a loop and prices rise continuously. Thus, the mechanism fails to ﬁnd a competitive equilibrium.

53

The previous example raises some important questions. First, it is not clear why the mechanism does not stop. It could be that there is no competitive equilibrium in the economy. Or, if there is a competitive equilibrium, it could be that the mechanism is not the adequate to ﬁnd it. An additional diﬃculty is that we are interested in competitive equilibria with integer prices because our aim is to study the performance of the DGS mechanism.
3.3 The model
3.3.1 Agents and goods
We consider an economy with n agents, n indivisibles goods and a perfectly divisible good or money. Each agent initially owns a certain amount of money and one and only one indivisible good.
Let A be the set of agents and G the set of goods. We identify a generic agent with ai or i and a generic good with gj or j. Each agent i ∈ A = {1, 2, ..., n} initially holds good i and has an amount of money ωi ≥ 0. Thus, the endowment of agent i is ei = (ωi, gi).
We suppose that each agent has no use for more than one indivisible good and that utility is quasi-linear in money. Agent’s preferences can be represented by a utility function ui deﬁned on R+ × G.21 The valuation of agent i for good j is αij. We assume that all valuations are integers and that no agent has the same valuation for two diﬀerent goods; that is, for each agent i it holds αij = αih, for all j = h. If αij > αih we say that good j is preferred over h by agent i.
For each agent i, vi is her vector of valuations and V = (αij)(i,j)∈A×G is the matrix of valuations of all agents. The notation V−i is used to denote the set of valuations of all agents diﬀerent from i. Thus, the utility that agent i has by holding a bundle x = (m, gj) composed with an amount of money m and good gj is ui(x) = m + αij. The initial level of utility of
21By R+ we denote the set of nonnegative real numbers.
54

each agent i is ui(ei). An economy is represented by E = {(ei)i=1,...,n, V }.
3.3.2 Allocations and prices
In what follows we recall some basic deﬁnitions. An allocation is a vector in (R+ × {g1, ..., gn})n. An allocation is feasible if there exists a permutation σ of the set of indices {1, 2, ..., n} such that the allocation is of the form ((m1, gσ(1)), (m2, gσ(2)),. ..,(mn, gσ(n))) and i mi ≤ i ωi. A coalition is a nonempty subset S ⊂ A. An allocation {(mi, gj)}i,j∈{1,2,...,n} is feasible for a coalition S if i∈S mi ≤ i∈S ωi and there is a permutation σS of S such that for all i ∈ S, (mi, gj) = (mi, gσS(i)). The core of the economy is the set of feasible allocations such that no coalition S can ﬁnd an allocation feasible for S which is strictly preferred by all its members. The strong core of the economy consists of those allocations such that no coalition S can ﬁnd an allocation feasible for S at which no member is worse oﬀ and at least one of them is strictly better oﬀ. We observe that the strong core is a subset of the core.
A price vector is a n−vector with non negatives entries, denoted by p = (p1, ..., pn). We assume that all prices are integers.
For each price vector p, Bi(p) is the budget set of agent i; that is, is the set of all aﬀordable goods. Thus,
Bi(p) = {j ∈ G : ωi + pi − pj ≥ 0}.
For each price vector p we deﬁne the demand set of agent i by:
Di(p) = {j ∈ Bi(p) : αij − pj ≥ αih − ph, for all h ∈ Bi(p)}. 55

That is, a good is an element of an agent demand set if its price satisﬁes the agent budget’s constraint and maximizes her utility. Note that Di(p) is a ﬁnite and nonempty set for every price vector.
Deﬁnition 1. A competitive equilibrium is a pair consisting of a price vector p and a feasible allocation (mi, σ(i))i=1,...,n such that for all agent i, σ(i) ∈ Di(p).
The concept of overdemanded set is introduced in Demange, Gale and Sotomayor (6). The authors deﬁne a mechanism which ﬁnds a competitive equilibrium in the Assignment Game. In this mechanism (that ends at the minimum equilibrium price vector), prices are increased based on information about sets of goods that are overdemanded. A set of goods is overdemanded if the number of agents demanding goods only in the set is greater than the number of goods. It is well-known that a necessary condition for reaching a competitive equilibrium is that there be no overdemanded set (Hall (9)). However, by using information only related to overdemanded sets, it is not guaranteed that, in general, the mechanism ﬁnds a competitive equilibrium.22 Demange, Gale and Sotomayor (6) solved the problem by increasing prices in a minimal overdemanded set; that is, a set with the property that none of its proper subset is overdemanded. We ﬁnish this section stating these concepts.
For every H ⊂ G and price vector p, the set of agents demanding items only in H is denoted by O(H, p), formally: O(H, p) = {i ∈ A : Di(p) ⊆ H}. A subset of items H is an overdemanded set at prices p if |O(H, p)| > |H|.
An overdemanded set at prices p with the property that none of its proper subsets is overdemanded, is called a minimal overdemanded set.
22See an example in Anderson et al. (3).
56

3.4 Competitive equilibrium
In this section, two mechanisms are introduced and the existence of competitive equilibrium is addressed. We analyze the IM assumption introduced by Quinzii (17) and observe that under this condition budget constraints are irrelevant. However, when the condition does not hold we show, by means of an example, that a competitive equilibrium may not exist. Finally, the main result of this section is presented.
3.4.1 Mechanisms We start by adapting to our setting the DGS mechanism (originally stated by Demange, Gale and Sotomayor (6)). In the second place, we describe the top trading cycles mechanism with price setting, which is used in the proof of the existence theorem.
3.4.1.1 The Demange, Gale and Sotomayor mechanism The mechanism runs as follows. Let pt denote the price vector in step t of the algorithm. Set p0 = 0. Step 1:
1. Input p0. 2. Compute the demand set Di(p0) for every agent i ∈ A. 3. If there are no overdemanded sets, stop. Otherwise, choose a minimal overdemanded
set S0. 4. Update prices such that: pi1 = p0i + 1 for all i ∈ S0 and pi1 = p0i for all i ∈/ S0. In general, Step t:
57

1. Input pt−1.
2. Compute the demand set Di(pt−1) for every agent i ∈ A.
3. If there are no overdemanded sets, stop. Otherwise, choose a minimal overdemanded set St.
4. Update prices such that: pit = pti−1 + 1 for all i ∈ St and pti = pti−1 for all i ∈/ St.
In every step, the mechanism computes each agent’s demand set. If it is possible to assign each good to an agent who demands it, the mechanism already ﬁnds a competitive equilibrium and stops. Otherwise, the auctioneer locates a minimal overdemanded set (which exists by Hall’s theorem) and raises the price of each good in this set by one unit.23 Then, each agent’s demand set is computed. If there are no budget constraints, Demange, Gale and Sotomayor (6) show that in any market of the Assignment Game there is a competitive equilibrium for some prices and the mechanism stops; moreover, the mechanism is strategy-proof (Demange and Gale (5)).
3.4.1.2 The top trading cycles with price setting The second mechanism, called the top trading cycles with price setting (TTCPS), consists of two phases. The ﬁrst one is the top trading cycles (TTC) algorithm deﬁned by Shapley and Scarf (19). In the second phase prices are set. The mechanism runs as follows.
Phase 1: Top trading cycles algorithm A subset C ⊆ A is a top trading cycle if all members of C can be indexed in a cyclic order: C = {c1, c2, ..., cs = c1} in such a way that each agent cj has in her demand set the cj+1’st (modulo s) good. Take all prices equal zero and consider a directed graph in which we have a node for each agent and a directed edge from i to j if and only if agent i demands the good of agent j. Since for each agent we assume that αij = αih for all j = h, all nodes have outdegree equal to 1, and thus, there is at least one cycle and no two cycles intersect. Then
23See Gale (8) for details about this result.
58

we partition the set A into a sequence of one or more disjoint sets: A = C1 ∪ C2 ∪ ... ∪ Ck by taking C1 to be all top trading cycles for A, then taking C2 to be all top trading cycles for A − C1, then taking C3 to be all top trading cycles for A − (C1 ∪ C2), and so on until A has been exhausted. We call this partition the TTC partition. Note that k, the number of elements of the partition, is also the number of steps in the TTC algorithm.24 This procedure deﬁnes an assignment of goods in the economy E, called the TTC assignment and denoted by σT T C(E).
Phase 2: Price setting Consider the TTC partition, A = C1 ∪ C2 ∪ ... ∪ Ck. We deﬁne the following price vector: For all i ∈ Ck, set pi = 0. Denote by ωk the highest endowment of money of agents in the set Ck; that is, ωk = maxi∈Ck {ωi}. For all i ∈ Ck−1, set pi = ωk + 1. Denote by ωk−1 the highest endowment of money of agents in the set Ck−1; that is, ωk−1 = maxi∈Ck−1{ωi}. For all i ∈ Ck−2, set pi = ωk + ωk−1 + 2. Denote by ωk−2 the highest endowment of money of agents in the set Ck−2; that is, ωk−2 = maxi∈Ck−2{ωi}. And so on until: For all i ∈ C1, set pi = ωk + ωk−1 + ... + ω2 + k − 1. We denote by pT TC the obtained price vector. If no agent has endowment in money, the price setting procedure reduces to the one stated by Shapley and Scarf (19). Finally, we have deﬁned an assignment of goods σT T C(E) and a price vector pT T C.
24Note that a top trading cycle may consist of a single agent and that k ≤ n.
59

3.4.2 Existence
Quinzii (17) proves that any economy has nonempty core and that the core is equivalent to the set of competitive equilibria under the IM condition. This condition states that each no agent can enjoy a utility level higher than her initial utility level, without saving some money.
Deﬁnition 2. An economy E = {(ei)i=1,...,n, V } satisﬁes the indispensability of money (IM) condition if αii + ωi ≥ αij for all agent i and good j.
It is worth noting that under the IM condition, budget constraints do not bind. Indeed, suppose that for a price vector p the good which maximizes the utility of agent i is not aﬀordable for the agent. Denote by j ∈ G that good. Clearly, this good is not the one initially held by the agent. We have: αij − pj ≥ αih − ph for all h and ωi + pi − pj < 0, which is equivalent to pj − pi > ωi. To the extent that this is true for all good h, we have also that relation for good i: αij − pj ≥ αii − pi, therefore: αij − αii ≥ pj − pi. But since good j is not reachable for i we have αij − αii ≥ pj − pi > ωi. However, the IM condition implies that for all i, j, ωi ≥ αij − αii. Therefore, under this condition budget constraints are irrelevant.
Thus, in order to study the eﬀects of agents’ budget constraints we may not assume the IM condition. But, as we show in the next example, if this condition does not hold, the existence of a competitive equilibrium is not guaranteed. Wako (24) presents an example with this result in which all agents are indiﬀerent between two goods. Clearly, the existence of indiﬀerences in agents’ valuations increases the opportunities to a coalition to weakly improve upon the allocations. We present a new example in which there are no indiﬀerences and however, the set of competitive equilibria is empty.
Example 1. Consider A = {a1, a2, a3} and G = {g1, g2, g3} and the following valuations and initial amounts of money:
60

g1 g2 g3 ω a1 5 1 8 1 a2 1 5 8 2 a3 5 4 3 3
Since Wako (24) we know that the strong core always coincides with the set of competitive equilibria. Note that there are only two allocations that may be in the strong core: X1 = ((1, g1), (0, g3), (5, g2)) and X2 = ((0, g3), (2, g2), (4, g1)). In the ﬁrst case, coalition {a1, a3} can weakly improve allocation X1 with the allocation ((0, g3), (4, g1)). In the second case, coalition {a2, a3} can weakly improve X2 with the allocation ((0, g3), (5, g2)). Thus, the strong core of the economy is empty and there is no competitive equilibrium.
The example raises the question of which condition, diﬀerent from the IM condition, guarantees the existence of a competitive equilibrium. We have noted that the IM condition can be viewed as abundance of money. It is quite surprising that the key components of the condition that ensures the existence of equilibrium are one related to the scarcity of money and the other related to the number of steps in the TTC algorithm.
Deﬁnition 3. Consider an economy E = {(ei)i=1,...,n, V }. Suppose that the TTC algorithm consists of k steps. The economy satisﬁes the weak version of the money scarcity condition (WMS) if for any agent i and diﬀerent goods h, l we have |αih−αil| ≥ j∈A\{i} ωj +k−1.
Some comments about the condition are in order. It requires that each agent should consider goods as heterogeneous. In the second place, the condition is independent of each agent’s endowment in money and also of the initial distribution of money. Finally, while the WMS condition indicates a speciﬁc lower bound of the diﬀerence between any two valuations, the IM condition states an upper bound. Indeed, suppose there are two goods j, h and one agent i such that αij ≥ αii and αih ≥ αii. Then, we have |αij − αih| = |αij − αii + αii − αih| ≤ |αij − αii| + |αii − αih| ≤ 2mi. Thus, the IM condition implies that the diﬀerence between
61

any two valuations should be lower than the double of the initial amount of money that the agent has. The main result of this section is the following.
Theorem 1. Consider an economy E = {(ei)i=1,...,n, V }.
1. If E satisﬁes the IM condition, there is a competitive equilibrium which can be reached by the DGS mechanism.
2. If E satisﬁes the WMS condition, there is a competitive equilibrium which can be reached by the TTCPS mechanism.
Proof. A proof of the ﬁrst part can be found in Quinzii (17) and Demange, Gale and Sotomayor (6). For the second part we have to prove that pT T C and ((ωi, σT T C(i))i∈A is a competitive equilibrium. Fix an agent i and denote by σ(i) the good assigned by the TTC algorithm to this agent. We shall prove that: (1) ωi + pi − pσ(i) ≥ 0 and, (2) αiσ(i) + pi − pσ(i) ≥ αih + pi − ph for all h such that ωi + pi − ph ≥ 0.
Assertion (1) is straightforward since good σ(i) leaves the market with good i and then we have pi = pσ(i).
For (2), suppose that agent i leaves the market in the step k − r of the procedure (0 ≤ r < k). Then, for all good l such that al leaves the market in the step j < k − r, we have pl ≥ ps = ωk + ωk−1 + ... + ωk−r + r + 1 for all s such that as ∈ Ck−r−1 with ωk−r ≥ ωi. Also, pi = ωk + ωk−1 + ... + ωk−r+1 + r. Thus, pi − ps = −ωk−r − 1 = −(ωk−r + 1) with ωk−r ≥ ωi. This means that i cannot achieve goods of agents that leave the market in any step j < k − r.
Finally, we have to verify that for any good j such that aj ∈ Ct with t = k − r, ..., k the following holds: αiσ(i) ≥ αij + pi − pj. By way of contradiction, suppose there is a good j ∈ Ct with t = k − r, ..., k such that αiσ(i) < αij + pi − pj. Then, 0 ≤ αiσ(i) − αij < pi − pj ≤
62

pi = ωk + ωk−1 + ... + ωk−r+1 + r. Since r ≤ k − 1, we have that αiσ(i) − αij < ωk + ωk−1 + ... + ω2 + k − 1 ≤ j∈A\{i} ωj + k − 1. Thus, we conclude that αiσ(i) − αij < r∈A\{i} ωr + k − 1, which is a contradiction.
Theorem 1 shows that there is a discontinuity in the existence of competitive equilibrium in relation to the total amount of money that initially exists in the economy. If there is abundant money in the economy (IM condition) or if money is very scarce (WMS condition), there is a competitive equilibrium. For other cases between those situations (for instance, Example 1), we cannot guarantee the existence of a competitive equilibrium. Also, as we note in the following example, the WMS condition cannot be relaxed. Example 2. Consider the following economy.
g1 g2 g3 g4 ω a1 1 25 13 37 4 a2 1 25 13 37 2 a3 1 25 13 37 3 a4 25 1 13 36 1

In the ﬁrst place, note that the WMS condition holds for agents a1, a2 and a3. For agent a4,

the condition does not hold because α44 − α41 = 11 <

3 i=1

ωi + 3

=

12.

It

is

straightforward

to verify that the unique allocation in the core of the economy is ((4, g1), (2, g2), (3, g3), (1, g4)).

In Appendix A.1 we prove that there is no integer price vector p such that the allocation

deﬁned previously and prices p are a competitive equilibrium.25 Thus, we conclude that

there is no competitive equilibrium in this economy.

Note that price vector pT T C satisﬁes that pi = pσ(i) for all agent i. Thus, at the competitive equilibrium found by the TTCPS mechanism, there are no money transfers between agents and the ﬁnal assignment of money is equal to its initial distribution. In this sense, we say that
25Note that if we allow real price vectors, the allocation is a competitive equilibrium associated with, for example, p = (0.9, 9, 5, 11.9)
63

the TTCPS minimizes money transactions. Moreover, the assignment of goods deﬁned by the TTCPS is the unique assignment with that property. Thus, we have a characterization of the TTCPS, which is introduced after presenting the mechanism deﬁnition.
Deﬁnition 4. A mechanism is a function that assigns a competitive equilibrium for each economy.
Proposition 1. A mechanism minimizes money transactions if and only if it is the TTCPS mechanism.
(See Appendix A.2 for a proof)
As we just noted, at the competitive equilibrium found by the TTCPS mechanism, there are no money transfers between agents and the ﬁnal assignment of money is equal to its initial distribution. In order to adjust prices, we introduce a mechanism which includes a ﬁnal phase that ﬁnds the minimum equilibrium price vector associated with the assignment found by the TTC mechanism.
Consider an economy E = {(ei)i=1,...,n, V }. Let pT T C and ((ωi, σT T C(i)))i∈A be the competitive equilibrium deﬁned by the TTCPS. Starting with the price vector pT TC we apply the following algorithm:
Step 1: Decrease the price of good 1 by one unit until either an overdemanded set appears or it is zero. In the last case, go to the following step. When an overdemanded set is found, ﬁx the price of good 1 in its previous value (at which there is no overdemanded set) and continue with the next step.
Step t ≤ n: Decrease the price of good t by one unit until either an overdemanded set appears or it is zero. When an overdemanded set is found, ﬁx the price of good t in its previous level (at which there is no overdemanded set). If the ﬁnal price of good t is lower than its value at the beginning of the step, go to Step 1. Otherwise, go to the following step.
The algorithm ends when no price can be decreased.
64

Let pˆ denote the ﬁnal price vector obtained by this procedure. The new proposed mechanism is the following.
Deﬁnition 5. The extended top trading cycles (ETTC) mechanism is the function that assigns for each economy E = {(ei)i=1,...,n, V } the competitive equilibrium formed by the price pˆ and the allocation (ωi + pˆi − pˆσTTC(i), σT T C(i))i∈A.
It is straightforward to verify that pˆ is the minimum equilibrium price vector associated with the allocation of goods (σT T C(i))i∈A. That is, any price vector that constitutes a competitive equilibrium with the previous allocation, veriﬁes that its components are greater than or equal to the components of pˆ. However, as we show in the next example, pˆ may not be the minimum equilibrium price vector.
Example 3. Consider the following economy.
g1 g2 g3 g4 ω a1 21 31 11 1 1 a2 28 1 10 19 2 a3 25 1 9 17 3 a4 1 15 22 8 4
Note that the economy in the example satisﬁes the WMS condition. In the ﬁrst place, we apply the TTC in order to ﬁnd the TTC partition; we get A = C1 ∪ C2 with C1 = {a1, a2} and C2 = {a3, a4}. Since ω2 = ω4 = 4 we have the following TTC induced price vector p = (p1, p2, p3, p4) = (5, 5, 0, 0). In the ﬁnal phase we obtain the price vector: pˆ = (4, 2, 0, 0). Thus, the competitive equilibrium found by the ETTC is pˆ = (4, 2, 0, 0) and ((3, g2), (0, g1), (3, g4), (4, g3)). However, the minimum equilibrium price vector is pˆ = (3, 0, 0, 0) which is associated with the allocation ((4, g2), (2, g4), (0, g1), (4, g3)).
One important result of Shapley and Shubik (20) is the existence of a unique minimum equilibrium price vector, smallest in the strong sense that this price vector is at least as
65

small in every component as any other equilibrium price vector. We ﬁnish the section by proving that this result does not hold in our model.
Proposition 2. Consider an economy E = {(ei)i=1,...,n, V }. Then, there may not exist a minimum equilibrium price vector.
(See Appendix A.3 for a proof)
3.5 Strategic questions
In this section we study some strategic questions about the mechanisms introduced previously. After some comments on the TTCPS mechanism, it is shown that the ETTC is strategy-proof if a slightly stronger condition than WMS holds, and that the DGS mechanism does not satisfy this property, even under the same condition. Then, we analyze the existence of Nash equilibria in the revelation game induced by the DGS mechanism. A link between these two mechanisms is speciﬁed by showing that the assignment of goods in a Nash equilibrium coincides with the assignment found by the ETTC mechanism; thus, it is Pareto eﬃcient. Finally, we identify some conditions under which the DGS mechanism stops and ﬁnds a competitive equilibrium.
3.5.1 Strategy-proofness
Before presenting the results, we need some deﬁnitions.
Denote by φi(e, V ) the assignment of agent i by the mechanism φ when endowments are e = (ei)i=1,...,n and agents’ valuations are V . A mechanism induces a game in which agents have to reveal some information (for example, valuations) and the mechanism determines the assignment of each agent. In this section we study two games which have the following common elements:
66

1. the set A of all players,

2. the set of strategies of each player i: Si

3. the set of strategy proﬁles deﬁned by S =

n i=1

Si,

and

4. the payoﬀ function of each player, deﬁned by ui : S → R such that if i gets gj at price pj and her good’s price is pi, her payoﬀ is ωi + pi + αij − pj and αii + ωi, otherwise.

In the ﬁrst place, we consider the game in which each agent has to declare her endowment in money and valuations. Moreover, we suppose that true and reported valuations belong to a certain domain of valuations D ⊂ Zn+. Thus, the set of strategies of each agent is Si = R+ × D. If truthful revelation is a weakly dominant strategy for each agent in the preference revelation game induced by the mechanism, then we say that the mechanism is strategy-proof on the domain D. In the second place, suppose that the endowment in money of each agent is common knowledge and then, the set of strategies of each agent is Si = D. If truthful revelation is a weakly dominant strategy for each agent in the preference revelation game induced by the mechanism, then we say that the mechanism is strategyproof on valuations on the domain D. Formal deﬁnitions are the following.

Deﬁnition 6. Suppose an economy in which each agent’s valuations belong to a certain domain of valuations D ∈ Z+n . A mechanism φ is strategy-proof on the domain D if for each V ∈ Dn, e and i ∈ A, ui(φi(e−i, ei, V−i, vi)) ≥ ui(φi(e−i, eˆi, V−i, vˆi)) for all vˆi ∈ D and eˆi ∈ {gi} × R+.26
Deﬁnition 7. Suppose an economy in which each agent’s valuations belong to a certain domain of valuations D ⊂ Z+n and that the endowment in money of each agent is common knowledge. A mechanism φ is strategy-proof on valuations on the domain D if for each V ∈ Dn and i ∈ A, ui(φi(e, V−i, vi)) ≥ ui(φi(e, V−i, vˆi)) for all vˆi ∈ D.
26We adopt the notation e−i for the endowment of all agents diﬀerent from i.

67

3.5.1.1 The top trading cycles with price setting mechanism As we state in the next theorem, the TTCPS mechanism is strategy-proof on the domain deﬁned by the WMS condition.
Let DWMS denote the domain of valuations deﬁned by the WMS condition.
Theorem 2. Suppose an economy that satisﬁes the WMS condition, then the TTCPS mechanism is strategy-proof on DWMS.
Proof. Note that the assignment of goods is computed by the TTC algorithm, without considering the initial amount of money of each agent. Thus, the proof presented in Abdulkadiro˘glu and S¨onmez (2) can be adapted to our framework to show that no agent can beneﬁt by announcing valuations diﬀerent from her true valuations.27 In the phase 2 when prices are set, by announcing a diﬀerent endowment of money, an agent does not change the price of her good neither the price of the good she is assigned to (which are always equal). Thus, truthful revelation is a weakly dominant strategy for each agent.
3.5.1.2 The extended top trading cycles mechanism

In Appendix A.4 we present an economy that satisﬁes the WMS condition in which truthful revelation is not a weakly dominant strategy for some agents. Thus, the mechanism is not strategy-proof on valuations on the domain deﬁned by the WMS condition (which implies that it is not strategy-proof). The economy should satisfy the following condition, slightly stronger than the WMS, to guarantee that the mechanism is strategy-proof on valuations.

Deﬁnition 8. Consider an economy E = {(ei)i=1,...,n, V }. Suppose that the TTC algorithm

consists of k steps. The economy satisﬁes the money scarcity (MS) condition if for any

agent i and diﬀerent goods h, l we have |αih − αil| ≥

n j=1

ωj

+

k

−

1.

27See Appendix A.5.

68

Let DMS denote the domain of valuations deﬁned by the MS condition. Theorem 3. Suppose an economy that satisﬁes the MS condition, then the ETTC mechanism is strategy-proof on valuations on DMS.
(See Appendix A.5 for a proof)
We must note that even if the MS condition holds, the ETTC mechanism is not strategyproof on DMS. Consider the example of Section 2. The economy satisﬁes the MS condition and the ETTC mechanism ﬁnds the following competitive equilibrium: p = (0, 8, 5, 7) and ((4, g1), (4, g4), (2, g3)(0, g2)). If a4 declares the following endowment of money: ω4 = 0, ﬁnal prices are pˆ = (0, 8, 5, 8) and she beneﬁts since she exchanges her good with agent a2 but she does not pay for it.
3.5.1.3 The Demange, Gale and Sotomayor mechanism
The next example shows that the DGS mechanism is not strategy-proof on valuations on the domain deﬁned by the MS condition (and thus, it is not strategy-proof). Example 4. Consider the following economy.
g1 g2 g3 ω a1 8 15 1 1 a2 16 2 9 2 a3 18 11 4 3 The DGS mechanism ﬁnds the following competitive equilibrium: p = (3, 0, 0) and σ = ((4, g2), (2, g3), (0, g1)). Note that if agent a2 announces its own good as her second option, she receives g1. Indeed, if a2 reveals valuations vˆ2 = (16, 9, 2) the competitive equilibrium found by the mechanism is pˆ = (4, 4, 0) and σˆ = ((1, g2), (2, g1), (3, g3)). Therefore, a2 obtains a higher utility if she reveals a vector of valuations diﬀerent from her true valuations. Finally, note that the economy satisﬁes the MS condition.
69

We must note that, in the last example, for agent a2 to manipulate the mechanism, she does not need any information about other agents’ valuations. She only needs to observe which objects were demanded by each of the other agents. The same observation was noted by Sotomayor (22) in the mechanism that she proposes. As she remarks, this situation contrasts with the existent results in the literature, where an agent needs to have a large amount of information to identify proﬁtable strategic manipulations.
We know that truthful revelation is not a weakly dominant strategy in the revelation game induced by the DGS mechanism. Next, we study the existence of equilibrium in this game. We focus on the game in which each agent has to reveal her valuations and endowments in money are common knowledge, and we search for a Nash equilibrium.
A strategy proﬁle (s∗1, ..., s∗n) is a Nash equilibrium of the game induced by the DGS mechanism, if there is no individual i ∈ A and no strategy si ∈ Si such that ui(si, s∗−i) > ui(s1∗, ..., sn∗ ).
In order to ﬁnd a Nash equilibrium of the revelation game, we introduce a set of strategies, called dropping strategies. A dropping strategy consists of a vector si ∈ Zn+ such that if σT TC(i) is the good assigned to agent i by the TTC procedure, the highest valuation in si corresponds to σTT C(i) and the second highest valuation corresponds to gi (her own good). A dropping proﬁle is a strategy proﬁle (s1, ..., sn) such that each si is a dropping strategy.
28
As we show in the next example, a dropping proﬁle may not be a Nash equilibrium of the revelation game induced by the DGS mechanism, even when the economy satisﬁes the MS condition. In order for a dropping proﬁle to be a Nash equilibrium, the economy should satisfy a stronger condition, which is deﬁned after the example.
Example 5. Suppose the following economy.
28This type of strategies was originally introduced by Kojima and Pathak (12).
70

g1 g2 ω a1 1 3 1 a2 2 1 0
Note that each agent plays a dropping strategy and that the DGS mechanism stops at the ﬁrst round. Also, we have that k = 1. Since α21−α22 = 1 = ω1+ω2, the economy satisﬁes the MS condition. The competitive equilibrium found by the DGS mechanism is: p = (0, 0) and ((1, g2), (0, g1)), and agent a2 gets an utility of 2. If a2 announces the following valuations, v2 = (1, 2), the new competitive equilibrium found by the mechanism is p = (0, 1) and ((0, g2), (1, g1)), and agent a2 gets an utility of 3. Thus, in this economy that satisﬁes the MS condition, a dropping proﬁle is not a Nash equilibrium.
Deﬁnition 9. Consider an economy E = {(ei)i=1,...,n, V }. The economy satisﬁes the strong money scarcity condition if for any agent i and diﬀerent goods h, l, we have |αih − αil| ≥
j∈A\{i} ωj + n − 1.
Example 5 presents an economy which satisﬁes the MS condition but does not satisfy the strong version of the condition. Indeed, since n = 2 we have that α21 −α22 = 1 < m1 +1 = 2.
A dropping proﬁle satisﬁes the strong MS condition if each agent’s strategy satisﬁes the strong MS condition.
Theorem 4. Suppose an economy that satisﬁes the strong MS condition, then a dropping proﬁle that satisﬁes the strong MS condition is a Nash equilibrium of the revelation game induced by the DGS mechanism.
(See Appendix A.6 for a proof)
The last theorem shows that the assignment of goods of the ETTC mechanism is the outcome of a Nash equilibrium in the revelation game induced by the DGS mechanism. Note that ﬁnal prices of each mechanism may not be equal.
71

3.5.2 Convergence of the DGS mechanism
In Section 4 we proved that the WMS condition guarantees the existence of a competitive equilibrium which can be found by the ETTC mechanism. In this section we investigate if the DGS mechanism also ﬁnds a competitive equilibrium whenever it exists.
The economy introduced in Section 2 satisﬁes the strong MS condition and, however, the DGS mechanism fails to ﬁnd a competitive equilibrium. In that economy the mechanism does not stop and prices increase indeﬁnitely. On the other hand, the outcome of the ETTC mechanism is p = (0, 8, 5, 7) and ((4, g1), (4, g4), (2, g3)(0, g2, )).
The example of Section 2 raises the following question: under which conditions does the DGS mechanism stop and ﬁnd a competitive equilibrium? We ﬁnish this section with the deﬁnition of a strong condition to guarantee that this mechanism stops. It is worth noting that the DGS mechanism always stops and ﬁnds a competitive equilibrium when it is applied to a three agents economy whenever the economy satisﬁes the WMS condition and that ωi = ωj for all i, j ∈ A such that i = j.
The conditions that ensure the convergence of the mechanism to a competitive equilibrium are very restrictive, however, we include the result in order to answer the question posited at the beginning of the paper and, to stress the inadequacy of this mechanism in our framework.
For each i ∈ A, her valuation vector vi deﬁnes a ranking of goods: j is ranked above h if αij > αih. Let Oi(j) be the place of good j in the ranking of agent i (for instance, if j is the good with highest valuation at vi, Oi(j) = 1).
Theorem 5. Suppose an economy E = {(ei)i=1,...,n, V } such that:
1. it satisﬁes the WMS condition, 2. for each agent i, Oi(i) ≥ 2; that is, for each agent there is at most one good preferred
over her own good.
72

Then, the DGS mechanism stops and ﬁnds a competitive equilibrium.
(See Appendix A.7 for a proof)
In the last proposition, the WMS condition cannot be discarded. We ﬁnish this section with an example illustrating this remark.
Example 6. Suppose the following economy:
g1 g2 g3 ω a1 3 6 1 2 a2 3 2 1 3 a3 1 7 2 4
Note that the economy satisﬁes the second condition of the last theorem but does not satisfy the WMS condition. One can easily show that the DGS mechanism does not stop when it is applied to this economy. Thus, the WMS condition is a necessary assumption for the last result.
3.6 Concluding remarks
In this paper, we study an economy with indivisible goods, money and budget-constrained agents with unit-demand, who act as both sellers and buyers. In this model, a widely used assumption is the indispensability of money, originally stated by Quinzii (17). As many authors have remarked, the assumption can be understood as abundance of money in the economy. We show that if this assumption holds, budget constraints never bind. On the other hand, the assumption is crucial to guarantee the existence of competitive equilibrium.
We contribute to the literature by extending the original result of Quinzii on the existence of competitive equilibrium to cases where money is scarce and utility functions are quasi-linear. Moreover, an extended version of the top trading cycles algorithm, which is strategy-proof
73

under the money scarcity condition, is deﬁned in order to ﬁnd a competitive equilibrium. We show also that the mechanism of Demange, Gale and Sotomayor is not strategy-proof and we ﬁnd a set of Nash equilibria of the revelation game induced by this mechanism. Finally, we identify a stronger condition than money scarcity to guarantee the convergence of this mechanism to a competitive equilibrium in the general model.
The results proven in the paper show that the ETTC is a suitable mechanism to ﬁnd a competitive equilibrium in the economies that have been analyzed. In particular, we have demonstrated that the mechanism is strategy-proof on valuations under the money scarcity condition. The next step involves a characterization of those mechanisms that are strategyproof in this framework. Recent studies have made some advances in this sense. For example, Morimoto and Serizawa (14) have characterized the rule that assigns a minimum price Walrasian equilibrium allocation in the Assignment Game. A similar characterization in our model where budget-constrained agents act as both sellers and buyers, requires a deep analysis and goes beyond the scope of the present work.
It could be interesting to study the extension of these results to the case in which there are also agents that only have money and do not own any good. In that case, the extended version of the top trading cycles cannot be used because agents without a good will fail to participate in a cycle. Thus, a new mechanism should be designed to ﬁnd a competitive equilibrium in that setting.

3.7 Appendix

A.1 Proof of Example 2

It is straightforward to verify that the unique allocation in the core of the economy is ((4, g1), (2, g2), (3, g3), (1, g4)). We have to prove that there is no integer price vector p such that the allocation deﬁned previously and prices p are a competitive equilibrium. By

74

way of contradiction, suppose there is a integer price vector p = (p1, p2, p3, p4) such that ((4, g1), (2, g2), (3, g3), (1, g4)) and p are a competitive equilibrium.
In the ﬁrst place, we claim that p4 > p2. Indeed, suppose that p4 ≤ p2; then, ω2 + p2 − p4 ≥ 0 and α24 + p2 − p4 > α22, but this means that a2 does not demand g2, a contradiction. In the same way, it can be shown that p2 > p3 and p3 > p1.
Therefore, we have the following inequalities: p4 > p2 > p3 > p1.
In the second place, we know that each agent demands her own good; that is, gi ∈ Di(p). In order to this result holds, we should have:
1. For agent a1: (1.1) 4 + p1 − p2 < 0 or, if 4 + p1 − p2 ≥ 0 the following should hold: 1 ≥ 25 + p1 − p2. But the second case is equivalent to p2 − p1 ≥ 24 if p2 − p1 ≤ 4, which is not possible. Then, the ﬁrst relation should hold. (1.2) 4 + p1 − p3 < 0 or, if 4 + p1 − p3 ≥ 0 the following should hold: 1 ≥ 13 + p1 − p3. As in the previous case, the second relation is not possible. (1.3) 4 + p1 − p4 < 0 or, if 4 + p1 − p4 ≥ 0 the following should hold: 1 ≥ 37 + p1 − p4. As in the ﬁrst case, the second relation is not possible.
2. For agent a2: (2.1) Since p2 > p1, we should have 25 ≥ 1 + p2 − p1, and thus, 24 ≥ p2 − p1. (2.2) Since p2 > p3 we should have 25 ≥ 13 + p2 − p3, and thus 12 ≥ p2 − p3. (2.3) 2 + p2 − p4 < 0 or, if 2 + p2 − p4 ≥ 0 then, 25 ≥ 37 + p2 − p4. But, as with agent a1, the last case is not possible.
3. For agent a3: (3.1) Since p3 > p1, we should have 13 ≥ 1 + p3 − p1, and thus 12 ≥ p2 − p1.
75

(3.2) 3 + p3 − p2 < 0 or, if 3 + p3 − p2 ≥ 0 then, 13 ≥ 25 + p3 − p2. Note that the last case is not possible.
(3.3) 3 + p3 − p4 < 0 or, if 3 + p3 − p4 ≥ 0 then, 13 ≥ 37 + p3 − p4. But note that the last case is not possible.
4. For agent a4: (4.1) Since p4 > p1, then we should have 36 ≥ 25 + p4 − p1, and thus 11 ≥ p4 − p1. (4.2) Since p4 > p2, then we should have 36 ≥ 1 + p4 − p2, and thus 35 ≥ p4 − p2. (4.3) Since p4 > p3, then we should have 36 ≥ 13 + p4 − p3, and thus 23 ≥ p4 − p3.
Thus, the following inequalities should hold:
(1) 4 < p2 − p1 ≤ 24 (2) 4 < p3 − p1 ≤ 12 (3) 4 < p4 − p1 ≤ 11 (4) 3 < p2 − p3 ≤ 12 (5) 2 < p4 − p2 ≤ 35 (6) 3 < p4 − p3 ≤ 23
Note that 11 ≥ p4 − p1 = p4 − p2 + p2 − p1 and, since p4 − p2 > 0, we have p2 − p1 ≤ 10. Following in the same way:
11 ≥ p4 − p1 = p4 − p3 + p3 − p1 and, since p3 − p1 > 0, we have p4 − p3 ≤ 10. 11 ≥ p4 − p1 = p4 − p2 + p2 − p3 + p3 − p1 and then, p4 − p2 ≤ 9, p2 − p3 ≤ 9, p3 − p1 ≤ 9. p4 − p3 = p4 − p2 + p2 − p3 and since inequalities (4) and (5), we have p4 − p3 > 5. p4 − p1 = p4 − p2 + p2 − p3 + p3 − p1 and since inequalities (2), (4) and (5), we have p4 − p1 > 9. Thus, the last set of inequalities becomes:
76

(1) 4 < p2 − p1 ≤ 10 (2) 4 < p3 − p1 ≤ 9 (3) 9 < p4 − p1 ≤ 11 (4) 3 < p2 − p3 ≤ 9 (5) 2 < p4 − p2 ≤ 9 (6) 6 ≤ p4 − p3 ≤ 10
We can suppose, without loss of generality, that p1 = 0; therefore, we have only two possible values for p4: p4 = 10 or p4 = 11.
1. If p4 = 10, by inequality (6) we know that p3 ≤ 4, which is not possible since inequality (2).
2. If p4 = 11, by inequalities (5) and (6), we know that 2 ≤ p2 < 9 and 1 ≤ p3 ≤ 5. But, since this last relation and inequality (2) we have that p3 = 5 and then, by (4), p2 > 8 which contradicts that 2 ≤ p2 < 9.
Therefore, there is no integer price vector such that the unique allocation of the core and prices p are a competitive equilibrium.
A.2 Proof of Proposition 1
Proposition 1: A mechanism minimizes money transactions if and only if it is the TTCPS mechanism.
Proof. At the competitive equilibrium found by the TTCPS, there are no money transfers. Denote by pT T C, (ωi, σT T C(i)) the TTCPS competitive equilibrium. We know that pi = pσTTC(i). We will prove that there is no other competitive equilibrium with an allocation of goods τ such that pi = pτ(i). Suppose, by way of contradiction, that there is a competitive
77

equilibrium q, (ωi, τ (i)), such that qi = qτ(i). Consider the TTC partition, A = C1 ∪ C2 ∪ ... ∪ Ck. Note that, at σT T C, all agents in C1 receive their most preferred good. Assume there is an agent in C1 such that she receives at τ a diﬀerent good from the one she receives at σ. Then, the allocation of goods deﬁned by C1 is feasible for C1 and no member is worse oﬀ and at least one of them is strictly better oﬀ at C1 respect to the assignment τ . Thus, the assignment (ωi, τ (i)) is not in the strong core of the economy, which is a contradiction. Then, both competitive equilibria have the same allocation of goods for agents in C1. Suppose now that there is an agent in C2 such that she receives at τ a diﬀerent good from the one she receives at σ. All agents in C2 receive at σT TC their most preferred good of those that were left. A similar argument as before shows that the allocation of goods deﬁned by C1 ∪ C2 is feasible for C1 ∪ C2 and no member is worse oﬀ and at least one of them is strictly better oﬀ at σT TC respect to the assignment τ . Then, (ωi, τ (i)) is not in the strong core of the economy. Proceeding in this manner for all the sets in the TTC partition, we see that σTTC(i) = τ (i).
A.3 Proof of Proposition 2
Proposition 2: Consider an economy E = {(ei)i=1,...,n, V }. Then, there may not exist a minimum equilibrium price vector.
Proof. Consider the following economy.
g1 g2 g3 g4 ω a1 8 1 22 15 1 a2 1 8 22 15 1 a3 20 13 7 1 2 a4 12 18 6 1 3
First note that the economy of the example satisﬁes the WMS condition. The outcome of the TTCPS mechanism is p = (p1, p2, p3, p4) = (4, 0, 4, 0) and ((1, g3), (1, g4), (2, g1), (3, g2)).
78

In the ﬁnal phase we obtain the price vector: pˆ = (1, 0, 2, 0). Thus, the competitive equilibrium found by the ETTC is pˆ = (1, 0, 2, 0) and ((0, g3), (1, g4), (3, g1), (3, g2)). But the vector p˜ = (0, 1, 2, 0) is also an equilibrium price vector associated with the allocation ((1, g4), (0, g3), (4, g1)(2, g2)) and it is straightforward to verify that there is no equilibrium price vector q such that q ≤ p and q ≤ p˜.
A.4 Example: an economy that satisﬁes the WMS condition and truthful revelation is not a dominant strategy
Consider the following economy.
g1 g2 g3 g4 g5 ω a1 4 13 7 1 10 3 a2 20 13 27 1 7 0 a3 27 7 13 20 1 0 a4 7 27 1 20 13 0 a5 6 1 21 16 11 1
First, note that the economy satisﬁes the WMS condition. The outcome of the ETTC mechanism is p = (0, 3, 2, 2, 0) and ((0, g2), (1, g3), (2, g1), (0, g4), (1, g5)). Thus, the utility of agent a1 is 13. Suppose that this agent announces the following vector valuation: v1 = (4, 10, 7, 1, 13). The new outcome of the ETTC mechanism is p = (2, 1, 2, 0, 1) and ((4, g5), (0, g2), (0, g1), (0, g4), (0, g3)); thus, the utility obtained by a1 is 14. Therefore, an agent can beneﬁt by announcing other valuations than her true ones; thus, the mechanism is not strategy-proof on valuations.
A.5 Proof of Theorem 3
The ETTC consists in two steps. In the ﬁrst, the TTC mechanism is applied and prices are computed. In the second step, in those cases where it is possible, prices are decreased in the
79

way deﬁned previously. To show that in the ﬁrst step the mechanism is strategy-proof on valuations, the proof presented in Abdulkadiro˘glu and So¨nmez (2) can be adapted to our framework. For the sake of completeness, we include the adapted proof. Then, we present the proof for the second step of the mechanism. We begin with the following lemma.
Lemma 1. Fix the valuations of all agents except i at V−i. Suppose that in the algorithm agent i is removed from the market at Step t under vi and at Step t under vi. Suppose t < t . Then, the remaining agents at the beginning of Step t are the same whether agent i announces vi or vi.
Proof. Since agent i fails to participate in a cycle prior to Step t in either case, the same cycles form.
Theorem 3: Suppose an economy that satisﬁes the MS condition, then the ETTC mechanism is strategy-proof on DMS.
Proof. First step of the mechanism:
Consider an agent i with true valuations vi. Fix an announced valuations proﬁle V−i for every agent except i. We want to show that revealing her true valuations vi is at least as good as announcing any other valuations vi. Let t be the step at which agent i leaves under vi, (i, h, i1, i2, ..., ik) be the cycle she joins, and thus, she is assigned to good h. Let t be the step at which she leaves under her true valuation vi. Two cases are considered. Case 1: t ≥ t . Suppose agent i announces her true valuation vi. By Lemma 1, the same agents remain in the market at the beginning of Step t , whether agent i announces vi or vi. Therefore at this Step, agent h points to agent i1, agent i1 points to agent i2,..., agent ik points to agent i, and all these agents keep doing so as long as agent i remains in the market. Since agent i truthfully points to her best remaining choice at each step, she either receives a good that is at least as good as good h or eventually joins to the cycle (i, h, i1, i2, ..., ik). Case 2: t < t . By the Lemma the same agents remain in the algorithm at the beginning of
80

Step t whether agent i announces vi or vi. Moreover, agent i is assigned a good at her best choice remaining at step t under vi. Therefore, in this case too, her assignment under the true valuation is at least as good as h.

Second step of the mechanism:

Let vi = (αij)j=1,...n be agent i true valuations. Since the economy satisﬁes the MS condition,

we know that |αih − αil| ≥

n j=1

ωj

+

k

−

1

for

all

goods

l,

p,

l

=

p.

Let j (h) be the good to which i is assigned when she declares vi (vi). Denote by p (p ) the price vector found by the TTCPS when i announces vi (vi). By the last result we know that αij ≥ αih. Suppose that when prices are set, we have that αij +ωi +pi −pj < αih +ωi +pi −ph, and so agent i beneﬁts by announcing vi. Since prices of goods that belong to the same cycle are equal, we have pi = pj and pi = ph, and then, the last inequality is not possible.

Finally, suppose, by way of contradiction, that in the the ﬁnal phase, when prices are decreased, agent i has a higher utility by announcing vi; that is, αij + ωi + pˆi − pˆj < αih + ωi + pˆi − pˆh, where pˆ and pˆ are the ﬁnal price vectors found by the ETTC mechanism. To make notation lighter, denote pˆ as q.

Therefore, suppose that 0 ≤ αij + pˆi − pˆj < αih + qi − qh.

First, note that if h = i we have a contradiction. Indeed, in this case 0 ≤ αij − αih <

pˆj − pˆi ≤

n j=1

ωj

+

k

−

1.

Second, denote as before by C = {i, h, i1, ..., ik} the top trading cycle to which agent i joins when she declares vi. We claim that qi −qh ≤ ωk +...+ω1 +ωh. Indeed, we have the following inequalities: ωk + qk − qi ≥ 0 ωk−1 + qk−1 − qk ≥ 0 ...

81

ω1 + q1 − q2 ≥ 0 ωh + qh − q1 ≥ 0

Therefore: ωk ≥ qi − qk ωk−1 ≥ qk − qk−1 ... ω1 ≥ q2 − q1 ωh ≥ q1 − qh

Thus, qi − qh = qi − qk + qk − qk−1 + ... + q2 − q1 + q1 − qh ≤ ωk + ... + ω1 + ωh.

Since ωi + pˆi − pˆj ≥ 0, we know that pˆj − pˆi ≤ ωi.

Finally, we have 0 ≤ αij − αih < pˆj − pˆi + qi − qh ≤ ωi + ωk + ... + ω1 + ωh ≤

n j=1

ωj

+

k

−

1,

which is a contradiction.

We must note that, it may seem to be enough to assume αij − αih ≥

n j=1

ωj

in

order

to obtain the result. However, we need to guarantee that the ETTC mechanism ﬁnds an

equilibrium in the economy E. Otherwise, it is straightforward that the mechanism may not

be strategy-proof on valuations. Thus, in order to obtain the result the MS condition should

hold.

A.6 Proof of Theorem 4

Theorem 4: Suppose an economy that satisﬁes the strong MS condition, then a dropping proﬁle that satisﬁes the strong MS condition is a Nash equilibrium of the revelation game induced by the DGS mechanism.

Proof. Let (αij)j∈G be agent i true valuations and s∗ a dropping proﬁle. When all agents play a dropping strategy, the DGS mechanism stops at the ﬁrst step and ﬁnal prices are zero. Suppose that agent i gets good σ(i) under s∗ and thus, she gets a payoﬀ
82

ωi + αiσ(i). We have to prove that no agent beneﬁts from deviating. Let us analyze the beneﬁts from deviating that an agent j1 may have. If she announces other valuations but the good with the highest valuation is σ(j1), she gets the same payoﬀ. Then, suppose that she reveals a valuation vector in which the good with highest valuation is diﬀerent from σ(j1). We have two cases. Case 1: In the ﬁrst step of the algorithm j1 demands a good that belongs to an agent who is not in her original cycle. This case is described in Figure 1.

Figure 1

As in the ﬁgure, suppose agent j1 demands the good of agent i1 who belongs to the cycle (i1, i2, ..., ik). So the price of gi1 increases until agent j1 or ik cannot demand it.

Subcase 1.1: If ωik < ωj1 at some step ik stops demanding gi1 and begins to demand her own

good. As gik is also demanded by ik−1, the price of gik increases and ik demands gi1 again.

This process continues until agent j1 or ik−1 changes her demand. If ωj1 < ωk + ωk−1 + 2

at some step of the mechanism agent j1 cannot demand gi1 and demands another good,

and we are in Subcase 1.2. If ωj1 > ωk + ωk−1 + 2 we have that pi1 = ωk + ωk−1 + 2,

pik = ωk−1 + 1, agent j1 demands i1’s good, agents ik and ik−1 demand their own goods and

gik−1 is overdemanded. The process continues until j1 cannot demand gi1 or the following

step is reached: pi2 = 0, pi3 = ωi2 + 1, pi4 = ωi2 + ωi3 + 2, ..., pik =

k−1 s=2

ωis

+k

− 2, pi1

=

k s=2

ωis

+k

− 1.

Since

at

all

steps

of

the

process

pi2

<

pi1 ,

good

gi2

is

always

aﬀordable

by

agent i1. Thus, this subcase ﬁnishes when pi1 = ωj1 + 1 and j1 no longer demands good gi1

and Subase 1.2 is reached.

83

Subcase 1.2: If ωik > ωj1, at some step of the mechanism agent j1 cannot demand gi1 and demands the second good in her vector valuation. We have the following situations:

1. If j1 demands some good of the cycle (i1, i2, ..., ik), for example gi2, the previous process applies until p2 = ωj1 + 1. We have the same situation if j1 demands a good of a cycle diﬀerent from (i1, i2, ..., ik) and from the cycle to which she originally joins.

2. If j1 demands a good of her cycle but diﬀerent from her own good, we are in Case 2.

3. The last case is when she demands her own good. In that case, her good gj1 is overde-

manded and its price increases. Once again, as good gi2 is always attainable by agent

i1, the process ﬁnishes when pi1 =

p s=1

ωjs

+

p

and

all

agents

in

the

original

cycle

(j1, ..., jp) demand their own goods. It is in this case that pi1 reaches its highest value of

all the analyzed cases, which is less or equal than

n i=1

ωi

+n−1

(because

p

≤

n

− 1);

i=i1

this implies that at the end of the process i1 still demands gi2 and ik still demands gi1.

Indeed, since the economy satisﬁes the strong MS condition and pi1 ≤

n i=1

ωi

+ n − 1,

i=i1

we have that αi1i2 − αi1h ≥ pi1 for all good h. With the same argument it can be shown

that αiki1 − αikh ≥ pi1 for all good h.

Case 2: Finally, we have to study the case in which agent j1 demands a good from an agent of her cycle as in Figure 4 (the dotted arrow represents agent’s demand under s∗).

Figure 2 84

Suppose that when j1 changes her valuations, she demands the good of agent jp. So the price of gjp increases until one of the agents cannot demand it. If ωjp−1 > ωj1, at some step of the mechanism agent j1 cannot demand gjp and has to demand another good. If ωjp−1 < ωj1, the price of good gjp increases until ωjp−1 + 1 and agent jp−1 demands her own good, which is overdemanded. The process continues until j1 no longer demands good gjp or the cycle (j1, jp, ..., jq) is implemented and all agents of the original cycle that no belong to (j1, jp, ..., jq) are assigned to their own goods. In the last situation, since αip < αiσ(i) the payoﬀ of agent i is lower than the payoﬀ when she declares a dropping strategy.
A.7 Proof of Theorem 5
Theorem 5: Suppose an economy E = {(ei)i=1,...,n, V } such that:
1. it satisﬁes the WMS condition, 2. for each agent i, Oi(i) ≥ 2; that is, for each agent there is at most one good preferred
over her own good.
Then, the DGS mechanism stops and ﬁnds a competitive equilibrium.

Proof. In the ﬁrst round of the algorithm there is at least one cycle. The ﬁnal assignment

of goods is the one deﬁned by this cycle (or cycles) and other agents are assigned to their

own good. The formal proof is similar to the one of Theorem 3, Case 1. Speciﬁcally, we

have to show that the cycles that appear in the ﬁrst step of the mechanism remain formed

until the mechanism ﬁnishes. The maximum level that a price pi can achieve is when at the initial step of the mechanism agents can be indexed in an order {i, 1, 2, ..., n − 1} such that

i demands her good, 1 demands the good of agent i and j demands the good of agent j − 1

for j = 2, ..., n − 1. In this case, the ﬁnal value of pi is equal to

n−1 j=1

ωj

+

n

−

1.

Since in

this situation n = k, we ﬁnish the proof.

85

References
[1] A. Abdulkadirog˘lu and T. So¨nmez, House allocation with existing tenants, Journal of Economic Theory 88, 233-260 (1999).
[2] A. Abdulkadirog˘lu, T. So¨nmez, School choice: A mechanism design approach, The American Economic Review 93 (3), 729-747 (2003).
[3] T. Andersson, C. Andersson and A.J.J. Talman, Sets in Excess Demand in Ascending Auctions with Unit-Demand Bidders, CentER Discussion Paper 2010-51, 1-17 (2010).
[4] C. Bevi´a, M. Quinzii and J.A. Silva, Buying several indivisible goods, Mathematical Social Sciences 37, 1-23 (1999).
[5] G. Demange and D. Gale, The strategy structure of two-sided matching markets, Econometrica 53, 873-883 (1985).
[6] G. Demange, D. Gale and M. Sotomayor, Multi-Item Auctions, Journal of Political Economy 94 (4), 863-872 (1986).
[7] D. Gale, Equilibrium in a Discrete Exchange Economy with Money, International Journal of Game Theory 13, 61-64 (1984).
[8] D. Gale, The Theory of Linear Economic Models. New York: McGraw-Hill, 1960.
[9] P. Hall, On Representatives of Subsets, Journal of London Mathematical Society 10, 26-30 (1935).
[10] Y. Hwang and M. Shih, Equilibrium in a market game, Economic Theory 31, 387-392 (2007).
[11] O. Kesten, Coalitional strategy-proofness and resource monotonicity for house allocation problems, International Journal of Game Theory 38, 17-21 (2009).
[12] F. Kojima and P. Pathak, Incentives and Stability in Large Two-Sided Matching Markets, American Economic Review 99:3, 608-627 (2009). 86

[13] S. Lars-Gunnar, Nash Implementation of Competitive Equilibria in a Model with Indivisible Goods, Econometrica 59 (3), 869-877 (1991).
[14] S. Morimoto and S. Serizawa, Strategy-proofness and Eﬃciency with Nonquasi-linear Preferences: A Characterization of Minimum Price Walrasian Rule. Working Paper. 2012.
[15] P. Milgrom, Assignment Messages and Exchanges, American Economic Journal: Microeconomics 1 (2), 95-113 (2009).
[16] E. Miyagawa, House Allocation with Transfers, Journal of Economic Theory 100, 329355 (2001).
[17] M. Quinzii, Core and Competitive Equilibria with Indivisibilities, International Journal of Game Theory 13, 41-60 (1984).
[18] H. Saitoh, Existence of positive equilibrium price vectors in indivisible goods markets: a note, Mathematical Social Sciences 48, 109-112 (2004).
[19] L.S. Shapley and H.E. Scarf, On Cores and Indivisibility, Journal of Mathematical Economics 1, 23-28 (1974).
[20] L.S. Shapley and M. Shubik, The Assignment Game I: The Core, International Journal of Game Theory 1, 111-130 (1972).
[21] T. So¨nmez and U. U¨ nver, House allocation with existing tenants: A characterization, Games and Economic Behavior 69, 425-445 (2010).
[22] M. Sotomayor, A Simultaneous Descending Bid Auction for Multiple Items and Unitary Demand, Rev. Bras. Econ. 56 (3), 497-510 (2002).
[23] G. van der Laan, A.J.J Talman and Z.F. Yang, Existence of an equilibrium in a competitive economy with indivisibilities and money, Journal of Mathematical Economics 28, 101-109 (1997).
87

[24] J. Wako, Strong Core and Competitive Equilibria of an Exchange Market with Indivisible Goods, International Economic Review 4 (32), 843-852 (1991).
[25] Z. Yang, A competitive market model for indivisible commodities, Economics Letters 78, 41-47 (2003).
88

Chapter 4
Strategic Uncertainty and Unraveling
in Matching Markets
4.1 Introduction
We study unraveling in labor markets, and in matching markets in general. Unraveling is a phenomenon by which matches are made too early. They are made at a point in time when there is too little information about the quality of a match. The literature has documented many episodes of unraveling: the market for medical interns is a famous example, in which labor contracts for interns were signed two years before the future interns would graduate (see Roth (19) or Roth and Sotomayor (18)). Other examples of unraveling include the market for federal court clerks (Avery, Jolls, Posner, and Roth (1); Roth (23)), for gastroenterology fellows (Niederle and Roth (14, 15)), for college football games (Fr´echette, Roth, and U¨ nver (7); Roth (22)), and for placement in sororities (Mongell and Roth (13)).
We explain unraveling of the timing of oﬀers as the result of strategic unraveling. If some agents go early, it becomes more attractive for other agents to go early, which makes it more attractive for even more agents to go early. Our explanation is reminiscent of models of bank
This chapter was written under the supervision of Federico Echenique from the Division of the Humanities and Social Sciences at California Institute of Technology. I am very are grateful to him for encouragement and guidance. I also thank David Cantala, Seraf´ın Frache, Drew Fudenberg, Kaniska Dam, Alberto Pinto Andr´es Sambarino, Juan Gabriel Brida, Doron Zeilberger, Szilvia P´apai, Renzo Sprugnoli, Christoph Koutschan, Marcelo Lanzilotta, Gast´on Cayssials, Dami´an Gibaja, Pablo Sanch´ez Buelna, Benjam´ın Tello for their comments and suggestions and the seminar participants at the Free University of Bolzano and El Colegio de M´exico.
89

runs, where strategic complementarity makes agents undertake an ineﬃcient action because they are concerned that others may take this ineﬃcient action (Diamond and Dybvig (4)). As we shall see, the matching environment is quite diﬀerent from models of bank runs, but the basic logic of strategic unraveling is similar.
Strategic unraveling in our model proceeds as follows. There is a loss in eﬃciency when some agents go early: Information about the quality of the matches arrives late, so it is better for eﬃciency to wait until the information has arrived to make a match. If some agents go early anyway, this forces later matches to be less eﬃcient. The result is a negative externality that makes it more tempting for all agents to go early. So the externality may push some additional agents over the threshold by which they decide to go early. In turn, these additional agents going early makes it even more tempting to go early—and so on and so forth.
We show that, as a result of such strategic unraveling, any given agent is more likely to go early than go late. Our model assumes that there are two periods, and that there is incomplete information over the agents’ discount factor. We view the incomplete information simply as modeling device: as a way of generating the strategic uncertainty that allows the logic of unraveling to apply. If an agent goes early, she has no information about the quality of a match. If an agent goes late, then all information has been released, and matching is assortative on the quality of an agent as a partner (highest quality agents match with each other, the second highest match with each other, and so on).
The qualitative eﬀects of the negative externality are intuitive, but how far do they go? In our model, we can precisely calculate (and the heart of our arguments is indeed very combinatorial) the extent to which strategic unraveling pushes agents to go early. It turns out that unraveling goes all the way to making each individual more likely to go early than to go late. There are ways in which our model is rigged against unraveling. It makes late matching particularly attractive, and rules out unraveling purely as the result of coordination
90

failure (see Section 4.4). Yet the model produces early contracting as the modal outcome.1
A more precise statement of our results follows. We ﬁrst assume that only ﬁrms are strategic. Workers always accept the oﬀers they receive. In this environment, we show that there is always a full unraveling Bayesian Nash equilibrium, in which all ﬁrms make early oﬀers. Further, in any symmetric Bayesian Nash equilibrium, a ﬁrm makes an early oﬀer with probability at least 3/4.
If we assume that the prior over discount factors is uniform, we can say more. There are exactly two symmetric equilibria when the size of the market is at least 11. One is the full unraveling equilibrium, but it is unstable. In the second equilibrium, which is stable, agents go early with probability larger than 3/4. As the size of the market grows, the probability of going early in the second equilibrium converges to 3/4. If the number of agents is lower than or equal to 10, the unique symmetric Bayesian Nash equilibrium is the full unraveling equilibrium.
In second place, we consider a model where both sides of the market are strategic. Our results continue to apply (there is actually not a substantial conceptual diﬀerence between the two models). Among other things, we prove that in any symmetric Bayesian Nash equilibrium, the expected proportion of agents that match early is at least 1/2.
Our results reveal that there may exist an equilibrium pattern of adherence and nonadherence to the hiring dates. The market may become divided in equilibrium, with one segment hiring early, and the other waiting to match in the ﬁnal period with full information about agents’ qualities. We demonstrate that a mixed level of adherence can be sustainable
1Continuing with the similarity with bank runs, the result is reminiscent of the literature on global games, where basic assumptions on the structure of signals give a precise calculation of how far iterated elimination of dominated strategies will go (Frankel, Morris, and Pauzner (6)). There is, however, a clear diﬀerence with the literature on bank runs. A run can be explained purely by coordination failure. Agents’ payoﬀs in our model are biased against unraveling, and coordination failure alone would not suﬃce to make agents unravel (see Section 4.4 for a discussion of this issue).
91

in an equilibrium, which is consistent with the empirical evidence Avery, Jolls, Posner, and Roth (1).
4.2 Related Literature
Ours is the ﬁrst theoretical study that identiﬁes strategic uncertainty as the main force behind the unraveling of matching markets. One empirical investigation of the market for medical interns also attributes unraveling to strategic uncertainty: Wetz, Seelig, Khoueiry, and Weiserbs (27) write that early contracting is motivated by concerns over losing interns to other programs who operate outside of the centralized algorithm. Their explanation, based on agents’ observed behavior in the market, is essentially what we have tried to capture formally in the present paper.
The best-known episode of unraveling is the case of the market for hospital interns before 1945 (Roth (19); Roth and Sotomayor (18); Roth (21)). There is evidence that unraveling still exists in this market: Wetz, Seelig, Khoueiry, and Weiserbs (27) study out-of-match residency oﬀers during the year 2007. In the market for interns, some interns are allowed to take outside-the-match oﬀers (for instance, osteopathic medical students and international medical graduates). Wetz, Seelig, Khoueiry, and Weiserbs (27) ﬁnd that 15.7% of the total number of postgraduate year-1 positions available in the three primary care and four procedural and/or lifestyle-oriented specialities studied, were oﬀered outside the match. The authors conclude that about one in ﬁve positions in nonprocedural, primary care specialties were oﬀered outside the match and, thus, the situation is similar to that which existed before 1952.
One classic explanation of unraveling is the “stability hypothesis,” as formulated by Roth (20) and Kagel and Roth (9). This hypothesis aﬃrms that unraveling will be prevented if once the relevant information is revealed, a stable matching is implemented through a clearinghouse. The idea is that, in some sense, the market is trying to establish a stable matching. It simply may be doing so in an ineﬃcient manner. Our paper provides some
92

justiﬁcation for central clearing houses. There is a clear eﬃciency gain from late contracting in our model, and late contracting equals a stable matching. The agents’ strategic behavior prevents the market from reaching this stable matching, and makes the market unravel.
A handful other papers provide theoretical explanations for unraveling. They focus on diﬀerent mechanisms than the one we have studied here.
Li and Rosen (10) and Li and Suen (11) study a model with transfers (a model based on Shapley and Shubik (25) assignment game) in which early contracting provides insurance. They show that unraveling may occur among workers who appear to be most promising a priori, before full information is revealed. In a similar framework, Li and Suen (12) allow for unproductive ﬁrms and ﬁnd multiple equilibria with unraveling. They show that more ﬁrms and workers will contract early if the uncertainty about the number of productive workers is higher and the more risk-adverse agents are. As we explain in Section 4.4, our model does not have an insurance motive for early contracting, and focuses on a diﬀerent explanation for unraveling.
Damiano, Li, and Suen (3) present an explanation of unraveling that is based on search and matching. Agents know their qualities, so there is no informational gain from matching late, but an agent may not meet a partner of suﬃciently high quality in a given period. If there are costs to searching, then there is unraveling in how willing agents are to accept a partner. In Damiano, Li, and Suen (3), unraveling is triggered by search costs. In our model, it is triggered by incomplete information.
Du and Livne (5) consider the role of transfers in unraveling. They show that, in the absence of transfers, and in the limit as the market size grows, a substantial number of agents will contract early. Unraveling in their paper happens because new agents arrive over time, and agents who are in relatively high positions may want to contract early because the new arrivals may be of higher match qualities. In contrast, in a ﬂexible-transfer regime, agents will not unravel.
93

Niederle, Roth, and U¨ nver (16) explain unraveling as the result of an imbalance between demand and supply. Unraveling arises when there is a surplus of applicants, but a shortage of high quality applicants. When a worker does not know if she will be in the long or short side of the market, she may ﬁnd early oﬀers made by low quality ﬁrms attractive. For such ﬁrms, early oﬀers is the only way to employ high quality workers.
Halaburda (8) proposes that the key to explaining unraveling is the similarity of ﬁrms’ preferences. Workers’ preferences for ﬁrms are identical, and known from the start, but ﬁrms learn their preferences for workers in the second period. If ﬁrms’ preferences are similar, then ﬁrms tend to prefer the same workers. Thus, worse ﬁrms may have better chances to hire their most preferred candidates if they make early oﬀers. So, if ﬁrms’ preferences are suﬃciently similar, it is likely that some ﬁrms will go early. In our model, although preferences are identical, this feature does not explain unraveling. An agent may be concerned about being one of the worst agents in the market, but she would still prefer to wait and contract in the second period. Early contracting in our model is ineﬃcient for every agent. As we show below, the strategic uncertainty over how many other agents go early is the main mechanism behind incentives for some agents to match early.
4.3 The model and results
We present a model of one-to-one matching between workers and ﬁrms. In our model, we adopt the language of the medical interns market. The workers are doctors, and ﬁrms are hospitals.
Let H and D be two ﬁnite and disjoint sets: H is the set of hospitals, and D the set of doctors. Suppose that |H| = |D| = n, so we can identify H and D with (copies of) {1, . . . , n}.
A matching is a function µ : H ∪ D → H ∪ D such that, for all h ∈ H and d ∈ D,
1. µ(h) ∈ D ∪ {h} and µ(d) ∈ H ∪ {d}
94

2. d = µ(h) if and only if h = µ(d).
The meaning of µ(h) = h is that the position of hospital h remains unﬁlled, and µ(d) = d means that doctor d does not ﬁnd a job.
Each doctor d and hospital h is assigned a quality πD(d) ∈ {1, . . . , n} and πH(h) ∈ {1, . . . , n}.
Suppose that πH and πD are permutations of {1, . . . , n}, so we can think of quality as the rank of a hospital or doctor in the market. The highest-ranked hospital is h such that πH(h) = n, for example. If doctor d is hired by hospital h, then they obtain utilities that depend on their qualities, ud(πD(d), πH(h)) is the utility to d and uh(πD(d), πH(h)) is the utility to h. If an agent remains unmatched, then she obtains a utility of zero.
A matching µ is stable if there is no pair (h, d) such that ud(πD(d), πH(h)) > ud(πD(d), πH(µ(d))) and uh(πD(d), πH(h)) > uh(πD(µ(h)), πH(h)).
We assume that ud and uh are multiplicative; that is: ud(i, j) = uh(i, j) = ij. Remark 1. There is a unique stable matching, the matching µ(i) = i (the identity matching).
4.3.1 Matching over time: early or late oﬀers
The model is a stylized environment with two periods. In the ﬁrst period, match qualities πH and πD are not known. In the second period, a pair (πH, πD) is drawn at random, uniformly and independently. A match is formed among the agents who wish to match in period t = 0: all agents are identical at that point, so the matching is purely random. In the second period, when match qualities are known, a stable matching is formed among the agents that did not match in the ﬁrst period.
Our purpose is to focus on the strategic motivations for going early: we study the simultaneousmove game in which hospitals decide whether to go early and match at time t = 0, or to
95

wait and match at time t = 1. In particular, we assume that only hospitals are strategic and that matchings are automatic. In period t = 1 the matching is assortative among the agents who have not matched in period t = 0; the assortative matching is the unique stable matching under our assumptions. In period t = 0, matching is random because no agent has any information on match qualities.
In Section 4.3.4 we present results where both doctors and hospitals are strategic. Our results essentially continue to hold when both sides are strategic, but we choose to present ﬁrst the model in which only hospitals are strategic. The reason is twofold. First, there is no deep conceptual diﬀerence between the two cases. Indeed, we use the results in this section to prove the results of Section 4.3.4. In second place, the discussion of unraveling in Roth (19) suggests that, in the hospital-interns market, only hospitals are strategic.
Each agent i ∈ H ∪ D has a discount factor δi. The utility at t = 0 when h and d match in period t is given by
δht uh(πD(d), πH (h)) = δht πD(d)πH (h), and δdt ud(πD(d), πH (h)) = δdt πD(d)πH (h),
to h and d, respectively.
The following timeline describes how events unfold.

δi drawn

t = 0 oﬀers π realized t = 1 oﬀers

We proceed to describe the payoﬀs from making an early vs. a late oﬀer to match. At time

0, qualities are purely random. So if a hospitals h matches in period 0 its expected utility is

Ue

=

1 n2

n i=1

n j=1

ij

,

the

expected

value

of

the

product

ij

when

i

and

j

are

random.

In period 1, agents have learned the values of πD and πH. The matching will be assortative among the agents who have not matched early. Assortative means that the doctor with

96

the highest value of πD(d) will match with the hospital with the highest value of πH(h), the doctor with the next-highest value of πD(d) will match with the hospital with the nexthighest value of πH(h), and so on.

Now, it is complicated to calculate the expected utility of going late because the calculation depends on how many agents go early. If m agents have left the market in time t = 0, then the assortative matching matches the highest available hospital and doctor, but the actual highest-quality matches may have left early. The problem is compounded as we consider the second-highest qualities, the third-highest, and so on.

One special case is simple to calculate. Consider a given hospital h. If all other hospitals

wait to make oﬀers in period t = 1, then the expected utility to hospital h, in period 0, of

waiting

for

period

1

is

δh

1 n

n i=1

i2

.

In general, if m hospitals have left the market, we write Um for the expected value of πH(h)πD(µ˜(h)), where πH and πD are random, and µ˜ is the (random) assortative matching in period 1. The matching µ˜ is determined by the realization of match qualities πH and πD, including the qualities of the m hospitals, with corresponding doctors, who have left the market. That is, when m hospitals exit the market at t = 0, Um is the expected utility to a hospital of waiting for t = 1.

The following is an important technical result in our paper.

Lemma 1.

(n + 1)2(2(n − m) + 1)

Um =

. 6(n − m + 1)

An important consequence of Lemma 1 is that Um > Um+1. The diﬀerence Um+1 − Um is the negative externality imposed by a hospital-doctor pair who match early on the agents who decide to match late. It is important to note that the negative externality increases with m, so that additional agents going early increase the incentives of any given agent to go early. This eﬀect vanishes as the market grows large, which helps to stabilize the number of agents who go early in a large market (see the discussion after Corollary 3 on page 116).
97

Section 4.5 gives a precise deﬁnition of the quantity Um and presents a proof of Lemma 1.

4.3.2 Incomplete information

We now introduce a Bayesian game in which hospitals may make early oﬀers due to the strategic uncertainty over how many other hospitals go early.

We assume that δh ∈ [0, 1] is the private information of hospital h. The type of an agent h is therefore δh. All agents share the prior that the diﬀerent δh are drawn independently from a distribution over [0, 1] with cumulative distribution function (cdf) F . We assume that x ≤ F (x) for all x ∈ [0, 1]: the assumption is satisﬁed for any distribution with a concave cdf. For example the uniform, or truncated normal, distributions on [0, 1] satisfy our assumption.

A strategy for a hospital h is a function

sh : [0, 1] → {0, 1},
where sh(δh) is the period in which hospital h makes its oﬀer. In our model, there is no decision to be made other than when to match.

Given a proﬁle of strategies s = (s1, . . . , sn), we write s−h for the proﬁle of strategies of

hospitals other than h. Given a proﬁle s−h, for each realization of δ−h, s−h determines

m, the number of hospitals, other that h, that go early. Thus, s−h deﬁnes a probability

distribution for m. Given a proﬁle s−h, m is a random variable, and so it is Um with a

distribution deﬁned by F . Then, we can compute the expected value of Um given s−h (see

Lemma 1), which is denoted by Es−hUm. We write δhEs−hUm for the expected utility at time

0, to hospital h, of waiting for t = 1 to make an oﬀer, if all hospitals other than h have the

proﬁle of strategies s−h: Es−hUm =

n−1 i=0

P r(m

=

i)

Ui,

where

as

we

just

noted,

P r(m

=

i)

is calculated from s−h and F .

98

Given a proﬁle s−h, a hospital h will decide to go early if and only if

Ue ≥ δhEs−h Um

(1)

(recall that Ue is the expected utility of making an early oﬀer). So a strategy sh is a best response to s−h if for every δh, sh(δh) = 0 iﬀ (1) is satisﬁed.

A proﬁle of strategies s = (s1, . . . , sn) is a Bayesian Nash equilibrium (BNE) if (1) is satisﬁed for each h ∈ H. A BNE is symmetric if sh = sh for all h, h ∈ H. A BNE is full unraveling if sh = 0 for all h ∈ H. Thus, in a full unraveling BNE, all agents go early no matter their type. Theorem 1. If n ≤ 10 then the unique symmetric BNE is the full unraveling BNE. If n > 10 then there is at least one symmetric BNE, namely the full unraveling BNE; moreover, in any symmetric BNE s = (s1, . . . , sn) we have that
P r(sh = 0) ≥ F (3/4) ≥ 3/4,
for all h ∈ H.

Theorem 1 says that any hospital, in any symmetric BNE, is more likely to go early than late. The equilibrium probability of going early is at least 3/4. It is therefore immediate that: Corollary 1. In any symmetric BNE, the expected number of hospitals that go early is at least nF (3/4) ≥ n3/4.

4.3.3 Stability of BNE – Uniform F
In this section we entertain an additional assumption. We suppose that the prior distribution F is the uniform cdf. In this case, we can make more precise statements about the set of BNE in our game. We can also talk about the stability of equilibria.
As we shall see, for large n, in the unique stable equilibrium, the market is divided. Most of the market (3/4 of all hospitals) go early, while the rest wait and contract late. Thus our
99

results with a uniform F can explain some of the empirical ﬁndings where only part of the market unravels. Theorem 2. Let F be the uniform cdf. If n ≤ 10 then the unique symmetric BNE is the full unraveling BNE. If n > 10 then there are exactly two symmetric BNE. One is the full unraveling BNE. The second is a BNE sn = (sn1 , . . . , snn) in which for every h ∈ H

P r(shn

=

0)

≥

3/4

=

lim
n→∞

P r(shn

=

0).

Remark 2. The proof of Theorem 1 actually follows from Theorem 2. We lay out the details in Section 4.7.

We discuss a notion of stability of BNE. Stability allows us to select a symmetric BNE in the cases in which there is more than one. It turns out that the full unraveling BNE is stable when n ≤ 10 and the equilibrium denoted by sn in Theorem 2 is the unique stable symmetric BNE when n > 10.
A strategy sh satisfying Equation (1) is characterized by a threshold δ¯h ∈ [0, 1] such that sh(δh) = 0 if δh ≤ δ¯h and sh(δh) = 1 if δh > δ¯h. Given identical thresholds δ¯−h = δ¯ for all hospitals other than h, we can let βn(δ¯) be the threshold for hospital h deﬁned by Equation (1).
A symmetric BNE is then described by a single δ¯ ∈ [0, 1] with the property that
δ¯ = βn(δ¯).

The function βn is the best-response function of our game. The symmetric BNE are the ﬁxed points of βn. The following ﬁgure shows the graph of βn for n = 3, 7, 11, 15, 17. A symmetric BNE δ¯ is stable if there is an open interval I of δ¯ in [0, 1] such that for all δ ∈ I
1. δ < βn(δ) when δ < δ¯, and 2. δ > βn(δ) when δ > δ¯.
100

Figure 3: The graph of βn for n = 3, 7, 11, 15, 17.
A symmetric BNE that is not stable is unstable.
In the examples in Figure 3, it is evident that the full unraveling BNE is stable when it is unique. For larger n, we have two BNE. The smaller BNE is stable, while the full unraveling BNE is unstable. The picture that emerges from Figure 3 holds more generally: Proposition 1. Let F be the uniform cdf. If n ≤ 10 then the full unraveling BNE is stable. If n > 10 then the symmetric BNE denoted by sn in Theorem 2 is stable while the full unraveling BNE is unstable.
4.3.4 Strategic doctors
We now assume that doctors are strategic as well. We consider the simultaneous-move game in which the players are H ∪D. Each agent has to decide whether to match in period t = 0 or t = 1. So the set of available actions is {0, 1} to each player. Agents’ strategies are functions si : [0, 1] → {0, 1}, with i ∈ H ∪ D.
When doctors are strategic, the probability that m agents go early is the probability that the minimum between the hospitals and the doctors that make oﬀers at period t = 0, equals m. For any proﬁle of strategies s, and any realization of types (δi), the number of agents who
101

exit the market is the minimum of two quantities, the number of hospitals h with sh(δh) = 0, and the number of doctors d with sd(δd) = 0.
Thus, given a proﬁle of strategies of all agents other than h, the expected value of Um, Es−hUm, involves the probability distribution of the minimum of two independent binomial random variables, instead of a single binomial random variable as in the previous case. The number m is drawn according to the minimum of two binomial distributions.
The calculations performed in the proof of Theorem 1 are still suﬃcient to give us the following result. Theorem 3. There is at least one symmetric BNE, namely the full unraveling BNE. In any symmetric BNE s = (si)i∈H∪D, for every i ∈ H ∪ D we have that
P r(si = 0) ≥ F (1/2) ≥ 1/2.
Corollary 2. In any symmetric BNE, the expected number of agents that go early is at least nF (1/2) ≥ n/2.
The results in Section 4.3.3 extend to the case when doctors are strategic. We obtain the following result. Theorem 4. Let F be the uniform cdf. If n > 10, then there are exactly two symmetric BNE. One is the full unraveling BNE, which is unstable. The second is a stable BNE s = (si)i∈H∪D such that P r(si = 0) ≥ 1/2 for every i ∈ H ∪ D.
4.4 A discussion of our model
Our model has two speciﬁc assumptions that merit some additional discussion.
Payoﬀs. We assume that payoﬀs are multiplicative, a common assumption in applied matching theory (see e.g. Bulow and Levin (2), Damiano, Li, and Suen (3), and many other papers). In our particular case, there are two reasons for working with multiplicative payoﬀs.
102

First, a parametric assumption about payoﬀs is unavoidable when we are trying to precisely calculate the probability that an agent will go early. As such, the multiplicative form is natural.
The multiplicative assumption also makes sense as a way of abstracting from other possible explanations of unraveling. We did not want an explanation of unraveling that was based on the insurance value of going early (an avenue explored by Li and Rosen (10)). We assumed payoﬀs for which there is a clear advantage to going late, not early. In our model, agents are risk neutral, and even though an agent may end up with a low quality, there is not enough insurance in going early to compensate from the gain in eﬃciency from a late assortative matching. The multiplicative model implies that, even though an agent may be concerned about a bad draw of their quality, the gains from matching assortatively outweigh the temptation to match to an average partner in t = 0.
Roth (19) suggests that unraveling is the result of a prisoners’ dilemma game among the hospitals. The implication is that it is a dominant strategy for the hospitals to go early. Our focus is on the strategic channel, whereby agents go early because of their concerns that others go early (and the consequence negative externality). By our assumptions on preferences, we rule out that it is dominant for agents to go early.
It is still possible to generate unraveling by way of a coordination failure, as in the literature on bank runs (Diamond and Dybvig (4)). In our model, however, and in contrast to the model of bank runs, such unraveling is unstable. Only when all agents are certain that all other agents want to go early, are they willing to go early. This would be an unstable situation: It is easy to rule out such an outcome if agents’ beliefs may depart from certainty that everyone goes early. In contrast, we show that there is in our model a stable equilibrium in which agents are more likely to go early than to go late. Coordination failure is still present in that equilibrium, but unraveling arises through the channel of strategic unraveling.
Finally, the multiplicative model also captures the negative externality imposed by agents who go early on the rest of the market. There is an eﬃciency loss when some agents go
103

early; they hurt the rest of the agents (even in a model without transfers like ours).
Information. The second assumption that deserves mention is our informational assumption. We assume that agents are completely ignorant about match qualities at date t = 0. The assumption is extreme, and it is meant to focus the model on the trade-oﬀ between the value of the information revealed at t = 1, and the incentives to go early. By assuming that there is no information at time t = 0, and full information at t = 1, we have biased the model against the unraveling outcome.
That said, it may not be an unrealistic assumption. From Roth and Xing (24): “oﬀers are being made so early that there are serious diﬃculties in distinguishing among the candidates.” So our assumption of complete ignorance over match qualities may reﬂect the actual situation in the markets where we observe unraveling.
Finally, we use an assumption of the cdf F that allows us to exploit the results obtained in the case when F is uniform. The assumption that x ≤ F (x) means that F is smaller in the sense of ﬁrst-order stochastic dominance, than the uniform distribution. Again, we need the uniform distribution to make precise calculations, and then the inequality on F allows us to obtain bounds. As we remarked above, the assumption on F is satisﬁed when F is concave.

4.5 Proof of Lemma 1

In this Section we present, in the ﬁrst place, a formula for U1 which clariﬁes the meaning of this quantity. Then, a algorithm to compute Um in the general case is introduced (Proposition 2). Lemmas 2 and 3 deduce a simple formula for Um.

Recall that U0 is the expected utility from waiting when all other hospitals wait. Then:

1 U0 = n

n

i2

=

(n

+

1)(2n

+

1) .

6

i=1

104

4.5.1 Computing U1 We compute the expected utility from waiting, when only one pair of hospital-doctor goes early. In period 1, after permutations πH and πD are drawn, sets H and D can be ordered according to agents’ quality. Then, consider the sets H and D described as: H = {1, 2, . . . , n} and D = {1, 2, . . . , n}, where the ﬁrst agent is the lowest-quality agent, and the last agent is the highest-quality agent. First, conditional on being of quality i, the leaving hospital is of a higher quality than i with probability (n − i)/(n − 1), and of a lower quality than i with probability (i − 1)/(n − 1). This is deduced from the fact that there are n − 1 possible qualities for the hospital that leaves early, (n − i) of those are higher than i and (i − 1) lower than i. Figure 2 may help to make the computations.
Figure 4: Computing U1 If the leaving hospital is of a higher quality than i, this means that hospital i is better oﬀ, unless the doctor that leaves with hospital i is also a “good” doctor: unless the doctor that leaves is one that would be matched in the second period with a hospital better than i. This happens with probability (n − i)/n. With the complementary probability, i/n, hospital i
105

is better oﬀ by the better hospital leaving. Being better oﬀ means that hospital i will be matched in the second period with a doctor with a quality one unit higher than i (i.e., a doctor of quality (i + 1)), which is worth i to a hospital of quality i.

If the leaving hospital is of a lower quality than i, then this does not aﬀect hospital i and it gets i2; unless the doctor that leaves used to be with a better hospital, or with i, in which case hospital i goes down one step. To a hospital of quality i, losing one step is worth −i. So in the event that a hospital of lower quality than i leaves (which has probability (i − 1)/(n − 1)) it gets i2 for sure but it loses −i with probability (n − i + 1)/n, the probability that the partner of the hospital that goes early is of a quality greater than or equal to i.

So:

1n U1 = n

n−i

i2 +

i i

i−1 +

i2

−

n

−

i

+

1 i

n−1

n n−1

n

.

i=1

Since the terms that multiply i2 add to 1, this gives:

1n U1 = n

i2 +

i

(2n − 1)(n + 1)2

(n − 2i + 1) =

.

n(n − 1)

6n

i=1

Note that U1 can be also expressed as:

1 n (n − i) i (i − 1) (n − i + 1)

n+1

U1 = U0 + n

i− (n − 1) n (n − 1)

n

i

= U0 −

. 6n

i=1

The intuition behind this equation is the following. Notice that with probability (n−i)/(n−1) the hospital that leaves early is of a higher quality than i and with probability (i − 1)/(n − 1) is of a lower quality than i. Then, ((n − i)/(n − 1))(i/n) is the probability that the hospital that leaves early is of a higher quality than i and the doctor it hires is of a quality lower than or equal to i. In this event, hospital i increases its utility by i. If the hospital that goes early is of quality lower than i and it hires a doctor of quality higher than or equal to i, which happens with probability ((i − 1)/(n − 1))((n − i + 1)/n), then hospital i decreases its utility by i. Therefore, U1 can be expressed as U0 plus the expected utility derived from

106

the

leaving

of

a

pair

of

hospital-doctor.

Moreover,

−

n+1 6n

is

the

negative

externality

imposed

on the rest of the market by the ﬁrst pair of hospital-doctor that decide to match early.

Clearly, this argument is very hard to generalize if we consider more than one pair of hospitaldoctor that goes early. In the following Section, we develop an algorithm to compute the expected utility from waiting when m pairs of hospital-doctor leave the market at t = 0.

4.5.2 An algorithm to compute Um
In this section, we introduce an algorithm to compute the value of Um in the general case. First, we deﬁne the payoﬀ matrix U as follows: the element (i, j) of U is the utility that a doctor of quality i has when she is hired by a hospital of quality j (which is also the utility of the hospital). In particular, the elements of the ﬁrst column of U are the utilities that the hospital of quality 1 has if it hires a doctor of quality 1, 2, . . . , n. Note that the elements of the main diagonal of U are: 1, 4, . . . , i2, . . . , n2, which are the payoﬀs that each agent has when no pair of hospital-doctor leaves early. Thus, matrix U is:



1

2

3 . . . (n − 1)

 n





 

2

4

6

. . . 2(n − 1)

2n

 





 

3

6

9

. . . 3(n − 1)

3n

 





 

.





 

.

 

.

 





 

.

 





(n − 1) 2(n − 1) 3(n − 1) . . . (n − 1)2 n(n − 1)





n

2n

3n . . . n(n − 1) n2

When a hospital makes an oﬀer at t = 0 and hires a doctor, both the hospital and the doctor may be of any quality. So, to compute the expected utility of a hospital that waits, we have to consider all possible qualities combinations. Assume that the hospital that leaves is of
107

quality j and the doctor that it hires is of quality i. If only this pair of hospital-doctor leaves the market at t = 0, in the second period the utilities of hospitals and doctors that do not leave the market are given by the assortative matching. Indeed, the highest quality hospital (between those that remain in the market) will hire the highest quality doctor of those that do not exit the market. The same argument holds for all agents.

Therefore, when doctor i is hired at t = 0 by hospital j, the utilities of hospitals and doctors that remain in the market in the second period, are the elements of the main diagonal of the submatrix of U that it is obtained from deleting the row i and the column j. To consider all possible combinations for the quality of the hospital that leaves early and the doctor that it hires, we have to go over all the elements of U. Thus, to compute the expected utility from waiting when only one pair of hospital-doctor leaves at t = 0, we have to compute all the submatrices of U obtained by deleting one row and one column, for each one of these submatrices we ﬁnd its trace, we sum all these traces and, ﬁnally, we have to divide the sum by n2(n − 1), since there are n2 possible pairs of qualities for the hospital and the doctor that go early, and n − 1 possible qualities that a hospital that waits may be assigned to in the second period..

If m hospitals make an oﬀer at t = 0, we generalize the previous argument as follows.

Consider all submatrices of U that result when m rows and m columns are deleted. There

are

n m

n m

submatrices that can be found. In each case, there are (n − m) possible qualities

for a hospital that waits. Thus, for each submatrix, compute its trace. Um is the sum of all

the computed traces after dividing it by

n m

n m

(n − m) =

n2(n−1)2...(n−m+1)2 (m!)2

(n

−

m).

The following proposition states this result.2

Proposition 2. Let Um be expected utility to a hospital of waiting for the second period when m hospitals (with their respective doctors) have left the market at t = 0. Denote by T (n, m) the sum of the traces of all submatrices of U when m rows and m columns are deleted.
2The algorithm can be also applied with other functions uh and ud whenever the functions are strictly supermodular on the lattice {1, 2, . . . , n}2.
108

Then:

T (n, m)(m!)2

1

Um

=

n2(n

−

1)2

. . . (n

−

m

+

1)2

. (n − m)

To come up with an expression for Um, the next step involves the computation of T (n, m). The following lemma ﬁnds a formula for T (n, m). Then, we obtain a reduced expression of the formula by means of some combinatorial identities.

Lemma 2. Denote by T (n, m) the sum of the traces of all submatrices of U obtained by deleting m rows and m columns. Then:

n

m

T (n, m) =

i2

i=1

k=0

i−1 n−i k m−k

2
+

m n−j

m i + j − 1 n − (i + j)

n−i

i−1

2

i(i + j)

.

k

m−k m−k+j k−j

j=1 i=1

k=j

Proof. First we consider the elements of the main diagonal of U, and then, the remaining elements.

(ii)-elements:

Consider an element ii of the matrix and suppose we delete m rows and m columns. Note that there are i − 1 rows (columns) above (at the left of) the element ii and n − i rows (columns) below (at the right). When we delete columns and rows, the element ii remains in the main diagonal if the number of rows that are deleted above ii is equal to the number of columns that are deleted from the left of ii. That is, if we delete k rows above ii and m − k rows below, then we have to delete k columns at the left and m − k columns at the right. Thus, the number of submatrices in which the element ii is in the main diagonal is:
m i−1 n−i 2 .
k m−k
k=0
Since the element ii in the matrix is i2, the share of T (n, m) that corresponds to the elements of the main diagonal of U is:
109

(ij)-elements:

n

m

i2

i=1

k=0

i−1 n−i 2 .
k m−k

Since U is a symmetric matrix, the trace of the submatrix that we obtain by deleting rows i1, i2, . . . , im and columns j1, j2, . . . , jm is equal to the trace of the submatrix obtained by deleting rows j1, j2, . . . , jm and columns i1, i2, . . . , im. Thus, we only have to consider the elements i(i + j) for j > 0, and take two times the ﬁnal result. In particular, when only one row and one column are deleted, the elements that will be in the main diagonal of some submatrix are those of the form i(i + j) for i = 1, . . . , n − 1 and j = 1. When two rows and two columns are deleted, the elements to be considered in T (n, m) are the previous elements and those of the form i(i + j) for i = 1, . . . , n − 2 and j = 2. In general, when m rows and m columns are deleted we have to consider all the elements that were contemplated when m − 1 rows and m − 1 columns were deleted, and those of the form i(i + j) for i = 1, . . . , n − m and j = m.

As we just noted, when we delete m rows and m columns, the elements that are in the trace of some submatrix are those of the form i(i+j) with j = 1, 2, . . . , m. So, consider an element i(i + j). This element has i − 1 rows above and n − i below. Moreover, it has i + j − 1 columns at the left and n − (i + j) columns at the right. Suppose we delete k columns at the left of i(i + j) and m − (i + j) at the right. Now the element is in column i + j − k. In order to be in the main diagonal of a submatrix, it should be that: j − k ≤ 0. Moreover, we have to delete k − j rows above the element i(i + j) to ensure that the element is in the main diagonal of a submatrix.

Then, the share of T (n, m) that corresponds to these elements is:

m n−j

m i + j − 1 n − (i + j) i − 1

n−i

2

i(i + j)

.

k

m − k k − j m − (k − j)

j=1 i=1

k=j

110

Lemma 3. For n ∈ N and m ∈ 1, 2, . . . , n − 1 it holds that:

T (n, m) =

n+1 2

n−m
i2

.

m

i=1

The following proof was provided to us by Doron Zeilberger.

Proof. The proof is organized in ﬁve claims.

Claim 1: T (n, m) can be written as:

i + j − 1 n − (i + j)

n−i

i−1

i(i + j)

,

k

m−k m−k+j k−j

i,j,k

where the summation range is over all triples (i, j, k), with the convention that the binomial

coeﬃcient

r s

is zero if it is not the case that 0 ≤ s ≤ r.

Proof Claim 1

In the proof of the last lemma we found an expression for T (n, m) using the symmetry of

the matrix U. If we do not use the symmetry we obtain the following equivalent expression:

n

m

T (n, m) =

i2

i=1

k=0

i−1 n−i 2 +
m−k k

m n−j

m i + j − 1 n − (i + j)

n−i

i−1

i(i + j)

+

k

m−k m−k+j k−j

j=1 i=1

k=j

m n−i

m i + j − 1 n − (i + j)

n−j

j−1

j(i + j)

.

k

m−k m−k+i k−i

i=1 j=1

k=i

Note that for each j = 1, . . . , m, the range for i is 1 ≤ i ≤ n − j, and for each i = 1, . . . , m,

the range for j is 1 ≤ j ≤ n−i. Thus, we can write these conditions as: 1 ≤ i ≤ n, 1 ≤ j ≤ n

and 1 ≤ i + j ≤ n. Now, consider the sum:

i + j − 1 n − (i + j)

n−i

i−1

i(i + j)

.

k

m−k m−k+j k−j

i,j,k

111

The implicit range for each variable is: j ≤ k ≤ m, 1 ≤ i ≤ n, 1 ≤ j ≤ n and 1 ≤ i + j ≤ n. This implies that both sums are equal.
Claim 2: The sum of Claim 1 equals:

n
a

min(a−1,m)

a=1 k=max(0,a−(n−m))

a−1 k

n − a a−k+m

n−i

i

m−k

m−k+a−i

i=a−k

i−1 .
k−a+i

Proof Claim 2

Writing a = i + j, (and leaving i as a discrete variable, but letting j = a − i), the sum of the last claim is equal to:

a−1 n−a

n−i

i−1

ia

.

k m−k m−k+a−i k−a+i

a,k,i

Note that summation range of each variable is deﬁned by:

1. For a: 1 ≤ a ≤ n.
2. For k: 0 ≤ k ≤ m, 0 ≤ m − k + a − i ≤ n − i and 0 ≤ k ≤ a − 1. This implies that max(0, a − (n − m)) ≤ k ≤ min(a − 1, m).
3. For i: 1 ≤ i ≤ n, 0 ≤ m − k + a − i and 0 ≤ k − a + i. This implies that a − k ≤ i ≤ m − k + a.

Then, the last sum equals the iterated summation:

n

min(a−1,m) a−k+m

ia

a=1 k=max(0,a−(n−m)) i=a−k

a−1 k

n−a m−k

n−i m−k+a−i

i−1 .
k−a+i

Which is equivalent to:

n
a

min(a−1,m)

a=1 k=max(0,a−(n−m))

a−1 k

n − a a−k+m

n−i

i

m−k

m−k+a−i

i=a−k

i−1 .
k−a+i

112

Claim 3: The innermost sum is:

a−k+m

n−i

i

m−k+a−i

i=a−k

i−1

n+1

= (a − k)

.

k−a+i

m

Proof Claim 3

First

note

that:

i

i−1 k−a+i

= (a − k)

i a−k

.

Then

we

have:

a−k+m

n−i

i

m−k+a−i

i=a−k

i−1

a−k+m

n−i

= (a − k)

k−a+i

m−k+a−i

i=a−k

i .
a−k

Now, notice that:

a−k+m

n−i

m−k+a−i
i=a−k

i

m n − (a − k + i)

=

a−k

m−i

i=0

a−k+i .
a−k

Since

a−k+i a−k

=

a−k+i i

,

the

last

sum

can

be

written

as:

m n − (a − k + i) m−i
i=0

a−k+i .
i

Which is equal to:

m (n − m − a + k) + m − i m−i
i=0

a−k+i .
i

Finally, we use the Vandermonde-Chu identity (Sprugnoli (26), page 54):

n x+k k
k=0

y+n−k

x+y+n+1

=

.

n−k

n

Deﬁning x = a − k and y = (n − m − a + k), we have:

m (n − m − a + k) + m − i m−i
i=0

a−k+i

x+y+n+1

n+1

=

=

.

i

n

m

Claim 4: For the middle sum it holds that:

min(a−1,m)
(a − k)
k=max(0,a−(n−m))

a−1 k

n−a

n−1

n−2

=a

− (a − 1)

.

m−k

m

m−1

113

Proof Claim 4

First, we divide the sum:

min(a−1,m)
(a − k)
k=max(0,a−(n−m))

a−1 k

n−a m−k

min(a−1,m)
=a
k=max(0,a−(n−m))

a−1 k

n−a m−k

min(a−1,m)

−

k

k=max(0,a−(n−m))

a−1 k

We use the Vandermonde-Chu identity (Sprugnoli (26), page 53):

nx k
k=0

y

x+y

=

.

n−k

n

And the ﬁrst sum is:3

min(a−1,m)
a
k=max(0,a−(n−m))

a−1 k

n−a

n−1

=a

.

m−k

m

n−a .
m−k

If

we

replace

k

a−1 k

=

(a − 1)

a−2 k−1

in the second sum, we have:

min(a−1,m)
(a − 1)
k=max(0,a−(n−m))

a−2 k−1

n−a ,
m−k

which is equal to:

m

a−2

(a − 1)

m−1−k

k=0

By the Vandermonde-Chu identity, the sum is:

n−a .
k

n−2

(a − 1)

.

m−1

Claim 5: Finally, we have:

T (n, m) =

n+1 2

n−m
i2

.

m

i=1

3Note that max(0, a − (n − m)) = 0. Indeed, if (a − (n − m)) > 0, we have n − a − m − k < 0 and thus,

n−a m−k

= 0. Also, we can write the sum up to k = m, because for k = a, a + 1, . . . , m,

a−1 k

= 0.

114

Proof Claim 5

Since the last claims we know that:

n+1 T (n, m) =
m

n−1

n
a2

−

n−2

n
a(a − 1) .

m

m−1

a=1

a=1

Then, compute:

n+1 m

n−1 m

n
a2

−

n−2

m−1

a=1

n
a(a − 1)
a=1

n+1

(n − 1)! n(n + 1)(2n + 1)

=

m m!(n − m − 1)!

6

(n − 2)!

(n − 1)n(n + 1)

−

(m − 1)!(n − m − 1)!

3

n+1 =
m

(n + 1)! (2n + 1)

(n + 1)! m

−

m!(n − m − 1)! 6

m!(n − m − 1)! 3

n + 1 (n + 1)!

2n + 1 m

=

−

m m!(n − m − 1)!

6

3

n + 1 (n + 1)! 2n − 2m + 1

=

m m!(n − m − 1)!

6

n + 1 (n + 1)! (n − m)(n − m + 1)(2n − 2m + 1)

=

m m!(n − m + 1)!

6

n + 1 2 (n − m)(n − m + 1)(2(n − m) + 1)

=

m

6

=

n+1

2 n−m
i2 .

m

i=1

Finally, we obtain the formula for Um. We know that:

T (n, m)

Um =

n m

n m

. (n − m)

115

First note that:

n+1 2

n+1 2 n 2

=

.

m

n−m+1 m

Then, by replacing the last expression in Um, we obtain:

(n + 1)2

(n − m)(n − m + 1)(2(n − m) + 1)

Um = (n − m + 1)2(n − m)

6

.

By simplifying the last equation, we prove the result:

(n + 1)2(2(n − m) + 1)

Um =

. 6(n − m + 1)

Note that Um increases with n, the number of agents. This means that if there are more agents in the market, the expected utility of waiting when a ﬁxed number of agents leave the market at t = 0, increases.

The next result shows that Um decreases with m, a property which will be used in the next section. Then, the expected utility of waiting and match at t = 1, decreases as more agents leave early. Corollary 3. Let Um be expected utility of a hospital that decides to wait for the second period when m pairs of hospital-doctor leave the market at t = 1. Then for n ∈ N and m = 0, 1, 2, . . . , n − 1, we have:

(n + 1)2

Um

−

Um+1

=

6(n

−

m)(n

−

m

+

. 1)

Note that Um+1 −Um represents the negative externality imposed on the rest of the market by one pair of hospital-doctor that decides to go early, when m agents have already decided to match at t = 0. Since Um − Um+1 increases when m becomes larger, the negative externality imposed by one more pair going early increases (in absolute value) as more agents have decided to go early. Moreover, when the number of agents (that is, n) increases the negative

116

1

externality decreases.

However, since lim Um+1 − Um = n→∞

, it does not converge to zero 6

as the market size goes to inﬁnity. Thus, the negative externality becomes neutral when n

tends to inﬁnity because it does not depend on the number of agents that have previously

decided to match early.

4.6 Proof of Theorem 2

Recall that the best-response function of the game, βn, is deﬁned by Equation (1) in the

following way. Given identical thresholds δ−h = δ for all hospitals other than h, βn(δ) is

given by the equation:

1n n2

n
ij = βn(δ)Es−hUm.

i=1 j=1

Where s−h is such that sh˜ = 0 if δh˜ ≤ δ and sh˜ = 1 if δh˜ > δ, for all h˜ = h.

Note that:

1n n

(n + 1)2

ij =

.

n2

4

i=1 j=1

When all hospitals other than h have the same threshold δ, the probability that m hospitals

make early oﬀers is the probability m hospitals have discount factors less than or equal to δ, and n − m hospitals have discount factors higher than δ. Since discount factors are drawn

independently from a uniform distribution on [0, 1], the probability that m hospitals leave

at

t=0

is

given

by

δm(1 − δ)n−1−m

n−1 m

.

Therefore:

n−1

Es−h Um =

δm(1 − δ)n−1−m

n−1 m

Um.

m=0

Then βn is deﬁned by:

βn(δ) = 4

(n + 1)2

.

n−1 m=0

δm(1

−

δ)n−1−m

n−1 m

Um

117

The symmetric BNE of our game are the ﬁxed points of the best-response function βn. Since

Lemma

1

we

know

that

Un−1

=

(n+1)2 4

,

and

then

βn(1) =

1

for

all

n.

Thus,

full

unraveling

is a BNE for all n. In this Section we investigate the existence of other ﬁxed points. In

particular, Lemma 4 gives a simple formula for βn. Lemma 6 shows that βn is an increasing

function of δ and βn(0) >

3 4

.

Thus, βn may have, at most, one ﬁxed point diﬀerent from

δ

=

1.

Moreover,

if

it

exists,

the

ﬁxed

point

is

higher

than

3 4

.

Lemma

6 proves that δ = 1 is

the unique ﬁxed point of βn for all n ≤ 10, and if n > 10, βn has exactly two ﬁxed points.

Finally, Lemma 8 studies the behavior of βn when n tends to inﬁnity.

It is worthwhile noting that the threshold at the BNE sn deﬁned in Theorem 2, decreases

as more agents are present in the market. This means that the probability that a hospital

makes early oﬀers, decreases as the number of agents increases. The intuition of this result

is straightforward since, as we noted before, the incentives to make early oﬀers when a ﬁxed

number of agents leave the market at t = 0, decreases with n.

Lemma 4.

βn(δ) = 3 2 − 1

n

−1

mδn−m .

2

n(n + 1)

m=1

First we will prove the following lemma which will be useful in the proof of Lemma 4.

Lemma 5. For any n ∈ N and δ ∈ R it holds:

n

(1 − δ)n−mδm

n m

=

n

(m + 1)δn−m .

n−m+2

(n + 1)(n + 2)

m=0

m=0

Proof. 4 Consider the following polynomials of degree n:

p(δ) =

n

(1 − δ)n−mδm

n m

,

and

n−m+2

m=0

n (m + 1)δn−m

q(δ) =

.

(n + 1)(n + 2)

m=0

4 We are very grateful to Andr´es Sambarino for helpful comments on this proof.

118

We want to prove that p = q and to this end, we will show that all the derivatives of p and q are equal at δ = 0. Denote by p(k) and q(k) the kth derivative of p and q, respectively. It is straightforward to show that:

n−k
q(k)(δ) =

1

(m + 1)(n − m)(n − m − 1) . . . (n − m − k + 1)δn−m−k,

(n + 1)(n + 2)

m=0

for k = 1, 2, . . . , n

Then:

n−k
q(k)(δ) =

1

(m + 1) (n − m)! δn−m−k.

(n + 1)(n + 2)

(n − m − k)!

m=0

When we evaluate at δ = 0, we have:

q(k)(0) =

(n − k + 1)k! .

(n + 1)(n + 2)

To compute the kth derivative of p, consider the functions:

g1(δ) = (1 − δ)n−m, and

g2(δ) = δm.

Then:

g1(i)(δ) =

(n − m)! (−1)i(1 − δ)n−m−i, (n − m − i)!

and

g2(k−i)(δ)

=

(m

m! −k+

δm−(k−i). i)!

By the general Leibniz rule we have, for k = 1, 2, . . . , n:

k
(g1g2)(k)(δ) =

k (n − m)!

m!

(−1)i(1 − δ)n−m−iδm−(k−i).

i (n − m − i)! (m − k + i)!

i=0

If m − k ≥ 0, m − (k − i) ≥ 0 for all i and thus, (g1g2)(k)(0) = 0 Then, suppose m − k ≤ 0,

we have:

(g1g2)(k)(0) =

k (n − m)! m!(−1)k−m. k − m (n − k)!

119

Thus, the kth derivative of p is:

n
p(k)(0) =

n

1

k (n − m)! (−1)k−mm! .

m (n + 2 − m) k − m (n − k)!

m=0

As we just noted, when m ≥ k, p(k)(0) = 0, then, we can write the previous sum from m = 0

to m = k.

We want to prove that p(k)(0) = q(k)(0) for all k = 1, 2, . . . , n; that is:

kn

1

k

(n − m)! (−1)k−mm! =

(n − k + 1)!k! .

m (n + 2 − m) k − m (n − k)!

(n + 1)(n + 2)

m=0

Note that:

n (n + 1)(n + 2) n + 2

=

(n + 1 − m), and

m (n + m − 2)

m

k (n − m)!

1

n+1−m

m!

(n + 1 − m) =

.

k − m (n − k)! (n − k + 1)k!

n−k+1

Thus, we have to prove that:

k
(−1)k

n+2

m

m=0

n + 1 − m (−1)m = 1. n−k+1

To ﬁnish the proof we use the following binomial identity (Riordan (17), page 8):

n
(−1)k

n

k

k=0

x−k

x−n

x−n

=

=

.

r

r−n

x−r

Thus:

k
(−1)k

n+2

m

m=0

n + 1 − m (−1)m = (−1)k −1 .

n−k+1

k

Finally, by the Negation rule we have:

−1 k

= (−1)k

1+k−1 k

= (−1)k, and then:

k
(−1)k

n+2

m

m=0

n + 1 − m (−1)m = (−1)2k = 1. n−k+1

Proof of Lemma 4. 120

We know that:

βn(δ) =

(n + 1)2

, and

4

n−1
(1 − δ)n−1−mδm

n−1 m

Um

m=0

(n + 1)2(2(n − m) + 1)

Um =

, 6(n − m + 1)

for m = 0, . . . , n − 1.

We will use these two identities:

2(n − m) + 1

1

=2−

,

n−m+1

n−m+1

n−1
(1 − δ)n−1−mδm

n−1

= 1.

m

m=0

Then, by substituting Um and since the last identities we have:

βn(δ) =

3 .

2

n−1
2−

(1 − δ)n−1−mδm

n−1 m

n−m+1

m=0

By the previous lemma we can write βn as:

Which is equivalent to:

βn(δ) =

3 .

2

n−1
2−

(m + 1) δn−1−m

n(n + 1)

m=0

βn(δ) = 2 2−

3 1

n

.

mδn−m

n(n + 1)

m=1

The following lemma gives more information on the nature of βn.

121

Lemma 6.









 βn(δ) =

2

1 2−
n(n + 1)





 

1

3 δn+1 − nδ2 + (n − 1)δ
(1 − δ)2

Further,

if δ ∈ (0, 1) if δ = 1

1. βn is increasing for each n.

2.

βn(0) >

3 4

and

βn(1) = 1,

for

all n.

3. βn has, at most, two ﬁxed points. δ = 1 is a ﬁxed point of βn for all n ∈ N and it may

have

another

ﬁxed

point

which,

if

it

exists,

is

higher

than

3 4

.

Proof. When δ = 1 we have:

βn(1) =

3

1

n

2 2−

m

n(n + 1)

3

=

1 n(n + 1)

2 2−

n(n + 1) 2

= 1.

m=1

Then, suppose δ ∈ (0, 1), and note that:

n

mδn−m = δn

n

m

1

m
.

δ

m=1

m=1

We use the following identity, that hold for x = 1:

n

mxm

=

1

−

nxn

+

(n

−

1)xn+1 .

(1 − x)2

m=1

Finally, for δ ∈ (0, 1) we have:

n

mδn−m

=

δn+1

−

nδ2

+

(n

−

1)δ .

(1 − δ)2

m=1

To prove part 1, note that for all δ ∈ [0, 1]:

n
mδn−m
m=1

n−1
= m(n − m)δn−m−1 ≥ 0.
m=1

122

Then, the expression

n m=1

mδn−m

increases

with

δ

and

thus,

βn

is

increasing.

For

part

2

notice

that

βn(0)

=

3(n+1) 2(2n+1)

>

3 4

for

all

n

≥

1.

To prove part 3, we know that δ = 1 is a ﬁxed point of βn.

Since βn(0) >

3 4

and

βn

is

increasing, βn crosses the line y = x at, at most, one point diﬀerent from δ = 1. Thus, if it

exists,

the

second

ﬁxed

point

is

higher

than

3 4

.

Lemma 7. Consider the best-response function βn. Then: 1. For each δ ∈ [0, 1] it holds that βn(δ) ≥ βn+1(δ). 2. For all n ≤ 10, δ = 1 is the unique ﬁxed point of βn. 3. For all n > 10, βn has two and only two ﬁxed points.

Proof. (1) We will show that:

1

δn+1 − nδ2 + (n − 1)δ

1

δn+2 − (n + 1)δ2 + nδ

≥

.

n(n + 1)

(1 − δ)2

(n + 1)(n + 2)

(1 − δ)2

Which is equivalent to:

δ (δn−1 − n) + n − 1 ≥

δ (δn − (n + 1)) +

n .

n

n n+2

n+2

Note that:

δδ

>

,

n n+2

δn − 1 − n > δn − (n + 1),

and:

n−1

1

2

n

=1− ≥1−

=

.

n

n

n+2 n+2

Thus, we ﬁnish the proof.

123

(2) and (3). We have to study the solutions in [0, 1] of the equation:

βn(δ) = 2 2−

3

1

n

= δ.

mδn−m

n(n + 1)

m=1

Since for each δ ∈ [0, 1] it holds that βn(δ) ≥ βn+1(δ), if βn has two ﬁxed points for some n0, then βn has two ﬁxed points for all n such that n ≥ n0. We know that δ = 1 is one solution of the equation and there may be, at most, one more solution in [0, 1]. The equation is equivalent to:

pn(δ)

=

δn

+

δn−1

+ 3δn−2

+

...

+ (n

−

1)δ2

+ (−2n2

−

n)δ

+

3n(n + 1) 2

=

0.

As

we

noted,

δ

=

1

is

a

root

of

pn.

We

also

know

that

pn(0) =

3n(n+1) 2

>0

and

that

pn

has,

at most, one more root. Then, we will prove that for some n0, pn0(1) > 0, which implies

that for all n ≥ n0, pn has two ﬁxed points in [0, 1]. Then, compute:

pn(1) =

n−1
i(n − i + 1)

+

(−2n2

−

n)

=

n(n

+

1)(n

−

10) .

6

i=1

Thus, for all n such that 0 ≤ n ≤ 10, pn(1) ≤ 0 and, for all n > 10, pn(1) > 0. This ﬁnishes the proof.

4.6.1 Behavior as n → ∞

Lemma 8. For each δ ∈ [0, 1],

3

 if δ ∈ [0, 1) lim βn(δ) = 4

n→∞

 1 if δ = 1

124

Proof. For δ = 1 we know that βn(1) = 1 for all n. Assume δ < 1. Then, by Lemma 6, it is enough to show that:

1

δn+1 − nδ2 + (n − 1)δt

lim

= 0.

n→+∞ n(n + 1)

(1 − δ)2

The last expression is equivalent to:

δ

(δ)n

δ

n−1

−

+

.

(1 − δ)2 n(n + 1) (n + 1) n(n + 1)

Finally, it is straightforward to show that the limit of the last expression when n tends to inﬁnity is 0. Note that Lemma 8 implies that the best-response function βn converges to a discontinuous function as n → ∞.

Finally, note that in any symmetric BNE the expected number of hospitals that go early is

given by:

n m(1 − δ∗)n−m(δ∗)m n m
m=0

Where δ∗ is a ﬁxed point of βn.

The last expression equals nδ∗. As we noted before, βn has, at most, two ﬁxed points, each one higher than 3/4. Thus, in any symmetric BNE, the expected number of hospitals that go early is at least (3/4)n.

4.7 Proof of Theorem 1
When all agents share the prior that diﬀerent δh are drawn independently from a distribution over [0, 1] with cdf F , the best-response function is given by F (βn(x)). Since βn is an increasing function and F (x) ≥ x, we have that βn(F (x)) ≥ βn(x). Finally, note that F (1) = 1 and that βn(1) = 1. Then Theorem 1 follows directly from Theorem 2.
125

4.8 Proof of Theorem 4

In the case where both sides of the market are strategic, the game is analyzed in the same way that we did in the previous sections. The diﬀerence is that now the probability that m agents leave early is the probability that the minimum between the hospitals and the doctors that play at t = 0, equals m. Then, the expected value of Um, involves the probability distribution of the minimum of two independent binomial random variables.

We introduce some additional notation. Let xm be the probability that a binomial random variable with parameters (δ, n−1) equals m, and let hm be the probability that the minimum of two independent such random variables equals m. Denote by G the cumulative distribution function of a binomial random variable with parameters (δ, n − 1) and let G¯ = 1 − G. Therefore, the best-response function is deﬁned by

β˜n(δ) = 4

(n + 1)2

.

n−1 m=0

hmUm

We use the results of the previous sections to ﬁnd a lower and upper bound for β˜n. It is

straightforward to

prove that

1 2

βn

≤ β˜n

≤ βn.

Then,

for all

n > 10, β˜n

has, at

least, one

ﬁxed

point

which

lies

within

the

interval

(

3 8

,

3 4

).

Moreover,

as

we

will

prove

in

the

following

lemmas, the lower bound can be improved, which allows us to conclude that in the general

model, the expected number of agents that go early is at least one half.

We ﬁrst prove some properties of β˜n. In particular, Lemma 9 shows that: δ = 1 is a ﬁxed point of β˜n for all n, β˜n is an increasing function of δ, and that β˜n(δ) ≥ β˜n+1(δ) for all n.

Lemma 10 demonstrates that for each > 0 there exists n0 such that for all n ≥ n0 and

δ ∈ [0, 1] it holds:

3

4

3 2

+

≤ β˜n(δ) ≤ βn(δ).

Then,

limn→∞

β˜n(δ)

≥

1 2

,

and

since

β˜

decreases

when

n

increases,

we

conclude

that

for

all

n:

1 ≤ β˜n(δ) ≤ βn(δ). 2

126

Lemma 9. Consider the best-response function β˜n as deﬁned before. Then: 1. β˜n(1) = 1 for all n. 2. β˜n is an increasing function of δ 3. For each δ ∈ [0, 1], β˜n(δ) ≥ β˜n+1(δ), for all n.
Proof. (1) Since the cumulative distribution function of the minimum of two iid random variables is 1 − (1 − G)2, we have:
hm = (1 − (1 − G(m))2) − (1 − (1 − G(m − 1))2) = (1 − G(m − 1))2 − (1 − G(m))2 = 2(G(m) − G(m − 1)) + G(m − 1)2 − G(m)2 = 2xm + (G(m − 1) − G(m))(G(m) + G(m − 1)) = xm(2 − G(m − 1) − G(m)) = xm(G¯(m − 1) + G¯(m)).

Thus,

β˜n(δ) = 4

(n + 1)2

.

mn−=10(1 − δ)n−1−mδm

n−1 n

(G¯(m − 1) + G¯(m))Um

When we compute β˜n(1) we obtain:

β˜n(1)

=

4[(G¯(n

−

(n + 1)2 2) + G¯(n −

. 1))Un−1]

Since

Un−1

=

(n−1)2 4

,

and

for

δ

=

1,

G¯(n − 2)

=

1

and

G¯(n

− 1)

=

0,

we

have

that

β˜n(1)

=

1.

127

(2) Now, if Gˆ is the cumulative distribution function of a binomial random variable with parameters (δˆ, n − 1), with δˆ > δ, we have that Gˆ(m) ≤ G(m) for all m ∈ {0, 1, . . . , n − 1}. This implies that 1 − (1 − Gˆ(m))2 ≤ 1 − (1 − G(m))2. Let hˆm be the probability that the minimum of two independent binomial random variables with parameters (δˆ, n − 1) equals
m. Then, since Um decreases with m, we have that

n−1

n−1

hˆmUm ≤ hmUm.

m=0

m=0

Therefore, β˜n is an increasing function of δ.

(3)

We know that Um

=

(n+1)2(2(n−m)+1) 6(n−m+1)

.

Then,

the best-response

function can be written

as:

β˜n(δ) = 2 1+

3

n−1 m=0

n−m n−m+1

hm

.

Using a change of variable, k = n − m, we obtain:

n−1 n − m

nk

nk

n − m + 1 hm =

k + 1 hn−k =

k + 1 hn−k.

m=0

k=1

k=0

Consider two binomial random variables X˜in, i = 1, 2. Each random variable i is deﬁned on the same sample space, the space of an inﬁnite number of Bernoulli trials. For X˜in we count the number of successes in the ﬁrst n such trials. The sample spaces for X˜1n and X˜2n are
independent.

Now, for each n there is also the random variable Y˜in counting the number of failures. Note that X˜in + Y˜in = n.

Let rk be the probability that max{Y˜1n, Y˜2n} = k. Observe that hn−k = rk. So we have that:

n−1 n − m

nk

n − m + 1 hm = k + 1 rk.

m=0

k=0

128

Since we have deﬁned these random variables on the same sample space, it is true that {Y˜in ≥ x} ⊆ {Y˜in+1 ≥ x}
for any x because any time that we have at least x failures in the ﬁrst n Bernoulli trials, we have at least x failures in the ﬁrst n + 1 Bernoulli trials (past failures cannot be undone).
By the same token: {max{Y˜1n, Y˜2n} ≥ x} ⊆ {max{Y˜1n+1, Y˜2n+1} ≥ x}.
So that the probability distribution (rk) increases in the sense of ﬁrst-order stochastic dominance (it actually increases in a stronger sense).
The function k → k/(k + 1) is monotone increasing. Thus the sum nk k + 1 rk
k=0
is increasing in n, as it is the expected value of a monotone increasing function, and the probability law is monotone increasing in n.

Lemma 10. Let > 0. Then, there exists n0 such that for all n ≥ n0, the function β˜n deﬁned

previously satisﬁes:

3

4

3 2

+

≤ β˜n(δ) ≤ βn(δ).

Proof. Since the last Lemma we know that:

hm = xm(G¯(m − 1) + G¯(m)) ≤ 2xmG¯(m − 1).

Then,

n−1

n−1

n−1

hmUm = xm(G¯(m − 1) + G¯(m))Um ≤ 2xmG¯(m − 1)Um.

m=0

m=0

m=0

129

The median of a binomial distribution with parameter (n, δ) lies within the interval [ nδ , nδ ].

Moreover, if nδ is an integer, the median is nδ. So, if nδ is an integer we have that

G¯(nδ)

=

P r[xm

≥

nδ + 1]

≤

1 2

.

Otherwise, if nδ is not an integer, G¯( nδ ) = P r[xm >

nδ ] = P r[xm ≥

nδ

]≤

1 2

.

Thus,

if

m≥

nδ

+ 1,

we

have

that

G¯(m − 1)

≤ G¯(

nδ

)≤

1 2

.

Then:



n−1

(n−1)δ


n−1

hmUm ≤ 2 

UmxmG¯(m − 1) +

UmxmG¯(m − 1)

m=0

m=0

m= (n−1)δ +1





(n−1)δ

1

n−1

≤ 2

Umxm + 2

Umxm

m=0

m= (n−1)δ +1

where g(δ) =

(n−1)δ

n−1

(n−1)δ

=

Umxm + Umxm = g(δ) +

Umxm,

m=0

m=0

m=0

n−1 m=0

Umxm.

Now, recall that:

(n + 1)2(2(n − m) + 1)

Um =

. 6(n − m + 1)

So we obtain that:

(n−1)δ

(n + 1)2 (n−1)δ (2(n − m) + 1)

Umxm = 6

n − m + 1 xm

m=0

m=0

(n + 1)2 (n−1)δ =
6 m=0

(n − m)

1+ n−m+1

xm

(n + 1)2 (n−1)δ

≤ 6

2xm

m=0

(n + 1)2

≤

.

6

Where,

in

the

last

inequality,

we

use

that

G(

(n − 1)δ

)≤

1 2

.

130

Therefore:

(n−1)δ m=0

Umxm

(n + 1)2/6

≤

=

g(δ)

g(δ)

n−1 2(n − m) + 1

−1

n − m + 1 xm .

(2)

m=0

Now, let > 0. Choose ρ0, ρ1 ∈ (0, 1) such that: 5

1

1

<+

1 + ρ0ρ1 2

Let n be large enough such that:

P r M˜ ≤ n − ρ0 1 − ρ0

≥ ρ1,

where M˜ is a binomial random variable with parameters (n − 1, δ).

Clearly, the value of n that satisﬁes the last inequality depends on δ. Moreover, for higher

values of δ,

we need to consider

higher values

of n.

Then, assume that δ

≤

1 2

,

and

take

n

large enough such that the inequality holds. In the last step of the proof, we extend the

result for all values of δ.

Now,

m≤n−

ρ0 1−ρ0

if

and

only

if

ρ0

≤ (1 − ρ0)(n − m)

if

and

only

if

n−m

ρ0

≤

n

−

m

+

. 1

Note that

n−1 m=0

2(n−m)+1 n−m+1

xm

is

the

expectation

of

the

random

variable

2(n − M˜ ) + 1 n − M˜ + 1 ,

then we have:

n−1 2(n − m) + 1 n − m + 1 xm = EM˜
m=0

2(n − M˜ ) + 1 n − M˜ + 1

= EM˜ 1 + EM˜

n − M˜ n − M˜ + 1 .

Now, note that:

5Note

that

ρ0

and

ρ1

exist

since

j(x)

=

1 1+x

is

a

continuous

and

decreasing

function

in

[0, 1]

with

j(0)

=

1

and

j(1)

=

1 2

.

131

n − M˜

n−1

n−m

EM˜

n − M˜ + 1

=
m=0

n−m+1

xm

n−

ρ0 1−ρ0

≥

m=0

n−m n − m + 1 xm

n−

ρ0 1−ρ0

≥ ρ0

xm

m=0

= ρ0P r

M˜ ≤ n − ρ0 1 − ρ0

≥ ρ0ρ1.

Thus:

n−1 2(n − m) + 1 n − m + 1 xm ≥ 1 + ρ0ρ1.
m=0

Now, using Equation (2) and the deﬁnition of ρ0 and ρ1 we obtain that:

(n−1)δ m=0

Umxm

≤

1

1 < +.

g(δ)

1 + ρ0ρ1 2

Then: which implies that: Finally, note that:

(n−1)δ

1

Umxm

<

( 2

+

)g(δ),

m=0

n−1

3

hmUm ≤

+ 2

m=0

g(δ).

β˜n(δ) = 4

(n + 1)2

n−1 m=0

hmUm

(n + 1)2 1

≥ 4g(δ)

3 2

+

= βn(δ)

1

3 2

+

.

132

Therefore, there exists n0 such that for all n ≥ n0:

β˜n(δ) ≥ βn(δ)

1

3 2

+

3

≥

4

3 2

+

.

for

all

δ

≤

1 2

.

Since

β˜n

is

an

increasing

function

of

δ,

if

δ

>

1 2

:

3

β˜n(δ) ≥ β˜n(1/2) ≥

4

3 2

+

.

To prove that β˜n(δ) ≤ βn(δ) just note that 1 − (1 − G(m))2 ≥ G(m), and since Um is

decreasing in m we have:

Then:

β˜n(δ) = 4

n−1

n−1

Umhm ≥ Umxm.

m=0

m=0

(n + 1)2

≤

n−1 m=0

Umhm

4

(n + 1)2

= βn(δ).

n−1 m=0

Umxm

Finally, we have that there exists n0 such that for all n ≥ n0 and δ ∈ [0, 1]:

3

4

3 2

+

≤ β˜n(δ) ≤ βn(δ).

(3)

The lower bond

3 2

+

is

arbitrarily

close

to

3 2

.

Then,

for

each

δ

we

have

that:

lim

β˜n(δ)

≥

1 .

n→∞

2

Since by Lemma 9, β˜n decreases when n increases, we have that for all n: 1 ≤ β˜n ≤ βn. 2

Finally, note that: 133

1. β˜n is an increasing function of δ,

2. β˜n(1) = 1,

3. βn has two ﬁxed points if n > 10,

4.

1 2

≤

β˜n

≤

βn,

then,

β˜n

has

exactly

two

ﬁxed

point:

δ

=

1

and

the

other

between

1 2

and

3 4

.

Thus,

in

the

general

model,

the

expected

number

of

agents

that

go

early

is

at

least

(

1 2

)n.

4.9 Proof of Theorem 3
Theorem 3 follows from Theorem 4 by observing that β˜n(F (δ)) ≥ β˜n(δ), and by employing the same argument used in Section 4.7.

References
[1] Avery, C., C. Jolls, R. A. Posner, and A. E. Roth (2001): “The market for federal judicial law clerks,” The University of Chicago Law Review, pp. 793–902.
[2] Bulow, J., and J. Levin (2006): “Matching and Price Competition,” The American Economic Review, 96(3), pp. 652–668.
[3] Damiano, E., H. Li, and W. Suen (2005): “Unravelling of dynamic sorting,” The Review of Economic Studies, 72(4), 1057–1076.
[4] Diamond, D. W., and P. H. Dybvig (1983): “Bank runs, deposit insurance, and liquidity,” The Journal of Political Economy, pp. 401–419.
[5] Du, S., and Y. Livne (2013): “Rigidity of Transfers and Unraveling in Matching Markets,” Available at SSRN 2203910. 134

[6] Frankel, D. M., S. Morris, and A. Pauzner (2003): “Equilibrium selection in global games with strategic complementarities,” Journal of Economic Theory, 108(1), 1– 44.

[7] Fre´chette, G. R., A. E. Roth, and M. U. U¨ nver (2007): “Unraveling yields inefﬁcient matchings: evidence from post-season college football bowls,” The RAND Journal of Economics, 38(4), 967–982.

[8] Halaburda, H. (2010): “Unravelling in two-sided matching markets and similarity of preferences,” Games and Economic Behavior, 69(2), 365–393.

[9] Kagel, J. H., and A. E. Roth (2000): “The dynamics of reorganization in matching markets: A laboratory experiment motivated by a natural experiment,” The Quarterly Journal of Economics, 115(1), 201–235.

[10] Li, H., and S. Rosen (1998): “Unraveling in matching markets,” American Economic Review, pp. 371–387.

[11] Li, H., and W. Suen (2000): “Risk sharing, sorting, and early contracting,” Journal of Political Economy, 108(5), 1058–1091.

[12]

(2004): “Self-Fulﬁlling Early-Contracting Rush,” International Economic Re-

view, 45(1), 301–324.

[13] Mongell, S., and A. E. Roth (1991): “Sorority rush as a two-sided matching mechanism,” The American Economic Review, pp. 441–464.

[14] Niederle, M., and A. E. Roth (2003): “Unraveling reduces mobility in a labor market: Gastroenterology with and without a centralized match,” Journal of political Economy, 111(6), 1342–1352.

[15]

(2004): “The gastroenterology fellowship match: how it failed and why it

could succeed once again,” Gastroenterology, 127(2), 658–666.

135

[16] Niederle, M., A. E. Roth, and M. U. U¨ nver (2009): “Unraveling Results from Comparable Demand and Supply: An Experimental Investigation,” Discussion paper, National Bureau of Economic Research.

[17] Riordan, J. (1979): Combinatorial identities. RE Krieger Publishing Company Huntington, New York.

[18] Roth, A., and M. Sotomayor (1990): Two-sided Matching: A Study in GameTheoretic Modelling and Analysis, vol. 18 of Econometric Society Monographs. Cambridge University Press, Cambridge England.

[19] Roth, A. E. (1984): “Stability and Polarization of Interests in Job Matching,” Econometrica, 52(1), 47–57.

[20]

(1991): “A natural experiment in the organization of entry-level labor markets:

regional markets for new physicians and surgeons in the United Kingdom,” The American

economic review, pp. 415–440.

[21]

(2002): “The Economist as Engineer: Game Theory, Experimentation, and

Computation as Tools for Design Economics,” Econometrica, 70(4), pp. 1341–1378.

[22]

(2012):

“Unravelling in college football.,”

http://marketdesigner.blogspot.mx/2012/09/unravelling-in-college-football.html (Ac-

cessed 01/06/2013).

[23]

(2013): “Supreme Court Clerks–some hiring already for 2014,”

http://marketdesigner.blogspot.mx/2013/01/supreme-court-clerks-some-hiring.html (Ac-

cessed 01/06/2013).

[24] Roth, A. E., and X. Xing (1994): “Jumping the gun: Imperfections and institutions related to the timing of market transactions,” The American Economic Review, pp. 992– 1044.

136

[25] Shapley, L., and M. Shubik (1971): “The assignment game I: The core,” International Journal of Game Theory, 1(1), 111–130.
[26] Sprugnoli, R. (2012): “Riordan Array Proofs of Identities in Gould’s Book,” http://www.dsi.uniﬁ.it/ resp/GouldBK.pdf (Accessed 03/13/2013).
[27] Wetz, R. V., C. B. Seelig, G. Khoueiry, and K. F. Weiserbs (2010): “Out-ofmatch residency oﬀers: the possible extent and implications of prematching in graduate medical education,” Journal of Graduate Medical Education, 2(3), 327–333.
137

