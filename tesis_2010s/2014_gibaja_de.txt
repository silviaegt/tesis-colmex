“THREE ESSAYS ON THE ALLOCATION OF INDIVISIBLE GOODS” TESIS PRESENTADA POR:
DAMIÁN EMILIO GIBAJA ROMERO
PROMOCIÓN 2011-2014

MÉXICO D.F.

AGOSTO DE 2014

“THREE ESSAYS ON THE ALLOCATION OF INDIVISIBLE GOODS” TESIS PRESENTADA POR:
DAMIÁN EMILIO GIBAJA ROMERO
PARA OPTAR POR EL GRADO DE
DOCTOR EN ECONOMÍA
PROMOCIÓN 2011-2014 DIRECTOR DE TESIS DR. DAVID CANTALA

MÉXICO D.F.

AGOSTO DE 2014

Doctorante: Tesis: Director de Tesis:

CONSTANCIA DE APROBACIÓN
Damián Emilio Gibaja Romero Three Essays on the Allocation of Indivisible Goods Dr. David Cantala

Aprobada por el Jurado Examinador:

Dr. David Cantala Dr. Jaime Sempere Campello Dr. Kaniska Dam Dr. Stephen John McKnight

Presidente Primer Vocal Vocal Secretario Suplente

México, D.F., 6 de agosto de 2014
i

Acknowledgements
This thesis project would not have been possible without the support of many people. I want to express my gratitude to El Colegio de Me´xico and Centro de Estudios Econo´micos by all the resources put at my disposal in these two years, without whom, this work would not be possible. I would like to express my sincere gratitude to my advisor, Prof. Dr. David Cantala who offered invaluable motivation, assistance, patience, support and guidance. It is with immense gratitude that I acknowledge the comments and suggestions of Herve´ Moulin, Szilvia Papai, Guillaume Haeringer, Utku Unver and Francis Bloch. Also thanks to my committee members, Kaniska Dam, Jaime Sempere, and Stephen McKnight, who offered guidance and support. I would like to thank my parents Magdalena Romero Plata and Emilio Gibaja Arriaga, for always supporting me and never let me down. Also, I want to thank my sister Iliana Gibaja, who endured this long process with me. Last but not the least, I would like to thank to my friends Vanessa, Osvaldo, Omar, Ce´sar who supporting me spiritually throughout my stay at El Colegio de Me´xico.
ii

Contents

1 Introduction

6

2 An equilibrium analysis for the Top Trading Cover algorithm in large markets

8

2.1 Introduction . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 8

2.2 The Model . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 11

2.2.1 Preliminary Deﬁnitions . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 11

2.2.2 The two-step Game . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 13

2.2.3 Solution Concept . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 14

2.3 The Assignment Procedure . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 14

2.3.1 Graph Theory Preliminaries . . . . . . . . . . . . . . . . . . . . . . . . . . 14

2.3.2 Top Trading Covers and Tie Breaking Rules . . . . . . . . . . . . . . . . . . 15

2.3.3 The Top Trading Cover Algorithm . . . . . . . . . . . . . . . . . . . . . . . 17

2.3.4 Picking rules and Other mechanisms . . . . . . . . . . . . . . . . . . . . . . 21

2.4 Characterization . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 25

2.4.1 Pareto Efﬁciency . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 26

2.4.2 Recursively Respects Top Preferences . . . . . . . . . . . . . . . . . . . . . 27

2.5 Equilibrium Analysis . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 31

2.5.1 Dominant Strategies in the TTCo algorithm . . . . . . . . . . . . . . . . . . 32

2.5.2 Dropping Strategies . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 34

2.5.3 Counting Effective schools . . . . . . . . . . . . . . . . . . . . . . . . . . . 35

2.5.4 The ε−Bayesian Nash equilibrium . . . . . . . . . . . . . . . . . . . . . . . 59

2.6 Concluding Remarks . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 60

iii

References . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 61 2.7 Appendix A1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 63

3 On uniqueness of equilibrium prices in large assignment games

65

3.1 Introduction . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 65

3.2 The Model . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 68

3.2.1 The Game . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 69

3.2.2 Solution Concept . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 75

3.3 Equilibrium Analysis of Third Stage . . . . . . . . . . . . . . . . . . . . . . . . . . 76

3.4 Equilibrium Price Vector of Second Stage . . . . . . . . . . . . . . . . . . . . . . . 78

3.4.1 Invariance with respect to tie breaking rules . . . . . . . . . . . . . . . . . . 78

3.4.2 Sellers Behaviour at equilibrium . . . . . . . . . . . . . . . . . . . . . . . . 81

3.4.3 Equilibrium Characterization for the Exponential Case . . . . . . . . . . . . 88

3.4.4 Small Markets . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 92

3.4.5 Public Policies . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 94

3.5 Appendix A2 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 95

3.6 Appendix B2 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 97

3.7 Appendix C2 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 99

3.8 Appendix D2 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 99

3.9 Appendix E2 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 106

References . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 109

4 The subsidized housing problem in Paris

112

4.1 Introduction . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 112

4.2 Model . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 115

4.3 The Nested Deferred Acceptance Mechanism . . . . . . . . . . . . . . . . . . . . . 120

4.4 Interrupters . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 123

4.5 Nested Deferred Acceptance with Interrupters . . . . . . . . . . . . . . . . . . . . . 127

4.6 Existence issues . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 137

4.6.1 Analysis of Mixite´ . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 137

iv

4.6.2 Analysis of Fairness . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 144 4.7 Concluding Remarks . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 147 References . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 148

List of Figures

150

v

Chapter 1
Introduction
This thesis is a collection of three essays on assignment problems in matching markets. Each essay is self-contained. However, the ﬁrst two essays are closely related, speciﬁcally, some of the results of the ﬁrst essay are applied in the second one.
We study the allocation of indivisible goods (e.g., apartments, school seats, scholarships) to different agents (e.g., households, students) in the context of three different assignment problems. The ﬁrst essay focuses on a school choice problem where all students have the same priority for all schools and students can be indifferent between them. In the second essay we establish the existence and uniqueness of the price vector of equilibrium in the assignment game when markets are large. The last essay deals with the subsidized housing problem in Paris.
The ﬁrst essay analyses the School Choice problem in Toluca to allocate seats in elementary schools to six years old children. Parents submit a preference list of up to ﬁve elementary schools to the assignment procedure used by the local Ministry of Education, the Sistema Anticipado de Inscripcio´n y Distribucio´n (SAID). This mechanism presents efﬁciency problems because indifferences are pervasive in the market. Well-known school choice mechanisms, like the Deferred Acceptance and Top Trading Cycles algorithms, have a loss of efﬁciency due to the presence of indifferences. We introduce the Top Trading Cover (TTCo) mechanism to deal with them. This new mechanism is characterized by Pareto efﬁciency and the fact that it recursively respects top ranking. Nevertheless, this assignment procedure is manipulable, that is to say students have incentives to misreport their pref-
6

erences. To support the use of this mechanism, we analyze its incentives properties when the market is large. In a Bayesian game where student only know their own ranking of elementary schools, we prove that truth-telling is the unique epsilon Nash equilibrium when the markets satisfy a “thickness” condition.
In the second essay we re-examine the heterogeneity feature of real estate markets by modelling them as large auction markets. More speciﬁcally, considering large enough markets, we study the equilibrium prices in the Assignment Game when buyers and sellers do not know the valuation of other. We model the problem as a three-stage game. First, nature draws the valuation of each agent, namely over the good they own for sellers, or the goods on sale for buyers. At stage two sellers simultaneously set prices, which are observed by buyers before stage three begins, when buyers report their valuation to the assignment mechanism. The payoffs are determined using the Top Trading Cover (TTCo) algorithm. We prove that the price vector at equilibrium is unique when markets satisfy the thickness condition and agents preferences are independent and follow an exponential distribution with the same parameter. This result is robust when we assume that preferences are independent but not identically distributed. Concretely, we extend our result to different parameters and overlapping valuations, assuming an exponential distribution.
Finally, in the last essay we study the subsidized housing problem in Paris. The French tradition in subsidized housing aims at “mixite´ sociale”, namely promoting social diversity in all districts. A high population percentage in Paris is eligible to one of the many existing programs, promoting by a wide quantity of institutions, which is ﬁnancially proﬁtable to the programs. The allocation of a common pool of subsidized housing is solved by the institutions in Committees. The assignment process, thus, is not transparent, which raises criticisms over its discretionality. Our work focuses on designing a fair and efﬁcient mechanism that incorporates different scoring schemes. We introduce the Nested Deferred Acceptance algorithm to get an assignment for this three sided market. However, it does not satisfy the “mixite´ sociale” condition nor fairness for the same type. We encompass these deﬁciencies by detecting institution acting as interrupters, and deleting them accordingly in the Efﬁciently Adjusted Deferred Acceptance Mechanism.
7

Chapter 2
An equilibrium analysis for the Top Trading
Cover algorithm in large markets
2.1 Introduction
In Toluca, seats in public elementary schools are assigned through the Sistema Anticipado de Inscripcio´n y Distribucio´n (Anticipated System of Inscription and Distribution, SAID). The parents of six years old children submit a preference list of up to ﬁve elementary schools to the local Ministry of education; schools do not distinguish between kids and only can accept a limited number of kids determined by a quota. Schools run two rounds of classes; the quota is the number of available seats in the morning turn plus the available seats in the afternoon turn, which are not necessarily equal. Since schools are indifferent between students, this assignment problem differs from the School Choice problem because all students have the same priority over schools. The authority runs the SAID to determine the ﬁnal allocation between students and schools. This mechanism has the following deﬁciencies1:
1. It does not deal with indifferences. This situation can be presented in the case of “twin schools”, which are two public schools in the same block. Given their proximity, parents do not distinguish between them. The existence of these schools is due to the fact that years ago male and
1http://saidedomex.wordpress.com/
8

female children were separated in two different schools in the same block. Now, they are two mixed gender schools2.
2. It is wasteful. A common situation after the publication of the ﬁnal allocation is that parents ﬁnd an available place in a preferred school to the school they have been assigned to.
3. It is not always Pareto efﬁcient. Parents exchange seats in order to get a better school.
The school choice problem in Toluca consists of a ﬁnite set of students; a ﬁnite set of elementary schools, each student has a non-strict ranking of elementary schools and elementary school with a ﬁnite capacity.
We introduce the Top Trading Cover (TTCo) algorithm to deal with indifferences. The mechanism relies on a graph representation of the market, where a node is associated to all students and schools, and directed edges represent the top choices of students. A cover of the graph is selected by a tie breaking rule; each student is assigned to her partner in the cover. The procedure is iterated with the remaining students, analogically to David Gale’s Top Trading Cycle; indeed TTCo also encompasses Hierarchical Exchange rules by Papai (2000).
We show that TTCo mechanism is characterized by: 1. Pareto efﬁciency, there is no other assignment that improves a student’s allocation without harming other; and 2. the fact that it recursively respects top rankings: if a student is not assigned to her top ranked school, then this school is assigned to a student that also top ranks it, and this is true when one removes iteratively students assigned to one of their top ranked schools. Both properties are satisﬁed when we consider tie breaking rules that remove a top trading cover of maximum cardinality at each step. However, this tie breaking rules do not ﬁnd all the Pareto efﬁcient assignments.
Previous properties are useful to support the TTCo mechanism. For example, the existence of indifferences induces a loss of efﬁciency in the Student Optimal Stable Mechanism (Erdil and Ergin, 2008). Moreover, queue allocation rules (Svensson, 1994) do not recursively respect top rankings despite the fact that they deal with indifferences and they are Pareto efﬁcient.
2http://portal2.edomex.gob.mx/edomex/temas/educacion/index.htm
9

Our characterization of the TTCo algorithm is related with the characterization of others mechanisms. The closest study to ours is Abdulkadiroglu and Che (2010), who provide a characterization of Top Trading Cycle mechanism through Pareto efﬁciency, strategy-proof and the fact that it recursively respects top ranking. Kojima and Manea (2010) characterize the Deferred Acceptance algorithm using non-wastefulness, population monotonicity and weak Maskin monotonicity. Kojima and Unver (2010) show that a mechanism coincides with the Boston mechanism if and only if the mechanism respects preference proﬁle, resource monotonicity, and consistency. On the other hand, Papai (2000) study and characterize the hierarchical exchange rules, connecting the Serial Dictatorship and the TTC mechanism when agents have strict preferences.
Assuming non-strict preferences, Svensson (1994) characterizes the queue allocation rules with Pareto efﬁciency and strategy-proofness, when there are no property rights. Ehlers (2002) shows the existence of a unique maximal domain on which efﬁciency and coalitional strategy-proofness are compatible, moreover, mixed dictator-pairwise-exchange rules are the only rules that satisfy both properties on this domain. Later, Bogomolnaia, Deb and Ehlers (2005) extend the queue allocation rules to the case of private information introducing Bi-polar Serially Dictatorial Rules. They characterized these rules and discuss the consequences on equity when information is private.
Under the existence of property rights and indifferences, Alcalde and Molis (2011) and Jaramillo and Manjunath (2012) extend the Top Trading Cycles mechanism through the Top Trading Absorbing Sets and the Top Cycle Rules mechanism, respectively. Both mechanisms are Pareto efﬁcient and strategy-proof.
Truth-telling, however, is not a dominant strategy for the TTCo. We extend the analysis on large matching markets, developed by Immorlica and Mahdian (2005) and Kojima and Pathak (2009), to the TTCo. In a simultaneous game where students report their preference list to the TTCo and only know their own schools valuations, we prove that truth-telling is an Epsilon Bayesian Nash equilibrium when market is sufﬁciently thick. There are crucial differences between our analysis and previous ones:
• Unlike in the Deferred Acceptance Algorithm (DA), the side of the market which manipulates
10

the mechanism is the one that points to the favorite option.
• Fuhito and Pathak (2009) uses the rural hospital theorem to prove that dropping strategies are exhaustive is a general property of stable mechanisms. TTCo, however, is not stable; the argument used to establish exhaustiveness relies on the fact that TTCo is Pareto Efﬁcient for all tie breaking rules.
• Students with more than one effective school have incentives to misreport their preference list. While previous works count schools using an algorithm based on reaction chains, we construct an algorithm based on dropping strategies that erase schools from the top, one-byone, to analyze whether the most preferred school in this ranking can be an effective school when other students do not change their ranking.
• We use the thickness condition of Kojima and Pathak (2009), which speciﬁes that for each school the number of students is balanced; the condition which implies that TTCo ends at the ﬁrst iteration of the mechanism, when DA does not.
The paper is organized as follows. The model and the TTCo are presented in Sections 2 and 3. The characterization of this assignment procedure is carried out in Section 4. Finally, the equilibrium analysis under the thickness condition is done in Section 5.
2.2 The Model
2.2.1 Preliminary Deﬁnitions
We consider an economy with a set of students and a set of schools. Let A = {1, 2, . . . , n} be the set of students, a generic student is denoted by i; and a set of elementary schools O = {ω1, ω2, . . . , ωm}, where ω denotes a generic elementary school, or simply school. Each school has a capacity of qω > 0. First, we assume that each school has capacity qω = 1. We consider that n and m are not necessarily equal, i.e. n can be less than, greater than or equal to m. A generic element in A ∪ O is represented by r.
11

We suppose that each student i has a preference relation represented by an utility ui(·) over Oi = O ∪ {i}. We assume the following quasi-linear utility function



 ui(r; vˆi) =

v ji + θ((vτi)τ= j)

if r = ω j ∈ O

0

if r = i.

Each student i has a valuation v ji ∈ R of school ω j for all j ∈ {1, 2, . . . , m}. The type of student i is the vector vˆi = (v1i, . . . , vmi). The set of all possible types of student i is denoted by Vˆi ⊆ Rm. The state of the market is the vector v = (vˆ1, . . . , vˆn) ∈ Rn. The set of all possible states of the market is the Cartesian product between all sets Vˆi; let V ≡ ∏ni=1 Vˆi. We suppose that the state of the market v ∈ V is drawn according to a probability function f from V to R, of common knowledge.

An school ω is individually rational (IR) for student i if ui(ω) ≥ ui(i). From now on, we omit not IR schools from the representation of Ri, for all i ∈ A.

An assignment is a function γ from A ∪ O to A ∪ O such that 1. γ(i) ∈ Oi = O ∪ {i}, for all i ∈ A, 2. γ(ω) ∈ Aω = A ∪ {ω}, and 3. γ(i) = ω if and only if γ(ω) = i.

In words, each student i is assigned exactly one school in Oi and each school ω is assigned exactly one student in Aω, under an assignment γ. If γ(r) = r, r remains unassigned. The set of all assignments is denoted by Γ.

An assignment γ is individually rational (IR) if ui(γ(i)) > ui(i) for all i ∈ A. In words, every student is assigned an IR school at γ.

We say that an assignment γ is blocked by a pair (i, ω) ∈ A × O with respect to R if and only if

1. γ(ω) = ω, and 2. ui(ω) > ui(γ(i)).

12

If γ is blocked by the pair (i, ω), we say that it is a blocking pair at R. An assignment γ is non-wasteful if and only if it is individually rational and it is not blocked by any pair. Non-wastefulness establishes than an student cannot be allocated with an school strictly preferred to her allocation because it has been assigned to some other student.
2.2.2 The two-step Game
We consider a two-step game. Nature moves ﬁrst, determining the type of each student according to the probability distribution f . All students of the market observe their type, but do not observe the type of the others. At stage 2, students report a preference list of schools. Each student observes the schools in the market and sets her preference relation Ri(vˆi), or Ri, over the set Oi. Naturally, students can be indifferent between different schools. This preference relation is complete, reﬂexive and transitive. Let Pi and ∼i represent the asymmetric and symmetric parts of Ri. For all ω, ω ∈ Oi, we write ωPiω when student i strictly prefers ω to ω , or ui(ω) > ui(ω ); and ω ∼i ω if i is indifferent between them, ui(ω) = ui(ω ). The indifference class of ω at Ri is the set [ω]i = {ω ∈ | ω ∼i ω }. If ω is the unique element in its indifference class at Ri, we consider that [ω]i = ω. The preference list of student i is represented by
Ri : [ω1]i, [ω2]i, . . . , [ωk]i, [i]i, [ωk+1]i . . . [ωK]i.
A preference proﬁle is a n−tuple of preferences, denoted by R. As in the usual way, let R−i = (R j) j=i, RA = (Ri)i∈A and R−A = (Ri)i∈A−A , for all A ⊂ A. We denote by ℜi the set of all preference lists of student i, ℜ = ∏ ℜi is the set of all possible preferences proﬁle. Let Ri(ω) be the rank of school ω
i∈A
in Ri, i.e. Ri(ω) = k if and only if ω belongs to the k−th most preferred indifference class.
Given the proﬁle R of reported preference proﬁle, the ﬁnal allocation of each student is determined by a ﬁx mechanism (assignment procedure). A mechanism is a systematic procedure φ from ℜ to Γ that maps a preference proﬁle into an assignment. The assignment generated by the mechanism φ at a preference proﬁle R is represented by φ[R ]. Let r ∈ A ∪ O, the allocation of r under the assignment φ[R ] is denoted by φ[R ](r). A mechanism φ is IR and non-wasteful if φ[R ] is IR and non-wasteful for all R ∈ ℜ. To determine the allocation of each student, we introduce the Top Trading Cover
13

algorithm to deal with indifferences. For all preference proﬁle R ∈ ℜ, this mechanism generates the assignment T TCo[R].
2.2.3 Solution Concept
We need some extra concepts and notations. Given the realization of her type vˆi, an action of student i is a preference list Ri over the set Oi. A decision rule/pure strategy βi(vˆi) for student i is a function that maps types into preference lists. Deﬁnition 1. Let β∗ = (β1∗, . . . , βn∗) be a proﬁle of strategies for students, and ε > 0. An ε−Bayesian Nash equilibrium is a proﬁle of pure strategies (β∗1, . . . , βn∗) such that
E[ui(T TCo[β∗i , β∗−i](i)] + ε ≥ E[ui(T TCo[βi, β−∗ i](i)], for all i ∈ A and βi decision rule.
2.3 The Assignment Procedure
At the end of the game, the students payoffs are induced by the TTCo algorithm. In order to describe it, we must ﬁrst introduce some concepts from Graph Theory.
2.3.1 Graph Theory Preliminaries
Consider a set of schools, O ⊆ O; a set of students, A ⊆ A; and a proﬁle of preferences R = RA . We deﬁne the bipartite directed graph G(A , O , R) as a pair (V (A , O , R), E(A , O , R)), where V (A , O , R) = A ∪ O is the set of nodes; and E(A , O , R) is the set of all directed edges (i, ω) ∈ A × O , such that (i, ω) ∈ E if and only if student ω is the most preferred school of i at Ri. Since we consider non-strict preference lists, the most preferred school of student i is not necessarily unique. Thus, the fact that there is more than one edge from i to the set of schools represents indifference. We refer us to this bipartite graph only by G = (V (G), E(G)) whenever there is no confusion.
Given that not all schools are IR for all students, it is possible that an student prefers to remain unassigned to be assigned with some school ω ∈ O, i.e. Ri(i) = 1 and Ri(ω) > 1 for all ω ∈ O. In
14

such situation, we use loops, which are pairs (i, i) ∈ A × A. In words, a loop is an edge from the set of students to the set of students. Consequently, loops are not admitted in bipartite graphs, that is why our assignment procedure makes use of quasi-bipartite graphs. We deﬁne a quasi-bipartite directed graph G(A , O , R) as a pair (V (A , O , R), E(A , O , R)), where V (A , O , R) = A ∪ O is the set of nodes; and E(A , O , R) is the set of all directed edges (i, ω) ∈ A × O and loops ( j, j) ∈ A × A , such that:
1. student i prefers school ω to any other school, and
2. student j prefers to remain unassigned to being assigned any school ω ∈ O.
An arbitrary element of E(A ∪ O , R) is denoted by e. So, the quasi-bipartite graph G is the graph on A ∪ O which results when each student i in A points to her most preferred element in Ai. Whenever there is no confusion, a quasi-bipartite graph is denoted by G = (V (G), E(G)). In the following example we show the construction of a quasi-bipartite graph.
Example 2.3.1. Consider O = {ω1, ω2, ω3}, A = {1, 2, 3}. The preference relations are:
R1 : [ω1, ω3], ω2, 1, R2 : [ω2, 2], R3 : ω3, 3.
Figure 2.1 shows the quasi-bipartite graph G(A, O, R).
2.3.2 Top Trading Covers and Tie Breaking Rules
Given a quasi-bipartite graph G, a top trading cover (ttco) is a subset T = {e1, e2, . . . , ek} of E[G], such that there are no two edges in T with a node in common. For example, the empty set and the set with a unique edge are top trading covers. Consequently, there always exist at least one ttco for all quasi-bipartite graph. A maximal top trading cover is a ttco of G that is no longer a ttco when an edge, not in it, is added to it. In other words, a maximal ttco is not a proper subset of any other ttco of the quasi-bipartite graph G. A maximum top trading cover is a ttco that covers the largest
15

ω1

ω2

ω3

1

2

3

Figure 2.1: A Quasi-bipartite Graph

ω1

ω2

ω3

ω1

ω2

ω3

1

2

3

4

(a) Maximal TTCo

ω1

ω2

ω3

1

2

3

4

(b) Non-Maximum and Non-Maximal TTCo

ω1

ω2

ω3

1

2

3

4

1

2

3

4

(c) Maximum TTCo 1

(d) Maximum TTCo 2

Figure 2.2: Top Trading Covers in dotted lines for the same Quasi-Bipartite Graph

possible number of nodes. It is clear that all maximum top trading covers are also maximal; however, a maximal ttco is not always maximum. Figure 2.2 shows four different top trading covers (in dotted lines) for the same quasi-bipartite graph. Note that all edges not in the ttco of Figure 2.2(a) have a node in common with it. Then, this ttco is a maximal ttco because adding an edge, not in it, the resulting subset of edges is not a ttco. Now,

16

the ttco illustrated in 2.2(a) covers 4 nodes and the ttco in 2.2(c) covers 6 nodes, the largest possible of nodes than can be covered. Therefore, 2.2(c) is a maximum top trading cover and 2.2(a) is not. Finally, if we add the edge (ω3, 1) to the ttco in 2.2(b), we get a larger top trading cover. Therefore, this ttco is non-maximum and non-maximal.
The existence of at least one maximum top trading cover is a well-known result from Graph Theory.
Proposition 2.3.1. Let G(A , O , R) a quasi-bipartite graph, a maximum T TCo always exists.
Proof. See Appendix A1.
However, the maximum top trading cover is not unique. Figure 2.2(d) shows a ttco that covers the same number of nodes than the ttco in 2.2(c), but they differ in the edges (ω1, 3) and (ω1, 2). That is, we have two different maximum top trading covers for the same quasi-bipartite graph.
The non-uniqueness of the maximum ttco represents a problem for the Top Trading Cover algorithm. In each iteration of it, every student i points to her most preferred school ω, between the remaining schools in the market. After that, we remove a maximum top trading cover and each student is assigned its corresponding partner in the ttco removed. To choose only one maximum ttco we use tie breaking rules. Formally, consider a quasi-bipartite graph G and let ϒ[G] = {T ⊆ E[G] | T is a ttco of G} be the set of all top trading covers of G. The set of elements which are subsets of ϒ[G] is denoted by 2ϒ[G]. A tie breaking rule is a function ς from 2ϒ[G] to ϒ[G] that chooses maximum top trading covers, for all quasi-bipartite graph G.
2.3.3 The Top Trading Cover Algorithm
Consider an economy (A, O, R) and a tie breaking rule ς. Initialize the algorithm with A0 = A and O0 = O. The assignment procedure proceed as follows: Step t: Every student in At−1 points to her most preferred school between the schools in Ot−1. According to the tie breaking rule ς, we remove a maximum top trading cover of Gt, every student in the cover is assigned to its partner in the cover. Let At and Ot be the sets of students and schools remaining in the economy after removing ς(ϒ[Gt]). If both are non-empty, we continue to the next step. Otherwise, the algorithm stops.
17

The ﬁnal allocation produced by the TTCo algorithm depends on the economy (A, O, R) and the tie breaking rule ς that we use. We sometimes write the ﬁnal allocation as T TCo[A, O, Rς], and we denote by T TCo[A, O, R, ς](r) the assignment given to r ∈ A ∪ O under this assignment procedure. If there is no confusion we refer to the assignment only by T TCo.
To illustrate how the TTCo algorithm works, we use the “lexicographic tie-breaking rule”. This rule is based on a lexicographic order deﬁned over the edges in E(G) ∩ A × O of the quasi-bipartite graph G.
Deﬁnition 2. Let G = (V (G), E(G)) be a quasi-bipartite graph, and (i, ω j, i), (i , ω j ) ∈ E(G) ∩ (A × O ). The lexicographic order L over E(G) ∩ (A × O ) is deﬁned as follows
  i < i or (i, ω j) L (i , ω j ) if and only  i = i and j ≤ j .
We recall that students and schools are indexed by the set of natural numbers, a well-ordered set, which implies the veracity of the next observation.
Observation 2.3.1. Given a quasi-bipartite graph, let E˜ be a subset of E(G) ∩ (A × O), then there exists an edge (i, ω) ∈ A × O such that (i, ω) L (i , ω ) for all (i , ω ) ∈ E˜ . In other words, the minimum element of E˜ exists for all E˜ ⊆ E(G) ∩ (A × O). We write (i, ω) = min E˜ .

By Proposition 2.3.1 we can ensure the existence of at least one maximum top trading cover regardless the quasi-bipartite graph. Thus, we can proceed to deﬁne the lexicographic tie-breaking rule over ϒ[G] using Deﬁnition 2 and Observation 2.3.1.

Deﬁnition 3. Consider a quasi-bipartite graph G, and let T = {Tη | Tη ∈ ϒ[G] and is maximum for all 1 ≤

η ≤ K} be a ﬁnite subset of maximum top trading covers. Consider Tη = Tη ∩ (A × O ) for all η ∈ {1, 2, . . . , K}. The lexicographic tie breaking rule ςL is the function ςL : 2ϒ[G] → ϒ[G] such that

ςL(T ) = Tκ if and only if for all t = κ.

K
min Tκ \ Tη
η=1

K
L min Tt \ Tη ,
η=1

18

We provide an example to show how the Top Trading Cover algorithm and the lexicographic tie breaking rule algorithm work.

Example 2.3.2. Consider the set of schools O = {ω1, ω2, ω3}, and the set of students A = {1, 2, 3, 4}. The preference list of each student is

R1 : [ω1, ω3], ω2, 1, R2 : ω1, ω2, 2, R3 : [ω1, 3], R4 : ω1, ω2, ω3, 4.

Figure 2.3 illustrates the step 1 of the TTCo algorithm. The maximum ttco that satisﬁes the lexi-

cographic is shown in dotted lines. The other maximum ttco, not chosen, includes the edge (4, ω1) instead of (2, ω1). Therefore, the set {(2, ω1), (1, ω3), (3, 3)} is removed from the market.

ω1

ω2

ω3

1

2

3

4

Figure 2.3: First step of the TTCo algorithm

Figure 2.4 shows the quasi-bipartite generated by the schools and students remaining in the market.

Consequently, the maximum ttco chosen by ςL is the unique edge (4, ω2).

The algorithm ﬁnishes at step 2 because all schools and students are removed from the market at the

end of this stage. Therefore, the ﬁnal allocation is





T TCo =  ω3 ω1 3 ω2  .

1 234

Unless we specify some other tie breaking rule, in each example we will show the assignment

produced by the the lexicographic tie breaking rule. However, it is important to remark that non-

wastefulness is a property that satisﬁes the TTCo algorithm for all tie breaking rule ς. This is because

19

ω2
4
Figure 2.4: Second and last step of TTCo algorithm the existence of a blocking pair contradicts the deﬁnition of maximum top trading cover, as we formalize in the following proposition. Proposition 2.3.2. Consider a market (A, O, R) and ς a tie breaking rule. The assignment
T TCo[A, O, ς]
is non-wasteful for all tie-breaking rule ς. Proof. By construction, it is clear that T TCo[R, ς] is individually rational. To prove that T TCo[R, ς] is not blocked by any pair, we proceed by contradiction. Suppose that this assignment is blocked by a pair (i, ω) ∈ A × O. Then, T TCo[R, ς](ω) = ω and ω Pi T TCo[R, ς]. We have the following cases. Case I. student i remains unassigned under T TCo[R, ς], i.e. T TCo[R, ς](i) = i. By assumption, student i strictly prefers ω to its allocation under this assignment. Then, there exists a step ti ∈ N such that the pair (i, ω) is an edge of the graph Gti. Moreover, we have that
(i, ω) ∈/ ς(ϒ[Gti])
because we assume that T TCo[R, ς](ω) = ω. Consequently, (i, ω) does not have nodes in common with the maximum ttco removed at step ti. So, the set ς(ϒ[Gti]) ∪ {(i, ω)} is a ttco greater than ς(ϒ[Gti]). This is a contradiction with the deﬁnition of maximum ttco. Case II. Suppose that T TCo[R, ς](i) = ω , then, the edge (i, ω ) was removed from the market in some step t of the TTCo algorithm, i.e. (i, ω ) belongs to the maximum ttco ς[ϒ(Gt )]. Also, we suppose that ωPiω , this implies that (i, ω) must be an edge of Gt, for some t ≤ t . Moreover, (i, ω)
20

was not included in the maximum ttco ς(ϒ[Gt]) because ω was not assigned to any student during the algorithm. Now, if t = t , we have that (i, ω) and (i, ω ) belong to the same graph Gt. By construction of Gt we conclude that ω ∼i ω , contradicting that (i, ω) is a blocking pair. Otherwise, t < t , we have that (i, ω) ∈ Gt and (i, ω) ∈/ ς(ϒ[Gt]). Even more, the edge (i, ω) does not have nodes in common with the edges in the removed ttco. Consequently, the set ς(ϒ[Gt]) ∪ {(i, ω)} is a ttco greater than the ttco ς(ϒ[Gt]), contradicting the deﬁnition of maximum ttco. Therefore, the assignment T TCo is not blocked by any pair regardless the tie breaking rule that we use.
2.3.4 Picking rules and Other mechanisms
The tie breaking rules are quite restrictive since they remove maximum top trading covers. Picking rules are more general functions than tie breaking rules. Given a quasi-bipartite graph G, a picking rules is a function ςˆG that chooses one and only one non-empty top trading cover of G.
In the following lemma we show that every Pareto efﬁcient assignment γ can be gotten using the TTCo algorithm and a picking rule ςˆγ that never chooses an empty ttco.
Lemma 2.3.1. If γ[R] is a Pareto efﬁcient assignment, there is some picking rule ςˆγ such that ςˆγ(T ) = 0/ for all T ∈ 2ϒ[G]\{0/ }, subset of top trading covers, and γ[R] = T TCo[R, ςˆγ].
Proof. Let T γ = {(i, r) ∈ A × (A ∪ O) | γ(r) = i} ∪ {(i, i) | γ(i) = i}. The pairs in the set T γ include all members in the market and do not have elements in common because γ is also a feasible assignment, i.e. each element in the economy is assigned one and only one element in A ∪ O. We partition T γ in the following way:
• T1Γ = {(i, r) ∈ T Γ | i ∈ A and r is the most preferred element of i in Ri}.
• For all k ≥ 2, deﬁne
k−1
TkΓ = {(i, r) ∈ T γ | i ∈ A and r is the top ranked in Ri after removing Tlγ},
l=1
and
21

K
• Let K ≡ max{k ∈ N|Tkγ = 0/ }, the set of remaining students is TKγ+1 = T \ Tk .
k=1
Note that, since γ is individually rational, TK+1 is the set of schools that are assigned to themselves at the end of the TTCo algorithm. We claim that each Tkγ is a non-empty top trading cover of the graph Gk for all k ≥ 1. Afﬁrmation 2.3.1. All sets Tkγ are non-empty for all 1 ≤ k ≤ K. Proof. We proceed by induction. Induction Base. By contradiction. Suppose that T1γ = 0/ , then, any buyer is assigned her most preferred basket. We have the following cases: Case I. There are i and i such that γ(i ) is the most preferred school of i and γ(i) is the most preferred school of i , consequently
γ(i )Piγ(i) and γ(i)Pi γ(i ), i.e. i strictly prefers the allocation of i than her allocation and vice versa. Then, deﬁning an assignment γ such that
• γ (i) = γ(i ) and γ (γ(i )) = i,
• γ (i ) = γ(i) and γ (γ(i)) = i ,
• γ (r) = γ(r) for all r ∈ (A ∪ O)\{i, i , γ(i), γ(i )},
we contradict the fact that γ is Pareto efﬁcient. Case II. There is an school ω such that γ(ω) = ω and it is the most preferred school of some student i. Then, ωPiγ(i). Consequently (i, ω) is a blocking pair. However, this is not possible because γ is Pareto efﬁcient. Therefore T1Γ = 0/ . Induction Hypothesis. Assume that TkΓ = 0/ , for all 1 ≤ k < K. Induction Step. We have to prove that Tk+1 = 0/ , for k + 1 < K + 1. We proceed by contradiction.
22

Suppose that TkΓ+1 = 0/ , then, applying the hypothesis of induction we have that
k+1
Tkγ+2 = (i, r) ∈ T γ | i ∈ A and r is the top ranked in Ri after remove Tlγ
l=1 k
= (i, r) ∈ T γ | i ∈ A and r is the top ranked in Ri after remove Tlγ .
l=1
So, Tkγ+2 = Tkγ+1 = 0/ . Analogously, we conclude that Tkγ = 0/ for all k > k + 1. Then max{t ∈ N | Ttγ = 0/ } = k < K = max{t ∈ N | Ttγ = 0/ , which is not possible. Therefore Tkγ+1 = 0/ .

Now, deﬁne the picking function ςˆγ : 2ϒ[G] → υ[G] as

 ςˆ(ϒ[G ]) =  Tkγ
 TKγ ∪ TKγ+1

if G = Gk[Ak, Ok, Rk] for all 1 ≤ k < K − 1, if G = GK[AK, OK, RK].

Afﬁrmation 2.3.1 guarantees that ςˆγ is a picking function that chooses the non-empty top trading cover Tkγ in every step k of the algorithm. Moreover, it is clear that γ(r) = T TCo[R, ςˆγ](r) for all r ∈ A ∪ O.

The TTCo algorithm and other mechanisms Assuming strict preferences, the top trading cover algorithm encompasses with hierarchical exchange rules. We describe the corresponding picking rules for the polar cases: the top trading cycles and the serial dictatorship mechanisms. Consider P a proﬁle of strict preferences and G the quasi-bipartite graph induced by these preferences.

Top Trading Cycles. Assume that the initial endowment of each agent is described by a bijection µ : O → A. Note that a cycle is a ttco C ⊆ E[G] if and only if for all (i, ω) ∈ C there exists ω ∈ O such that (µ(ω), ω ) ∈ C. So, a cycle picking rule is a picking rule ςC such that ςC(ϒ[G]) is a cycle.

Serial Dictatorship. Given an exogenous priority π of agents in A, the serial picking rule ςS is deﬁned as follows: ςS(ϒ[Gt]) = {(i, ω) ∈ E[Gt] | i = π(t)}, for all t = 1, . . . , |A|.

As we know, top trading cycle and serial dictatorship mechanism belong to a more general family of mechanisms: the hierarchical exchange rules. The TTCo algorithm encompasses with this family of mechanisms. To show it, we ﬁrst describe the inheritance trees.
23

An inheritance tree Γa = (V, A˜) for object a is a rooted tree where V is the set of nodes, and A˜ ⊆ V × V is the set of arcs (or edges) such that there is a path from vi to v j for all vi, v j ∈ V . The root of an inheritance tree is a node such that there is no incident arcs on it. An inheritance tree has the following properties
1. All nodes are students, V ⊆ A,
2. Every vertex of a path represent a different individual. 3. All arcs in A˜ are labelled by schools, that is to say, for all (vi, v j) ∈ A˜, this arc corresponds to a
school in O \ {a}.
4. Every arc in a path represents a different school.
5. Arcs from the same node represent different schools. Consider Ga the set of inheritance tree, G = ×a∈OGa, where Γ ∈ G is a list of inheritance trees. When A = O = ∅, the initial endowment ξiΓ of each student is given by
ξΓi = {ω ∈ O|i is the root in Γa}.

Let σT,P : T → P a bijection between T and P. Now, consider T ⊆ A, P ⊆ O and a student i ∈ A \ T , the corresponding non-initial endowment ξiΓ(T, P, σT,P) is given by
ξΓi = {ω ∈ O \ P|i is the root in Γa or there exists a v0 − vr path such that v0 = i, (vs, vs+1) ∈ P, φ(vs) = (vs, vs+1)}.

The initial endowment is denoted by E1(i, R) = ξiΓ(∅), and a cycle at the ﬁrst step is deﬁned as

follows:



S1(i, R) =  { j1, . . . , jg} if there exist j1, . . . , jg ∈ Asuch that R−ja1(1) ∈ E1(i, R),

(2.1)

∅

otherwise.

Consequently, the set of assigned students is W1(R) = {i : S1(i, R) ∈/ ∅}, and the set of assigned schools is F1(R) = {R−j 1(1) : j ∈ W1(R)}. Consequently, the non-endowments are deﬁned as follows

Et (i, R) = ξΓi (Wt (R), Ft (R), φWt(R),Ft(R)).

24

We deﬁne the hierarchical exchange rules as a picking rule ςH such that (i, ω) ∈ ςH[Gt] if and only there exists in (i , ω ) ∈ ςH[Gt] such that ω ∈ Et(i , R). In other words, in a hierarchical picking rule me remove a top trading cover if and only the owner of each object is also in the ttco, according to the endowment Et(i , R).
Now, consider R a proﬁle of non-strict preference list, Alcalde and Molis (2011) propose the Top Trading Absorbing Sets mechanisms as a generalization of the Top Trading Cycles mechanism. To describe this mechanism through picking rules, we need the following concepts.
Let i, ω j ∈ V [G], we say that there is a path from the student i to the school ω j if there is a sequence of nodes v1 = i, . . . , v2m = ω j that satisﬁes two conditions: 1. v2k−1 ∈ A for all k ∈ {1, . . . , m}, v2k ∈ O for all k ∈ {1, . . . , m}; and 2. (v2k−1, v2k) ∈ E[G] and µ(v2k) = v2k+1 for all k ∈ {1, . . . , m − 1}. Analogously, we deﬁne a path between a school ω j and a student i. The pair i, ω j is symmetric if (i, ω j) ∈ E[G] and µ(ω j) = i.
An absorbing set is a set of nodes A ⊆∈ V [G] such that
1. for any two nodes i, ω j ∈ A there is a path from one to the other,
2. there is no path from any node r ∈ A to any node r ∈/ A.
An observing set is paired symmetric if each of its nodes belongs to a symmetric pair.
The absorbing rule is a picking rule ςAS that chooses a collection of paired symmetric absorbing sets. In the corresponding T TC[ςAS] algorithm, the quasi-bipartite graph Gt+1 actualizes the endowments of each agent not in a paired-symmetric absorbing set. Every agent in a non paired-symmetric absorbing set point to the maximal object with the highest priority, different from her initial endowment. Each agent in a cycle changes her endowment for the object that she is pointing to.
2.4 Characterization
The objective of this section is to present the axioms that characterize the Top Trading Cover algorithm. We get a characterization through Pareto efﬁciency and the Recursively Respect Top Prefer-
25

ence axiom, introduced by Abdulkadiroglu and Che in [1] as the fact that an assignment Recursively Respects Top Rankings.

2.4.1 Pareto Efﬁciency

An assignment γ is Pareto efﬁcient if there is no other assignment γ such that γ(i) ∼i γ(i) for almost i ∈ A, and there exists at least one i such that γ (i)Piγ(i).

Proposition 2.4.1. Let γ be a Pareto efﬁcient assignment, then γ is IR and non-wasteful.

Proof. Let γ be a Pareto efﬁcient assignment. To prove that γ is IR, we proceed by contradiction, so we assume that γ is not IR. Consider A− = {i ∈ A | iPiγ(i)}, the set of students assigned to some not IR school. Since γ is not IR, then A− = ∅.

Now, deﬁne the assignment γ in the following way:



 

γ(r)





γ (r) = r





 

r

if r ∈ A \ A− or γ(r) ∈ A \ A−, if r ∈ A− or γ(r) ∈ A−, if r ∈ O and γ(r) = r.

It is clear that γ (i)Rii for all i ∈ A. Then, γ is IR.

Consequently, by deﬁnition of γ we have that

γ (i) = γ(i) for all i ∈ A \ A−,

and, by individual rationality, we conclude that γ (i)Piγ(i) for all i ∈ A−.
This is a contradiction because γ is Pareto efﬁcient. Therefore, γ is IR. Also, to prove that γ is wasteful, then there exists a blocking pair (i, ω) such that

γ(s) = s and sPiγ(i).

Deﬁne the assignment γ as follows



 

γ(r)





γ (r) = s





 

i

if r ∈ (A ∪ O) \ {i, s}, if r = i, if r = s.

26

Since (i, s) is a blocking pair, the deﬁnition of γ implies that
γ ( j) = γ( j) for all j ∈ A \ {i}, and γ (i)Piγ(i).
This is a contradiction because γ is Pareto efﬁcient. Therefore γ is non-wasteful. Now, we prove that every tie breaking induces a Pareto efﬁcient assignment.
Proposition 2.4.2. Let ς be a tie breaking rule. The assignment T TCo[R, ς] is Pareto efﬁcient.
Proof. We proceed by contradiction. Suppose that there exists an assignment γ such that γ(i) ∼i T TCo[R, ς](i) for almost i ∈ A, and there exists at least one j such that γ( j)PjT TCo[R, ς](i). Consider that T TCo[R, ς] = ∪kK=1T TCok, where T TCok is the maximum ttco removed at step t of the TTCo algorithm. Since γ( j)PjT TCo[R, ς], for at least one j ∈ A, then ( j, γ( j)) ∈/ T TCok for some k ∈ {1, 2, . . . , K}. Let k∗ be the minimum k such that some j improves under γ. We know that other students in T TCok∗ are indifferent between γ and T TCo[R, ς]. This implies that T TCok∗ is not a maximum ttco, which is not possible by the deﬁnition of ς. Therefore T TCo[R, ς] is Pareto efﬁcient for all tie breaking rule ς.
2.4.2 Recursively Respects Top Preferences
An assignment γ respects top preferences if for each ω ∈ O and i ∈ A such that Ri(ω) = 1 and ωPiγ(i) implies that
Rγ(ω)(ω) = 1. In words, if an student is not assigned some of her most preferred schools, this implies that her most preferred schools are assigned to students who also put these schools as their most preferred schools.
All tie breaking rules generate an assignment that respects top preferences.
Proposition 2.4.3. T TCo[ς] respects top preferences for all tie breaking rule ς.
Proof. Consider (i, ω) ∈ A × O such that Ri(ω) = 1 and ωPiγ(i). Then (i, ω) ∈ E[G1] and (i, ω) ∈/ ς[ϒ(G1)].
27

Then, by deﬁnition of maximum top trading, there is i ∈ A such that (i , ω) ∈ E[G1] and (i , ω) ∈ ς[ϒ(G1],
otherwise ς did not remove a maximum ttco which contradicts the fact that it is a tie breaking rule. Consequently, there is i such that i = γ(ω) and Ri (ω) = 1. Therefore T TCo[ς] respects top preferences for all tie breaking rule.
The TTCo mechanism is related with the Gales Top Trading Cycles (TCC) mechanism. Both mechanisms respect top preferences, and remove a set of pairs (students-schools) at the end of its iteration. Both properties are crucial to describe the TTCo algorithm when we use a tie breaking rule.
If γ respects top preferences, then ςγ(ϒ[G1]) is a maximum ttco. However, this axiom says nothing about other iterations.
Abdulkadiroglu and Che (2010) made a characterization of the Top Trading Cycle mechanism for the assignment of indivisible schools between students. In this work, they introduced the axiom recursively respect top rankings (top preferences in our case) to explain how the TTC mechanism removes a set of students in each iteration. Before introduce this axiom, note that respecting top preferences axiom leads to the following concept.
Deﬁnition 4. A top preference group is a subset A0 = {a1, a2, . . . , ak} ⊆ A such that there is ωi ∈ O such that
γ(ai) = ωi and Rai(ωi) = 1 for all 1 ≤ i ≤ k. A top preference group is a set of students assigned to its most preferred school.
Let γ be an assignment and A0 ⊆ A a top ranked group of the initial economy E = (A, O, R). The sub-economy induced by A0 is the economy (A \ A0, OAγ \A0, RA\), to simplify, we sometimes represent the induced economy by E \ A0. In words, the induced economy E \ A0 is the economy where all the students in A0 left the initial economy with her allocations under the assignment γ. As in [1], we use this elements to generalize the idea of respecting top preferences in a recursive form.
Let E0 = (A0, O0, R0) = (A, O, R) be the original economy and consider an assignment γ. We denote by Et the sub-economy induced by a top preference group At0 of the economy Et−1, for all t ≥ 1.
28

Deﬁnition 5. We say that the assignment γ recursively respects top preferences if γ[Et] respects top preferences for all t ≥ 0, regardless the sequence of top ranked groups {At0}t≥0. In words, an assignment recursively respects top preferences if it respects top preferences in any sub-economy induced by a top preference group and this goes recursively in each sub-economy. Moreover, it is important to note that this must be true regardless the top preference group initially chosen.
We say that Ri(ω; Et) = k if and only if (i, ω) ∈ At × Ot and ω is the k−th most preferred student in Ot with respect to Ri.
We have already proved that every Pareto efﬁcient assignment can be gotten using a picking rule that never chooses the empty top trading cover, see Lemma 2.3.1. Before to establish our characterization of the TTCo algorithm and tie breaking rules, we require an extra lemma.
The following lemma shows a sufﬁcient condition to choose a maximum top trading cover in the ﬁrst step of the TTCo algorithm. That is to say, if an IR assignment respects top preferences, then the corresponding picking rule chooses a maximum ttco.
Lemma 2.4.1. Let γ be an IR assignment that respects top preferences, then there is a picking rule ςˆ such that γ = T TCo[ςˆ] and ςˆ[ϒ(G1)] is a maximum ttco.
Proof. By Lemma 2.3.1, there exists ςˆγ such that γ = T TCo[ςˆγ]. We have to prove that ςˆγ[ϒ(G1)]
is a maximum ttco. By construction, ςˆγ[ϒ(G1)] = {(i, γ(i)) | Ri(γ(i)) = 1}. We proceed by contradiction. Suppose that it is not a maximum ttco, then there is (i, r) ∈ E[G1] such that
(i, r) ∈/ ςˆγ[ϒ(G1)], and (i, r) does not have nodes in common with ςˆγ[ϒ(G1)].
29

Case I. If r = i, then ςˆγ[ϒ(G1)] ∪ {(i, i)} is a larger ttco than ςˆγ[ϒ(G1)], which is not possible by construction of ςγ. Case II. If r = ω ∈ O, we know that Ri(ω) = 1 and γ(i) = ω. Then there is r ∈ (A\{i}) ∪ {ω} such that γ(ω) = r . II.A If r = ω, this means that ω remains unassigned under γ and ωPiγ(i) because i is not removed in the ﬁrst step (remember that (i, r) does not have nodes in common with the ttco removed). This is a contradiction because γ respects top preferences. II.B If r = j ∈ A\{i}, then R j(ω) ≥ 1. If R j(ω) = 1, the fact that γ respects top preferences implies that ( j, ω) belongs to ςˆγ(ϒ[G1]) which contradicts that (i, ω) does not have nodes in common with the ttco. If R j(ω) > 1 we contradict that γ respects top preferences. In any case, we get a contradiction. Therefore ςˆγ(ϒ[G1]) is a maximum top trading cover.

The Theorem establishes a characterization of the TTCo algorithm when it uses a tie breaking rule.

Theorem 2.4.1. Given an economy (A, O, R), a mechanism φ is Pareto efﬁcient and recursively respects top preferences if and only there is a tie breaking rule ςφ such that φ[R] = T TCo[R, ς].
Proof. We have proven that T TCo[ς] is Pareto efﬁcient and respects top preferences in propositions 2.4.2 and 2.4.3 for all tie breaking rule ς, respectively. We have to prove that T TCo[ς] recursively respects top preferences, i.e. we have to prove that T TCo[Et] respects top preferences for all t ≥ 0. We proceed by induction. Base of Induction. Consider A01 a top ranked group of E0. We have to prove that T TCo[E1, ς] respects top preferences. Let (i, ω) ∈ A1 × O1 such that

Ri(ω; E1) = 1 and ωPiT TCo[E1, ς](i).

Then, we have that

(i, ω) ∈ G1[E1] and (i, ω) ∈/ ς(ϒ[G1[E1]]).

Consequently, there exists j ∈ A1 \{i} such that ( j, ω) ∈ ς(ϒ[G1[E1]]). Otherwise, (i, ω)∪ς(ϒ[G1[E1]]) is a top trading cover greater than ς(ϒ[G1[E1]]), which is not possible because ς is a tie breaking rule. Since j ∈ A1 and G1[E1] is the quasi-bipartite graph where all students in A1 point to her most preferred school in E1, we conclude that R j(ω; E1) = 1.

30

Hypothesis of Induction. Let k ∈ N. Consider At0 a top ranked group of Et−1 for all t = 0, 1, . . . , k. Suppose that T TCo[Ek, ς] respects top preferences. Induction Step. Let Ak0+1 a top ranked group of Ek. We have to prove that T TCo[Ek+1, ς] respects top preferences. The proof is equal to the done in the Base of Induction. Therefore, T TCo[ς] recursively respects top preferences for all tie breaking rule ς.
Now, let γ be a Pareto efﬁcient assignment that recursively respects top preferences. We have to prove that γ = T TCo[ς] for some tie breaking rule ς. In Lemma 2.3.1 we proved the existence of a picking rule ςγ such that γ = T TCo[ςγ]. Even more, we know that ς(ϒ[Gk]) = Tkγ is a non-empty top trading cover for all k = 1, 2, . . . , K. Then, we have to prove that every ttco Tkγ is a maximum ttco. We proceed by induction. Base of Induction. Since γ recursively respects top preferences, particularly, γ respects top preferences. Therefore, ςγ(ϒ[G1]) = T1γ is a maximum top trading cover by Proposition 2.4.1. Hypothesis of Induction. For 1 ≤ k < K, suppose that Tkγ is a maximum ttco of Gk. Induction Step. We have to prove that Tkγ+1 is a maximum ttco of Gk+1. By hypothesis of induction, we know that each ttco Tkγ is a maximum ttco. Note that T1γ is also a top preference group of the economy E0 with maximum cardinality. If E1 = E0 \ T1γ, the construction of ςγ implies that T2γ is a top preference group of the economy E1 because T1γ is a maximum ttco. So, consider the sequence of economies Et such that Et = Et−1 \ Ttγ. Since γ recursively respects top preferences, we have that γ respects top preferences at economy EK−1. By construction, TKγ is a top preference group of the economy EK−1. Then, applying Lemma 2.4.1, we conclude that TKγ is a maximum ttco of G[EK−1]. So, any Pareto efﬁcient assignment that recursively respects top preferences is generated by the TTCo mechanism through a tie breaking rule.
2.5 Equilibrium Analysis
The objective of this section is to show the existence of a unique ε−Bayesian Nash equilibrium, where all students are truth-telling, in large markets that satisfy the thickness condition. Remember,
31

an ε−Bayesian Nash equilibrium of the game described above is a proﬁle of decision rules such that in expectation no student has large incentives to deviate from it. In other words, no single student i can improve signiﬁcantly her ﬁnal allocation T TCo[β∗, ς](i) at equilibrium.
We search the best response correspondence of each student following the methodology developed by Immorlica and Mahdian (2005), and extended by Kojima and Pathak (2009). Since the TTCo algorithm is manipulable, we simplify the searching of the best responses analysing dropping strategies, and show that students have incentives to deviate whenever they have more than one effective school. In large markets, the proportion of students with more than one effective school tends to zero. Finally, the thickness condition ensures the existence of a unique ε−Bayesian Nash equilibrium where all students are truth-telling.
2.5.1 Dominant Strategies in the TTCo algorithm
A preference list R∗i is a dominant strategy for student i if and only if φ[A, O, (Ri∗, R−i)](i)Riφ[A, O, (Ri, R−i)](i),
for all Ri ∈ ℜi and for all R−i ∈ ∏ ℜ j. An student i is truth-telling if her true preference list is a
j=i
dominant strategy. We use Ri to denote the true ranking of i; if i is not truth-telling, she manipulates the TTCo algorithm.
Deﬁnition 6. An student i manipulates the φ at R through Ri if there exists Ri in ℜi such that φ[A, O, (Ri, R−i)](i)Piφ[A, O, (Ri, R−i)](i).
If an student manipulates the mechanism, the mechanism is said to be manipulable.
Recall that the T TCo assignment depends on: a set of students, A, a set of schools, O, and the reported proﬁle of preference lists R . We deﬁne a market as a tuple ℵ = (A, O, R).
Observation 2.5.1. The TTCo mechanism is manipulable.
The above observation is illustrated in the example below.
32

Example 2.5.1. Consider the market given in Example 2.3.2, students true preferences are

R1 : ω1, ω2, 1 R2 : ω1, ω2, 2 R3 : ω1, ω2, ω3, 3 R4 : ω1, ω2, ω3, 4.

Given the proﬁle R of true preferences, the assignment produced by the TTCo algorithm under the market (S, B, R) is:

T TCo(1) = ω1 T TCo(2) = ω2 T TCo(3) = ω3 T TCo(4) = 4.

Now, suppose that student 4 reports

R4 : ω3,

while other students report their true preferences. Let R = (R1, R2, R3, R4), the T TCo algorithm under R outputs the following assignment:

T TCo[R ](1) = ω1 T TCo[R ](2) = ω2 T TCo[R ](3) = 3 T TCo[R ](4) = ω3.
Since student 4 prefers ω3 to remain unassigned, she manipulates the mechanism at (R1, R2, R3) through R4. Indeed, truth-telling is neither a dominant strategy for students nor a Nash equilibrium in small markets.

33

2.5.2 Dropping Strategies
To establish that truth-telling is an ε−Nash equilibrium in large markets, we show ﬁrst that dropping strategies cover all the range of best responses, i.e. dropping strategies are exhaustive.
Deﬁnition 7. A preference list Rb is said to be a dropping strategy for the TTCo at true preference list Rb if
1. ωRbω then ωRbω , and
2. bRbω then bRbω. That is to say, a dropping strategy is a preference list that 1. drops some elements and 2. respects the order in Rb.
In [15], Kojima and Pathak showed the exhaustiveness of dropping strategies in their Lemma 1: “All manipulations of the Student Optimal Stable Mechanism (SOSM) can be gotten through a dropping strategy when others report true preferences”. Even more, they proved that this is a general property of any stable mechanism. We establish a similar result for the family of non-wasteful assignments T TCo[ς] for all tie breaking rule ς. With respect to the proof of Kojima and Pathak, we restrict our attention to dropping strategies which drop all the schools preferred to the one assigned by the TTCo algorithm, denoted by RTb TCo(b). That is to say, if student b reports a strategy
Rb : [ω1]b, [ω2]b, . . . , [T TCo(b) = ωk]b, . . . , [b]b, the corresponding dropping strategy RbTTCo(b) is deﬁned as follows
RTb TCo(b) : [T TCo(b) = ωk]b, . . . , [b]b.
Lemma 2.5.1. (Dropping strategies are exhaustive) Fix an student b ∈ A. Suppose that b reports Rb ∈ ℜb, and all the other students report any ranking R−b. Consider that the assignment γ is equal to T TCo[Rb, R−b; ς], that is to say T TCo[Rb, R−b; ς](i) = γ(i) for all i ∈ A. Then
T TCo[Rbγ(b), R−b; ς](b) = γ[Rb, R−b],
for all tie breaking rules ς.
34

Proof. Speciﬁcally, we prove that T TCo[Rγb(b), R˜−b; ς](b) = γ(b) when γ(b) is declared as the unique most preferred school of b at Rγb(b), i.e. Rγb(b) : [γ(b)]b, . . . , [b]b. We have that γ(b) = T TCo[Rb, R−b](b) = ω. By construction of the TTCo algorithm, there is τ ∈ N, such that
(b, ω) ∈ ςL(ϒ[Gτ]). Then, all student b that points to ω are not removed in any step t = 1, . . . , τ. So, edges (b , ω) were never removed from the market. Case I. If τ = 1, then T TCo[Rγb(b), R−b] = T TCo[Rb, R−b]. Case II. If τ = 1. Running the TTCo algorithm with the proﬁle (R−γ(bb), R−b), in its ﬁrst step we have that
b ∈ Dω1 (p) = {i ∈ A | ω is the most preferred school in (Rbγ(b), R−b)}. The only change in the algorithm is that b ∈ D1ω(p), which did not happen under (Rb, R−b). Remember that any tie breaking rule selects a maximum ttco at any step of the mechanism. Since ω is the unique most preferred school of b, the edge (b, ω) does not have nodes in common with other edges in ς(ϒ[G1[Rb, R−b]]). Therefore, (b, ω) must belong to ς(ϒ(G1[Rbγ(b), R−b])), so T TCo[Rbγ(b), R−b](b) = ω.
We extend Lemma 1 of Kojima and Pathak to the family of non-wasteful assignments T TCo[ς], for all tie breaking rule ς. In general, non-wasteful assignments do not satisfy the “Rural Hospital Theorem” (Roth (1984)), which is a central argument in Lemma 1 of [15]). Figure (2.5) shows this fact, the set of single agents is not the same in two different non-wasteful assignments.
2.5.3 Counting Effective schools
Below, we introduce the tools that we use to prove that no student has incentives to deviate from her true ranking in large markets.
Given an assignment Γ, we recall that Γω[R](b) ∈ O ∪ {∅} is the good assign to b at Γ[R], for some R ∈ ℜ. We say that [ω]b = {ω ∈ O|ω ∼b ω} is effective for the student b if and only if there is a
35

ω1

ω1

1

2

1

2

(a) Non-Wasteful Assignment 1

(b) Non-Wasteful Assignment 2

Figure 2.5: Dotted lines represent two different non-wasteful assignments. These assignments have different sets of
unmatched members, so, the “Rural Hospital” Theorem does not hold for our non-wasteful assignment problem.

strategy Rb such that Γ[Rb, R˜−b] ∈ [ω]b. If there is no preference list Rb ∈ Rb such that Γ[Rb, R˜−b] ∈ [ω]b, we say that [ω] is a non-effective class.

Observation 2.5.2. Student b has not incentive to deviate from her true ranking if and only if T TCo[Rb, R˜−b](b) = T TCo[Rb, R˜−b](b), for all dropping strategies
Rb : [ω1], [ω2], . . . , [T TCo[Rb, R˜−b](b)], . . . [b].

The Waiting Algorithm
The importance of Observation 2.5.2 lies in changing our original problem: instead of searching best response correspondences it is sufﬁcient to count how many effective schools each student has. In this section we explain how to count effective schools.

Immorlica and Mahdian (2005) and Kojima and Pathak (2009) also change the original problem into a counting problem. They count stable partners3 using an algorithm based in reaction chains. However, we cannot use reaction chains to count effective schools because our game only considers that one side of the market reports a ranking of the members of the other side of the market.

Example 2.5.1 shows that TTCo is manipulable and Lemma 2.5.1 implies that all proﬁtable manipulations can be gotten through dropping strategies where the corresponding effective school is declared
3In papers [11] and [15] the deviations are identiﬁed with stable husbands/students, which are equivalent to the effective schools in our model.
36

as the most preferred school. Based on these observations we construct the Waiting Algorithm (WA) to count all the effective schools preferred to T TCo[R](b).
The WA checks if student b can get a school preferred to T TCo[R](b) using dropping strategies while other students are truth-telling. These dropping strategies are truncating R˜b in a descending form. The Waiting Algorithm Fix a student b, the Waiting Algorithm is described below: Step 0. Initialization: Consider R0b = Rb the ranking reported by b, and Xb0 = ∅, the set of effective schools of b before starting the assignment procedure. Run the T TCo algorithm with the proﬁle of true preferences R = (R0b, R˜−b).
Step t. 1. Effective schools: If T TCo[Rtb−1, R˜−b](b) ∈ S, the WA actualizes the set of effective schools:
Xbt = Xbt−1 ∪ {[T TCo[Rtb−1, R˜−b](b)]}.
2. Preference actualization: Case A. If the dropping strategy Rtb−1 is the strategy where the original assignment
[T TCo[R0b, R˜−b](b)]
is the most preferred school, then the algorithm stops. Case B. Otherwise, consider the dropping strategy Rtb as the strategy where the most preferred indifference class in Rtb−1 is dropped. Run the T TCo algorithm with the proﬁle of preferences Rt = (Rtb, R˜−b). Go to t.1.
In the step t.2.B, we construct the dropping strategy Rtb by dropping simultaneously all the elements of the most preferred indifference class in Rtb−1. We can construct this dropping strategy deleting school by school from the most preferred class of indifference at Rtb−1. For example, consider
Rb : [s, ω1, ω2], s˜, T TCo[Rb, R˜−b](b), b,
and suppose that s˜ is an effective school of b, but [s, ω1, ω2] is not an effective class when other students are truth-telling. The ranking
Rb : [ω1, ω2], s˜, T TCo[Rb, R˜−b](b), b
37

is also a drooping strategy of b. The TTCo algorithm ignores these strategies when the whole class is not effective. In other words, reducing a non-effective class school by school does not affect the ﬁnal allocation when others tell the truth. This property is justiﬁed in the following proposition.

Proposition 2.5.1. Let b ∈ A and R˜ = (R˜b, R˜−b), a proﬁle of preference lists. Suppose that R˜b : [s0, ω1, . . . , ωk], [T TCo[R˜](b)], . . . , [b],

for some k ≥ 1. Consider

Rb : [ω1, ω2, . . . , ωk]b, [T TCo[R˜](b)]b, . . . , [b]b.
Then T TCo[Rb, R˜−b](b) = T TCo[R˜b, R˜−b](b).
Proof. It is clear that b is removed from the market in the second step of the TTCo algorithm and is assigned to T TCo[R˜](b). First, note that each school in [ω0, ω1, . . . , ωk] is assigned to some student at the end of ﬁrst step of T TCo[R˜]. To see it, proceed by contradiction. Suppose the existence of ωt, for some τ ∈ {1, 2, . . . , k}, such that she is not removed at the end of step 1. We know the following

1. b and ωt are not removed from the market at the end of step 1, and

2. (ωt, b) is an edge of G1.

Then the maximum ttco of G1 is not a maximum cover, because ς(ϒ[G1]]) ∪ {(ωt, b)} is a larger top

trading cover. Consequently T TCo[R˜](b)R˜bωt = T TCo[R˜](b), which is a contradiction. Then there exist students bτ such that T TCo[R˜b, R−b](bτ) = ωt, for all τ = 0, 1, . . . , k. Moreover, the

tie breaking rule implies that

(b, ωt) ≺ (ωt, bτ)

(2.2)

for all τ = 0, 1, . . . , k. Given the proﬁle (Rb, Rb), the pair (s0, b) is not an edge of the quasi-bipartite graph G1[Rb, R˜b], but all pairs (ωt, bτ) are edges of G1[Rb, R˜b] and the equation (2.2) is also true. So, the maximum ttco of G1[Rb, R˜b] is the same maximum ttco of G1[R˜].

38

Following to the second step, as student b is the unique student who changes her strategy and all schools in [ω1, ω2, . . . , ωk] are removed at the end of step 1, we have that
G2[R˜] = G2[Rb, R˜−b]. Therefore T TCo[Rb, R˜−b](b) = T TCo[R˜b, R˜−b](b). Let xb = |XbT | denote the number of effective schools that improve the allocation of b, produced at the end of the WA.

Next example illustrates how the Waiting Algorithm works.

Example 2.5.2. Consider the same market described in Example 2.5.1. We count all the effective schools of student 4 using the WA. We know that T TCo[R0](4) = 4, then Xb1 = ∅. The step 2 of the WA submit R14 : ω2, ω3, 4 to the TTCo algorithm. Then T TCo[R41, R˜−4](4) = 4. WA outputs not effective schools, X42 = ∅. Actualizing the ranking, we have R42 : ω3, 4, consequently T TCo[R42, R˜−4] = 3. WA outputs X43 = {ω3}. In step 4 we have that R44 : 4 = T TCo[R˜](4), the algorithm stops. We conclude that ω3 is the unique effective school of 4.

We prove formally that the WA outputs all the possible effective class of indifference that represent a proﬁtable deviation.

Proposition 2.5.2. The Waiting Algorithm outputs, under R˜b, all the effective classes [ω]b for b such that
[ω]bPbT TCo[Rb, R˜−b](b).

Proof. We proceed by contradiction. Suppose there is an effective class [ω]b such that the waiting

algorithm did not output it and

[ω]bRb[T TCo[Rb, R˜−b](b)]b.

Then T TCo[Rtb, R˜−b](b) = [ω]b for all t ∈ N. Since [ω]b is an effective class, there is a strategy Rb such that T TCo[(Rb, R˜−b)] = ω ∈ [ω]b. By Lemma 2.5.1, we have that

T TCo[Rb, R˜−b](b) = T TCo[Rωb , R˜−b](s), 39

where Rbω is the dropping strategy where ω is declared the unique most preferred school of b. Now, dropping all the indifference classes preferred to [ω]b, we get the dropping strategy R[bω]b such that
T TCo[Rbω , R˜−b](b) ∼b T TCo[R[bω]b, R˜−b](b). By construction of the WA algorithm, in some step t ∈ N we have Rtb = Rb[ω]b, which is a contradiction. Therefore, the waiting algorithm outputs all affective classes of b.
Random Markets
To simplify the analysis, we ﬁrst assume complete information. We have shown that: truth-telling is not a Nash equilibrium of the game described in Subsection 2.2, and students can manipulate the TTCo mechanism. We investigate how likely students manipulate the TTCo algorithm introducing random markets as in [11] and [15].
Consider D = (d1, d2, . . . , dm) a probability distribution over O such that, without loss of generality, d j ≥ d j+1 and d j > 0 for all ω j ∈ S. We say that school ω j is more popular than school ω j if d j ≥ d j . For each student i, a distribution D induces a random ranking R˜i, not necessarily complete, of length k ∈ N as follows4: Step 1. Select randomly a school following distribution D. List this school as the most preferred school of i. Step t. Select randomly a school following distribution D. t.1 If this school has not been previously drawn in steps 1 through t − 1, list this school as the tth most preferred school of i, go to t + 1. t.2 Otherwise, we select randomly a school following distribution D, go to t.1. The procedure ends at step k.
A random market is a tuple ℵ˜ = (A, O, D, k) with an associated proﬁle of random preferences R˜. Given ε > 0, a proﬁle of preferences R∗ = (Ri∗)i∈A is an ε-Nash equilibrium if there is no i ∈ A and Ri such that
E[ui(T TCo[A, O, (Ri, R∗−i)](i))] > E[ui(T TCo[A, O, R∗](i))] + ε,
4This is deﬁned in the same form as in [15].
40

where the expectation is taken with respect to random preferences.
In random markets, we count all proﬁtable deviations of student b using the WA, assuming that she knows her true ranking Rb and other students report random preferences R˜−b. As a consequence of Proposition 2.5.2, the WA outputs all effective indifference classes [ω]b strictly preferred to T TCo[Rb, R˜−b](b), for all b ∈ A.

Large Markets A sequence of random markets is denoted by (ℵ˜ 1, ℵ˜ 2, . . .), where each ℵ˜ n is a random market
(An, On, Dn, kn)

such that Dn = (d1n, d2n, . . .), |An| = n and |On| = mn, for all n ∈ N. For each random market ℵ˜ n in the sequence, we denote the expected number of students that manipulate the TTCo mechanism by
δk(n) = E[# i ∈ An|T TCo Rin, R˜n−i (i)PiT TCo Rin, R˜n−i (i) for some Rni in the induced market|ℵ˜ n].
The expectation is taken with respect to the random proﬁle R˜n of the random market ℵ˜ n. This represents a difference with the work done by [11] and [15]: we cannot assume that other students are truth-telling because schools do nothing during the TTCo algorithm.

We prove that the expected proportion of students that manipulate the algorithm, δk(n)/n, tends to zero as n tends to inﬁnity, i.e., for all ω > 0 there must exists N ∈ N such that

δk(n) − 0 n

< ω.

for all n ≥ N. To prove it, we require the following regularity conditions.

Deﬁnition 8. A sequence of random markets (ℵ˜ 1, ℵ˜ 2, . . .) is regular if there exists a positive integer k such that

1. kn = k for all n,

41

2. mn ≤ n for all n. Condition (1) assumes that preferences length of each student does not grow as the size of the market increases, i.e., each student has an incomplete preference list because she does not know all the schools in the market; condition (2) requires that the number of schools does not grow much faster than the number of students, the supply is lower than demand.

Regularity conditions are taken from [15], which considers four regularity conditions. The other two conditions are: the number of college positions is bounded and all students are acceptable to any college, respectively. We do not require a bound of “positions ” because we assume that students only can hold one and only one school. On the other hand, they need all students to be acceptable to guarantee the existence of a large number of IR matchings. We do not need it because the existence of a large number of IR assignments is guaranteed by Proposition 2.3.1: there always exists at least one maximum ttco in any quasi-bipartite graph, regardless the tie breaking rule that the assignment procedure uses.

Since we want to know how likely students misreport their true preferences at equilibrium, regularity conditions ensure that markets in the sequence are very similar, they only differ in their associated proﬁle of random preferences. Our ﬁrst Theorem establishes that δk(n) tends to zero as n tends to inﬁnity. Its proof requires the following lemma, which is the adaptation of Lemma 4.2 in [11] to the characteristics of the TTCo algorithm. With this lemma we can ﬁnd the bounds to δk(n).

We introduce extra notation to describe the required bounds. Consider a random market ℵ˜ = (A, O, D) and a ﬁxed student b ∈ A, from now on we only write T TCo(b) instead of T TCo[Rb, R˜−b](b). Let OTTCo(b) = {ω ∈ O | dω ≥ dTTCo(b) and T TCo(ω) = ω}, the set of all schools more popular than T TCo(b) which are not assigned at the end of the algorithm. The number of elements in OTTCo(b) is denoted by XT TCo(b) = |OT TCo(b)|. Consider ET TCo(b) = {ω ∈ O | dω > dT TCo(b) and iR˜is for all i ∈ A}, the set of schools more popular than T TCo(b) that do not appear on any ranking R˜−b. The number

of elements in ET TCo(b) is denoted by Yb = |ET TCo(b)|.

Lemma 2.5.2. Consider a regular sequence of random markets (ℵ˜ 1, ℵ˜ 2, . . .). For every b > 4k,

1

12e8nk/b

E

≤

.

XT TCo(b) + 1

b

42

Moreover,

∂g ∂b

<

0

where

g(b)

≡

12e8nk/b b

.

Proof. We divide this proof in the following three afﬁrmations.

Afﬁrmation 2.5.1. For every b, we always have XTTCo(b) ≥ Yb.

Proof. Let ω ∈ ETTCo(b), by deﬁnition, ω does not appear in any ranking and is more popular than T TCo(b). Then, no student does point to s during the T TCo algorithm. Consequently, T TCo(ω) = ω for all ω ∈ ETTCo(b). Moreover, we have that ω is more popular than T TCo(b) and remains unassigned. So, ω ∈ OT TCo(b), which implies that ET TCo ⊆ OT TCo(b). Therefore XT TCo(b) ≥ Yb.

Afﬁrmation 2.5.2. Consider a distribution D. For b > 4k, then

E[XT TCo(b)]

≥

b e−8nk/g. 2

Proof. Let b ∈ A a ﬁxed student, and Q = ∑kj=1 d j the total probability of the ﬁrst k more popular schools according to D. Suppose that b picks ω1b, ωb2, . . . , ωbl−1 as her ﬁrst l − 1 preferred schools,

with l ≤ k. Since d1 ≥ d2 ≥ . . . ≥ dm, we have that

l−1

∑ Q ≥

dωbj

j=1

l−1
∑ 1 − j=1 dωbj ≥ 1 − Q

dω ≥

dω

1−Q

i−1

1

−

∑
j=1

dωbj

1 − dω

≥ 1 − dω .

i−1

1−Q

1

−

∑
j=1

dωbj

for all schools ω. In words,

1 − dω
l−1

1

−

∑
j=1

dωbj

is the probability that student b does not rank school ω as her l’th most preferred school, given that

she picks schools ωbj. Even more, the probability that a student does not list ω in her ranking is

1 − dω . (1 − Q)

43

By construction of random preferences, each school is chosen according to D independently of the

schools chosen before. Then, the stochastic independence implies that the probability that ω is not

listed by any student in her ranking is at least

1 − dω

nk
.

1−Q

(2.3)

Now, consider ω = ωt. If t > k, there are at least t − k schools who are at least as popular as ω, but not among the k most popular schools5. So, dω is at most the probability of not being one of the k most popular schools, divided by the total of schools who are at least as popular as her

1−Q

dω ≤ t − k .

(2.4)

On the other hand, we know that the limit deﬁnition of the exponential function is

ex = lim

x 1+

n
.

n→∞

n

(2.5)

For t > 2k, expressions (2.3), (2.4) and (2.5) imply that

Pr[ET TCo(b)] ≥

1 − dω nk 1−Q

1 nk ≥ 1−
t−k

≥ e−2nk/(t−k)

≥ e−4nk/t .

Therefore, decomposing the expectation of Yb, we obtain

b

∑ E[Yb] =

Pr[ET TCo(w)]

w=1

b

∑ ≥

e−4nk/ j

j=2k

∑ ≥

b e−8nk/b = b e−8nk/b,

j=b/2

2

for every b > 4k.
5Remember that we assume dt ≥ dt+1 in distribution D.

44

By Afﬁrmation 2.5.1, we conclude that

E[XT TCo(b)]

≥

E [Yb ]

≥

b e−8nk/g. 2

Afﬁrmation 2.5.3. The variance σ2(Yb) ≤ E[Yb]. Proof. This proof is taken from Immorlica and Mahdian (2005), Lemma 4.4. We show it for pedagogical purposes. We will show that events ETTCo(i) are negatively correlated, proving that

Pr[ET TCo(i) ∩ ET TCo( j)] ≤ Pr[ET TCo(i)]Pr[ET TCo( j)],

for all i, j ∈ A. Let Fω(i) be the event that a given school s is not included in the list of preference of i. By stochastic independence, discussed in Afﬁrmation 2.5.2, we know that

Pr[ET TCo(i)] ≤ (Pr[Fω(i)])n and Pr[ET TCo(i) ∩ ET TCo( j)] ≤ (Pr[Fω(i)] ∩ Pr[Fω ( j)])n.

On

the

other

hand,

the

deﬁnition

of

conditional

probability

is

Pr[X|Y ]

=

Pr[X∩Y ] Pr[Y ]

then,

it

is

enough

to

show that for every i and j,

Pr[Fω(i)|Fω ( j)] ≤ Pr[Fω(i)].

Let M be an arbitrarily large constant. With the following process, we simulate the selection of one preference list L = (l1, l2, . . . , lk): Consider Σ the set of pωM , the immediate inferior integer of pωM, copies of school ω. Pick a random permutation R of Σ. Let li be the i’th distinct name in R. It is clear that, if M tends to ∞, the probability of a given list L in this process converges to its probability under Dk. Therefore, Pr[Fω(i)] is equal to the probability that k distinct schools of ω are chosen by i in R when M tends to ∞. Similarly, if Σ denotes the multiset obtained by removing all copies of school ω from Σ, then Pr[Fω(i)|Fω ( j)] is equal to the probability that k distinct schools are chosen by i in a random permutation of Σ as M tends to ∞. However, this is precisely equal to the probability that k distinct names other than ω occur before ω in a random permutation R of Σ. This implies that k

45

distinct schools (including ω ) occur before ω in R. So, for every R where Fω(i)|Fω ( j) happens, Fω(i) also happens. It means that the ﬁrst event is contained by Fω(i), so Pr[Fω(i)|Fω ( j)] ≤ Pr[Fω(i)]. Using the relation between Fω(i) and ETTCo(i), we conclude that ETTCo(i) and ETTCo( j) are negative correlated
Pr[ET TCo(i) ∩ ET TCo( j)] − Pr[ET TCo(i)]Pr[ET TCo( j)] ≤ 0.
Then

σ2(Yb) = E[Yb2] − E[Yb]2

b

b

∑ ∑ ∑ = Pr[ETTCo(i)] + 2

Pr[ET TCo(i) ∩ ET TCo( j)] − Pr[Ei]2 + . . .

i=1

1≤i< j≤b

i=1

∑ . . . −2

Pr[ET TCo(i)]Pr[ET TCo( j)]

1≤i< j≤b

b
≤ ∑ Pr[ETTCo(i)] = E[Yb]. i=1

Continuing with the proof of Lemma 2.5.2, this last part is equal to the proof of Lemma 4.1 in [15].

Consider

Pr

Yb

<

E [Yb ] 2

= q.

Using Chebyshev’s inequality, we have that

q

≤

Pr

|Yb

−

E [Yb ]|

>

E [Yb ] 2

≤

σ2(Yb) (E [Yb ]/2)2

.

Now, applying Afﬁrmation 2.5.3 to the above expression

q

≤

4 E [Yb

]

.

(2.6)

Afﬁrmation 2.5.1 tells us that Yb + 1 ≤ XTTCo(b) + 1. Moreover, the expectation operator respect inequalities, then

1 E
XT TCo(b) + 1

1 ≤E
Yb + 1 1
∑ = Yb Yb + 1 Pr[Yb].

46

On the other hand, we know that:

1 ≤ 1 and Pr
Yb + 1

Yb ≤ E

Yb 2

1

1

= Pr

≤

.

E[Yb]/2 + 1 Yb + 1

Consequently

1

∑ ∑ Yb Yb + 1 Pr[Yb]

≤

1Pr[Yb]
Yb

1/(E [Yb ]/2+1)

≤

∑ Pr[Yb] +

∑

Pr[Yb]

Yb=0

Yb =1/(E [Yb ]/2+1)

1

1

1/(E [Yb ]/2+1)

≤ Pr

≤

E[Yb]/2 + 1 Yb + 1

∑ 1+...
Yb=0

1

1

+Pr

≥

E[Yb]/2 + 1 Yb + 1

1

= (1 − q)

+ q.

E[Yb]/2 + 1

Using expression (2.6)

1

4

2

(1 − q)

+q ≤

+.

(2.7)

E[Yb]/2 + 1

E[Yb] E[Yb]

Finally, expressions (2.6) and (2.7), together with Lemma 2.5.2, imply that

1 E
XT TCo(b) + 1

6 ≤
E [Yb ]

6

12e8nk/b

≤

b 2

e−8nk/b

=

. b

To complete the proof of Lemma 2.5.2, we need to prove that function g(b) = 12e8nk/b/b is decreasing

with respect to b:

∂g(b) ∂b

=

b12e8nk/b(−8nk/b2) − 12e8nk/b b2

=

−12e8nk/b

b−1 b2

.

Since b > 4k, we conclude that

∂g(b) < 0. ∂b

47

In the following lemma we prove that the proportion of students with incentives to deviate from their true preference list tends to zero as the size of the market increases. Its proof follows closely the proof of Theorem 4.1 in [11]. The reasoning is the same, however, we avoid the arguments related with reaction chains using the properties of the TTCo algorithm, the Waiting Algorithm and Lemma 2.5.1.
Theorem 2.5.1. Let (ℵ˜ 1, ℵ˜ 2, . . .) a regular sequence of random markets, and k a ﬁxed positive constant. Suppose that each student has a random ranking chosen according to Dk. Then
lim δk(n) = 0. n→∞ n Proof. If b is an student that manipulates the TTCo algorithm, by construction of the WA we have that xb > 1, she has incentives to report a dropping strategy instead of her true ranking, see Lemma 2.5.1 and Deﬁnition 7. Consequently, δk(n) is equal to the expected number of students such that xb > 1, then
δk(n) = ∑ Pr[b has at least one effective school preferred to T TCo[Rb, R˜−b](b)].
b∈Bk
We search an upper bound for δk(n). First, we bound the probability that b has at least one school preferred to T TCo[Rb, R˜−b](b). By Proposition 2.5.2, this is the same as bounding the probability that the random variable xb is more than one, Pr[xb > 1]. We can divide the WA into two phases: the ﬁrst phase is from the beginning of the algorithm until it ﬁnds the ﬁrst effective school, and the second phase is from that point until the algorithm terminates. By Proposition 2.3.1, at the end of the ﬁrst phase there exists an IR assignment, i.e. the assignment T TCo[Rb, R˜−b] = T TCo always exists. Given the existence of this assignment, we ﬁrst bound
Pr[xb > 1|T TCo],
the probability that xb > 1 conditioned on the existence of the IR assignment T TCo; later, we take the expectation of this bound over T TCo to get Pr[xb > 1]. We know that
T TCo(b) ∈ O ∪ {b}.
Case I. If T TCo[Rb, R˜−b](b) = b, b does not get any school, we have that Pr[xb > 1|T TCo] = 0. The proof ﬁnishes.
48

Case II. If T TCo[Rb, R˜−b] ∈ S, remember that

OT TCo(b) = {ω ∈ O | dω ≥ dT TCo(b) and T TCo(ω) = ω},
the set of schools more popular than T TCo[Rb, R˜−b](b) that remain unassigned, and XTTCo(b) is the cardinality of this set. Moreover, xb > 1 if and only if for student b there exists a proﬁtable dropping strategy Rtb∗, and we know that the WA ends at some t such that Rtb is the strategy where [T TCo[Rb, R˜−b](b)] is declared as the most effective indifference class. So, student b has exhausted all strategies Rtb strictly preferred to T TC[Rb, R˜−b](b) in the WA. Implicitly, we assume that no allocation was made before the WA starts. Since the T TCo always exists at the end of the ﬁrst phase of the WA, we claim that:
Afﬁrmation 2.5.4. Xb ∩ OTTCo(b) = ∅.
Proof. If there exists ω ∈ Xb ∩ OTTCo(b) then T TCo(ω) = b and T TCo(ω) = ω which is a contradiction.

Thus, the WA cannot output an element of OTTCo(b) by Afﬁrmation 2.5.4. Consequently, the probability Pr[xb > 1|T TCo] is equal or less than the probability that T TCo(b) appears before any school in OTTCo(b) because dropping strategies in the WA truncate schools in a descending form, so

Pr[xb > 1|T TCo] ≤ Pr[T TCo(b) appears before any school in OTTCo(b)].

(2.8)

On the other hand, by deﬁnition of OTTCo(b), the probability that t is picked is at least as large as the probability that T TCo(b) is picked, for all t ∈ OTTCo(b). Thus, the probability that T TCo(b) appears before all elements in OTTCo(b), in a sequence of elements picked according to Dk, is at most the probability that T TCo(b) appears ﬁrst in a random permutation on the elements of {T TCo(b)} ∪ OT TCo(b) which is 1/(XT TCo(b) + 1). So

1

Pr[T

T

Co(b)

appears

before

any

school

in

OT TCo(b)]

≤

XT

TCo(b)

+

. 1

(2.9)

Joining expressions (2.8) and (2.9)

1

Pr[xb

>

1|T

T Co]

≤

XT

TCo(b)

+

. 1

(2.10)

49

Applying the expectation operator and the Law of Iterative Expectations

Pr[xb > 1] = ET TCo[Pr[xb > 1|T TCo]] 1
≤ ET TCo XT TCo(b) + 1 .

(2.11)

Applying

Afﬁrmation

2.5.2

for

b

≥

16nk ln(n)

,

equation

(2.11)

and

the

fact

that

Pr[xb

>

1]

≤

1,

for

all

i

∈

{1,

2,

.

.

.

,

16nk ln(n)

},

we

get

16nk

ln(n)

n

δk(n) = ∑ Pr[xb > 1] + ∑ Pr[xb > 1]

i=1

16nk

ln(n)

16nk

ln(n)

n

1

∑ ∑ ≤

1 + ET TCo

i=1

16nk

XT TCo(b) + 1

ln(n)

16nk

n 12e8nk/b

∑ ≤

+

ln(n)

b=

16nk ln(n)

. b

Moreover, by Lemma 2.5.2, we know that g(b) is a decreasing function with respect to b, so

16nk

n 12e8nk/b

16nk

n

12e8nk/

16nk ln(n)

∑ +

ln(n)

b=

16nk ln(n)

b

∑ ≤

+

ln(n)

b=

16nk ln(n)

16nk ln(n)

16nk

n 3 ln(n)eln(n)/2

∑ =

+

ln(n)

b=

16nk ln(n)

4nk

16nk

3 ln(n)eln(n)/2

≤

+n

ln(n)

4nk

√

16nk

n ln(n)

=

+3

.

ln(n)

4k

Dividing between n, we have that

δk(n) ≤ 16k + 3 ln√(n) . n ln(n) 4 k n

Therefore, the fraction of students with more than one effective school goes to zero as n goes to

inﬁnity, for every length k.

Thickness Condition and Truth-telling at Equilibrium We have proven that the number of schools with incentives to manipulate tends to zero as the market size increases. A large market is necessary but not sufﬁcient to guarantee that truth-telling is an
50

ε−Nash equilibrium. The following example shows that.

Example 2.5.3. Consider a market (A, O, D, k) such that |A| = |O| = n and D is a probability distribution over O deﬁned as follows:

1

dω1

=

dω2

=

dω3

=

, 4

1 dωj = 4(n − 3) for all j > 3.

With probability

dω1 dω2 dω3 (1 − dω1)(1 − dω1 − dω2)

31 = 243 ,

preferences of students 1, 2 and 3 are given by:

R1 : ω1, ω2, ω3, . . . , R2 : ω1, ω2, ω3, . . . , R3 : ω1, ω2, ω3, . . . ,

Under the TTCo algorithm, we have that:





T TCo[R] =  ω1 ω2 ω3  .

123

Now, suppose that ω3 reports

R3 : ω2, 3.

Figure 2.6(b) illustrates the maximum ttco ςL(ϒ(G1[R3, R−3])). Therefore





ω1 ω2 ω3 · · ·

T TCo[R3, R−3] = 

,

1 3 2 ···

where ω2P3ω3. In words, student 3 manipulates the T TCo algorithm with a positive probability, 1/(243), regardless the size of the market.

Note that the tie breaking rule ςL beneﬁts students with the minimum index. Example 2.5.3 shows that ω1 is too popular with respect to other schools. Students with an index far from 1 are aware that it
51

ω1 ω2

ωm

ω1 ω2

ωm

123

nn

123

nn

(a) True preferences

(b) student 3 deviates from her true ranking

Figure 2.6: student 3 has the opportunity to manipulate T TCo, in order to get ω2 regardless the size of the
market.

is impossible to get ω1 and decide to point to some school less popular than ω1 but in a high position on her preference list. Pointing to an school with a lower popularity implies higher possibilities to be the student with the minimum index. In Example 2.5.3, student 3 is not the student with minimum index between the student that point to school ω1. However, if she points ﬁrst to ω2, she becomes the student with the minimum index of ω2. Even more, this situation does not change for 3 when the size of the market increases because new elements have indexes far from ω2, they are greater than 3. Therefore, the deviation R3 is always proﬁtable to 3 with probability 1/24. Thus, with positive probability, truth-telling is not the best response of student 3 when others are truth-telling.

Kojima and Pathak (2009) proved that truth-telling is an ε-Nash equilibrium when the sequence of random markets satisﬁes the thickness condition. In Example 2.5.3, the relative probability between

ω1 and ωn is

dω1 = 1/4 = n − 2. dωn 1/4(n − 2)

So, for each student pointing to ωn, the number of students that points to ω1 tends to inﬁnity, i.e. ω1

is too popular with respect to ωn, for all n ≥ 4. If a market satisﬁes the thickness condition, then no

school is too popular in comparison with others, relative probabilities are bounded.

dn

Let VT (n) =

ω∈O

max
ω ∈O

dωωn

≤T

the random set that denotes the set of schools sufﬁciently

popular ex-ante. Below, we present the thickness condition of Kojima and Pathak.

Deﬁnition 9. A sequence of random markets is sufﬁciently thick if there exists T ∈ R such that

E[|VT (n)|] → ∞, 52

as n → ∞.

Example 2.5.4. A particular random market that satisﬁes the thickness condition is one where D is a

uniform distribution. Consider a sequence of random markets ℵ˜ n = (An, On, Dn) such that |An| = n, |On| = n and dω = 1/n for all ω ∈ O, i.e. D = (1/n, 1/n, . . . , 1/n). Now, let s, ω ∈ S, the maximum

of the relative probabilities is

max dω ω ∈S dω

1/n = max
ω ∈S 1/n = max {1}
ω ∈S
= 1.

If T = 2, then (ℵ˜ n) is a sequence of random markets sufﬁciently thick.

In large thick markets, the TTCo algorithm covers all market members at the end of its ﬁrst step.

Proposition 2.5.3. Let (ℵ˜ 1, ℵ˜ 2, . . .) a regular sequence of random markets that satisfy the thickness condition. There exists N ∈ N such that the TTCo algorithm removes all schools in ℵ˜ n at the end of its ﬁrst step, for all n ≥ N.

Proof. Consider t[T TCo, ℵ˜ n] the step of the TTCo algorithm such that at the end of it there is no remaining schools in the market. We have to prove that

lim t[T TCo, ℵ˜ n] = 1,
n→∞
in other words, the maximum ttco ςL(ϒ[G1[ℵ˜ n]]) covers all schools in ℵ˜ n.

We suppose that the sequence of random markets satisﬁes the thickness condition, then, there exists

T > 0 such that

max
ω ∈On

{dn }
ω
dωn

≤T

⇒ max
ω ∈On

{dn
ω
T

}

≤ dωn ,

and dωn > 0, for all n ≥ N. In such markets, this implies that ω is with positive probability the most

preferred school of at least one student.

Let

dωn M

=

maxω

∈On

{dn
ω

},

then

1

=

dωn M dωn M

≤

dωn M dωn

≤ T.

53

This means that for each student who prefers ωm to any other school ω there exist between 1 and T students who prefer ω to any other school, ex-ante. Thus, there is a student bω such that (bω, ω) is an edge of G1[ℵ˜ n], for all ω ∈ On and n ≥ N. Moreover, since we assume a regular sequence of random markets, we have that |On| ≤ |An|. By the Pigeon-hole principle, there is N > N such that bω = bω for all ω = ω in On, for all n ≥ N . Let θ = {(bω1, ω1), (bω2, ω2), . . . , (bωmn , ωmn)} and
Θ = θ ∪ {(b, b) ∈ An | b ∈/ θ}.
It is clear that Θ is a subset of edges of G1(ℵ˜ n), and no edges in Θ have a node in common. Moreover, θ covers all schools in On. Therefore, Θ is a maximum ttco of G1(ℵ˜ n). Still ςL[ϒ(G1(ℵ˜ n))] is not necessary equal to Θ. However, we have found a maximum top trading cover that covers all students in ℵ˜ n. Consequently, all maximum ttco of G1(ℵ˜ n) must cover all students in ℵ˜ n. Particularly, ςL[ϒ(G1(ℵ˜ n))] must cover all students in ℵ˜ n for all n ≥ N . Therefore
lim t[T TCo, ℵ˜ n] = 1.
n→∞
In Example 2.5.3 we show that too popular schools can induce proﬁtable deviations of schools from their true preferences, we call it an opportunity6. The thickness condition ensures that all schools have a large enough demand, which reduces the possibility to be the the minimum student implying that the opportunity vanishes. Next lemmas explain in more details what are vanishing opportunities.
Consider an student b, and suppose that her true ranking is represented by
Rb : [ωb1]b, [ωb2]b, . . . , [ωbη]b, [b]b.
Let Rb(ωb j) be the dropping strategy where [ωb j]b is declared as the most preferred class of b and all her strictly preferred classes are declared not IR,
Rb(ωb j) : [ωb j]b, [ωb( j+1)]b, . . . , [ωbη]b, [b]b.
6Kojima and Pathak in [15] call it market power of colleges.
54

Now, let d(Rb(ωb j)) be the probability that the WA outputs a school T TCo[Rb(ωb j), R˜−b](b) strictly

preferred to T TCo[R](b), conditioned to the matching T TCo[R] and Yb(n) > E[Yb(n)]/2, i.e. the

number of schools more popular than T TCo[R](b) that do not appear in any ranking is bounded

inferiorly by E[Yb(n)]/2. So,

d(Rb(ωb j)) = Pr T TCo[Rb(ωb j), R˜−b](b)PbT TCo[R](b)

Yb(n)

>

E[Yb(n)] , T 2

TCo

.

If this probability tends to zero, the probability to do a proﬁtable manipulation also tends to zero, then opportunities vanish.

In the next lemma, equivalent to Lemma 9 presented in Appendix B of ([15]), we investigate if the ﬁrst step of the WA algorithm results in a proﬁtable manipulation, so, we bound the probability that reporting Rb(ωb2) is a proﬁtable manipulation.
Lemma 2.5.3. Consider (ℵ˜ 1, ℵ˜ 2, . . .) a regular sequence of sufﬁciently thick random markets. Let T be such that E[YT (n)] → ∞ as n → ∞. Then there is n ∈ N large enough such that
4T t d(Rb(ωb2)) ≤ E[YT (n)] , where t is the number of schools preferred to T TCo[Rb, R˜−b](p) under Rb.

Proof. In the ﬁrst step of the WA, student b reports the dropping strategy Rb(ωb2). In a sequence of

thick markets, we know that

pωn

(r)

≥

pωn b2(r) , T

for all ω ∈ VT (n). The WA algorithm outputs a proﬁtable manipulation at the end of its ﬁrst step if

T TCo[Rb(ωb2)](b)PbT TCo[Rb](b).

Then, ωb2 is an school that appears in some ranking (Ri) and is assigned. Then, the probability that [ωb2] is an effective class of b is at least

1

1−

,

YT (n)/T + 1

the complement event of some school, more popular than T TCo[R](b), is not picked in any ranking

and remains unassigned. Moreover, we are conditioning to Yb(n) > E[Yb(n)]/2, by deﬁnition of

55

d(Rb(ωbj )), consequently we have that

1

1

1−

> 1−

.

YT (n)/T + 1

E[YT (n)]/2T + 1

Now, if all dropping strategies Rb(ωb j) are proﬁtable, for j = 2, . . . , r − 1 < t. Then, there are still at

least YT (n) − r + 1 schools more popular than T TCo[R](b) that are still unassigned because at most

r − 1 schools in VT (n) have been assigned. Therefore, in step r, ωbr results to be the less preferred

effective school of b with probability of at least

1

1−

.

E[YT (n)]/2T − (r − 1) + 1

Since the waiting algorithm has t steps, the WA outputs proﬁtable manipulations with probability of

at least

t

1

1

t

∏
r=1

1− E[YT (n)]/2T − (r − 1) + 1

≥

1− E[YT (n)]/2T − t + 2

1

t

≥ 1−

.

E[YT (n)]/4T

First and second inequalities hold because n is sufﬁciently large and the sequence of random markets

satisﬁes the thickness condition, also because r ≤ t. Therefore we have that

1

t

d(Rb(ωb2))

≤

1−

1− E[YT (n)]/4T

.

By Bernoulli’s inequality we know that 1 − yx ≤ (1 − x)y then 1 − (1 − x)y ≤ yx for any x ∈ (0, 1) and

y ≥ 1. We conclude that

4T t d(Rb(ωb2)) ≤ E[YT (n)] .

To have incentives to deviate from the true ranking is equivalent to xb > 1 at the end of the WA. Consider δTTCo[R](b)(R) = Pr[WA outputs xb > 1]. We bound this probability in the following lemma, which corresponds to Lemma 10 in Appendix B of [15].

Lemma 2.5.4. Consider (ℵ˜ 1, ℵ˜ 2, . . .) a regular sequence of random markets that satisﬁes the thick-

ness condition. There exists a large enough n ∈ N such that

for all b ∈ A.

δT TCo[R](b)(R)

≤

4[tT |[ωb2]| + E[YT (n)]

1] ,

56

Proof. First, note that

∑ d(Rb(ωb2)) ≤

d(Rb(ωb j))

ωb j∈[ωb2]

4T t
∑ ≤
ωb j∈[ωb2] E[YT (n)]

4T t

∑ =

1

E[YT (n)] ωb j∈[ωb2]

4T t = E[YT (n)] |[ωb2]|,

where the second inequality follows from Lemma 2.5.3.

Previous inequality is conditioned to the T TCo[R] assignment. The same reasoning can be applied to

all assignments T TCo[Rb, R˜−b]. Hence

∆(ωb j)

=

Pr xb > 1

Yb(n)

>

E [Yb (n)] 2

≤ 4T t|[ωb2]| . E[YT (n)]

Remembering what was done in the proof of Afﬁrmation 2.5.3, we know that

Consequently

Pr

Yb

≤

E [Yb ] 2

≤

Pr

Yb

≤

E [Yb ] 2

+ Pr

Yb

≥

3E [Yb ] 2

=

Pr

|Yb

−

E [Yb ]|

≥

E [Yb ] 2

≤

Var[Yb] (E [Yb ]/2)2

≤

4 .
E [Yb ]

∑ δT TCo[R](b)(R)

=

∆(ωb j)Pr
ωb j∈Xb

YT (n)

≥

E[YT (n)] 2

∑ ≤

∆(ωb2)Pr

YT

(n)

≥

E[YT (n)] 2

+

∆(ωb j)Pr

ωb j=ωb2

YT

(n)

≥

E[YT (n)] 2

≤

Pr

YT

(n)

≥

E[YT (n)] 2

4T t|[ωb2]| + Pr E[YT (n)]

YT

(n)

≤

E[YT (n)] 2

≤ 4T t|[ωb2]| + 4 . E[YT (n)] E[YT (n)]

Therefore

δT TCo[R](b)(R)

≤

4(T t|[ωb2]| + E[YT (n)]

1) .

57

In words, Lemmas 2.5.3 and 2.5.4 say that students opportunities vanish as the market size increases. These bounds imply the ε−Nash equilibrium. Corollary 2.5.1. Consider a sequence of random markets (ℵ˜ 1, ℵ˜ 2, . . .) regular and sufﬁcient thick. There exists an N ∈ N large enough such that truth telling is an ε-Nash equilibrium, given the TTCo mechanism.

Proof. Fixed a student b, an consider ε > 0. As before, the probability that b proﬁtable manipulates the TTCo algorithm is δT TCo[R](b)(R). We prove that
E ub T TCo[On, An, (Rb, R˜−b)] (b) − E ub T TCo[A, O, (Ri, R˜−b)] (b) = 0, as n tends to inﬁnity. We know that

E ub T TCo[Rb, R˜−b](b) − E ub T TCo[(Rb, R˜−b)](b) = E ub T TCo[Rb, R˜−b](b) − ub T TCo[(Rb, R˜−b)](b) ≤

Pr T TCo[Rb, R˜−b](b)PbT TCo[(Rb, R˜−b)](b) ≤ δT TCo[R](b)(R) × t sup ub(ω).
n∈N,ω∈On
Moreover, the sequence of random markets is regular and satisﬁes the thickness condition. Then,

E[YT (n)] → ∞, from Lemma 2.5.2, as n tends to inﬁnity. Hence 1/E[YT (n)] tends to zero. Moreover,

considering

ε=

ε

1

,

4(T t|[ωb2]| + 1) sup ub(ω)

n∈N,ω∈On

there exists N ∈ N such that

1 E[YT (n)] < ε ,

for all n ≥ N. Lemma 2.5.4 and expression (2.12) imply that

(2.12)

E ub T TCo[Rb, R˜−b](b)

− E ub T TCo[Rb, R˜−b](b) ≤

≤ δT TCo[R](b)(R) sup ub(ω)
n∈N,ω∈On

≤

4(T t|[ωb2]| + E[YT (n)]

1)

sup
n∈N,ω∈On

ub

(ω)

≤ 4(T t|[ωb2]| + 1) sup ub(ω)ε
n∈N,ω∈On

≤ ε,

58

for all n ≥ N. We conclude that truth-telling is an ε-Nash equilibrium.

By Theorem 2.5.1 we know that

√ 16nk 3 n ln(n) δk(n) ≤ ln(n) + 4k .

So, the number of students that are not truth-telling at equilibrium tends to zero as the market size increases. Therefore, there exists n ∈ N such that truth-telling is the unique ε−Nash equilibrium for all n ≥ N.

2.5.4 The ε−Bayesian Nash equilibrium

The Bayesian game of stage two is described by (A, O, f , D), where the types are drawn according to f , D is a probability distribution over the set of schools. Since the ﬁnal allocation is determined by the TTCo algorithm, the pay-off function of each student i is



ui(T TCo(i)) =  vωi + θ((vτ= j)) if T TCo(i) = ω for some ω,

 mi

otherwise.

The expected utility function of each student i is

∑ E[ui] =

(mi − pω + vωi)Pr(T TCoω[Ri, R˜−i](i) = ω) + miPrω(T TCo[Ri, R˜−i](i) = i).

ω∈O,ωRii

The ε-Bayesian Nash equilibrium of this stage is a proﬁle of preferences such that a single student

cannot improve substantially her ﬁnal allocation under the T TCo algorithm.

Deﬁnition 10. Given ε > 0, a strategy proﬁle (R∗i (vˆi))i∈B,vˆi∈Vˆi is an ε-Bayesian Nash equilibrium if there is no Ri(vˆi) ∈ Vˆi such that

E[ui(T TCo[Ri∗(vˆi)](i))] > E[ui(T TCo[Ri(vˆi)], R∗(vˆ)−i](i))] + ε.

Students’ behaviour at equilibrium is the same as in the complete information case.

Corollary 2.5.2. Assuming a ranking with length k, the number of students with incentives to deviate from her true ranking tends to zero as the market size increases.

59

Proof. This is a direct consequence of Theorem 2.5.1 where we prove this inequality for all possible ﬁxed types. Making the summation over types we get this corollary. As before, previous Corollary does not guarantee that truth-telling is an ε−Bayesian Nash equilibrium. However, Corollary 2.5.1 can be generalized to the case of incomplete information for a sequence of regular random markets that satisﬁes the thickness condition. Theorem 2.5.2. Consider a regular sequence of random markets that satisﬁes the thickness condition. For any ε > 0, there exists N ∈ N such that truth-telling by every student is an ε-Bayesian Nash equilibrium for any market in the sequence with more than N students. Proof. Let (ℵ˜ n)n∈N a regular sequence of random markets that satisfy sufﬁcient thickness condition, and ε > 0. From Corollary 2.5.1 there exists n ∈ N such that truth-telling is an ε-Bayesian Nash equilibrium of ℵ˜ N, for all N ≥ n. This results holds for any of students type, then we can ﬁnd N across types realizations. Therefore truth-telling is an ε-Bayesian Nash equilibrium.
2.6 Concluding Remarks
The Top Trading Cover algorithm induces a family of Pareto efﬁcient mechanisms that recursively respect top preferences and deal with indifferences. Its application is not only restricted to school choice problems. In general, we can use this family of mechanisms whenever we have indivisible objects and agents. For example, we can determine the allocation of apartments and scholarships between households and students.
60

References
[1 ] A. ABDULKADIROGLU AND Y.-K. CHEN. The role of priorities in assigning indivisible objects: A characterization of top trading cycles. 2010.
[2 ] J. ALCALDE-UNZU AND E. MOLIS. Exchange of indivisible goods and indifferences: the Top Trading Absorbing Sets mechanisms. Games and Economic Behavior, 73(1):1-16, September 2011.
[3 ] E. M. AZEVEDO AND J. D. LESHNO. A supply and demand framework fro two-sided matching markets. Mimeo, Harvard University, 2012.
[4 ] C. BERGE. Topological Spaces. Oliver and Boyd, 1963. [5 ] A. BOGOMOLNAIA, R. DEB, AND L. EHLERS. Incentive-compatible assignment on the full preference
domain. Journal of Economic Theory, 123:161-186, 2005. [6 ] R. L. BURDEN AND D. FAIRES. Numerical Analysis. 7th edition, 2000. [7 ] L. EHLERS. Coalitional strategy-proof house allocation. Journal of Economic Theory, 105(2):298-317,
August 2002. [8 ] A. ERDIL AND H. ERGIN. What’s the matter with tie-breaking? improving efﬁciency in school choice.
American Economic Review, 98(3), 2008. [9 ] D. GALE AND L. SHAPLEY. College admissions and the stability of marriage. American Mathematical
Monthly, (69):9-15, 1962. [10 ] D. GALE AND L. SHAPLEY. College admissions and the stability of marriage. The American Mathe-
matical Monthly, 69(1):9-15, 1962. [11 ] N. IMMORLICA AND M. MAHDIAN. Marriage, honesty, and stability. Proceedings of the Sixteenth
Annual ACM-SIAM Symposium on Discrete Algorithms, 2012. [12 ] P. JARAMILLO AND V. MANJUNATH. The difference indifference makes in strategy-proof allocation of
objects. Journal of Economic Theory, 2012. [13 ] F. KOJIMA AND M. MANEA. Axioms for deferred acceptance. Econometrica, 78(2):633-653, 2010.
61

[14 ] F. KOJIMA AND U. UNVER. The Boston school-choice mechanism. Boston College Working Papers in Economics, 2010.
[15 ] F. KOJIMA AND P. A. PATHAK. Incentives and stability in large two-sided matching markets. American Economic Review, 2009.
[16 ] P, KRYSTA, B. TASTEGARI, D. MANLOVE AND J. ZHANG. Size versus truthfulness in the House Allocation problem. Technical Report No. 1404.5245, Computing Research Repository, Cornell University Library,2014.
[17 ] S. LEE. INCENTIVE COMPATIBILITY OF LARGE CENTRALIZED MATCHING MARKETS. Working Paper, 2010.
[18 ] T. MENNLE AND S. SEUKEN. Relaxing strategy-proofness in one sided matching. working paper. [19 ]A. POLANSKI. BILATERAL BARGAINING IN NETWORKS. Journal of Economic Theory, (124):557-565,
2007. [20 ] S. PAPAI. Strategyproof assignment by hierarchical exchange. Econometrica, 2000, 68(6):1403-1433. [21 ] A. E. ROTH. Incentive compatibility in a market with indivisible goods. Economic Letters, (9): 127-132,
1982. [22 ] L. SHAPLEY AND H. SCARF. On cores and indivisibilities. Journal of Mathematical Economics, (1):23
- 37, 1971. [23 ] L. SHAPLEY AND M. SHUBIK. The assignment game I: The core. International Journal of Game
Theory, (1): 111 - 129, 1971. [24 ] J. C. STEIN. Prices and trading volume in the housing market: A model with down-payment effects.
The Quarterly Journal of Economics, 110(2):379-406, 1995. [25 ] L.-G. SVENSSON. Queue allocation of indivisible goods. Social Choice and Welfare, 11: 323-330,
1994. [26 ] L.-G. SVENSSON. Strategy-proof of indivisible goods. Social Choice and Welfare, 16, 1999. [27 ] L. ZHOU. On a conjecture by Gale about one-sided matching problems. Journal of Economic Theory,
52(1):123-135, 1990.
62

2.7 Appendix A1 The Existence of Top Trading Covers
To prove the existence of a maximum Top Trading Cover in each quasi-bipartite graph G(S , B , π; p, v), we need more deﬁnitions from Graph Theory. Given a top trading cover T of G, a node r ∈ S ∪ B is said to be covered if there exists r ∈ S ∪ B such that (r, r ) ∈ T . A path P in G is a succession of nodes
{r1,t1, r2,t2, . . . rn,tn} such that (ri,ti) ∈ E(S ∪ B , π; p, v) for all i = 1, 2, . . . , n. We say that r1 and tn are the end points of P. Deﬁnition 11. Let G = G(S , B , π; p, v) a quasi-bipartite graph and a top trading cover T of G. A path P is an augmenting path for T if:
1. The two end point of P are not covered by T . 2. The edges of P alternate between edges ∈ T and edges ∈/ T . Let R a top trading cover of G, and P and augmenting path of R. We deﬁne and denote the operation between R and P, as
R ⊕ P = (A ∪ B) − (A ∩ B), i.e., we operate ttco’s and paths through symmetric difference. The algorithm to ﬁnd a maximum top trading cover is described below
Step 1. Consider T a top trading cover of G, could be T = ∅. Step 2. While exists an augmenting path P do
2.1 T = T ⊕ P. Step 3. While exists r ∈ G \ T such that (r, r) is and edge of G do
3.1 T = T ∪ {r}.
63

Step 4. Output T . We have to prove that T is effectively a maximum top trading cover. However, this is clear, because we delete all possible augmenting paths. We conclude this proof applying Berge’s Theorem: ”The matching M is maximum if and only if there is no augmenting path”7.
7For more details consult: Claude Berge (1963). Topological Spaces. Oliver and Boyd.
64

Chapter 3
On uniqueness of equilibrium prices in large
assignment games
3.1 Introduction
The diversity of approaches and problems is one distinctive characteristic of the literature on real estate economy. We mention here only a few of them. The fact that properties are heterogeneous has been addressed through hedonic price modelling, both in academic papers (Rosen (1974), Maclennan (1977) (1982), Nelson (1978), . . .) and in real life practice, in the U.S., by the Uniform Standards of Professional Appraisal Practice. While the approach is insightful for measuring the contributions of determinants (age, rooms, structure type, neighborhood, . . .) in the valuation of a property, it is outperformed by dynamic models to predict other aspects of housing markets like bargaining (Yavac¸ (1992), Muthoo (1999), Merlo and Ortalo-Magne´ (2004), Di Pascuale and Wheaton (2012), . . .), the role of list prices, their stickiness, and the optimal acceptance and rejection strategy of sellers (Salant (1991), Horowitz (1992), Albrecht et al. (2012), Merlo et al (2013)). These works adopt the tools developed by search theory to model the behavior of one side of the market and do not provide closed-form solutions for prices. Exceptions are Corominas-Bosch (2004) and Polanski (2007)) who elaborate a network framework to study bargaining processes. Our contribution to this vast literature is to re-examine the heterogeneity feature of real estate markets
65

by modeling them as large auction markets. More speciﬁcally, in the Assignment Game introduced in Shapley and Shubik (1971), we study the equilibrium prices when buyers and sellers do not know the valuation of others in large markets. It is intended to capture three features: 1. the stickiness of selling prices: Horowitz (1992) and Merlo et al (2013) provide empirical evidence where prices do not change even after houses have remained unsold for a long period of time or in the presence of different offers; 2. sellers accept to sell to (one of) the ﬁrst buyers to meet the asking price: Merlo and Ortalo-Magne´ (2004) present evidence from England where the difference between the list price and the sold price is around 2 per cent, i.e. the bargaining is almost insigniﬁcant; and 3. households are not strategic: in an empirical work, Wheaton (1990) shows that buyers search for their favorite house. We model the problem as a three-stage game. First, nature draws the valuation of each agent, namely over the good they own for sellers, or the goods on sale for buyers. At stage two sellers simultaneously set prices, which are observed by buyers before stage three begins, when buyers report their rankings of houses to the Top Trading Cover (TTCo) algorithm, which determines the payoffs. During this assignment procedure, each buyer points to her most favorite house in a descending form and sellers sell their houses to one of the buyers that are willing to pay the list price.
The TTCo algorithm is developed in Chapter 2. The mechanism relies on a graph representation of the market, where a node is associated to all buyers and sellers, and directed edges represent the top choices of buyers. A loop represents a buyer that prefers remaining with her original amount to buy a house. A cover of the graph is selected by a tie breaking rule, transactions between buyers and sellers take place according to the cover and involved agents are withdrawn from the market. The procedure is iterated with the remaining agents, analogically to David Gale’s Top Trading Circle; indeed TTCo also encompasses Hierarchical Exchange rules by Papai (2000). Moreover, in Chapter 2 we also prove that at the third stage of the mechanism, when market is sufﬁciently thick, it is an Epsilon Bayesian Nash equilibrium for buyers to report their true ranking to the TTCo. The thickness condition is reminiscent of the one by Fuhito and Pathak (2009), which speciﬁes that for each seller the number of buyers is balanced, it implies that TTCo ends at the ﬁrst iteration of the mechanism.
Our main result establishes that the Bayesian equilibrium of the second stage always exists and is unique. The Bayesian equilibrium, as far as we know, is the unique approach interested in estab-
66

lishing the uniqueness of equilibrium prices in the Assignment Game. In contrast, multiplicity of competitive equilibria and core allocations are pervasive in the Assignment Game. Assuming that agents cannot have more than one indivisible good, Quinzii (1984) shows that the core of the economy is non-empty, and not necessarily unique. Also, she analyses the conditions under which the core allocations coincide with competitive equilibrium allocations. Similarly, Demange (1984) proves the existence of at least one competitive equilibrium, which is not always unique, in a model with externalities. Demange and Gale (1985) show that the set of equilibria have a lattice structure in the Assignment game. A generalization of the assignment game is done by Scarf (1990, 1994) through non-convexities. Moreover, Alkan, Demange and Gale (1991) shows that the set of efﬁcient and envy free allocations is non-empty. Even in the presence of multiplicity of fair assignments, they show that it is possible to do some comparative statistics when the amount of money increases. In similar models with multiplicity of fair assignments, Tadenuma and Thomson (1991) study when fair allocations satisfy consistency and Svensson (2009) characterized the set of fair allocation rules that are strategy-proof.
We also provide a closed form solution when valuations are exponentially distributed. The assumption echoes empirical works such as Trippi (1977) who estimates the length of time on market of real estate with data from San Diego, using an exponential distribution. So does I-Chun Tsai (2010) with data from Taiwan and Horowitz (1992) who studies real estate in Baltimore. Unsurprisingly, the relation between the price at equilibrium and its corresponding seller valuation is positive; while the price decreases when the number of sellers and the distribution parameter increases. These results are robust to the cases where agents’ preferences are exponentially distributed but not identically. We analyze two cases: different parameter distributions and overlapping valuations.
The paper is organized as follows. The model and the TTCo are presented in Section 2. The analysis of equilibrium incentives of buyers when the market is large under the thickness condition is carried out in Section 3. The uniqueness of equilibrium price vector and its closed-form solution is established in Section 4.
67

3.2 The Model

We consider a market with indivisible goods, money, and two disjoint sets of agents: a set of sellers, S, and a set of buyers, B. Each member of the market initially has a certain amount of money. Only sellers initially own one and only one indivisible good. A generic amount of money is represented by ω ∈ R, and r is used to represent any agent, so r ∈ S ∪ B. We use ∅ whenever a member does not own any indivisible good. Any member owns at most one indivisible good.

Consider S = {s1, s2, . . . , sm}, the set of m sellers. To identify a generic seller we use s j, or s. Each seller initially holds only one indivisible good also identiﬁed by s j; and an amount of money ω j. By simplicity we suppose that ω j = 0. Thus, the initial endowment of seller s j is the basket (0, s j). We suppose that each seller s j has a preference relation represented by the utility function usj(·), deﬁned over baskets (ω, s) ∈ R × ({s j} ∪ {∅}). We assume the following quasi-linear utility function



 ω + v j if s = s j, usj (ω, s; v j) =

ω

if s = ∅.

The type of s j is the valuation v j ∈ R+ of her own good. Let Vj = R+ be the set of all possible types of s j. Consider B, the set of n buyers. We identify a generic buyer by i. Each buyer i initially owns only an

amount of money ωi ≥ 0, and no good. The initial endowment of buyer i is the basket (ωi, ∅). We suppose that each buyer i has a preference relation represented by the utility function ui(·) over the set of baskets (ω, s) ∈ R × (S ∪ {∅}). We assume the following quasi-linear utility function



 ω + v ji if s = s j, ui(ω, s; vˆi) =

ω

if s = ∅.

Each buyer i has a valuation v ji ∈ R of good s j for all j ∈ {1, 2, . . . , m}. The type of buyer i is the vector vˆi = (v1i, . . . , vmi, ωi). The set of all possible types of buyer i is denoted by Vˆi ⊆ Rm+1.

The state of the market is the vector v = (v1, . . . , vm, vˆ1, . . . , vˆn) ∈ Rm+ × Rn. The set of all possible states of the market is the Cartesian product between all sets Vj and the sets Vˆi; let V ≡ ∏mj=1 Vj ×

68

∏ni=1 Vˆi. We suppose that the state of the market v ∈ V is drawn according to a probability function f from V to R, of common knowledge. An assignment is a function Γ from S ∪ B to R × (S ∪ {∅}), i.e Γ assigns to each r ∈ S ∪ B a basket composed of money and a good, or not. The allocation of member r is denoted by Γ(r) = (Γω(r), Γs(r)), so Γω(r) ∈ R and Γs(r) ∈ S ∪ {∅}. The assignment Γ is feasible if it satisﬁes the following conditions
1. ∑r∈S∪B Γω(r) ≤ ∑ni=1 ωi, 2. let r, r ∈ S ∪ B such that Γs(r) = Γs(r ) ∈ S then r = r , and
3. for all s j ∈ S there exists some r ∈ S ∪ B such that Γs(r) = s j. Conditions 2 and 3 tell us that at Γ, any good in the market is assigned to one and only one agent.
We say that a basket (ω, s) is individually rational (I.R.) for agent r if and only if the utility of r by holding (ω, s) is greater or equal than the utility of r by holding her initial endowment. So, Γ is an individually rational assignment (I.R.) if each member of the market weakly prefers her allocation under Γ to her initial endowment.
3.2.1 The Game
A Three-step Game
We consider a three-step game. Nature moves ﬁrst, determining the type of each member of the market according to the probability distribution f . All members of the market observe their type, but do not observe the type of the others. At stage 2, sellers decide simultaneously to set the price of their good. If a seller s j decides to sell her good, she sets a non-negative price p j. Otherwise, she sets a price p j = +∞. Thus, A j = R+ ∪ {+∞} is the set of actions of seller s j. We deﬁne a price vector p = (p1, p2, . . . , pm) as a vector in A1 × A2 × · · · Am. We denote by E(p) the set of baskets on sale, i.e. E(p) = {(ps, s) ∈ R+ × S | ps = ∞}; a basket (ps, s) in E(p) is denoted by es(p).
At stage three buyers report their preferences over baskets. Each buyer observes the price vector p of the second stage and sets her preferences πi(p; vˆi) over the set of baskets in E(p) she can afford
69

and her initial endowment (mi, ∅), we use Ei(p) to represent this set. Naturally, buyers might be indifferent between different baskets. So, for each buyer i, πi(p; vˆi) is a non-strict list of preferences over the set of baskets Ei(p). We write es(p) ∼i es (p) when i is indifferent between buying s and s , i.e. mi + vsi − ps = mi + vs i − ps , and es(p)Pies (p) when i strictly prefers buying s to s , i.e. mi + vsi − ps > mi + vs i − ps . Also, not all baskets in Ei(p) are better than the initial basket (mi, ∅), so, we write iπies(p) when i weakly prefers remaining with her initial endowment buying s, i.e. mi ≥ mi + vsi − ps. The ranking of buyer i is represented by
πi : [esi1 (p)], [esi2 (p)], . . . , [esik (p)], [i], [esik+1 (p)], [esik+2 (p)], . . . , [esiK (p)], where [esij (p)] = {es(p) ∈ Ei(p) | es(p) ∼i esij } and [i] = {es(p) ∈ Ei(p) | es(p) ∼i (mi, ∅)} are called classes of indifference. Each buyer strictly prefers remaining with her initial basket to being assigned to some non I.R. basket. Our analysis only focuses on I.R. baskets.
Let Πi(p; vˆi) be the set of all possible rankings πi(p; vˆi), thus, Πi(p; vˆi) is the set of actions of i. The proﬁle of reported rankings is the vector
π(p; v) = (π1(p; vˆ1), π2(p; vˆ2), . . . , πn(p; vˆn)).
Given the proﬁle π(p; v) of reported rankings, the payoffs of each member of the market are induced by the Top Trading Cover (TTCo) algorithm, to be introduced in the following section.
The TTCo Mechanism and Payoffs
To describe the TTCo algorithm, we must ﬁrst record some concepts from Graph Theory (see Appendix A2). In general, the TTCo algorithm removes sequentially maximum top trading covers in every step. Since the maximum ttco is not always unique, we use tie breaking rules to choose one of them. Formally, let G be a quasi-bipartite graph and ϒ[G] = {T ⊆ E[G] | T is a ttco of G} the set of all top trading covers of G. Note that ∅ ∈ ϒ[G], i.e., the picking rule can decide not to pick any cover in some iterations of the ttco algorithm. The set of elements which are subsets of ϒ[G] is denoted by 2ϒ[G]. A tie breaking rule is a function ς : ϒ[G] → ϒ[G] such that ς(T ) is a maximum ttco of G, for all T ∈ 2ϒ[G]\{∅}.
70

The following questions immediately arise: how do tie breaking rules affect the ﬁnal assignment? Do tie breaking rules modify agent’s behaviour? In Chapter 1, we prove that the assignments produced by tie-breaking rules are characterized by Pareto efﬁciency and that recursively respects top Rankings. Also, we prove that seller’s behaviour at equilibrium is not affected by tie-breaking rules. In other words, equilibrium prices are invariant with respect to tie-breaking rules.

The above results allow us to ﬁx a tie-breaking rule without loss of generality. The tie-breaking rule that we use in the assignment procedure is based on the lexicographic order deﬁned over the set of edges of a quasi-bipartite graph G.

Deﬁnition 12. Let G = (S ∪ B , E(S ∪ B , p, π(p; v))) be a quasi-bipartite graph, and (s j, i), (s j , i ) ∈

E(S ∪ B , p, π(p; v)) ∩ (S × B). The lexicographic order L over E(S ∪ B , p, π(p; v)) ∩ (S × B) is

deﬁned as follows


 j < j , or (s j, i) L (s j , i ) if and only
 j = j and i ≤ i .

We recall that buyers and sellers are indexed by the set of natural numbers, a well-ordered set, which implies the veracity of the next observation.

Observation 3.2.1. Each subset E of E(S ∪ B , p, π(p; v)) ∩ (S × B) has a minimum element, i.e. there exists (s, i) such that (s, i) L (s , i ) for all (s , i ) ∈ E. We write (s, i) = min E.

By Proposition 2.3.1 we can ensure the existence of at least one non-empty maximum top trading cover regardless the quasi-bipartite graph. Thus, we can proceed to deﬁne the lexicographic tiebreaking rule over ϒ[G] using Deﬁnition 12 and Observation 3.2.1.

Deﬁnition 13. Let G be a quasi-bipartite graph, and T = {Tη | Tη ∈ ϒ[G] and Tη is maximum for all 1 ≤

η ≤ K} a ﬁnite subset of maximum top trading covers of G. Consider Tη = Tη ∩ (S × B) for all η ∈ {1, 2, . . . , K}. The lexicographic tie breaking rule ςL is the function ςL : 2ϒ[G] → ϒ[G] such that

ςL(T ) = Tκ if and only if for all t = κ.

K
min Tκ \ Tη
η=1

K
L min Tt \ Tη ,
η=1

71

The Top Trading Cover Algorithm Consider a market (S, B, π(p; v)) and a tie breaking rule ς. The assignment proceed as follows: Step 0: Let S0 = {s j ∈ S|p j = ∞} and B0 = B. If S0 = ∅, the algorithm ﬁnishes and all agents in the market receive their original basket. Otherwise, S0 = ∅, the procedure continues to the iterative step t. Step t: Let Gt = Gt(St−1, Bt−1, p, π(p, v)) be the t−th quasi-bipartite graph. We choose a maximum TTCo of Gt according to ς. For all pairs (s, i) ∈ ς(ϒ[Gt]), seller s sells her good to buyer i. Then, baskets (ps, ∅) and (mi − ps, s) are assigned to s and i, respectively. The maximum ttco ς(ϒ[Gt]) is removed from the market. Let St and Bt be the sets of buyers and sellers remaining in the market after removing this maximum ttco. If both are non-empty, we iterate the procedure. Otherwise, the algorithm stops.
Agents that sell/buy a good receive a payoff of ps/mb − ps + vsb respectively. Agents that do not sell, or buy, any good during the assignment procedure are assigned to their initial basket. The payoffs of these sellers and buyers are v j and mi, respectively.
The ﬁnal allocation produced by the algorithm described above depends on the price vector p, the proﬁle of reported rankings π, the state of nature v and the tie breaking rule ς that we use. We sometimes write the ﬁnal allocation as T TCo[S, B, π; p, v, ς]. We use T TCo[S, B, π; p, v, ς](r) to represent the assignment given to r ∈ S ∪ B under the assignment procedure. If there is no confusion we refer to the assignment only by T TCo.
From now on, we ﬁx the lexicographic tie breaking rule ςL. Below, we provide an example to show how the T TCo[ςL] algorithm works.
Example 3.2.1. Consider the set of seller S = {s1, s2, s3}, and the set of buyers B = {1, 2, 3, 4}. We assume that sellers have the same valuation v j = 0 for all j ∈ {1, 2, 3}, and buyers also have the same valuation vector:
vˆ1 = vˆ2 = vˆ3 = vˆ4 = (5, 5, 5).
In stage 2, all sellers set the same price, p1 = p2 = p3 = 1; and the amount of money given to each buyer is m1 = m2 = 2.5 and m3 = m4 = 3.5.
72

Suppose buyers report the following rankings at the end of the stage 3 (which are not necessarily equilibrium strategies):

π1(p, vˆ1) : es1(p), es2(p), π2(p, vˆ2) : es1(p), es2(p), π3(p, vˆ3) : es1(p), es2(p), es3(p), π4(p, vˆ4) : es1(p), es2(p), es3(p).

Figure 3.1 illustrates the step 1 of the TTCo algorithm. The dotted line is the maximun ttco chosen

by ςL, so the pair (s1, 1) is removed from the market.

s1

s2

s3

1

2

3

4

Figure 3.1: First step of Top Trading Cover algorithm

In the step 2 (Figure 3.2) the set {(2, s2)} is the maximum ttco removed from the market.

s2

s3

2

3

4

Figure 3.2: Second step of Top Trading Cover algorithm

Now, the ttco removed from the market in the Step 3 is {(3, s3)} (see Figure 3.3). Consequently, the TTCo algorithm stops because there are no sellers remaining in the market after removing s3. So, buyer 4 is assigned to her original basket.

73

s3

3

4

Figure 3.3: Third and last step of Top Trading Cover algorithm

Therefore, the ﬁnal allocation is





T TCo =  s1

s2

s3

1

2

3

4 .

(p1, ∅) (p2, ∅) (p3, ∅) (1.5, s1) (1.5, s2) (2.5, s3) (3.5, ∅)

Properties of the TTCo algorithm
Consider π(p; v) a proﬁle of rankings, an assignment Γ and a pair (i, s j) ∈ B × S. We say that Γ is blocked by (i, sj) with respect to π(p; v), if and only if
• Γ(s j) = (0, s j) and p j = ∞, and
• esj (p)Pi(p; vˆi)eΓ(i)(p).
If Γ is blocked by the pair (i, s j), we say that it is a blocking pair of Γ. An assignment Γ is nonwasteful with respect to π(p; v) if and only if it is individually rational and it is not blocked by any pair. In words, an assignment is non-wasteful if there is no buyer such that she strictly prefers an unassigned basket to her allocation.
The non-wastefulness property will be useful in the section of the Large Markets to prove that all assignments can be generated by the T TCo algorithm through dropping strategies. This in turn implies that any deviation is identiﬁed through effective sellers. Buyers with at most one effective seller do not have incentives to deviate from her true ranking. Given a proﬁle of reported rankings π, and a non-wasteful assignment Γ with respect to π, s ∈ S is an effective seller for buyer b ∈ B if and only if Γs[π](b) = s . Analogously, we deﬁne an effective buyer for any seller s.
74

We say that an assignment satisﬁes Pareto efﬁciency if there is no other assignment that assigns each agent in the market a weakly preferred basket and at least one agent a strictly preferred basket. So, it is impossible to make an agent better off without making another agent worse off. An assignment Γ is Pareto efﬁcient at rankings proﬁle π if there is no other feasible assignment Γ such that ur(Γ [π](r)) ≥ ur(Γ[π](r)) for all r ∈ S ∪ B, with strict preference for some r . The T TCo[ς] assignment is Pareto efﬁcient for all tie-breaking rules ς.
Proposition 3.2.1. The assignment T TCo[A, B, π; p, v, ς] is individually rational and non-wasteful.
Proof. See Chapter 1.

3.2.2 Solution Concept

We need some extra concepts and notations. A decision rule of seller s j is a function α j : Vj → A j mapping a type into an action. A pure strategy for seller s j is an element σ j ∈ S j = {α : α : Vj → A j}. Given a price vector p and the realization of her type vˆi, an action of buyer i is a ranking πi(p, vˆi) over the set of baskets {(ps, s)|ps = ∞} ∪ {(mi, ∅)}. A decision rule βi(p, vˆi) for buyer i is a function that maps a price vector and types into rankings.

Deﬁnition 14. Let σ∗ = (σ∗1, . . . , σm∗ ) and β∗ = (β∗1, . . . , βn∗) be proﬁles of strategies for sellers and buyers respectively, and ε > 0. A ε−sub-game perfect Bayesian Nash equilibrium is a proﬁle of

pure strategies

(σ∗1, . . . , σm∗ ), β∗1(σ∗), . . . , β∗n(σ∗)) = (σ∗1, . . . , σ∗m, β∗1, . . . , β∗n)

such that

1. For all s j ∈ S, E[usj (T TCo(σ∗j , σ∗− j, β∗(σ∗j , σ−∗ j))(s j)] + ε ≥ E[usj (T TCo(σ j, σ−∗ j, β(σ j, σ−∗ j))(s j)].

2. For all i ∈ B, E[ui(T TCo(σ∗, βi∗(σ∗), β−∗ i(σ∗))(i)] + ε ≥ E[ui(T TCo(σ∗, βi(σ∗), β−∗ i(σ∗))(i)].

75

3.3 Equilibrium Analysis of Third Stage
To analyse the set of ε−sub-game perfect Bayesian Nash equilibria, we proceed by backward induction. We suppose that buyers observe the price vector p set at the end of stage two. Also, we consider that f = fS fB, where fS is the type distribution of sellers and fB is the type distribution of buyers. In other words, we assume that buyers behaviour is independent from sellers behaviour.
The third stage is a simultaneous game where each buyers only knows her own preference relation and reports a ranking of sellers to the TTCo algorithm. Moreover, sellers wait until someone is interested in buying their good. So, an ε−Bayesian Nash equilibrium of the third stage is a proﬁle of decision rules such that every buyer does not have incentives to deviate from her equilibrium strategy. This game coincides with the game described in Chapter 1. In this paper we proved the existence of a unique ε−Bayesian Nash equilibrium where all agents report their true ranking in large markets that satisﬁes the thickness condition. Moreover, the TTCo algorithm ends at step 1 in these kind of markets, i.e. all sellers sell their good. Before to present previous result, we remember the thickness condition.
Assume that all sellers want to sell her good, i.e. ps = ∞ for all s ∈ S. Consider D = (d1, d2, . . . , dm) a probability distribution over S such that, without loss of generality, d j ≥ d j+1 and d j > 0 for all s j ∈ S. We say that seller s j is more popular than seller s j if d j ≥ d j , that is to say, s j is top ranked in more preference list that s j .
A random market is a tuple ℵ˜ = (B, S, D, k) with an associated proﬁle of random rankings π˜ 1. Given ε > 0, a proﬁle of rankings π∗ = (π∗i )i∈B is an ε-Nash equilibrium if there is no i ∈ B and πi such that
E[ui(T TCo[S, B, (πi∗, π˜ ∗−i)](i))] + ε > E[ui(T TCo[S, B, (πi, π˜ ∗−i)](i))],
1Step 1. Select randomly a seller following distribution D. List this seller as the most preferred seller of i. Step t. Select randomly a seller following distribution D.
t.1 If this seller has not been previously drawn in steps 1 through t − 1, list this seller as the tth most preferred seller of i, go to t + 1.
t.2 Otherwise, we select randomly a seller following distribution D, go to t.1.
The procedure ends at step k.
76

where the expectation is taken with respect to random rankings.
A sequence of random markets is denoted by (ℵ˜ 1, ℵ˜ 2, . . .), where each ℵ˜ n is a random market (Sn, Bn, Dn, kn; pn)
such that Dn = (d1n, d2n, . . .), |Bn| = n and |Sn| = mn, for all n ∈ N. Also, some regularity conditions over sequences of random markets are necessary to deﬁne thickness condition. Deﬁnition 15. A sequence of random markets (ℵ˜ 1, ℵ˜ 2, . . .) is regular if there exists a positive integer k such that
1. kn = k for all n,

2. mn ≤ n for all n.

Let VT (n) = s ∈ S

max
s ∈S

dsn dsn

≤T

the random set that denotes the set of sellers sufﬁciently popular

ex-ante. Below, we present the thickness condition of Kojima and Pathak.

Deﬁnition 16. A sequence of random markets is sufﬁciently thick if there exists T ∈ R such that

E[|VT (n)|] → ∞,

as n → ∞.

Now, we present the results from Chapter 2 that we use to compute the set of ε−Bayesian Nash equilibria. The ﬁrst result is a property of the TTCo algorithm. The following proposition establishes that all sellers sell their good in the ﬁrst step of the TTCo algorithm, regardless the tie breaking rule, when the market satisﬁes the thickness condition. Proposition 3.3.1. Let (ℵ˜ 1, ℵ˜ 2, . . .) a regular sequence of random markets that satisfy the thickness condition. There exists N ∈ N such that the TTCo algorithm removes all sellers in ℵ˜ n at the end of its ﬁrst step, for all n ≥ N.

Finally, with the thickness condition we can ensure the existence of a unique ε−Bayesian Nash equilibrium where all buyers are truth-telling

Theorem 3.3.1. Consider a regular sequence of random markets that satisﬁes the thickness condition. For any ε > 0, there exists N ∈ N such that truth-telling by every buyer is an ε-Bayesian Nash equilibrium for any market in the sequence with more than N buyers.

77

3.4 Equilibrium Price Vector of Second Stage
To compute the equilibrium of the second stage we assume a large thick market ℵ˜ and we suppose that agents’ types are drawn according to a probability function f of common knowledge. The Bayesian Nash equilibrium of this stage is a proﬁle of decision rules (ps(vs))s∈S such that each seller s maximizes her expected utility function. Remember, a decision rule maps sellers’ types into prices.
3.4.1 Invariance with respect to tie breaking rules
We prove that the equilibrium price is independent of the tie breaking rule used in the TTCo algorithm. For a market (S, B; v), the payoff function of each seller s is the following:
  ps if s sells her good, us =  vs otherwise. Moreover, the expected utility function of s is:
E[us](ps, p−s; ς) = psPr[Selling] + vsPr[not selling] = (ps − vs)Pr[Selling] + vs, (3.1)
for all type vs ∈ Vs. At equilibrium, each seller s maximizes E[us].
Now, we know that seller s sells her good if and only if there exists a buyer i such that T TCos(i) = s, then
Pr[Selling] = Pr[T TCo[π; (ps(vs), p−s(v−s)), ς](s) = i, for some i ∈ B]. The decision rule at equilibrium can be written as
p∗s = p∗s (T TCo[S, B, π; p∗i , p∗−i, v, ς]). Proposition 3.4.1. Invariance with respect to the tie breaking rule. Let s ∈ S, then
p∗s = ps∗(T TCo[S, B, π; (p∗s , p−∗ s), v, ςL]) = p∗s∗(T TCo[S, B, π; (p∗s∗, p∗−s), v, ς]) = ps∗∗, for all tie breaking rules ς.
78

Proof. By deﬁnition, p∗s is the decision rule that maximizes E[us] when the algorithm uses the tie breaking rule ςL, then
E[us](ps∗, p−∗ s; ςL) ≥ E[us](ps, p−∗ s; ςL),
for all ps ∈ Ss, and p−∗ s denotes the decision rules at equilibrium of sellers different from s. Particularly
E[us](ps∗, p−∗ s; ςL) ≥ E[us](ps∗∗, p∗−s; ςL),
where p∗s∗ is the decision rule at equilibrium when the TTCo algorithm uses ς. Substituting equation (3.1) in the above inequality, we have that

(ps∗ − vs)Pr[T TCo[π; (ps∗, p−s), v, ςL](s) = i] + vs ≥ (ps∗∗ − vs)Pr[T TCo[π; (ps∗∗, p−s), v, ςL](s) = i] + vs.

So

(p∗s − vs)Pr[T TCo[π; (p∗s , p∗−s), v, ςL](s) = i] ≥ (p∗s∗ − vs)Pr[T TCo[π; (p∗s∗, p−∗ s), v, ςL](s) = i].

(3.2)

Analogously, for any tie breaking rule ς we get that

(ps∗∗ − vs)Pr[T TCo[π; (p∗s∗, p∗−s), v, ς](s) = i] ≥ (p∗s − vs)Pr[T TCo[π; (ps∗, p∗−s), v, ς](s) = i].

(3.3)

We claim that Afﬁrmation 3.4.1. For any price vector p, we have that

Pr[T TCo[π, p; v, ςL](s) = i] = Pr[T TCo[π, p; v, ς](s) = i],

for any tie breaking rule ς. Proof. In Chapter 1 we prove that the assignment T TCo[ς] partitions the quasi-bipartite graph G[S, B, π; p, v] in disjoint subsets T TCo[ς]k such that
(s, b) ∈ T TCo[ς]k if and only if s is the most preferred seller of b in Gk, 79

i.e. seller s sells her good if and only she belongs to some T TCo[ς]k for k ∈ {1, 2, . . . , Kς}. Conse-

quently

Kς
Pr[selling] = ∑ Pr[ selling | s ∈ T TCok] · Pr[s ∈ T TCok] k=1
Kς
= ∑ 1 · Pr[s ∈ T TCok] k=1
Kς
= ∑ Pr[(s, b) ∈ T TCok] k=1
Kς
∑ = Pr[vsi − ps = {vs b − ps | s ∈ S}(k) ≥ 0] k=1
= Pr[T TCos[π : (p∗s , p−s), v, ς](b) = s for some b],

where {vs b − ps — s ∈ S}(k) is the statistic of order k and Kς is the number of elements in the partition induced by T TCo[ς]. However, seller s does not know buyers rankings in stage two, whereby she does not know Kς, then we must consider Es[Kς], the expectation of Kς, to compute the expected utility E[us]. Let lmax the maximum length of buyers rankings (if S = m, then lmax ≤ m). It is clear that the number of elements in the partition is equivalent to the number of steps of the TTCo algorithm, consequently

1 ≤ Ksς ≤ lmax,

(3.4)

the TTCo algorithm can terminate in the ﬁrst step, the maximum ttco of G1 covers all agents in the

market, or the algorithm can ﬁnish in lmax iterations. Then

lmax
Es[Kς] = ∑ kPr[TTCo terminates in Kς steps.]. k=1

(3.5)

It is important to note that expression (3.4) holds for any tie breaking rule ς, that is to say

Es[Kς] = Es[KςL].

Moreover

Pr[T TCo[π, p; v, ςL](b) = s] = Pr[(s, b) ∈ T TCok[ςL]]

=

|{T ∈ ϒ[Gk] | (s, b) ∈ T and T is maximum ttco}| |ϒ[Gk]|

= Pr[(s, b) ∈ T TCok[ς]

= Pr[T TCo[π, p; v, ς](b) = s].

(3.6)

80

Therefore, expressions (3.5) and (3.6) imply that

Pr[T TCo[π; (p∗s , p−∗ s), v, ςL](s) = i] = Pr[T TCo[π; (ps∗, p−∗ s), v, ς](s) = i] = X

(3.7)

and

Pr[T TCo[π; (p∗s∗, p∗−s), v, ςL](s) = i] = Pr[T TCo[π; (p∗s∗, p∗−s), v, ς](s) = i] = Y, (3.8)

for all tie breaking rules ς. Using expressions (3.2), (3.3), (3.7) and (3.8) we have that

(ps∗ − vs)X ≥ (p∗s∗ − vs)Y and (p∗s − vs)X ≤ (ps∗∗ − vs)Y.

Above expression implies

(p∗s − vs)X = (ps∗∗ − vs)Y,

for all vs ∈ Vs. By the Bapat-Beg Theorem (see Appendix C2), the probabilities X and Y are polynomials from the variable vs because we use the permanent to compute it. Thus, the equality between polynomials implies that X = Y . Therefore, p∗s = ps∗∗ for all tie breaking rule ς.

Summarizing, we use the TTCo assignment procedure because the assignment T TCo[ς] is nonwasteful and Pareto efﬁcient for any tie breaking rule ς. Even more, Proposition 3.4.1 allows us to ﬁx the tie breaking rule ςL without loss of generality. In Chapter 1 we characterize the TTCo mechanism and study other properties that satisﬁes it.

3.4.2 Sellers Behaviour at equilibrium
Indifferences are pervasive in the market. Moreover, in large markets, effective buyers are assigned their favourite good (Proposition 3.3.1). We show that under the thickness condition, the expected utility of sellers is independent on the pattern of indifferences.
We assume a quasi-linear utility function for each seller s and we consider that buyers report nonstrict rankings over baskets es(p), at the end of stage three. So, a buyer i can be indifferent between
81

seller s and at most m − 1 other sellers. This motivates the introduction of tie breaking rules during the TTCo assignment procedure to choose only one maximum top trading cover. To compute the expected utility E[usj] we need to describe the situation where the buyer that is assigned s j is indifferent between s j and other sellers. Suppose that i buys s j, we deﬁne the following events to consider the case of indifferences.

• Aij0 = {(v, p) | v ji − p j ≥ max{vti − pt} > 0}.
• Let there be s j1 ∈ S \ {s j}, we deﬁne the set Aij1 = {(v, p) | v ji − p j = v j1i − p j1 ≥ max{vti − pt} > 0 and v j > v j1}.

• Let κ ∈ N such that κ ≤ m − 1 and s j1, s j2, . . ., s jκ ∈ S. Also, suppose that s jτ = s j for each τ = 1, . . . , κ. We deﬁne the set Aijκ = {(v, p) | v ji − p j = v j1i − p j1 = . . . = v jκi − p jκ ≥ max{vti − pt} > 0 and v j > v jτ for all τ}.

So, the event Aijκ is the set of all pairs (v, p), a state of the market v and a price vector p, that satisfy: 1. esj(p) is the most preferred basket of buyer i, and

2. there exists κ sellers in S such that i is indifferent between s j and s jt , for all t = 1, . . ., = κ.

The payoff function of s j is



 

pj

usj (ω, s; v j) =

 

vj

m−1
if T TCo(i) = s j and (p, v) ∈ Aijκ for some i,
κ=0
otherwise.

Seller s j earns p j if the basket esj(p) is assigned to some buyer i in the ﬁrst step of the TTCo algorithm.

A pair (v, p) belongs to Aijκ if and only if esj(p) is the most preferred basket of i and she is indifferent between s j and κ different sellers. Then, the ﬁrst condition ensures that (v, p) ∈ Aij0. Therefore, Aijκ ⊆ Aij0 for all κ ∈ {1, 2, . . . , m − 1}. This implies that
m−1
Aijκ = Aij0.
κ=0
82

So, the payoff function is



 pj usj (ω, s; v j) =

if T TCo(i) = s j and (p, v) ∈ Aij0, for some i,

 v j otherwise.

In order to simplify the algebra, we consider the following monotonic transformation of the payoff

function usj



 pj−vj usj (ω, s; v j) =

if T TCo(i) = s j and (p, v) ∈ Aij0, for some i,

0

otherwise.

In other words, usj = usj −v j. Then, to maximize the expected utility of seller s j, we simply maximize the expected utility E[usj], which is

E[usj ] = p j − v j Pr v ji − p j ≥ msτ∈aSx{vτi − pτ} ≥ 0 .

(3.9)

To ﬁnd the decision rule at equilibrium, we proceed computing the best response correspondence of each seller. To do that, we ﬁrst compute the probability that esj(p) is the I.R. most preferred basket of i, the probability indicated in expression (3.9). Remember that, by Proposition 3.3.1, buyers get their most preferred good in large markets that satisfy the thickness condition. Since sellers set simultaneously the price of their good and only know their own type, we compute this probability following an Auction Theory technique. We investigate if there is a symmetric Bayesian Nash equilibrium in which all sellers set a linear price
pτ = αvτ,

where α is a non-negative constant, for all τ = j. Consequently

Pr[Aij0] = Pr v ji − p j ≥ msτ∈aSx{vτi − pτ} ≥ 0 = Pr v ji − p j ≥ max{vτi − pτ}, v ji − p j ≥ 0
sτ∈S
= Pr v ji − p j ≥ msτ∈aSx{vτi − pτ} Pr v ji − p j ≥ 0 . On the other hand, we know that the probability of the largest order statistic is deﬁned as

Pr[max x ≤ x0] = Pr[x1 ≤ x0, x2 ≤ x0, . . . , xn ≤ x0]. 83

To simplify it, we assume that random variables Vτ and Vτi are statically independent and identically distributed for all sτ ∈ S and i ∈ B. Then

∏ Pr[Aij0] =

Pr vτi − αvτ ≤ v ji − p j 1 − Pr v ji ≤ p j

τ= j

= Pr vτi − αvτ ≤ v ji − p j m−1 1 − Pr v ji ≤ p j .

So, the expected utility function can be written as follows E[usj ] = (p j − v j)Pr vτi − αvτ ≤ v ji − p j m−1 1 − Pr v ji ≤ p j .

(3.10)

Moreover, we assume that agents types are drawn according to the distribution

f (v) = f (v1, . . . , vm, vˆ1, . . . , vˆn),
thus, we denote by fvτ and fvτi the marginal distributions of variables Vτ and Vτi for all τ ∈ {1, 2, . . . , m} and i ∈ {1, 2, . . . , n}, respectively.

Now, consider the random vector



 

Vτi − αVτ −Vji

Z



 

g

j,τ,i

=

 

Vτi

= 

X

. 



 

Vτ

Y

It is clear that g j,τ,i is a linear transformation of the random vector (Vτi,Vτ,Vji). The inverse transfor-

mation g−j,τ1,i is given by

 



Vτi

X

 

 

Vτ

= 

Y

 



 

=

g−j,τ1,i.



Vji

X − αY − Z

Since the inverse transformation exists, the Jacobian of the transformation g j,τ,i is not zero.

Observation 3.4.1. Let X = (X1, X2, . . . , Xp) be a continuous random vector with joint distribution fX (x1, . . . , xp). Let h = (h1(x1, . . . , xp), . . . , hp(x1, . . . , xp)) be a one-to-one transformation of X. Consider A = {(x1, . . . , xp) ∈ Rp | fX (x1, . . . , xp) > 0}, the domain of distribution f , and B = {(u1, . . . , up) ∈ Rp | ul = hl(x1, . . . , xp) ∀l = 1, 2, . . . , p, and (x1, . . . , xp) ∈ A} = h(A), the image of

84

A under transformation h. Since we assume that h is one-to-one, its inverse transformation exists and is denoted by xl = Hl(u1, . . . , up), for all l ∈ {1, 2, . . . , p}. The Jacobian of the transformation H = (H1, . . . , Hp) is deﬁned as

∂x1 ∂u1

∂x1 ∂u2

...

∂x1 ∂up

J(H) =

∂x2
∂u1
...

∂x2
∂u2
...

... ...

∂x2 ∂up
...

,

∂xp ∂u1

∂xp ∂u2

...

∂xp ∂up

the determinant of a matrix of partial derivatives. The Jacobian of H is not zero because h is a one-

to-one transformation. Therefore, the joint probability distribution of U = (U1,U2, . . . ,Up) on the set

B is given by

fU (u1, . . . , up) = fX (H1(U), H2(U), . . . , Hp(U))|J(H)|.

Observation 3.4.1 and the independence assumption imply that the probability distribution of g j,τ,i(V) is

fg j,τ,i(x, y, z) = fv ji(x − αy − z) fvτi(y) fvτ(z)|J(g j,τ,i)| = fvji(x − αy − z) fvτi(y) fvτ(z).

Let Xj,τ,i ≡ Xτi − αXτ −Vji, the probability distribution of Xj,τ,i is given by

fvτi−vτ−v ji(x) = y,z fv ji(x − αy − z) fvτi(y) fvτ(z)dydz,

(3.11)

where FXj,τ,i and FVji denote the cumulative densities functions of variables Xj,τ,i and Vji, respectively. Rewriting the expected utility in (3.10), we have that

E[us j ] = (p j − v j)FXj,τ,i(−p j)m−1 1 − FVji(p j) .

(3.12)

Sellers problem is to compute the price of her good that maximises her expected utility, function

(3.12). Assuming that FXj,τ,i and FVji are differentiable on an open interval, the ﬁrst order condition is

∂E[usj ] ∂pj

=

FVji (p j)FXj,τ,i (−p j)m−1

+(pj

− v j)FXj,τ,i (−p j)m−1FVji (p j)

+

−(m − 1)(p j − v j)FVji(p j)FXj,τi(−p j)m−2FXj,τ,i(−p j) = 0.

(3.13)

85

Consider γ(p j) = ∂E[usj]/∂p j, which is not necessarily a linear function from R to R. The Theory of Non-Linear Equations deﬁne a root of γ as a point x∗ ∈ R such that γ(x∗) = 0. Newton’s method, that we describe below, is used to ﬁnd these roots.

Newton’s Method. Assume that γ(x) has at least one real root.

Step 0. Start with an initial guess x0 ∈ R, for the location of the root.

Step t. Finding a root is given by iterating repeatedly next expression

xt+1

=

xt

−

γ(xt) . γ (xt)

A

root

of

the

equation

γ(x)

=

0

is

x∗

=

lim
t→∞

xt

.

If the Newton’s succession {xt}t∈N converges, the Newton’s method implies that

x∗

=

x∗

−

f (x∗) f (x∗) .

In other words, the Newton’s method computes a ﬁxed point of function

f (x) g(x) = x − .
f (x)

However, the convergence of this succession is not generally guaranteed and there is not a unique criteria to choose the starting point.

There exist functions that ensure the convergence of the Newton’s succession regardless the starting point. Even more, extra conditions guarantee the uniqueness of the root. One of these is the Lipschitz condition, deﬁned below.
Deﬁnition 17. Assume that g(x) is a continuous function in [a, b]. Then g(x) is a contraction if there exists a constant L such that 0 < L < 1 for which any x, y ∈ [a, b]:

|g(x) − g(y)| ≤ L|x − y|.

The constant L is the Lipschitz constant. 86

Above condition ensures the existence of a unique zero of the equation g(x) = x and the converges to the Newton’s succession to it, regardless the starting point.

Theorem 3.4.1. (Contracting Map) Let g : [a, b] → R a continuous function. Assume that g(x) satisﬁes the Lipschitz condition (17), and that g([a, b]) ⊂ [a, b]. Then g(x) has a unique ﬁxed point x∗ ∈ [a, b]. Also, the Newton’s succession converges to x∗ as n → ∞ for any x0 ∈ [a, b].

We impose some conditions to the distribution f to guarantee the existence of a unique price vector.

To maximize the expected utility of seller s j, we have to compute her best response through the ﬁrst

order condition

∂E[usj ] = 0. ∂pj

To solve this problem is the same as ﬁnding the ﬁxed point of

∂E [us j ∂pj

]

+

p

j

=

p

j.

Let

γ(p j)

=

∂E[usj ] ∂pj

+

pj.

To get a unique ﬁxed point, γ must satisfy the Lipschitz condition in (17). Consequently, the ﬁrst

derivative of E[usj ] must satisfy

∂E[usj ] (x) − ∂E[usj ] (y) ≤ L|x − y|,

∂pj

∂pj

(3.14)

for some 0 < L < 1 and any x, y ∈ [a, b], where [a, b] is an interval where γ(x) is continuous. The

following theorem summarizes previous discussion.

Theorem 3.4.2. Let f ∈ C[a, b]. If the ﬁrst derivative of E[usj] satisﬁes condition (3.14), then the

Newton’s succession

xn+1

=

xn

−

γ(xn) γ(xn+1)

converges to a unique root from every starting point.

Proof. This is an immediate consequence of Theorem 3.4.1 and the discussion made in above paragraphs.

Theorem 3.4.2 implies the existence of a unique best response for every seller. In next subsection we show that the exponential distribution satisﬁes the Lipschitz condition established in (3.14).

87

3.4.3 Equilibrium Characterization for the Exponential Case

The price p j is implicitly deﬁned in the non-linear equation (3.13). Theorem 3.4.2 establishes the conditions over the probability function f to compute a unique price vector, even more, we have a method to compute it (Newton’s Method).

Assume that all random variables Vj, Vji are independent and exponentially distributed with parameter

λ > 0. So, their probability distributions are



 λe−λx if x > 0,

fVji(x) = fVj (x) =

0

otherwise.

For all j ∈ {1, 2, . . . , m} and i ∈ {1, 2, . . . , n}.

We compute the probability distribution of the random variable Xj,τ,i assuming that α > 1, i.e. sellers do not set a price lower than its valuation. To do that, we follow the methodology described in

Observation 3.4.1. We know that g j,τ,i(Vτi,Vτ,Vji) is a linear transformation of the vector

 Vτi



 

Vτ

 

=

g−1(X

j,τ,i,

Y,

Z),



Vji

where each probability is exponentially distributed with parameter λ > 0. Then, the joint distribution

of g−j,τ1,i is

fVτi,Vτ,Xj,τ,i (vτi, vτ, x) = λ3e−λ(x−2vτi+(α−1)vτ).

By Observation 3.4.1 and expression (3.11), the probability distribution of Xj,τ,i is

fXj,τ,i (x) =

∞∞
λ3e−λ(2vτi−x+(1−α)vτ)dvτidvτ.
0 αvτ+x

If x ≤ 0, we have that

fXj,τ,i (x)

=

λ(1 + α)e−λx . 2(1 + α)

Otherwise,

fXj,τ,i (x) =

∞∞
λ3eλ(2vτi−x+(1−α)vτ)dvτidvτ
0 αvτ+x

= λ(1 + α)e−λx . 2(1 + α)

88

Therefore, where Xj,τ,i ∈ (−∞, ∞). Then

fXj,τ,i (x)

=

λe−λ|x| 2

Prob[Xj,τ,i ≤ −p j] = Prob[−Xj,τ,i ≥ p j]

= ∞ λe−λx dx pj 2

e−λp j

=

.

2

Consequently, the expected utility is given by

E[usj ] = (p j − v j)e−λpj

e−λp j 2

m−1
.

(3.15)

Before to solve the ﬁrst order condition, we verify that E[usj] satisﬁes the uniqueness condition (3.14) of Theorem 3.4.2, and the thickness condition.

Observation 3.4.2. (Leibnitz Condition.) First, since each random variable is exponentially dis-

tributed, it is clear that ∂E[usj]/∂p j is bounded and differentiable on an interval [a, b], because

0 ≤ e−λp j ,

e−λ(p j+r) m−1 ≤ 1,
2

then for β large enough, where

∂E[usj ] ([0, β]) ⊂ [0, β], ∂pj

∂E[usj ] ∂pj

=

−eλr(−1

+

λm(p j

−

v j))

e−λp j 2

.

Since we are searching the best response of s j we can assume that a ≥ 0. Then, for any x, y ∈ [a, b]

we have that

E[us j ∂pj

]

(x)

−

E[us j ∂pj

]
(y)

|x − y|

=

E[us j ∂pj

]

(x)

−

E[us j ∂pj

]

(y)

x−y

(1 − xλm)

e−λx 2

m
− (1 − yλm)

e−λy 2

m

=2

.

x−y

89

Moreover, we know that

e−λx, e−λy < e−λ0 = 1, and x > y,

then

(1 − xλm)

e−λx 2

m
− (1 − yλm)

e−λy 2

m

2

<

x−y

(1 + xλm) 2

1 2

m − (1 + yλm)

1 2

m

=

x−y

2λm 2m−1

.

Let

L

≡

(2

2λm + 2α)m−1

,

for α ≥ λm and m > 1, we have that 0 < L < 1. So,

E[usj ] (x) − E[usj ] (y) < L|x − y|,

∂pj

∂pj

i.e., the expected utility satisﬁes the condition (3.14).

Also, it is important to note that the exponential function satisﬁes the thickness condition.

Observation 3.4.3. (Thickness Condition.) Since valuations are independent and identically dis-

tributed, we have that d j = e−nλpj , then

d j = e−nλp j

dk

e−nλ pk

= e−nλ(p j−pk).

If s j is the most popular seller, then d j ≥ dk implies that p j ≤ pk, i.e p j − pk ≤ 0. Moreover, we have a

ﬁnite

set

of

sellers

that

set

prices

in

the

second

stage,

then

dj dk

is

bounded

by

e−nλ(p j−pmax),

where

pmax

is the highest price set at the second stage. Therefore, the exponential function satisﬁes the thickness

condition.

Therefore, sellers problem has a unique solution given by the ﬁrst order condition 0 = ∂E[usj ] ∂pj = −eλr(−1 + λm(p j − v j))e−λpj .
90

The best response of s j when other sellers set a linear price is

p∗j

=

1 + λmv j λm

1 = v j + λm .

Verifying the second order condition, we have that

∂2E[usj ]

∂ p2j

p j=p∗j

=

2λmeλr(−2 + λm(p j − v j)

e−λ(p j+r) 2

m p j=p∗j

=



−λ

−2λmeλr

 

e

r+

1+λmv m

j

m

 

< 0.



2



Therefore p∗j is the price of s j at equilibrium. Previous discussion is summarized in the following theorem.

Theorem 3.4.3. Suppose that Vj and Vji are independent and exponentially distributed with parameter λ > 0. For the second stage, the price vector at symmetric equilibrium exists and is unique. Even more, the price that each seller s j sets at equilibrium is

p∗j

=

v

j

+

1 mλ

,

for all s j ∈ S.

By the above theorem, we have shown that the price vector at equilibrium is unique. Consequently, we can do some comparative statics.

Corollary 3.4.1. Let p∗j be the unique price at the symmetric equilibrium found. Then • The relation between p∗j and v j is positive, and • The relation between p∗j and m is negative.

Proof. Note that

p∗j

=

1 λm

+

vj.

91

Its derivative with respect to v j is

∂p∗j = 1 > 0. ∂v j

The derivative of p j∗ with respect to m is

∂ p∗j ∂m

=

−

1 λm2

+

vj m

−

vj m

1 = − λm2 < 0.

We compute in Appendix D2 two extensions that shows the robustness of previous results: the case where parameters of the exponential distributions vary, then we assume that valuations overlap. Finally, in the Appendix E2 we discuss the uniform distribution case and computational difﬁculties that it entails.

Concluding Remarks

3.4.4 Small Markets

When markets are small, uniqueness of equilibrium price vector is not guaranteed any more, as shows the following example.

Example 3.4.1. Consider a market such that S = {s1, s2, s3, s4} and B = {1, 2, . . . , n}, with n < ∞; and the random variables Vτi, Vτ are independent and exponentially distributed with parameter λ > 0. Note that Proposition 3.3.1 is not necessarily true because we do not have a large thick market. So, the top trading cover algorithm can stop in four steps. Denote by X(ik) the statistic of order k. So, if vτi − pτ = X(ik), this means that sτ is the k−most preferred good given de price vector p, where k ∈ {1, 2, 3, 4}. Note that X(1) = max{vτi − pτ} and X(4) = min{vτi − pτ}. Consequently, the payoff function of each seller is the following.



 pj us j =

if v ji − p j = X(ik) and X(i1) ≥ 0, ∀k ∈ {1, 2, 3, 4} and for some i ∈ B,

 v j otherwise.

92

As before, in order to simplify the algebra, we consider the linear transformation usj = usj − v j.
Hence, the expected utility function of s j is
4
∑ E[usj ] = (p j − v j)Pr[v ji − p j ≥ 0] Pr[X(k) ≤ v ji − p j]. k=1
Using the random variable Xj,τ,i, we know that the cumulative density function of the statistic of order

k is given by


∑ F(k)(x) = 3  3  FXj,τ,i(x)r(1 − FXj,τ,i(x))3−r.
r=k r

On the other hand, a well-known result is that


∑m  m  pτ(1 − p)m−τ = Ip(t, n − t + 1)
τ=t τ

=

p
0 1 0

rk−1(1 rk−1(1

− −

r)m−kdr r)m−kdr

,

where Ip(t, m − t + 1) is the incomplete beta function deﬁned as follows.

By previous discussion, the expected utility E[usj] is given by

4
∑ E[usj ] = (p j − v j)Pr[v ji ≥ p j] IFXj,l,i(−pj)(k, n − k + 1) k=1

= (p j − v j)e−λp j

3 e−λp j + 3 e−2λp j + 15 e−3λp j − 47 e−4λp j

2

8

8

64

.

The ﬁrst order condition is the following

e−5λp j 64

(24 − 72λ(p j − v j))e2λpj

− 96(−1 + 2λ(p j − v j)) − 120(−1 + 4λ(p j − v j))eλpj

+ 47(−1 + 5λ(p j − v j)) = 0.

Note that the expression

24 − 72λ(p j − v j))e2λpj − 96(−1 + 2λ(p j − v j))e3λpj − 120(−1 + 4λ(p j − v j))eλpj 47(−1 + 5λ(p j − v j))
can be seen as a polynomial of degree 3 with respect to z = eλpj. This implies that it is not bounded, consequently, it does not satisfy the Lipschitz condition. Therefore, we cannot guarantee that the Newtons succession converges to a unique price p j.

93

3.4.5 Public Policies
Mexican government has included strengthening the housing sector as a public policy priority since 2000. Public housing policy is outlined in National Housing Programs (Programas Nacionales de Vivienda, PNV), which aim to help those most in need by providing access to mortgages and loans, and by encouraging the construction of affordable housing. To achieve this goal, Mexican government provides credits to both buyers and sellers through different institutions. For example, home-builders can request support from the Federal Mortgage Society (Sociedad Hipotecaria Federal, SHF), encourages construction through direct loans and guarantee of bank loans; and the National Institute of Worker Housing (Instituto Nacional de la Vivienda para los Trabajadores, INFONAVIT) provides loans to workers to build, purchase or repair a house. Moreover, there exists institutions like the National Fund for Popular Housing (Fideicomiso Fondo Nacional de Habitaciones Populares, FONHAPO) subsidizes the purchase or the construction of low income housing. Public intervention affects both valuations and prices. It is not clear, especially in stressed market, which side of the market beneﬁts more from public spending. Establishing a closed-form solution is ﬁrst step to empirically answer the question.
94

3.5 Appendix A2 Graph Theory Concepts
Consider a set of sellers, S ⊆ S; a set of buyers, B ⊆ B; and a proﬁle of rankings at p, π(p; v) = (πi1(p; v), . . . , πik(p; v)), where i j ∈ B for all j = 1, . . . , k. We deﬁne the bipartite directed graph G(S , B , p, π(p; v)) as a pair (S ∪ B , E(S ∪ B , p, π(p; v))), where S ∪ B is the set of nodes; and E(S ∪ B , p, π(p; v)) is the set of all directed edges (s, i) ∈ S × B , such that (s, i) ∈ E if and only if buyer i prefers buying the basket es(p) to any other basket (ps, s) in Ei(p). The reported rankings are non-strict; the most preferred basket of a buyer i is not necessarily unique. Thus, there are more than one edge from i to the set of sellers, which represents indifference between baskets.
We represent the case where a buyer i prefers her initial endowment to any basket es(p) by a loop (i, i), which is an edge from B to B . Loops, however, are not admitted in bipartite graphs, that is why the TTCo makes use of quasi-bipartite graphs. We deﬁne a quasi-bipartite directed graph G(S , B , p, π(p; v)) as a pair (S ∪ B , E(S ∪ B , p, π(p; v))), where S ∪ B is the set of nodes; and E(S ∪ B , p, π(p; v))) is the set of all directed edges (s, i) ∈ S × B and loops ( j, j) ∈ B × B , such that:
• buyer i prefers the basket es(p) to any other basket, and
• buyer j prefers her initial endowment (mi, ∅) to any basket es(p).
An arbitrary element of E(S ∪ B , p, π(p; v))) is denoted by a.
The quasi-bipartite graph G(S , B , p, π(p; v)), or only G whenever there is no confusion, represents the situation when each buyer i in B points to the owner of her favorite basket. The following example shows the construction of a quasi-bipartite graph.
3
Example 3.5.1. Consider S = {s1, s2, s3}, B = {1, 2, 3}. For some p ∈ ∏ A j and v ∈ V , suppose that
j=1
95

the rankings reported by 1, 2 and 3 are the following:

π1(p; v) : [es1, es3], es2, 1, π2(p; v) : [es2, 2], π3(p; v) : es3, 3.

Figure 3.4 shows the quasi-bipartite graph G(B, S, π; v).

s1

s2

s3

1

2

3

Figure 3.4: A Quasi-bipartite Graph
Given G(S , B , p, π(p; v)), a Top Trading Cover (ttco) is a subset
T = {a1, a2, . . . , ak}
of E[G], such that no two edges in T have a common node. In particular, the empty set is top trading cover.
A ttco T is maximal1 if it is no longer a ttco when an edge, not in T, is added to T. In other words, a maximal ttco is not a proper subset of any other ttco of the quasi-bipartite graph G. A maximum top trading cover is a ttco that covers the largest possible number of nodes. It is clear that all maximum top trading covers are also maximal; however, a maximal ttco is not always maximum. Figure 3.5 shows four different top trading covers in dotted lines for the same quasi-bipartite graph. The ttco in 3.5(a) is maximal, because if an extra edge is added to it, the resulting subset of edges is not a ttco; 3.5(a) is not a maximum ttco because there exists 3.5(c), which covers the largest possible number
96

of nodes, 6, a number larger than the number of nodes cover by 3.5(a), 4. On the other hand, in

3.5(b) we can add the edge (1, s3) and get a larger top trading cover, so 3.5(b) is non-maximum and non-maximal.

s1

s2

s3

s1

s2

s3

1

2

3

4

(a) Maximal TTCo

s1

s2

s3

1

2

3

4

(b) Non-Maximum and Non-Maximal TTCo

s1

s2

s3

1

2

3

4

1

2

3

4

(c) Maximum TTCo 1

(d) Maximum TTCo 2

Figure 3.5: Top Trading Covers in dotted lines for the same Quasi-Bipartite Graph

We can ensure the existence of at least one maximum ttco for any quasi-bipartite graph. Proposition 3.5.1. Let G(B , S , π; p, v) a quasi-bipartite graph, a maximum T TCo always exists. Proof. See Appendix B2. Note that the maximum top trading cover is not unique. Figure 3.5(d) shows a ttco that covers the same number of nodes than the ttco in 3.5(c), but does not have the same edges. That is, in 3.5(d) we have a maximum ttco different from the maximum ttco in 3.5(c).

3.6 Appendix B2 The Existence of Top Trading Covers
97

To prove the existence of a maximum Top Trading Cover in each quasi-bipartite graph G(S , B , π; p, v), we need more deﬁnitions from Graph Theory. Given a top trading cover T of G, a node r ∈ S ∪ B is said to be covered if there exists r ∈ S ∪ B such that (r, r ) ∈ T . A path P in G is a succession of nodes
{r1,t1, r2,t2, . . . rn,tn} such that (ri,ti) ∈ E(S ∪ B , π; p, v) for all i = 1, 2, . . . , n. We say that r1 and tn are the end points of P. Deﬁnition 18. Let G = G(S , B , π; p, v) a quasi-bipartite graph and a top trading cover T of G. A path P is an augmenting path for T if:
1. The two end point of P are not covered by T . 2. The edges of P alternate between edges ∈ T and edges ∈/ T . Let R a top trading cover of G, and P and augmenting path of R. We deﬁne and denote the operation between R and P, as
R ⊕ P = (A ∪ B) − (A ∩ B), i.e., we operate ttco’s and paths through symmetric difference. The algorithm to ﬁnd a maximum top trading cover is described below
Step 1. Consider T a top trading cover of G, could be T = ∅. Step 2. While exists an augmenting path P do
2.1 T = T ⊕ P Step 3. While exists r ∈ G \ T such that (r, r) is and edge of G do
3.1 T = T ∪ {r} Step 4. Output T .
98

We have to prove that T is effectively a maximum top trading cover. However, this is clear, because we delete all possible augmenting paths. We conclude this prove applying Berge’s Theorem: ”The matching M is maximum if and only if there is no augmenting path”2.

3.7 Appendix C2

Bapat-Beg Theorem

The permanent of a matrix of 2 × 2 is denoted and deﬁned by



ab

Perm 

 = ad + bc.

cd

Let A = (ai j) a matrix of n × n, then
n
Perm(A) = ∑ ∏ ai,σ(i). σ∈Sn i=1
Theorem 3.7.1. Bapat-Beg Theorem X1, X2, . . . , Xn be independent random variables with distri-

butions functions F1, . . . , Fn respectively. Then the distribution function of the statistic of order r,

1 ≤ r ≤ n, is given by



F1(y)

n1

  

...

P[Yr

≤

y]

=

∑
i=r

i!(n

−

i)!

Per

  

Fn(y)





i times



1 − F1(y)

...

  

 

,

−∞

<

y

<

∞.

1 − Fn(y) 





n − i times

(3.16)

3.8 Appendix D2

A Unique Fixed Point

We explain some concepts from the theory of non-linear equations what we use to get the uniqueness

of the price vector. In the main text we use the one dimensional Newton method given by the iteration

xn+1

=

xn

−

f (xn) , f (xn)

x0

∈

[a, b]

n

≥

0

2For more details consult: Claude Berge (1963). Topological Spaces. Oliver and Boyd.

(3.17)

99

assuming f = 0 on [a, b]. First, we must guarantee the existence of at least one root. This is possible by Browser’s Theorem:
Theorem 3.8.1. (Brouwer’s Fixed Point Theorem) Assume that g(x) is continuous on the closed interval [a, b]. Assume that the interval [a, b] is mapped to itself by g(x), i.e., for any x ∈ [a, b], g(x) ∈ [a, b]. Then there exists a point c ∈ [a, b] such that g(c) = c. The point c is a ﬁxed point of g(x).
Deﬁnition 19. Assume that g(x) is a continuous function on [a, b]. Then g(x) is a contraction on [a, b] if there exists a constant L such that 0 < L < 1 for which for any x and y in [a, b]:

|g(x) − g(y)| ≥ L|x − y|.

(3.18)

The equation (3.18) is referred to as a Lipschitz condition and the constant L is the Lipschitz constant.

Indeed, if the function g(x) is a contraction, i.e., if it satisﬁes the Lipschitz condition (3.18), we can expect the iterative Newton’ method converges. This is established in the Contraction Mapping Theorem.
Theorem 3.8.2. (Contraction Mapping) Assume that g(x) is a continuous function on [a, b]. Also, suppose that g(x) satisﬁes the Lipschitz condition (3.18), and that g([a, b]) ⊆ [a, b]. Then g(x) has a unique ﬁxed point c ∈ [a, b]. Also, the sequence {xn} deﬁned in (3.17) converges to c as n → ∞ for any x0 ∈ [a, b].
Proof. By the Brower’s Theorem, we know that g(x) has at least one ﬁxed point. So, to prove the uniqueness, we assume that there are two ﬁxed points c1 and c2. We will prove that these two points must be identical. We know that

|c1 − c2| = |g(c1) − g(c2)| ≤ L|c1 − c2| and 0 < L < 1,
consequently, c1 must be equal to c2. Finally, we need to prove that the succession described in (3.17) converge to c, for any x0 ∈ [a, b]. note that
|xn+1 − c| = |g(xn) − g(c)| ≤ L|xn − c| ≤ . . . ≤ Ln+1|x0 − c|. Since 0 < L < 1, we have that |xn+1 − c| → 0, as n → ∞. The succession converges to the ﬁxed point of g(x), independently of the starting point x0.
100

Non-identically Distributed Random Variables
In previous section we compute the price vector at equilibrium when Vj and Vji are independent random variables exponentially distributed with parameter λ > 0. In this section, we assume that buyers and sellers are statistically independent but not identically distributed. We analyse the case where random variables are exponentially distributed with different parameters.

In the exponential distribution, the parameter λ represents the occurrence of a rare event. In our housing model, we interpret this parameter parameter as the occurrence of selling a house. Naturally, this parameter changes according to the seller, for example: a construction company decides to sell a house every month in a year, i.e. λ = 1. On the other hand, a professor decide to sell a house one time in ﬁve years, λ = 60. So, the mean of the distribution of variable Vs, 1/λ, can be understanding as the number of times that seller s decides to sell her house. In buyers case, ﬁrst note that each buyer has a vector of parameters λˆ i = (λ ji) j∈S, each parameter represents the occurrence of buying a house from seller j. For example, if λ ji = 10, this means that every 10 months buyer i buys a house from seller s j. However, we assume that each buyer can have at most one indivisible good, and, more important, we do not analyse a dynamic problem. Hence, we interpret 1/λ j as the expected time of sale her house, for each s j ∈ S, and 1/λ ji as the interest of buying the house of s j, for all i ∈ B.

Consider S = {s1, s2, . . . , sm} and B = {1, 2, . . . , n}. Given that vˆi = (v1i, v2i, . . . , vmi) is a random vector, we suppose that random variables v ji and v j are independent. We assume that variables v j are exponentially distributed with parameter λ j > 0. Thus, the mean and the variance of Vj are denoted by µ j = 1/λ j and σ2j = 1/λ2j. Variables v ji are exponentially distributed with parameter λ ji, for all j = 1, . . . , m and i = 1, . . . , n. We write µ ji and σ j2 to describe the mean and the variance of Vji. So, the joint distribution of (Vτi,Vτ,Vji) is

fVτVτiVji (vτ, vτi, v ji) = λτλτiλ jie−λτvτ−λτivτi−λ jiv ji .

Applying Observation 3.4.1 for the random variable Xj,τ,i, we have that

fXj,τ,i (x) =

∞∞
0 αvτ+x λτλτiλ jie−λτvτ−λτivτi−λ ji(vτi−αvτ−x)dvτidvτ

=

λτλτiλ jie−λτix

.

(λτi + λ ji)(λτ + αλτi)

101

Then

Pr[Xj,τ,i ≤ −p j] = Pr[−Xj,τ,i ≥ p j]

=

∞

λτλτiλ jie−λτix

dx

pj (λτi + λ ji)(λτ + αλτi)

∏ =

λ

jie−λ

ji

p

j

τ=

j

λτe−λτi p j (λτ + αλτi)

.

Since we assume that random variables are independent and exponentially distributed with different

parameters, the expected utility E[usj] is given by

∏ E

[us

j

]

=

(

p

j

−

v

j)λ

jie−λ

ji

p

j

τ=

j

λτe−λτi p j (λτ + αλτi)

.

The ﬁrst order condition is

0 = ∂E[usj ] ∂pj

m

λmji−1

∏

−p j ∑ λτi
λτe τ=1

m
−1 + (p j − v j) ∑ λτi

=−

τ= j

τ=1

.

∏ (λτi + λ ji) ∏ (λτ + αλτi)

τ= j

τ= j

The best response of s j when others set a linear price is

p∗j

=

1 λ ji + ∑

λτi

+ v j.

τ= j

The second order condition evaluated in p∗j is

∂2E[usj ]

∂ p2j

p j=p∗j

=

m

λmji−1

∏

λτ

m
∑

λτi

m
−2 + (p j − v j) ∑ λτi

−p j ∑ λτi
e τ=1

τ= j τ=1

τ=1

=

∏ (λτi + λ ji) ∏ (λτ + αλτi)

τ= j

τ= j

p j=p∗j

m

λmji−1

∏

λτ

∑

−1−v j ∑ λτi

λτie

τ=1

−

τ= j τ= j

∏ (λτi + λ ji) ∏ (λτ + αλτi)

τ= j

τ= j

< 0.

Therefore p∗j is the equilibrium price.

102

Theorem 3.8.3. Suppose that Vj and Vji are independent and exponentially distributed with parameters λ j and λ ji, respectively, for all s j ∈ S and i ∈ B. Let p∗j be the unique price at the symmetric equilibrium. Then

• The relation between p∗j and v j is positive, • The relation between p∗j and λτi is negative for all τ = j. • The relation between p∗j and µτi is positive τ = 1, 2, . . . , m.

Proof. Note that The respecting derivatives are:

p∗j

=

λ ji

1 + (m − 1)λτi

+ v j.

∂p∗j = 1. ∂v j

The relation with her own valuation is positive.

∂ p∗j ∂λτi

=

1

− (λ ji +

∑

λτi)2

< 0.

τ= j

Finally

∂ p∗j ∂λ ji

=

1

− (λ ji +

∑

λτi)2

< 0.

τ= j

On the other hand, we can compute the relation between the price at equilibrium and the mean µτi for

all sτ ∈ S. First, note that

p∗j

=

1 µ−ji1 + ∑

µτ−i1

+ v j.

τ= j

Then

∂p∗j = ∂µ ji

1 2 > 0,

µ2ji

1 µ ji

+

∑
τ= j

1 µτi

103

and

∂p∗j = ∂µτi

1 2 > 0.

µτ2i

1 µ ji

+

∑
τ= j

1 µτi

Overlapping Valuations

To analyse overlapping valuations, we assume that each variable Vj and Vji has a minimum value r j

and r ji, respectively. Then, their probability distributions are



 λ je−λ j(v j−r j) if v j > r j,

fVj (v j) =

0

Otherwise.



 λ jie−λ ji(v ji−r ji) if v ji > r ji, and fVji(v ji) =

0

Otherwise.

The probability distribution of Xj,τ,i is given by

fXj,τ,i (x)

=

λ jiλτλτieλ ji(r ji−rτ)−λτi(rτ+αrτ−rτi+x) . (λ ji + λτi)(αλτi + λτ)

Consequently, the expected utility is

∏ E [us

j

]

=

(

p

j

−

v

j )e−λ

ji(p

j −r

ji)

τ=

j

λ

jiλτeλ ji(r ji−rτ)−λτi(p j+rτ+αrτ−rτi) (λ ji + λτi)(αλτi + λτ)

.

The ﬁrst order condition is

0 = ∂E[usj ] ∂pj

λmji−1

∏

λ ji(p j+r ji− ∑ rτ)− ∑ λτi(p j+rτ+αrτ−rτi)

λτe

τ= j

τ= j

(1 + λ ji(v j − p j) +

∑

λτi(v j − p j))

=

τ= j

τ= j

.

∏ (λ ji + λτi)(αλτi + λτ)

τ= j

we get that

p∗j =

1
m

+ v j.

∑ λ ji
j=1

Verifying the second order condition, we have that

∂2E[usj ]

∂ p2j

p j=p∗j

=

− ∑ λτi(p j+rτi+αrτ−rτi)−λ ji(p j−mr ji+ ∑ rτ)

∏ λmji−1

e τ= j λτ

τ= j

∏ (λ ji + λτi)(αλτi + λτ)
τ= j

τ= j

p j=p∗j

−1− ∑ λτi(rτ+αrτ−rτi+v j)−λ ji(−mr ji+v j+ ∑ rτ)

∏ = −λmji−1

e λτ

τ= j

τ= j
∏ (λ ji + λτi)(αλτi + λτ)
τ= j

τ= j
< 0.

104

Therefore, when we assume overlapping valuations, the unique price set at equilibrium is

p∗j

=

1
m

+ v j.

∑ λ ji
j

This equilibrium price coincides with the equilibrium price vector when we use that random variables

are independent and exponentially distributed with different parameters.

105

3.9 Appendix E2

Uniform Case

To characterize the price vector at equilibrium we assume that random variables are independent and

uniformly distributed. Without loss of generality, we assume that variables Vτ and Vτi are independent

and uniformly distributed over [0, 1]. Thus, its probability distribution is:

  1 if x ∈ [0, 1]/x ∈ [0, 1]n, fvj (x) = fVˆi(x) =  0 otherwise.

(3.19)

We compute the probability distribution of the random variable

X j,τ,i ≡ Vτi − αVτ − Vji, assuming that α > 1, i.e. sellers do not set a price lower than its valuation. To do that, we follow the methodology described in Observation 3.4.1.

Vector g j,τ,i is a linear transformation of the vector

 Vτi



 

Vτ

, 



Vji

where each probability is uniformly distributed over [0, 1], we have that their joint distribution is

1 fVτi,Vτ,Vji(x, y, z) = α for all (x, y, z) ∈ [0, 1] × [−α, 0] × [0, 1] = ∆.

We know that αVτ is uniformly distributed over [0, α] and Vji is uniformly distributed over [0, 1]. Then −1 − α ≤ Xj,τ,i ≤ 1, consequently

fXj,τ,i (x) =

1dvτidvτ
∆

=

 

1 0

x

α
0

1 α

dvτidvτ

0 ≤ x ≤ 1,



1 0

1

x α

−1−α

1 α

dvτidvτ

−1 − α ≤ x ≤ 0.



x
=  α2

0 ≤ x ≤ 1,

 α+α2−x
α2

−1 − α ≤ x ≤ 0.

106

When other sellers have a linear behaviour, we calculate the best response of each seller analysing the following cases:. A. |S| = 1 and |B| = n, with n ∈ N, and B. |S| = m and |B| = n, with n, m ∈ N and 2 < m ≤ n.

Both cases satisfy the second condition of a regular sequence of markets, required for the veracity of Theorem 3.3.1.

Case A. |S| = 1, and |B| = n Consider S = {s1} and B = {1, 2, . . . , n}. Seller s1 sets the price of her good strategically, she wants to maximize her expected utility. Moreover, since the TTCo algorithm ends at its ﬁrst step in large thick markets, the payoff function of seller s1 is:
  p1 if v1i − p1 > 0 for some i ∈ B, us1(ω, s; v1) =  v1 otherwise.
Then, the expected utility function for seller s1 is
E[usj (ω, s; v1)] = p1Pr[v1i > p1] + v1Pr[v11 ≤ p1],
for some i ∈ B. Also, we assume that v1i is a random variable uniformly distributed over [0, 1], for all i ∈ B. This implies that

E[usj (ω, s : v1)] = p1Pr [v1i > p1] + v1Pr [v1i ≤ p1] = p1(1 − p1) + v1 p1.

The ﬁrst order condition is

0 = ∂E[usj ] ∂ p1
= 1 − 2p1 + v1.

The best response is

p∗1

=

1 + v1 . 2

107

The second derivative evaluated in p∗1, we have that

∂E [us1 ]

= −2.

∂p1 p1=p1∗

Therefore, the price that maximizes E[us1] is p1∗.

Case B. 2 ≤ |S| = m ≤ |B| = n

Let there be S = {s1, s2, . . . , sm} and B = {1, 2, . . . , n}. Given that vˆi = (v1i, v2i, . . . , vmi) is a random

vector, we suppose that the random variables v ji and v j are independent and uniformly distributed

over [0, 1] for j = 1, . . . , m and i = 1, . . . , n. As before, we maximize the expected utility of s j through

the transformation usj of her payoff function:



 pj−vj usj (ω, s; v1) =

in Aij0 for some i,

0

otherwise.

(3.20)

We consider that s j assumes that seller sτ sets a price pτ = αv j, for all τ = j. So, the expected utility

function is

E[usj ] = (p j − v j)Prob[Xj,τ,i ≤ −p j]m−1(1 − Pr[v ji ≤ p j]).

(3.21)

where

Prob[X j,τ,i

≤

−pj]

=

5 2

+

1 2α2

+

2 α

+α−

pj

−

pj α

−

p2j 2α2

.

Since

Vji

is

uniformly

distributed

over

[0, 1], we have that FVji(p j) = p j. Replacing it in (3.21), the expected utility is

E[usj ] = (p j − v j)

5 2

+

1 2α2

+

2 α

+

α

−

p

j

−

pj α

−

p2j 2α2

(1 − p j).

Clearly, above expression induces an equation of degree at least 2m, so, the uniform distribution is not useful to do comparative statistics.

108

References
[1 ] A. ALKAN, G. DEMANGE, AND D. GALE. Fair allocation of indivisible goods and money and criteria of justice. Econometrica, pages 1023-1040, 1991.
[2 ] E. M. AZEVEDO AND J. D. LESHNO. A supply and demand framework fro two-sided matching markets. Mimeo, Harvard University, 2012.
[3 ] R. L. BURDEN AND D. FAIRES. Numerical Analysis. 7th edition, 2000. [4 ] M. COROMINAS-BOSCH. Bargaining in a network of buyers and sellers. Journal of Economic Theory,
(115): 35-77, 2004. [5 ] C. N. DE VIVIENDA. Programa nacional de vivienda 2007-2012: Hacia un desarrollo sustentable(versio´n
ejecutiva), 2008. [6 ] G. DEMANGE. Implement efﬁcient and egalitarian equivalent allocations. Econometrica, (5):1167-1177,
September 1984. [7 ] G. DEMANGE AND D. GALE. The strategy structure of two sided matching markets. Econometrica,(4):873-
888, 1985. [8 ] D. GALE AND L. SHAPLEY. College admissions and the stability of marriage. American Mathematical
Monthly, (69):9-15, 1962.31 [9 ] D. GIBAJA. The ttco mechanism. 2013. [10 ] J. L. HOROWITZ. The role of the list price in housing theory and an econometric model. Journal of
Applied Economics, 7:115-129, 1992. [11 ] N. IMMORLICA AND M. MAHDIAN. Marriage, honesty, and stability. Proceedings of the Sixteenth
Annual ACM-SIAM Symposium on Discrete Algorithms, 2012. [12 ] F. KOJIMA AND P. A. PATHAK. Incentives and stability in large two-sided matching markets. American
Economic Review, 2009. [13 ] S. LEE. Incentive compatibility of large centralized matching markets. Working Paper, 2010.
109

[14 ] D. MACLENNAN. Some thoughts on the nature and purpose of house price. Urban Studies, pages 39-72, 1977.
[15 ] D. MACLENNAN. Housing Economics: An Applied Approach. Urban Studies, 1982. [16 ] S. J. MAYO. Subsidies in housing. Inter-American Development Bank, 1999. [17 ] A. MERLO, F. ORTALO-MAGNE, AND J. RUST. The home selling problem: Theory and evidence.
PIER, 2013. [18 ] A. MERLO AND F. ORTALO-MAGNE. Bargaininig over residential real estate: evidence from england.
Journal of Urban Economics, 56(2): 196-216, September 2004. [19 ] N. G. MILLER AND M. A. SKLARZ. Pricing strategies and residential property selling prices. The
Journal of Real Estate Research, 2(1):31-40, 1987. [20 ] J. NELSON. Residential choice, hedonic prices, and the demand for urban air quality. Journal of Urban
Economics, 5:357-369, 1978. [21 ] S. PAPAI. Strategyproof assignment by hierarchical exchange. Econometrica, 68(6): 1403-1434, Novem-
ber 2000. [22 ] B. M. PERTERSON. Fooled by search: Housing prices, turnover and bubbles. Bank of Canada Working
Paper, 3:1-48, 2012.32 [23 ] A. POLANSKI. Bilateral bargaining in networks. Journal of Economic Theory, (124):557-565, 2007. [24 ] M. QUINZII. Core and competitive equilibria with indivisibilities. Cowles Foundation Discussion Paper,
(644):1-43, 1982. [25 ] H. S. ROSEN. Housing subsidies: Effects on housing decisions, efﬁciency, and equity. National Bureau
of Economic Research, (1161), 1983. [26 ] S. ROSEN. Hedonic prices and implicit markets: product differentiation in pure competition. Journal of
Political Economy, pages 34 - 55, 1974. [27 ] A. E. ROTH. Incentive compatibility in a market with indivisible goods. Economic Letters, (9):127-132,
1982.
110

[28 ] S. W. SALANT. For sale by owner: When to use a broker and how to price the house. The Journal of Real Estate Finance and Economics, 4(2):157-173, June 1991.
[29 ] L. SHAPLEY AND H. SCARF. On cores and indivisibilities. Journal of Mathematical Economics, (1): 23-37, 1971.
[30 ] L. SHAPLEY AND M. SHUBIK. The assignment game i: The core. International Journal of Game Theory, (1):111-129, 1971.
[31 ] J. C. STEIN. Prices and trading volume in the housing market: A model with down-payment effects. The Quarterly Journal of Economics, 110(2): 379-406, 1995.
[32 ] K. TADENUMA AND W. THOMSON. No-envy and consistency in economies with indivisible goods. Econometrica, 59(6):1755-1766, 1991.
[33 ] R. R. TRIPPI. Estimating the relationship between price and time to sale for investment property. Management Science, 23:838 -842, 1977.
[34 ] I.-C. TSAI. The average rate of selling price concessions: Selling price and time in the housing market. International Research Journal of Finance and Economics, 38:116-121, 2010.
[35 ] W. WHEATON. Vacancy, search, and prices in a housing market matching model. Journal of Political Economy, 98(6), 1990.
111

Chapter 4
The subsidized housing problem in Paris
4.1 Introduction
The French tradition in subsidized housing aims at ”mixite´ sociale”, namely promoting social diversity in all districts. In Paris, according to the Atelier Parisien d’Urbanisme, 70% of the households are eligible to one of the many existing programs. Institutions promoting social housing are diverse; the main City Hall, City Halls of all districts, ministries, the Societe´ National des Chemins de Fer (national railways), La Poste (national mail service), . . . . The diversity of involved institutions is ﬁnancially proﬁtable to the programs. They apply, however, very different eligibility criteria and the conﬂict between them to allocate a common pool of subsidized housing is solved by the institutions in Committees. The assignment process, thus, is not transparent, which raises criticisms over its discretionality.
In contrast, the anglo saxon tradition is focused on low income households, which allows a systematic approach to allocate subsidized apartments. Consider the case of Toronto1. The households register on the internet ﬁlling a form where they describe their family situation: number of members, age of each member, income, working status, health condition, . . . . Every two months the pool of free apartments and the score of each household are updated, which determines the ranking of all eligible households for each apartment2. Then, parallel serial dictatorships are performed. Is it possible to
1http://www1.toronto.ca/wps/portal 2http://www.torontohousing.ca/
112

adopt such systematic method in the context of Paris subsidized housing? Is there a mechanism that copes with ”mixite´ sociale” and deals with different scoring schemes fairly and efﬁciently?
Our problem casts similarities with the one of afﬁrmative action in the school choice problem. One stream of papers interprets afﬁrmative action as ”leveling the playing ﬁeld”, like in Kojima (2010) and Hafalir, Yanmez and Yildirim (2011). Students from less privileged ethnic groups, independently of their effort, have lower chance to incorporate the schools which are academically most demanding. It is fair to give priority to these students with criteria less demanding than those required to students belonging to privileged groups. Kominers and So¨nmez (2013) generalize Hafalir, Yanmez and Yildirim (2011) to allow for slot-speciﬁc priorities in a model with contracts. The consequence on welfare is that assignments with afﬁrmative action should be Pareto superior for minority students to assignments without afﬁrmative action. We are closest to the ones for which afﬁrmative action is an objective per se, formalized by the existence of quotas of agents to be fulﬁlled like in Abdulkadiroglu (2003), Ehlers (2010) and Ehlers, Hafalir, Yanmez and Yildirim (2011). Afﬁrmative action might hurt agents, individually, who do not take into account the externalities generated by afﬁrmative action. The consequence on welfare is that the Pareto criteria are only used to compare assignments where afﬁrmative action is implemented. Unlike these papers, however, we do not consider the existence of lower and upper bound for each category. In a different approach, Echenique and Yenmez (2013) and Erdil and Kumano (2012) study the diversity as a policy goal focused on schools priorities.
We model the subsidized housing problem in Paris as a three sided market with households, institutions and apartments. Households are assigned apartments through programs operated by institutions and might qualify to different programs. What matters for them is the apartment they are assigned to, not the institution that promote them, that is why preferences of households are only deﬁned over the set of apartments. Our approach requires formalizing the following. First, institutions have priorities deﬁned over: 1. apartments, and 2. households. Priorities over apartments are motivated by the amount of ﬁnancing to the real estates (the more an institution spends in a building, the stronger its interest in using it), or because it is closest to its headquarters. Priorities over households are generated by a scoring method which can be different from one institution to another. Second, apartments have priorities over institutions: the more an institution has spent in ﬁnancing a building, the highest
113

its priority.
The literature of three sided markets focuses on the existence of a stable matching, where a matching is a set of disjoint families with three agents, commonly of the form (man, woman, dog). A matching is stable if there is no blocking family that is preferred by all its members to their current families in the matching. Chuang (2007) considers a model where each agent has two preference lists over the other two sets. Since a stable three sided matching does not always exists, he introduces indifferences and deﬁnes a hierarchy of stabilities. Under these structure he proves that a stable matching always exists but is NP-complete regardless the deﬁnition of stability. On the other hand, Biro´ and McDermind (2010) consider a model with cyclic preferences, i.e. men only care about women, women only care about dogs and dogs only care about men. They prove that to ﬁnd a three sided stable matching is a NP-complete problem.
To deal with the subsidized housing problem, we introduce the Nested Deferred Acceptance (NDA) algorithm. This assignment procedure nests two Deferred Acceptance algorithms. During the ﬁrst one, each household asks for her most preferred apartment, i.e. the demand of each household is elicited. Then, we run the nested DA between institutions and those apartments that are demanded by a household of its type. Institutions choose a set of apartments that maximizes its priority and does not exceed its vector of quotas. If more than one institution is interested in assigning an apartment, the apartment priority breaks the tie. After that, each apartment is temporarily assigned to the household with the highest priority among the households with the same type that demand it. The rejected households ask for their next preferred apartment and the procedure continues until no household is rejected.
However, the NDA alone fails to cope with mixite´ sociale and fairness for the same type. We identify that these problems arise due to interrupters. As Kesten (2010), we say that some institutions make interruptions and deﬁne two types of interrupters, one for each problem. The ”mixite´ sociale” condition is not reached given that households can have more than one type. Thus, some institutions assign an apartment to a household that should receive the same apartment from a different institution so as the ”mixite´ condition” to hold. On the other hand, the NDA assignment is not fair for households of the same type because there are institutions that tentatively hold an apartment during some steps, but
114

this apartment is not included in their ﬁnal assignment. So, this can induce justiﬁed envy for the same type because the institutions that assign such apartments do not consider again households rejected from these apartments.
The NDA with Interrupters (NDAI) improves the NDA by dropping apartments from the priority of the interrupter institutions. Assuming a the market that admits at least one fair for the same type assignment that satisﬁes mixite´ sociale, our main result shows that the output given by the NDAI is fair for households of the same type, Pareto undominated by an assignment fair for households of the same type and satisﬁes mixite´ sociale. Even more, telling the truth is a dominant strategy in the induced revelation game for households. On the opposite, the Efﬁciency Adjusted Deferred Acceptance Mechanism (EADAM) by Kesten is manipulable because students are interrupters and make offer during the DA, while our interrupters receive offers during the NDA.
Previous result assumes the compatibility between mixite´ sociale and fairness for the same type. However, this is not always true. Analysing the relation between these two concepts, we ﬁnd a condition to guarantee the existence of an assignment that satisﬁes the mixite´ condition. Moreover, we explain the behavior of the NDAI mechanism in markets where mixite´ social and fairness for the same type are not compatible.
The present work is organized as follows. Section 2 introduces formally the subsidized housing model. Section 3 presents the Nested DA and Section 4 the interrupters discussion. In Section 5 we present or main result for the NDAI mechanism. Section 6 analyses the existence issues related with mixite´ sociale and fairness for the same type.
4.2 Model
A subsidized housing market with mixite´ is (I, Hτ, D, Q, A, δ, P, , π) where:
1. I = {1, 2, ..., N} is the ﬁnite set of institutions, a generic institution is i;
2. H = {h1, ..., hH} is the ﬁnite set of Households, a generic household is h;
115

3. τ : H → 2I is the type function, where the types of household h are τ(h); Hi = {h ∈ H | i ∈ τ(h)}.

4. D = {d1, ..., dD} is the ﬁnite set of districts, there are D districts, a generic district is d; 5. Q = ((qidj )Ni=1)Dj=1 is the vector of quotas, where qdi is the quota of households of type i in
district d, a generic quota is q;

6. A = {a1, ..., aA} is the ﬁnite set of apartments, a generic apartment is a;

7. δ : A → D is the district function, where the district of apartment a is δ(a); the number of
N
apartments in district d is #d, ∑ qdi = #d for all districts d;
i=1
8. P = (Ph1, ..., PhH ) is the vector of households’ preferences, Ph is the strict preferences of household h ∈ H over A ∪ {h}, aPha means that households h prefers a to a , an apartment a is acceptable for household h if a h h. Let Ph : a1h, a2h, . . . aAh, and consider Rh be the antisymmetric preference list where aPhb and bPha if and only if a = b.

9. = ( i)i∈I is the vector of institutions’ priorities

i= (

Ai , (

i a1

,

.

.

.

,

i aA

)),

we assume that priorities are lexicographic in:

9.a

i A

the

priority

of

institution

i

over

apartments

A,

ar

i A

as

means

that

department

ar

is

prioritized over apartment as by institution i; and

9.b

i a

the

strict

priority

of

apartment

a

∈

A

over

Hi,

it

is

generating

by

the

score

of

house-

holds, h

i a

h

means that household h has priority over household h

at apartment a; an

household h is acceptable for apartment a if h

i a

a,

else

h

is

unacceptable;

9.c We suppose that for all acceptable apartments a for institution i, at least one household is

acceptable.

10. πa is a priority of institutions over apartment a.

To design an assignment procedure for the subsidized housing problem, we consider that this problem is: 1. a many-to-one matching problem between apartments and institutions, and 2. a ono-to-one
116

matching problem between households and pairs composed by one apartment and one institution. Such assignment is formalized in the following deﬁnition. An assignment µ = (θ, ϕ) is a duple such that:
i. θ : A ∪ I → 2A ∪ I ∪ {∅} where i.a θ(a) ∈ I ∪ {∅}, i.b θ(i) ∈ 2A, i.c θ(a) ∈ θ(i) if and only if θ(a) = i.
ii. ϕ : A × I ∪ H → (A × I) ∪ H ∪ {∅}, where ii.a ϕ(h) ∈ A × I ∪ {∅}, ii.b ϕ(a, i) ∈ H ∪ {∅}, ii.c ϕ(h) = (a, i) ⇔ ϕ((a, i)) = h. The corresponding projections are ϕA(h) = a and ϕI(h) = i,
iii. θ(a) = i if and only if ϕ(h) = (a, i).
Conditions i. a, b and c refer to the many-to-one matching problem between apartments and institutions. Conditions ii. a, b and c refers to the one-to-one matching problem between institutions and pairs composed by one apartment and one institution. Condition 3 says that a household cannot be assigned a pair of one apartment and one institution apartment if the apartment is not assigned to the institution. The match of k ∈ H is ϕ(k) ∈ (A × I) ∪ {∅}, k is unmatched if ϕ(k) = ∅. The match of i ∈ I is θ(∈ 2A, i is unmatched if θ(i) = ∅.
117

Let (I, H, τ, D, Q, A, δ, P, , π) a subsidized housing market with ”mixite´ sociale”, an assignment rep-

resentation is



 h3

h5

µ=



h1

h2

h4 ϕ−1[∅] 

 ϕ(h3) ϕ(h5) ϕ(h1) ϕ(h2) ϕ(h4) ∅ 





















   

h3

h5

h1

∅

h2

h4



∅

  









= a2 a4 a3 ∅ ∅ ∅ a1 .





   

i2

i2







 θ(i2)





i3

i1

∅

∅



∅

  







θ(i3) θ(i1) θ−1[∅] 

An assignment µ is individually rational if

i. for all h ∈ H either ϕA(h)Phh or ϕ(h) = ∅, and

ii. for all i ∈ I, a

i A

∅

for

all

a

∈

θ(i)

and

h

i a

a

for

all

household

h

such

that

ϕ(h)

=

(a,

i)

and

i ∈ τ(h).

We assume that the set of individually rational matchings is not empty.

For any individually rational assignment µ, let Hid(µ) be the set of households of type i assigned at district d, formally Hid(µ) = {h ∈ H | ϕI(h) = i and δ(ϕA(h)) = d}. An assignment µ respects mixite´ whenever #Hid(µ) = qid for all i ∈ I and d ∈ D.

An assignment µ is non-wasteful if no household justiﬁably claims an empty apartment, i.e. there is no i, h and a such that:

i. aPhϕA(h),

ii. θ(a) = ∅,

iii. a

i A

∅

and

h

i a

∅.

Household h has justiﬁed-envy over household h at individually rational assignment µ if 118

i. ϕA(h )PhϕA(h) and

ii. h

i ϕA(h

)

h

for some institution i ∈ I.

Institution i has justiﬁed-envy over institution i at individually rational assignment µ if there exists a ∈ θ(i ) such that

i. a

i A

a

,

for

some

a

∈ θ(i), and

ii. iπai .

An assignment µ is fair if it is individually rational, non wasteful and there is no justiﬁed envy. A matching µ is fair for households of the same type if it is individually rational, non-wasteful, there is no justiﬁed envy over institutions and there is no justiﬁed envy for households of the same type, i.e. when i = ϕI(h).
An assignment µ is Pareto efﬁcient if there is no matching µ such that all households prefer µ to µ, with strict inequality for at least one household. An assignment µ Pareto dominates other assignment µ if µ (h)Rh(h) for each h ∈ H, and µ (h )Ph (h ) for at least one h ∈ H.
A mechanism χ associates a proﬁle of preference list with an assignment µ. Let Rh be the true preference list of each household h. The set of all possible preference lists of household h is denoted by ℜh. A proﬁle of preference list is a vector R = (Rh1, Rh2, . . . , RhH ) ∈ ℜh1 × ℜh2 × · · · × ℜhH = ℜ. As usual, R−h is the proﬁle of all preference list except Rh. A mechanism is strategy proof if telling the truth is a dominant strategy, i.e.
ϕA[Rh, R∗−h](h)RhϕA[Rh, R−∗ h](h) for all Rh ∈ ℜh and R−∗ h ∈ ℜ−h.

119

4.3 The Nested Deferred Acceptance Mechanism

In this section we present a mechanism that deals with the subsidized housing problem. We introduce the Nested Deferred Acceptance (NDA) to ﬁnd an assignment µ = (θ, ϕ). The idea behind this assignment procedure is to compute simultaneously a many-to-one matching, θ, and a one-to-one matching, ϕ. To do that, the NDA mechanism nests two deferred acceptance (DA) algorithms: in the ﬁrst one, each household asks for her most preferred apartment, i.e. the demand of each household is elicited. Then, we run the nested DA between institutions and those apartments which are demanded by a household of its type. Formally the NDA proceed as follows:

Initialization

For all households h ∈ H, let Ath := A. and t := 1. A. Eliciting the demand of households

All unassigned households h ask for the most preferred apartment in Ath, denoted Dth, while matched households h iterate their demand to their match, Dth = ϕtA−1(h). For all i ∈ I and a ∈ A deﬁne the set of households that demand apartment a and i is one of her possible

types:

Hait = {h ∈ H | (Dth = {a}) and i ∈ τ(h)}.

For all i ∈ I deﬁne the set of apartments to which i can be assigned to an household at an individually

rational matching:

Ati = {a ∈ A | (∃h ∈ Hait}), (a

i A

∅)

and

(h

i a

∅)}.

B. Assignment of apartments to institutions B.1 All institutions i demand apartments in

Chi(Ati, iA) = {s ∈ 2Ati | #s ≤ qi and s is maximal for

i A

in Ati

}.

Moreover

Iat = {i ∈ I | a ∈ Chi(Ai, Ai )}.

120

B.2 For all apartments a which received a demand from some institution, the apartment a is tentatively assigned to the institution highest ranked in πa, i.e. a ∈ θt(maxπa Iat ).

C. Assignment of households to institutions and apartments

Each institution i assigns an apartment a ∈ θt(i) to the household with the highest priority, that is to

say ϕt(a, i) = max

ix a

Hait

.

For all unassigned household, h, let Ath+1 := Ath maxPh Ath, t := t + 1, go to A. Else stop, if each

household has been rejected from all the apartments in her preference list or is matched.

The tentative matching is the outcome assignment. Each household tentatively matched with a pair

composed by one apartment and one institution at the last step is assigned that apartment by the

corresponding institution in the pair. Other households are assigned the null object ∅.

We denote by µNDA = (θNDA, ϕNDA) the assignment given by the NDA. Note, that the NDA algorithm has a ﬁnite number of steps because each DA ends in polynomial time. In the following example we show how the NDA mechanism works.

Example 4.3.1. Consider A = {a1, a2}, H = {h1, h2, h3}, I = {i1, i2}. Assume only one district, δ(a1) = δ(a2) = 1, households type function is given by τ−1(1) = {1, 2} and τ−1(2) = {h2, h3}. The quota for both institutions is equal to 1. Households preferences are





Ph1 Ph2 Ph3





P

=

 

a1

a2

a2

. 





a2 a1 a1

The priorities of institutions and apartments are the following













11

1

A a1 a2

22 2 A a1 a2

πa1 πa2













1=  

a1

h2

h2

, 

2=  

a2

h3

h2

 

and

π

=

 

1

2

. 













a2 h1 h1

a1 h1 h3

21

Running the NDA, the demand elicited by households at Step 1 is the following

• Apartments demanded by type 1 households are: Ha11 = {h1} and Ha12 = {h2},

121

• Apartments demanded by type 2 households are: Ha21 = ∅ and Ha22 = {h2, h3}. Consequently A11 = {a1, a2} and A21 = {a2}. According to the vector of quotas and the vector of priorities A, the set of apartments that each institution chooses is
Ch11(A11, A1 ) = {a1} and Ch12(A12, 2A) = {a2}.
Therefore, we get tentatively the triads

(h1, a1, 1) and (h2, a2, 2).

We have that h3 was rejected from apartment h2. Then, the demand elicited by households at Step 2 is

• Apartments demanded by type 1 households are: Ha11 = {h1} and Ha12 = {h2},

• Apartments demanded by type 2 households are: Ha21 = {h3} and Ha22 = {h2}.

Consequently A11 = {a1, a2} and A21 = {a1, a2}. Note that institution a1

1 A

a2

and

a2

1 A

a2;

moreover,

the quota of each institution is equal to one. Then, each institution chooses the following set of

apartments

Ch11(A11, A1 ) = {a1} and Ch12(A12, A2 ) = {a2}.

Therefore, we get tentatively the triads

(h1, a1, 1) and (h2, a2, 2).

We have that household 3 has been rejected from all her acceptable apartments Thus, the algorithm

stops, and ﬁnal assignment is





h1 h2 h3





µNDA

= 

a1

a2

∅

. 





1 2∅

122

4.4 Interrupters
In this section we show that the assignment produced by the NDA algorithm fails to cope with the mixite´ condition and fairness for the same type. The following example show that these problems arise because some institutions turn out to be interrupters as deﬁned by Kesten (2010). We identiﬁed two types of interrupters.

Example 4.4.1. (There is justiﬁed envy for households of the same type). Let I = {i1, i2}, A = {a1, a2, a3} and H = {h1, h2, h3, h4}, where households type function is given by τ−1(1) = {h1, h2} and τ−1(2) = {h3, h4}. The vector of quotas is q = (2, 1). The priorities for the institutions are









11

1

1

A


a1

a2

a3 

22

2

2

A


a1

a2

a3 









 1= 

a1

h1

h1

h1  ,

 2= 

a2

h3

h3

h3  .









 

a2

h2

h2

h2

 

 

a1

h4

h4

h4

 









a3

a3

Households preferences and apartments priorities are





Ph1 Ph2 Ph3 Ph4





 

 

πa1 πa2 πa3

 a1 a2 a1 a1 





P= 

 

,

π

=

 

2

2

1

. 

 

a2

a1

a2

a2

 









112

a3 a3 a3 a3

At Step 1 of the NDA algorithm, we have that:

• the type 1 households that demand an apartment are Ha11 = {h1} and Ha12 = {h2}, • the type 2 households that demand an apartment are Ha21 = {h3, h4} and Ha22 = ∅. Under the priority πa1, institution 2 assigns apartment a1. Then, we tentatively get the triads

(h3, a1, 2), (h2, a2, 1).

During Step 2, we have that

123

• the type 1 households that demand an apartment are Ha12 = {h1, h2}, • the type 2 households that demand an apartment are Ha21 = {h3} and Ha22 = {h4}.
The priority of apartment a2 implies that institution 2 assigns apartment a2. However, its quota is 1 and apartment a2 is preferred to a1 under 2A. Therefore, we get temporarily the triad

(h4, a2, 2).

That is to say, the triads (h3, a1, 2) and (h2, a2, 1) are dissolved at the end of Step 2. Since each household makes an offer to those apartments such that she has not been rejected, at Step 3, we have that:

• the type 1 households that demand an apartment are Ha11 = {h2} and Ha13 = {h1},

• the type 2 households that demand an apartment are Ha22 = {h3, h4}.

According to the quotas, institutions 1 and 2 choose the set {a1, a2} and a3, respectively. Since

h3

2 a3

h4,

the

tentative

assignment

is





h1 h2 h3 h4





µ3

= 

a3

a1

a2

∅

. 





1 1 2∅

Thus, household h4 is rejected from a3. During the ﬁnal Step 4, h4 asks for apartment a3. However,

1πa32 and h1 ∈ Ha13. Therefore, h4 does not get this apartment and the algorithm stops. Therefore, the

ﬁnal assignment is





h1 h2 h3 h4





µNDA

= 

a3

a1

a2

∅

. 





1 1 2∅

Note that ϕNADA(h2) = a1Ph1a3 = ϕANDA(h1), h1

1 a1

h2

where

1

=

ϕINDA(h1)

=

ϕNI DA(h2).

Therefore,

household h1 justiﬁably claims the apartment a1 to household h2, i.e. there is justify envy for house-

holds of the same type.

124

Previous example illustrates the interruption of type 1. The NDA does not satisfy fairness for the

same type because institution 2 tentatively assigns a1, so household h1 and institution 1 are displaced

from it at Step 1. However, institution 2 does not assign a1 at the end of the mechanism due to

a2

2 A

a1

and

q2

=

1,

i.e.

a1

is

displaced

from

θ(2)

at

Step

2.

We

deﬁne

formally

type

1

interrupters.

Given a problem to which the NDA is applied, we say that i is a type 1 interrupter for a if it exists

1. Steps t to t + n such that a ∈ θt (i) for all t ∈ {t,t + 1, . . . ,t + n} but a ∈/ θt (i) for all t > t + n, and

2. institution j = i such that a ∈ Ch j(Alj, Aj ) but a ∈/ θl( j) for some l ∈ {t,t + 1, . . . ,t + n}.

Now, we show an example where the NDA algorithm does not output an assignment that respects mixite´ sociale.

Example 4.4.2. (Mixite´ Condition) Consider I = {1, 2}, A = {a, b, c}, H = {h1, h2, h3} where the

households function type is given by τ−1(1) = {h1, h2, h3} and τ−1(2) = {h2}. The vector of quotas

is q = (q1, q2) = (2, 1). The of households preferences is





Ph1 Ph2 Ph3









a a a

P=

.





b b b









ccc

Institutions priorities over households is





1 111

Aabc









 1= 

a

h1 h1 h1   and





b 

h2

h2

h2

 





c h3 h3 h3





2 222

Aabc









 2= 

a

h2

h2

h2

 −





b











c

Priorities over apartments and apartments are





πa πb πc





π

=

 

1

1

1

. 





222

125

Running the algorithm, at Step 1 we have that: • type 1 households that demand an apartment are Ha1 = {h1, h2, h3}, • type 2 households that demand an apartment are Ha22 = {h2}.
So, following the priorities, we tentatively get the triad

(h1, a, 1).

At Step 2, the elicited demand by households implies that • type 1 apartments that demand an apartment are Ha1 = {h1}, Hb1 = {h2, h3}, • type 2 apartments that demand an apartment are Hb2 = {h2}.
The priority vector π determines that

(h1, a, 1), (h2, b, 1).

At Step 3, household h3 asks for apartment a3. So, a1, a2, a3 ∈ A31. Since a1, a2 are preferred to a3 under A1 , and 1πa22, we have that institution 1 assigns apartments a1, a2 to households h1, h − 2,

respectively. Consequently, h3 is rejected from a3 and the algorithm stops. The assignment produce

by the NDA algorithm is





h1 h2 h3





µ= 

a

b

∅

. 





1 1∅

On the other hand, the assignment





h1 h3 h2





µ

= 

a

c

b

 





112

is a feasible assignment that respects mixite´ sociale condition. In other words, the market described in previous example satisﬁes the over-demand condition. However, the output of the NDA mechanism

126

does not satisfy the mixite´ condition because #θ(2) = 0 < q2. This interruption is caused because institution 1 assigns the apartment a2 to household h2, where h2 has the possibility to receive the same apartment by institution 2. whose quota is not fulﬁlled. We deﬁne formally type 2 interrupters.
Given a problem to which NDA is applied, we say that i is a type 2 interrupter of the NDA algorithm if
1. ϕNDA(h) = (a, i), 2. #τ(h) ≥ 2, i.e., there exists j ∈ τ(h) − {i}, 3. iπa j ,and 4. #θNDA( j) < q j.
The triad (h, a, i) is a type 2 interrupting triad for the triad (h, a, j). Observation 4.4.1. Note that assignment µ satisﬁes mixite´ condition and does not have type 2 interrupters. However, institution 1 justiﬁably claims apartment a2 to institution 2.

4.5 Nested Deferred Acceptance with Interrupters

We have shown that the NDA assignment is not always fair for households of the same type and it does

not always respects the mixite´ condition. Moreover, these problems are caused given the existence

of type 1 and 2 interrupters. Following the Efﬁciency Adjusted Deferred Acceptance Mechanism

(Kesten, 2010), we modify the NDA introducing a second stage where we search for all the interrupter

institutions. Then, these institutions delete the apartment where they caused the interruption from

their priority deﬁned over apartments. That is to say, we deﬁne a delete operation on priorities

i A

.

Let Λ be the set of all possible priorities iA, for all i ∈ I. The delete operation over Λ is the function \ : Λ × A → Λ such that \( , a), or simply \a, is the priority that declares apartment a unacceptable for i only if a ∅. In other words, the priority \a drops a from and holds the original order in . Otherwise, \a = . Note that Kesten deﬁnes this operation over students preferences, the agents

127

who makes the proposal, because he identiﬁes that students causes the loss of efﬁciency during the Deferred Acceptance mechanism. In our case, institutions, the agents who ”receive” the proposal, cause a loss in fairness and non-wastefulness because the mixite´ condition is not satisﬁed.

Now, we introduce the Nested Deferred Acceptance with Interrupters (NDAI). Each step if this mechanism has two stage: in the ﬁrst we run the NDA algorithm, and the second stage actualizes the priorities of all interrupters. Formally, the NDAI proceed as follows.

Initialization Counter of iterations over interrupter institutions, x := 0. STEP 0. This step is divided in the following stages:

Stage 0.1 NDA Phase. Let A0 = ( Ai )i∈I. Run the NDA algorithm using the proﬁle of priorities and
preferences ( A0 , (( ai )a∈A)i∈I, P).

Stage 0.2 Priorities Actualization. Find the last step of the NDA phase in which an interrupter is

rejected from the apartment which she is an interrupter. For each interrupting triad (h, a, i), do

iA1=

i0 A

a, and

j1 A

=

j0 A

if

j

is

not

an

interrupter.

If

there

is

no

interrupters,

the

algorithm

stops.

STEP x. The stages are the following.

Stage x.1 NDA Phase. Run the NDA algorithm with the proﬁle of priorities and preferences (

x A

, (( ia)a∈A)i∈I, P).

Stage x.2 Priorities Actualization. Find all the interrupting triads (of any type) in the last step of

the NDA phase in Round x − 1. For each interrupting triad (h, a, i), do

Aix+1=

ix A

a, and

Ajx+1=

jx A

if

j

is

not

an

interrupter.

If

there

is

no

interrupters,

the

algorithm

stops.

The output of the previous mechanism is denoted by µNDAI[H, A, P, I, , πA, q]. We know that the

NDA phase is solvable in polynomial time and there are at most #I interrupters in each stage x.2.

Also, priorities

i A

have

a

ﬁnite

length.

Therefore, the NDAI is solvable in polynomial, i.e.

the

128

number of iterations x is ﬁnite. This implies the existence of an iteration x∗ such that there is no interrupters in its corresponding NDA phase (Stage x∗.1)
Before to present our main result about the NDAI mechanism, it is important to note that µNDAI is not fair because there is justiﬁed envy between institutions. For an example see Observation 4.4.1, where the assignment µ is equal to µNDAI. The justiﬁed envy between institutions is a direct consequence of the deﬁnition of type 2 interrupter. For this mechanism it is not possible to get mixite´ sociale and fairness for institutions.
Also, if there is a unique institution in the market, it is easy to see that all the apartments are assigned by this institution i. Moreover, each pair (i, a) has associated the priority ai . Hence, we only have to solved a one-to-one matching problem between pairs (i, a) and households. In other words, the NDAI coincides with the Deferred Acceptance mechanism when there is a unique institution. Thus, the NDAI can be understood as a generalization of the DA.
We present our main results about the NDAI mechanism in the following theorem.
Theorem 4.5.1. Consider a subsidized housing market ℵ = (I, H, τ, D, Q, A, δ, P, , π). We have the following cases
1. Suppose the existence of at least one assignment that satisﬁes mixite´ sociale under ℵ.
A. If mixite´ sociale and fairness for the same type are compatible, then the assignment µNDAI satisﬁes both properties. Moreover, there is no fair for the same type assignment that satisﬁes mixite´ sociale that Pareto dominates µNDAI.
B. Otherwise, the assignment µNDAI only satisﬁes the mixite´ condition. Moreover, there is no assignment that satisﬁes mixite´ that Pareto dominates µNDAI.
2. If there does not exist an assignment that satisﬁes mixite´ sociale under ℵ, then µNDAI is fair for the same type.
3. The NDAI mechanism is strategy-proof.
129

Proof. Consider x∗ the NDAI last iteration where there is no interrupters. We know that the corresponding Stage x∗.1 is solvable in polynomial time, i.e., the corresponding NDA phase ends at Step t∗. By construction, we have that

• θNDAI(i) = Chi(Ati∗,

i A

|qi,

πA)

for

all

i

∈

I

,

then

θNDAI

(a)

=

i

if

and

only

if

a

∈

θNDAI

(i),

•

The function ϕNDAI(·) is deﬁned as ϕNDAI(h) = (a, i) if and only if h = ϕNDAI(a, i) = max

ix∗ a

Hait∗

for all (a, i) ∈ Chi(Ati∗,

i A

|qi,

πA)

×

{i}.

So,

i

∈

τ(h).

Therefore, µNDAI = (θNDAI, ϕNDAI) where θNDAI : I ∪ A → I ∪ 2A ∪ {∅} and ϕNDAI : H ∪ I × A →

H ∪ (I × A) ∪ {∅}. Moreover, ϕI(h) ∈ τ(h) for all h ∈ H. That is to say µNDAI is feasible.

Mixite´ Condition. We have to prove that #Hid(µNDAI) = qdi for all i ∈ I.

By deﬁnition, we know that θNDAI(i) = Chi(Ati∗,

i A

|qi, πA),

then

institution

i

chooses

its

highest

ranked apartments such that its quota in each district is not violated. So, #Hid(µNDAI) ≤ qdi .

Now, we need to prove that #Hid(µNDAI) ≥ qid. We proceed by contradiction assuming that #Hid(µNDAI) <

qdi . Consequently, institution i does not fulﬁlled its quota, #θ(i) < qi, and we have that ∑i∈I #θNDAI(i) <

∑i∈I qi = #A. This implies the existence of at least one apartment a that remains unassigned, θNDAI(a) =

∅. Moreover, we assume the existence of at least one assignment that satisﬁes the mixite´. Such as-

signment ensures the existence of a household h such that ϕNDAI(h) = ∅ and τ(h) = i because we

consider that µNDAI does not satisfy the mixite´ condition. Since Ph is a strict preference list of all

apartments, we have that h ∈ Hait and a ∈ Ati, for some Step t, at iteration x∗. We have two cases:

- First case, institution i is not an interrupter of apartment a, that is to say, a

ix∗ A

∅.

Thus,

we

have

the following subcases:

I.A Institution i does not choose this apartment at Step t, i.e. a ∈/ Chi(Ati,

i A

|qi, πA).

Moreover,

we

know that #θ(i) < qi and a ∈ Ati. Consequently, there must exists an institution j = i such that

apartment a belongs to Ch j(Atj,

j A

|q j, πA).

So,

some

household

h

= max

j Hajt is tentatively
a

assigned to a by institution j. However, apartment a remains unassigned at the end of the NDAI

algorithm, this means that the triad (h , a, j) was deleted in some later Step. We conclude that institution j is a type 1interrupter for apartment a, which contradicts the election of x∗.

130

I.B Institution i chooses this apartment at Step t, i.e. a ∈ Chi(Ati,

i A

|qi,

πA),

we

have

two

possibili-

ties: h = max

i a

Hait

or

not.

Let

h

the household assigned to a under i. Since θNDAI(a) = ∅ and

#θNDAI(i) < qi, we conclude that h was displaced in some later step by an institution j with a

higher priority under πa. At the end of the algorithm, j does not assigned apartment a. That is to say, the institution j is a type 2 interrupter, which contradicts the election of x∗.

- Second case, institution i is an interrupter of apartment a, that is to say ∅

ix∗ A

a.

So,

we

analyze

each type of interruption in the following subcases:

II.A Institution i is a type 1 interrupter for a in some iteration x . By deﬁnition, institution i tentatively assigns a to some household h at Step t, but the apartment a is not assigned by i at the end of the NDAI algorithm. Then there exists institution i = i interested in apartment a in {t,t + 1, . . . ,t + n} and iπai because a ∈/ Chti (Ati ; Ai , qi ) On the other hand, institution i rejects apartment a because its quota its fulﬁlled or there exists an institution j = i with a higher priority than i under πa. The ﬁrst case is not possible because we assume that #θ(i) < qi. Then, we have that jπaiπai . Since θ(a) = ∅ we conclude that j is a type 1 interrupter for apartment a and the interruptions occurs after the interruption made by institution i at iteration x . Therefore, the last interruption does not occur at Step t of the stage x .1. This is a contradiction with the election of x and t.
II.B Institution i is a type 2 interrupter for a in some iteration x < x∗. Then there exists an institution j and a household h such that the quota of j is not fulﬁlled, i has a higher priority than j under πa, both institutions belong to the type set of h and institution i assigns the apartment a to h. Since the apartment a remains unassigned, the apartment a was displaced from j because its quota is fulﬁlled with a higher ranked apartment than a under Aj or by the existence of an interrupter. The ﬁrst case is not possible because j needs the apartment a to fulﬁlled its quota. So, deleting a from all the interrupters of (a, h, j), we conclude that a must belong to θ( j). Otherwise, we will have that x∗ is not the last iteration.

We get a contradiction in any case. Hence, #θNDAI(i) ≥ qi. Therefore, the mixite´ condition is satisﬁed #θNDAI(i) = qi for all i ∈ I.
131

Non-wastefulness. We proceed by contradiction. Suppose the existence of a triad (h, a, i) such that

aPhϕNADAI(h), θNDAI(a) = ∅ and the institution i can assign the apartment a to the household h, i.e.

#θNDAI(i) < qi, h

i a

∅

and

i

∈

τ(h).

As

before,

let

x∗

be

the

last

iteration

where

no

institution

is

an

interrupter. So, at stage x∗.1, in some Step t of the NDA phase we have that

h ∈ Hait and a ∈ Ati.

Moreover, we know that #θNDAI(i) < qi and Chi(Ati,

Ai ) = {s ∈ 2Ati | #s ≤ qi and s is maximal for

i A

in Ati. Thus, Iat = ∅, particularly i ∈ Iat .So, consider i ∈ Iat such that a ∈ Chi (Ati , πi ).

On the other hand, θNDAI(a) = ∅,then a is displaced from θNDAIt(i ) by some i , but she does not

assign it. This means that i is a type 1 interrupter, which contradicts the election of x∗. Therefore,

µNDAI is non-wasteful.

There is no justiﬁed envy. Let x∗ be the last iteration of the NDAI algorithm. Consider households

h, h such that

ϕNI DAI(h) = ϕINDAI(h ) = i and a = ϕNADAI(h )PhϕNADAI(h).

So, apartment a is acceptable for both households.

Consequently

h ∈ Hait and h ∈ Hait

for some Steps t, t during the NDA phase at Stage x∗.1. Since there are not interrupters at iteration x∗ and a ∈ θNDAI(i), we have that

a ∈ Chsi (Ais, Ai ) for all s ≥ min{t,t }.

Moreover, h

= max

i a

Hais

for

all

s

≥

t

because a = ϕNADAI(h ). We analyze the following cases:

Case I.

Consider t

≤ t.

We know that h

= max

i a

Hais

for

all

s

≥

t

and h ∈ Hait .

Then h is not

assigned to a because h

i a

h.

Case II. Suppose that t < t . Since h ∈ Hait and a ∈ θ(i), we have two possibilities: household h is

the household in Hait with the highest priority under

i a

or

not.

In

any

case,

institution

i

assigns

the apartment a to some household h

at Step t. By deﬁnition, h

= max

i a

Hait ,

then

h

i a

h.

However, h = max

i a

Hait

at Step t

and ϕ(h ) = (a, i). That is to say, h

is displaced from a by

an household with a higher priority under

ai . By transitivity, we conclude that h

i a

h.

132

In any case, h

i a

h.

Therefore

households

does

not

have

justiﬁed

envy

under

µN DAI .

So,

the

assign-

ment µNDAI is fair for households of the the same type.

Pareto Undominated. Now, we prove that there is no fair for households the same type assignment

that Pareto dominates assignment µNDAI.

We proceed by contradiction. Let µ be a fair for households of the same type assignment that Pareto

dominates the assignment µNDAI. Thus, ϕA(h) = ϕANDAI(h) for all h ∈ H, but exists at least one household h∗ such that strictly improves under ϕ, that is to say ϕA(h∗)Ph∗ϕNADAI(h∗). Now, let hα be the household that is assigned to the apartment α under the NDAI algorithm. So, ϕANDAI(hα) = α for all α ∈ A. Particularly, we have that

ϕANDAI(ha) = a = ϕA(h∗)

Moreover, denote by ϕI(h∗) = i, ϕINDAI(h∗) = i∗, ϕI(ha) = j and ϕNI DAI(ha) = j∗, the corresponding institution that assigns an apartment to the households h, ha. We deﬁne and denote the set of households that improve (and remain equal) under the assignment µ as follows:

H+ = {h ∈ H : ϕA(h)PhϕANDAI(h)} and H= = {h ∈ H : ϕA(h) = ϕANDAI(h)}.
It is easy to note that H+ ∩ H= = ∅ and H+ ∩ H= = H. In the spirit of the decomposition lemma, consider h ∈ H+ and b = ϕA(h). We know that exists the household hb because µNDAI is non-wasteful and respects the mixite´ condition. Since µ is a fair for households of the same type assignment, we have that ϕA(hb) = ϕNADAI(hb). So, hb ∈/ H=, this implies that hb must belong to H+. In words, the assignment µ re-allocates all the apartments in ϕNADAI(H+) between the elements in H+. We know that h∗ ∈ H∗. Then there exists household ha ∈ H∗ such that we have the following cycle:

aPh∗ϕNADAI(h∗), ϕNADAI(h∗)Phaa = ϕANDAI(ha) and ϕA(ha) = ϕANDAI(h∗) = a∗.

This cycle arises during the last iteration of the NDAI algorithm because there exist households ha

and

h
β

that

are

tentatively

assigned

to

(a,

j

)

and

(ϕNADAI(h∗), i

)

at

Steps

ta,

tβ,

respectively,

but

are

rejected in later steps. We analyse the next cases

133

Case I. Suppose that i = i∗ = j = j∗. Since µ is fair for households of the same type, previous cycle implies that assignment µNDAI is not fair for households of the same type. Case II. Otherwise. Without loss of generality, consider that ta < tβ. We conclude that institution j is a type 1 interrupter of (h∗, a, i). This is a contradiction because there is no interrupters at iteration x∗. Analogously for larger cycles. In any case we get a contradiction by assuming that µNDAI is Pareto dominated.

To prove the strategy-proofness, we need the following concepts.

Deﬁnition 20. Consider that Rh is the true preference list of each household h. A dropping strategy is a preference list Rh such that

1. Rh preserves the order of the true preference list. Thus, aRhb =⇒ aRhb, and
2. All unacceptable apartments under Rh are also unacceptable under Rh. So, ∅Rha =⇒ ∅Rha, for all a, b ∈ A.

For each apartment a, let Rah be the dropping strategy where all the apartments preferred to a under Rh are declared unacceptable, i.e. if bPha then ∅Rhab. As Kojima and Pathak (2009), we have that dropping strategies are exhaustive, that is to say, every possible apartment for a household h can be
gotten through a dropping strategy, when other preference list remain unchanged.

Lemma 4.5.1. (Dropping strategies are exhaustive) Fix a household h. Suppose that h reports R¯h and other households preference proﬁle is R¯−h. Also, consider that ϕ[R¯](h) = (a, i). Then ϕA[RahR¯−h](h) = a = ϕA[R¯](h), for all R¯h ∈ ℜh.

Proof. We proceed by contradiction, suppose that ϕa[Rha, R¯−h](h) = a. Consider x∗ the last iteration of the mechanism with the proﬁle (Rah, R¯−h). By assumption, household h was rejected from a at some Step t ≥ 1 during the NDA phase at Stage x∗.1. Consequently, there exists a household h such that ϕ[Rha, R¯−h](h ) = (a, j). We have the following cases:

Case I. If j = i, the allocation ϕ[Rha, R¯−h](h ) = (a, j) implies that h

i a

h.

On

the

other

hand,

we

know that each household of type i makes an offer to apartment a during the last iteration

134

because there is no interrupter institutions. Since ϕa[R¯](h) = a, we conclude that h

i a

h.

We

get a contradiction.

Case II. If j = i, we know that h was rejected from a at some Step tha ≥ 1, then jπai because ϕ[Rah, R¯−h](h ) = (a, j) and a ∈ θ[R¯](i), institution i prefers assign a by the mixite´ condition. In other words, is not possible that i does not assign a to h by quota restrictions. On the other hand, the output of the NDAI[Rah, R¯−h] procedure also satisﬁes the mixite´ condition. Consequently there exists an apartment b such that

b = θ[Rha, R¯−h]( j) and b ∈ θ[R¯]( j),

in words, the apartment a displaced the apartment b from institution j. Moreover, other house-

holds do not change their preference lists, then a, b ∈ Atj and #Atj > q j at some Step t during

the last NDA phase under the proﬁle (Rah, R¯−h). We have that a

j A

b

because

ϕ[Rha,

R¯−h](h

)

=

(a, j). However, a ∈/ θ[R¯]( j) although h ∈ Hajth at some step th . Since there is no interrupter

institutions at last NDA[R¯] iteration, we conclude that iπa j. This is a contradiction with jπai.

In any case we get a contradiction by assuming that ϕa[Rah, R¯−h](h) = a. Strategy Proofness. Let R−h ∈ ℜ−h. and ϕNADAI[Rh, R−h](h) = ash Since dropping strategies are

exhaustive, we will show that h cannot get an apartment with a higher rank that ash, i.e., there is no strategy Rh such that ϕNADAI[Rh, R−h](h) = arh for all r = 1, 2, . . . , s − 1. We proceed by induction over s, the rank of ϕANDAI[Rh, R−h](h). Induction Base. For s = 1, we have that ϕANDAI[Rh, R−h](h) = ash is the most preferred apartment of

h. Therefore, h cannot get a better apartment.

If s = 2, during the NDA phase at Stage x∗.1 we have that household h was rejected from her most

preferred apartment because. 1) there exists household h such that ϕNDAI(h ) = (a1h, i) and h

i a

h,

2)

apartment a1h is assigned by an institution jπa1h i, for all i ∈ τ(h) or 3) (h, a1h, i) is a type 1 interrupter triad for some i ∈ τ(h).Therefore, h cannot get her most preferred apartment.

If s = 3, it is clear that h cannot get her most preferred apartments by the same reasons exposed in

previous case.. Now, we show that apartment a2h is not possible for h when R−h is ﬁxed. We proceed by contradiction, suppose that a2h is possible. First, we know that ϕANDAI[Rh, R−h](h) = a2h, there

135

exists h such that ϕANDAI[Rh, R−h](h ) = a2h. This implies that h does not get a1h by one of the same

reasons that h. Since in the last iteration there is no interrupter institutions and other households

report the same preference list, we have that h ∈ Hait2h , h ∈ Haj2th at some Steps t, t respectively. Then

a2h is assigned to h because: jπa2h i or h

i a2h

h.

On the other hand, if a2h is possible for h, the exhaustiveness of dropping strategies implies that ϕNADAI[Rha2h , R−h](h) = a2h. Hence, there exist Steps t, t at Stage x∗.1 of the NDA[Rah2h , R−h] such that

h ∈ Hait2h , h ∈ Haj2th . Then a2h is assigned to h because: iπa2h j or h

i a2h

h

.

We

get

a

contradiction

in

any case.

Hypothesis of Induction. If ϕANDAI[Rh, R−h](h) = anh, then apartments arh are not possible for h, for

all r ∈ {1, 2, . . . , n − 1}.

Induction Step. For s = n + 1, we have to prove that apartments arh are not possible for h, for all r ∈ {1, 2, . . . , n}. We proceed by contradiction, i.e., suppose that apartment arh∗ is possible for some r∗ ∈ {1, 2, . . . , n}. By the induction hypothesis, we have that apartments arh are not possible for h for all r ∈ {1, 2, ..., r∗ − 1}. Analogously to the case s = 3, we get a contradiction because ϕANDAI[Rh, R−h](h) = arh∗. Then, household h cannot get an apartment preferred to ϕA[Rh, R−h](h), for all ﬁxed proﬁle R−h. Therefore, the NDAI mechanism is strategy-proof.

Suppose that an assignment that satisﬁes mixite´ sociale does not exist. During the last iteration of the NDAI, we have that #Chti < qi for all step t of the NDA phase. Consequently, the assignment µNDAI is fair for the same type because in the last step there are not interrupters, and each institution assigns an apartment according to {Chti}tN. Suppose that mixite´ sociale and fairness for the same type are not compatible We proceed anal-

ogously to the proof of mixite´ sociale. Justify envy arises because the algorithm is forced by type

2 interrupters to reach mixite´ sociale even if the household in the interrupting triad does not get the same apartment. Moreover, if we assume that µNDAI is Pareto dominated by a mixite´ assignment, then

we ﬁnd interrupters during the last iteration of the NDAI algorithm.

Therefore, the interrupters of the NDAI algorithm can determine the compatibility between fairness

for the same type and mixite´ sociale.

136

Previous theorem establishes that the assignment µNDAI is fair for the same type and satisﬁes the mixite´ condition in markets where these two concepts are compatible. However, we can not generalize the existence of such assignments for all markets. Even more, there are markets where an assignment that satisﬁes mixite´ does not exist. The following section focuses on these problems.

4.6 Existence issues

It is important to recall that a fair for the same type assignment that respects the mixite´ condition does not always exists.

Example 4.6.1. Consider a subsidized market such that H = {h1, h2}, I = {i1, i2} and A = {a1, a2}. The type function is described by τ−1(i1) = τ−1(i2) = {h1, h2}. Households preferences and institu-

tions priorities are





Ph1 Ph2

 i1
A

ai11

ia12

i2 A

ai21

ai22 









P= 

a2

a2

 

and

= 

a2

h1

h1

a2

h1

h1

. 









a1 a1

a1 h2

a1 h2

The priorities of apartments over institutions are πa1 = πa2 : i1, i2.

Note that the only individually rational assignments that satisﬁes the mixite´ condition are

 h1



µ

=

 

a1



i1

 h2

 h1





a2

 

and µ

= 

a1





i2

i2

 h2



a2

. 



i1

In both cases, we have that

a2Ph1a1 and h1

ij a2

h2,

for

all

j

=

1, 2.

So, household h1 has justify envy over the household of the same type h2.

4.6.1 Analysis of Mixite´
Mixite´ sociale is not guaranteed An assignment that respects mixite´ does not always exists.
137

Example 4.6.2. Let H = {h1, h2, h3}, A = {a1, a2, a3} and I = {1, 2}. The type function is described as follows τ−1(1) = {h1, h2, h3} and τ−1(2) = {h1}. The quotas are q1 = 2 and q2 = 1. The institutions priorities are









11

1

1

A


a1

a2

a3 

11

1

1

A


a1

a2

a3 









 a1 h1 h1 h1 

 a1 h1 h1 h1 

1=

 

 and 

 2

. 

 

a2

h2

 

 

a2

 









a3 h3

a3

Since h1 is the unique household of type 2, in order to satisfy the mixite´ condition, we have that ϕI(h1) for all assignment µ. So, h2, h3 must be assigned through institution 1. This condition generates a non-individually rational assignment because ∅ aj h2, h3 for all j ∈ {1, 2}. Therefore, in this market it does not exist an IR assignment that respects the mixite´ condition.

The NDAI and the existence of mixite´ sociale The NDAI algorithm is also useful to identity the compatibility between fairness for the same type and mixite´ sociale. According to Theorem 4.5.1 we have that
1. Mixite´ sociale and fairness for the same type are compatible if during the last iteration of the NDAI algorithm there is no interrupters,
2. Suppose that a mixite´ sociale assignment exists. Fairness for the same type and mixite´ sociale are not compatible if during the last iteration of the NDAI there are type 2 interrupters, and
3. An assignment that satisﬁes mixite´ sociale does not exist if some institution never reaches its quota in the last iteration.

A condition for the existence of mixite´ sociale A hyper-graph Yˆ is an ordered pair Yˆ = (V [Yˆ ], HE[Yˆ ]) where V [Yˆ ] is the set of nodes; and HE[Yˆ ] is the set of hyper-edges eˆ ⊆ V [Yˆ ]. Considering a subsidized housing market ℵ = (I, H, τ, D, Q, A, δ, P, , π), let Hai = {h ∈ H | aPh∅ and i ∈
138

τ(h)} be the households of type i that prefers the apartment a to remain unassigned. With this information, we can infer a demand matrix.

Deﬁnition

21.

A

demand

matrix

is

a

matrix

D

=

(∆αβ)

such

that

∆αβ

=

Hα
β

where

α

∈

I

and

β

∈

A.

Since I ∩A = ∅ and institutions are not interested in other institutions, the demand matrix is in fact the matrix of adjacency3 of a bipartite hyper-graph. Formally, the bipartite hyper-graph induced by ℵ is a hyper-graph Y = (V [Y ], HE[Y ]) where the set of nodes is V [Y ] = I ∪ A, and the set of hyper-edges HE[Y ] is a subset of ∪i∈I2{i}×A. We say that eˆ ∈ HE[Y ] is a hyper-edge if it satisﬁes the following two conditions:

1. eˆ ⊆ {i} × A, so |eˆ ∩ I| = 1, and

2. Hai = ∅ for all (i, a) ∈ eˆ.
Condition (1) says that hyper-edges must not contain more than one institution. Condition (2) is about the relation between an institution and an apartment; that is to say, the institution i is interested in the apartment a, both nodes in the same hyper-edge, if some household of type i demands the apartment a. A subset C ⊆ HE[Y ] is a matching if no pair of hyper-edges in C has nodes in common. A node v ∈ V [Y ] is covered by the matching C if v is element of a pair in some hyper-edge of C. An institution i ﬁlls its quota whenever it is covered by a hyper-edge eˆ with cardinality qi. A matching is perfect if it covers all the nodes in the bipartite hyper-graph Y . Consider S ⊆ V [Y ], the neighbourhood of S is the set NY (S) = {v ∈ V [Y ] | if there exist eˆ ∈ HE[Y ] that covers v and an element s ∈ S, s = v}. We say that x is a neighbour of y if there exists a hyper-edge eˆ that covers x and y. Since we do not consider the existence of loops4, a single node is not its own neighbour. Therefore, S is not necessarily a subset of it neighbourhood.

Example 4.6.3. Consider the hyper-graph Y with nodes V [Y ] = {i, j} ∪ {a1, a2, a3, a4, a5} and hyper-
edges HE[Y ] = {eˆ1, eˆ2} where eˆ1 = {(i, a1), (i, a2), (i, a3)} and eˆ2 = {( j, a4), ( j, a5)}. Now, let S1 =
3Consider x, y nodes in V [Yˆ ], the matrix of adjacency is a matrix (axy) such that axy = ∅ if and only if there is a hyper-edge that contains x and y.
4For a node v ∈ V [Y ], a loop is the hyper-edge eˆ = {(v, v)}.

139

{i, a2} and S2 = {i, j}. The corresponding neighbourhoods are

NY (S1) = {i, a1, a2, a3} and NY [S2] = {a1, a2, . . . , a5}.

Note that S1 ⊆ NY (S1) and S2 NY (S2). The following example shows the construction of a bipartite hyper-graph.

Example 4.6.4. Consider the market H = {h1, h2, h3, h4, h5}, I = {1, 2, 3} and A = {a1, a2, a3, a4}. The type function is described by τ−1(1) = {h1, h2}, τ−1(2) = {h3, h4} and τ−1(3) = {h3, h5}. Households preferences are the following





Ph1 Ph2 Ph3 Ph4 Ph5









 a1 a2 a4 a3 a1 

P=

.





 

a2

a3

a2

a4

a3

 





a3 a4 a1 a1 a4

The corresponding demand matrix is:


  1 D=  2  
3

a1 h1 h3, h4 h3, h5

a2 h1, h2
h2 ∅

a3 h1, h2
h3 h3, h5



a4 



h2

 .



h3, h4

 

 h3, h5

Consequently, an hyper-graph is V = I ∪ A and HE = {eˆ1, eˆ2, eˆ3, eˆ4} where

eˆ1 = {(1, a1), (1, a4)} eˆ2 = {(1, a1), (1, a2), (1, a3), (1, a4)} eˆ3 = {(2, a1), (2, a2), (2, a4)} eˆ4 = {(3, a1), (3, a3)}.

Previous hyper-graph is represented in the Figure 4.1.

Observation 4.6.1. In the previous example, all hyper-edges have a1 as a common node and only a1. Therefore there is no matching with cardinality more than 1. So, each hyper-edge is a matching.

140

Figure 4.1: The institutions and apartments are represented by a node. The hyper-edges are illustrated as a
box with its corresponding nodes.
Now, ﬁnding an assignment that satisﬁes the mixite´ condition is equivalent to ﬁnding a matching 1. that covers all the nodes in V [Y ] ∩ I, and 2. such that the cardinality of the hyper-edge eˆ that covers each i is equal to qi + 1. Our objective is ﬁnding a condition that guarantees the existence of a matching with cardinality I.
Recall that a bipartite hyper-graph includes hyper-edges of all cardinalities. Then, perfect matchings in a bipartite hypergraph cover all the institutions, but cannot satisfy the mixite´ condition. In order to avoid this problem, we focus our attention on a speciﬁc bipartite hyper-graph.
Deﬁnition 22. Considering a subsidized housing problem (I, H, τ, D, Q, A, δ, P, , π), a subsidized housing hyper-graph ∆ is an ordered pair (V [∆], E[∆]) such that V [∆] = I ∪ A is the set of nodes, and the set of hyper-edges is E[∆] = {eˆ ⊆ ∪i∈I2{i}×A | #(eˆ ∩ A) = qi if i ∈ eˆ}.
Remark 1. The subsidized hyper-graph does not always exist. For example, consider a market with only one institution, three households and two apartments. If an apartment is not acceptable for all the households, all the hyper-edges in the induced hyper-graph cover the institution and the acceptable apartment. So, there are no hyper-edges such that #(eˆ ∩ A) = 2, that is to say, the subsidized hypergraph does not exist. Moreover, the mixite´ condition is never reached.
141

We need some condition over the size of the market to guarantee the existence of hyper-edges that cover the quota of each institution.

A subsidized housing market satisﬁes the hyper-edge condition if for all apartments b = a, there exists a household hai ∈ Hai such that hia ∈/ Hbi .
Proposition 4.6.1. If a subsidized housing market satisﬁes the hyper-edge condition, then the subsidized hyper-graph exists.

Proof. For each institution i, we have to prove the existence of at least one hyper-edge eˆ such that

i ∈ eˆ and #(eˆ ∩ A) = qi.

Consider an apartment a and an institution i. Since the market satisﬁes the hyper-edge condition,

there exists a household hia ∈ Hai such that hai ∈/ Hbi for all b = a. In other words, Hai ∩ Hbi = ∅ for all

a = b, there exists ha ∈ Hai such that ha ∈ Hai and ha ∈/ Hbi for all apartment b = a. Moreover, it is clear

that Hai = ∅. Consequently, all the apartments are demanded by the institution i. Therefore, there

exist

|A|! (|A|−qi)!q!

hyper-edges

eˆ

that

covers

institution

i

and

#(eˆ ∩ A)

=

qi.

That

is

to

say,

the

subsidized

hyper-graph exists.

For simple graphs, the Hall’s theorem5 establishes a necessary and sufﬁcient condition to guarantee the existence of a perfect matching in simple bipartite graphs. The generalization of the Hall’s Theorem for hyper-graphs remains as an open question. However, there exist sufﬁcient, but not necessary, conditions that determine the existence of a perfect matching in a hyper-graph.
A transversal is a subset T ⊆ V with the property that E ∩ T = ∅ for all E ⊆ HE. We denote by η[Y ] the maximum cardinality of a matching in Y , and τ[Y ] the maximum cardinality of a transversal of Y .

Remark 2. Let r ≥ 2. A bipartite hyper-graph satisﬁes the Haxell’s condition if |eˆ ∩ I| = 1 and |eˆ ∩ A| ≤ r − 1 for all eˆ ∈ HE.
5Hall’s Theorem. Consider a bipartite hyper-graph Y such that |eˆ| = 1 for all eˆ ∈ E[Y ]. A perfect matching exists if and only if #S ≤ NY (S) for all S ⊆ N[Y ].

142

It is important to note that subsidized hyper-graphs satisﬁes the Haxell’s condition by deﬁnition: an hyper-edge eˆ is a subset of {i} × A for some i ∈ I and its cardinality is equal to qi. So, |eˆ ∩ I| = 1 and |eˆ ∩ A| ≤ q∗ + 1 − 1 for all eˆ ∈ HE, where q∗ is the highest quota.
Theorem 4.6.1. If Y = (V, HE) is a subsidized hyper-graph that satisﬁes the hyper-edge condition and τ(YC) > (2r − 3)(|C| − 1) for every C ⊆ I, then a perfect matching exists. Proof. This is the application of Theorem 3 in Haxell (1995) for subsidized hyper-graphs.
Previous theorem ensures the existence of a permutation of apartments such that each institution i is assigned qi apartments. However, we have not solved the subsidized housing problem. We need to ensure the existence of enough households to be assigned one apartment from one and only one institution. A subsidized market satisﬁes the labelled condition if there exists a household hai ∈ Hai such that hai ∈/ Hbj for all apartments b ∈ A and j = i. Therefore, to guarantee the existence of at least one assignment that satisﬁes mixite´, a subsidized housing market must satisfy the following condition. A subsidized housing market satisﬁes Mixite´ Existence Condition if there exists hai ∈ Hai such that
1. hai ∈/ Hbi for all apartment b = a., 2. hia ∈/ Haj for all a ∈ A and j ∈ I \ {i}, and 3. τ(YC) > (2q∗ − 3)(|C| − 1) for every C ⊆ I, where Y in the correspondent subsidized hyper-
graph.
The subsidized housing market described in Example 4.3.1 does not satisfy the Mixite´ Existence Condition because τ1(1) = {h2} and h2 ∈ τ−1(1). That is to say Ha1 ∩ Ha2 = ∅.
143

4.6.2 Analysis of Fairness
We can ensure the existence of at least one fair for the same type assignment.

Proposition 4.6.2. There always exist at least one fair for the same type assignment.

Proof. Randomly, we can choose a matching θ between institutions and apartments such that no apartment remains unassigned. Then, as in a School Choice problem, we run the following Deferred Acceptance algorithm: For each household h, consider Ah = {a ∈ A : θ−1(a) ∈ τ(h)}. Step 1. Each household demands her most preferred apartment in Ah. Among the households that demand each apartment a, the pairs (θ−1(a), a) tentatively accept the highest priority household under
aθ−1(a). The pair rejects the other households. Step t. Each household that was rejected in the previous step demands her most preferred apartment in Ah that has not rejected her. Among the households that demand each apartment a and the households tentatively accepted in the previous step, the pairs (θ−1(a), a) tentatively accept the highest priority household under θa−1(a). The pair rejects the other households. The assignment produced by previous procedure in denote by µSDA. For some household h, suppose the existence of a household h such that

ϕA(h )PhϕA(h) and ϕI(h ) ∈ τ(h).

By construction of the algorithm, the households h and h demand the apartment ϕA(h ) in some steps t, t ∈ N. Without loss of generality, we assume that t < t . Consequently, the institution θ−1(a) assigns the apartment a to the highest household under θa−1(a). Thus, we conclude that

h

θ−1 a

h.

Therefore, µSDA is a fair for the same type assignment.

The existence of interrupters induces loss in fairness.

Proposition 4.6.3. If there are not interrupters, the µNDAI is fair.

144

Proof. We proceed by contradiction. Consider the existence of a blocking pair triad (h, a, i) such that

1. aPhϕANDA(h),

2. a

i A

b,

form

some

b

∈

θNDA(i),

3. iπa(θNDA)−1(a), or i = (θNDA)−1(a),

4. h

i a

∅,

or

h

i a

ϕ−1(a,

i).

Case I. If a = b, we have that a ∈ θ(i). By construction of the NDAI, we know that

(ϕt (a,

i))−1

=

max i

Hait

a

for all t ∈ {1, . . . ,tlast}. Moreover, the apartment a is acceptable for household h and i ∈ τ(h), so there exists step t∗ such that h ∈ Hait∗. Since ϕ(h) = (i, a), we conclude that

ϕ−1(a, i)

i a

h.

Since there is no Type 1 interrupters, previous paragraph induces a contradiction because h

i a

ϕ−1(a, i).

Case II. If a = b, since aPh∅ and i ∈ τ(h), there exists step t∗ such that

h ∈ Hait∗ and a ∈ Ati∗.

Moreover, a ∈ θ( j), for some institution j = i, because a ∈/ θ(i). By construction of the NDAI algorithm, in some step t ≥ t∗ we have that

a ∈ Chi(Ati , Ai ) ∩Ch j(A j, Aj ).

This implies that jπai,
which is a contradiction because we assume that iπaθ−1(a) = j and there are not type 2 interrupters. In any case the contradiction arises because we assume the existence of a blocking triad. Therefore, the assignment µNDAI is fair.

Conversely statement is not always true, that is to say, there are interrupters even if the µNDAI is fair.

145

Example 4.6.5. Let H = {h1, h2}, I = {1, 2} and A = {a1, a2}. Households preferences are



Ph1



P= 

a1



a2



Ph2



a1

. 



a2

The type function is described by τ−1(1) = {h1, h2} and τ−1(2) = {h2}. The institutions quotas are q1 = q2 = 1, and priorities institutions are









11

1

22

2

A a1 a2

A

a1

a2









1=  

a2

h1

h2

 and 

2=  

a2

h2

h2

. 









a1 h2 h1

a1

Finally, we assume the following apartments priorities πa1 = πa2 : 1, 2.

Running the NDAI algorithm, in ﬁrst step of the NDA phase we have that

Ha111 = {h1, h2}, Ha211 = {h2}, and Ha121 = Ha221 = ∅.

Since 1πa12, we tentatively get the triad

(h1, a1, 1).

Consequently, household h2 is rejected from apartment a1.

At second step, households that demand an apartment, according to its type, are

Ha112 = {h1}, Ha212 = ∅, and Ha122 = Ha221 = {h2}.

Since a2

1 A

a1,

household

h1

is

rejected.

The

tentatively

triad

is

(h2, a2, 1).

At step 3, after eliciting households demand, we have that Ha113 = Ha213 = ∅, Ha123 = {h1, h2} and Ha223 = {h2}.

146

Since 1πa22 and h2

1 a2

h1,

the

ﬁnal

assignment

in

the

ﬁrst

NDA

stage

is

 h1



µN1 DA

=

 

∅



∅

 h2



a2

. 



1

Previous assignment does not satisfy the mixite´ condition. Moreover, institution 2 can assign apart-

ment a2 to household h2. Therefore, (h2, a2, 1) is a type 2 interrupter triad. Consequently, we actualize

institutions priorities

2A1=

20 A

\a2,

A11=

10 A

.

Running a second round of the NDA phase with priorities 1= ( 11, 21), the ﬁnal assignment is

 h1



µNDA2

= 

a1



1

 h2



a2

 = µNDAI. 



2

Also, note that µNDAI is fair and satisﬁes the mixite´ condition, even in the presence of type 2 interrupters.

4.7 Concluding Remarks
We model the subsidized housing problem in Paris as a three sided market. Speciﬁcally, we assume that institutions have priorities over the total pool of subsidized apartments, and apartments have priorities over the set of institutions. However, both assumptions are not formalized in the real problem and can be not necessary. We would like to investigate if a fair for the same type assignment that respects mixite´ sociale exists in a simpler model that do not consider these priorities.

147

References
[1 ] A. ABDULKADIROGLU. College admission with afﬁrmative action. Discussion paper Columbia University, 2003.
[2 ] A. ABDULKADIROGLU AND T. SONMEZ. School choice: A design mechanism approach. American Economic Review, 93(3):729-747, 2003.
[3 ] P. BIRO´ AND E. MCDERMIND. Three-sided stable matching with cyclic preference and the kidney exchange problem. Algorithmica, 58:5-18, 2010.
[4 ] Y. BLUM, A. E. ROTH, AND U. G. ROTHBLUM. Vacancy chains and equilibration in senior-level labor markets. Journal of Economic Theory, 76:362-411, 1997.
[5 ] D. CANTALA. Re-stabilizing matching markets at senior level. Games and Economic Behavior, 48(1):117, 2004.
[6 ] F. ECHENIQUE AND M. B. YENMEZ. How to control controlled school choice. Caltech and Carnegie Mellon Working Paper, 2013.
[7 ] L. EHLERS. School choice with control. CIREQ, cahier, 13, 2010. [8 ] L. EHLERS, I. E. HAFALIR, M. B. YENMEZ, AND M. A. YILDIRIM. School choice with controlled
choice constraints: Hard bonus versus soft bonus. Working Paper, 2012. [9 ] A. ERDIL AND T. KUMANO. Prioritizing diversity in school choice. Working Paper, 2013. [10 ] H. I. ERGIN. Efﬁcient resource allocation on the basis priorities. Econometrica, (6):2487-2489, 2002. [11 ] D. GALE AND L. SHAPLEY. College admision and the stability of marriage. American Mathematical
Monthly, 69(1):9-15, 1962. [12 ] I. E. HAFALIR, M. B. YENMEZ, AND M. A. YILDIRIM. Effective afﬁrmative action in school choice.
Working Paper, 2011. [13 ] P. E. HAXELL. A condition for matchability in hyper-graphs. Graphs and Combinatorics, 1(3), pages
245-248, 1995.
148

[14 ] A. D.-C. HUANG. Two’s company three’s a crowd: Stable families and threesome roommate problems. Algorithms-ESA, pages 558-569, 2007.
[15 ] D. E. KNUTH. Marriages stables et leurs relations avec d’autre proble´mes. Les Presses del universite´ de Montre´al., 2014.
[16 ] O. KESTEN. School Choice with Consent. Quarterly Journal of Economics 125, 1297-1348, 2010. [17 ] O. KESSLER. Matching in Hyper-graphs. Dsc thesis, Technion, 1989. [18 ] A.E. ROTH AND M. SOTOMAYOR. Two-Sided Matching: A Study on Game-Theoretic Modelling.
Cambridge University Press, 1990.
149

List of Figures
2.1 Quasi-Bipartite Graph 1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 16 2.2 Examples of Top Trading Covers . . . . . . . . . . . . . . . . . . . . . . . . . . . . 16 2.3 TTCo algorithm 1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 19 2.4 TTCo algorithm 2 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 20 2.5 Non-wasteful assignments and the Rural Hospital Theorem . . . . . . . . . . . . . . 36 2.6 TTCo algorithm is manipulable . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 52 3.1 Step 1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 73 3.2 Step 2 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 73 3.3 Step 3 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 74 3.4 Quasi-Bipartite Graph 2 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 96 3.5 Examples of Top Trading Covers . . . . . . . . . . . . . . . . . . . . . . . . . . . . 97 4.1 Example of a hyper-graph . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 141
150

